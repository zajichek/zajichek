<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Zajichek Stats</title>
<link>https://www.zajichekstats.com/</link>
<atom:link href="https://www.zajichekstats.com/index.xml" rel="self" type="application/rss+xml"/>
<description>Statistician/data scientist in Central Wisconsin.</description>
<generator>quarto-1.5.57</generator>
<lastBuildDate>Wed, 23 Apr 2025 05:00:00 GMT</lastBuildDate>
<item>
  <title>What decision are we trying to make, anyway?</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/what-decision-are-we-trying-to-make/</link>
  <description><![CDATA[ 




<p>Everyone acknowledges, or even agrees with, the issues and limitations of <a href="https://www.ncbi.nlm.nih.gov/books/NBK459346/#:~:text=A%20study%20is%20statistically%20significant,not%20a%20statistically%20significant%20result.">statistical significance</a> (which I previously wrote about <a href="https://www.zajichekstats.com/post/statistical-significance-is-insignificant/">here</a>): the effect size is ignored, you’ll get it with a really large sample, it doesn’t account for practical importance, and so on…</p>
<p>Yet it is still used all the time, and life goes on. People debate these nuances back and forth as to when and where it is or isn’t valid, etc. But just recently in a <a href="https://www.linkedin.com/feed/update/urn:li:activity:7319500623299653633?commentUrn=urn%3Ali%3Acomment%3A%28activity%3A7319500623299653633%2C7319674842163621888%29&amp;dashCommentUrn=urn%3Ali%3Afsd_comment%3A%287319674842163621888%2Curn%3Ali%3Aactivity%3A7319500623299653633%29">conversation on LinkedIn</a>, I had a realization of the fundamental reason on why it is an issue, and why there are many <a href="https://www.tandfonline.com/doi/full/10.1080/00031305.2016.1154108#d1e167">calls to ban</a> p-values and statistical significance entirely.</p>
<blockquote class="blockquote">
<p>“Except experimental field, like randomized clinical trials, where both statistical and practical significance are necessary and when combined, answer the question of interest.”</p>
</blockquote>
<p>It’s <em>not</em> that a p-value, or statistical significance itself even, is inherently bad or wrong. <strong>It <em>all</em> has to do exclusively with how they are used, interpreted, implemented, and implicated.</strong></p>
<p>Take <a href="https://www.linkedin.com/posts/adrianolszewski_how-to-combine-statistical-discernibility-activity-7310365190959632384-sNHs?utm_source=share&amp;utm_medium=member_desktop&amp;rcm=ACoAACwA1gEB29rAFO327bVy4fMmOqVeTbmsXA8">this point from Adrian Olszewski’s post</a> (which was cited in the conversation above) talking about using statistical significance in combination with practical importance, but in a mathematically formal manner.</p>
<p>The key quote here is:</p>
<blockquote class="blockquote">
<p>“We all make BINARY decisions every day, based on some criteria.”</p>
</blockquote>
<p>And from this supporting image:</p>
<p><img src="https://www.zajichekstats.com/post/what-decision-are-we-trying-to-make/adrian.png" class="img-fluid"></p>
<blockquote class="blockquote">
<p>“Thresholds are essential in binary decision making in experimental studies…”</p>
</blockquote>
<p>All of that is well and good, and sure, makes sense if statistical significance helps you solve a problem in that way. But the main thing that stuck out to me was the emphasis on <em>decisions</em>.</p>
<p><strong>THIS</strong> is exactly the problem with statistical significance.</p>
<p>We use it to declare there is or isn’t an effect of some sort, therefore implicating decision X, Y, or Z. But in many (or most) cases, it is only a <em>guise</em> of a decision actually being made. Think about it: in a typical academic publication, they collect data, run some statistical modeling and/or tests, and get a p-value. The “decision” being made amounts to writing the words <em>“there was a significant difference”</em> on a page in some boilerplate fashion, not an actual action being taken. Where’s the decision?</p>
<p>Sure, you might argue that a published statistical test result could <em>lead</em> to many decisions being made by those consuming the analysis. That’s exactly the point. We have no idea what these decisions are. It is intractable. Those subsequent decisions are not actually related to or reflected in the statistical setup and testing done in the original analysis. We don’t know who is using the results, how they are using them, or what they are using them for. It’s just words on a page.</p>
<p>Contrast this with, say, <a href="https://en.wikipedia.org/wiki/William_Sealy_Gosset">William Sealy Gosset</a> (the inventor of the <a href="https://en.wikipedia.org/wiki/Student%27s_t-test">t-test</a>, and who I <a href="https://www.zajichekstats.com/post/on-the-creation-of-classical-statistics/">wrote about previously</a>), whose primary goal was to brew better beer. His statistical testing methodology, and the use of statistical significance, was directly tailored to the problem at hand and the decisions he was trying to make in order to produce higher quality product. It was tangible. He could <em>see</em> the impact with his own two eyes of using significance testing for decisions he was actually making. And in his case, it provided value. Kind of like the way a tape measure is as useful as the context it is applied and the tolerance needed for making a decision. It’s not just the fact that a tape measure was used that creates its importance, it’s that the information happens to be useful in that situation so subsequent action can be taken.</p>
<p>So when we say statistical significance or p-values should be banned, what we really mean is that they shouldn’t be used the way they are. If we could just find better uses for them, then sure, they can stay. The problem is that incentive structures, education, etc. are poorly designed around these concepts, and they are so deeply ingrained that it’s difficult to dig our way out.</p>


<!-- -->


 ]]></description>
  <category>Philosophy</category>
  <category>Statistical Significance</category>
  <category>Decision Making</category>
  <guid>https://www.zajichekstats.com/post/what-decision-are-we-trying-to-make/</guid>
  <pubDate>Wed, 23 Apr 2025 05:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/what-decision-are-we-trying-to-make/feature.png" medium="image" type="image/png" height="133" width="144"/>
</item>
<item>
  <title>How to reconcile the regression equation from spline terms</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/reconciling-regression-equation-spline-terms/</link>
  <description><![CDATA[ 




<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/HXTjssAYCdw" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>Suppose we want to model blood pressure as a function of age (dataset details found <a href="https://archive.ics.uci.edu/dataset/45/heart+disease">here</a>):</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract the data set</span></span>
<span id="cb1-5">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cheese<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>heart_disease</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb1-8">dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb1-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb1-12">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Age,</span>
<span id="cb1-13">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> BP</span>
<span id="cb1-14">    ),</span>
<span id="cb1-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,</span>
<span id="cb1-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb1-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"brown"</span>,</span>
<span id="cb1-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb1-19">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age (years)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Systolic blood pressure"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb1-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb1-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>),</span>
<span id="cb1-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb1-26">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/reconciling-regression-equation-spline-terms/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It looks like a larger age is associated with a larger blood pressure, on average, so we fit a <a href="https://en.wikipedia.org/wiki/Simple_linear_regression">simple linear regression</a> model:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit the model</span></span>
<span id="cb2-2">mod1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(BP <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Age, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(mod1)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = BP ~ Age, data = dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-38.659 -11.449  -0.904  10.218  67.444 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 101.4851     5.9364  17.095  &lt; 2e-16 ***
Age           0.5548     0.1076   5.157 4.55e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 16.9 on 301 degrees of freedom
Multiple R-squared:  0.08119,   Adjusted R-squared:  0.07814 
F-statistic:  26.6 on 1 and 301 DF,  p-value: 4.547e-07</code></pre>
</div>
</div>
<p>We estimate that for every 10 year increase in age, systolic blood pressure increases by 5.5 mmHg. We can also write out the full regression equation for estimating the blood pressure given a new patient’s age:</p>
<p><img src="https://latex.codecogs.com/png.latex?BP%20=%20101.49%20+%200.56%20%5Ctimes%20Age"></p>
<p>And we can add this to our plot to get a visual.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb4-2">dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb4-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb4-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Age,</span>
<span id="cb4-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> BP</span>
<span id="cb4-8">    ),</span>
<span id="cb4-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,</span>
<span id="cb4-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb4-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"brown"</span>,</span>
<span id="cb4-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb4-13">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_abline</span>(</span>
<span id="cb4-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">slope =</span> mod1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]],</span>
<span id="cb4-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">intercept =</span> mod1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]],</span>
<span id="cb4-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb4-18">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age (years)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Systolic blood pressure"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb4-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb4-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>),</span>
<span id="cb4-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb4-25">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/reconciling-regression-equation-spline-terms/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Simple enough. We can verify our formula works by comparing with the output of the <code>predict</code> function:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb5-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">BP1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(mod1, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> dat),</span>
<span id="cb5-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">BP2 =</span> mod1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mod1<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Age</span>
<span id="cb5-4">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> _, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">near</span>(BP1, BP2))), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"% of fitted values match."</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "100% of fitted values match."</code></pre>
</div>
</div>
<p>As we can see, all of the predictions match, thus we understand exactly how the model works.</p>
<section id="adding-spline-terms" class="level3">
<h3 class="anchored" data-anchor-id="adding-spline-terms">Adding spline terms</h3>
<p>Now suppose from the plot above we argue there may be a nonlinear relationship between age and blood pressure, such that it only slightly increases at lower ages and then accelerates in higher ages. So we choose to use a <a href="https://en.wikipedia.org/wiki/Spline_(mathematics)">restricted cubic spline</a> with 3 knots:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">mod2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(BP <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> rms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rcs</span>(Age, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat)</span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(mod2)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = BP ~ rms::rcs(Age, 3), data = dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-37.817 -11.576  -1.212   9.642  66.782 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           94.8089    11.2104   8.457 1.22e-15 ***
rms::rcs(Age, 3)Age    0.7016     0.2351   2.984  0.00308 ** 
rms::rcs(Age, 3)Age'  -0.1854     0.2640  -0.702  0.48305    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 16.91 on 300 degrees of freedom
Multiple R-squared:  0.0827,    Adjusted R-squared:  0.07659 
F-statistic: 13.52 on 2 and 300 DF,  p-value: 2.38e-06</code></pre>
</div>
</div>
<p>We can see there are now 2 parameters in the model to capture the age effect. We can again plot this to see what it looks like:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb9-2">dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb9-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb9-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Age,</span>
<span id="cb9-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> BP</span>
<span id="cb9-8">    ),</span>
<span id="cb9-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,</span>
<span id="cb9-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>,</span>
<span id="cb9-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"brown"</span>,</span>
<span id="cb9-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb9-13">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(</span>
<span id="cb9-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Age), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Fitted =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(mod2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unique</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Age)))),</span>
<span id="cb9-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb9-17">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Age,</span>
<span id="cb9-18">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Fitted</span>
<span id="cb9-19">    ),</span>
<span id="cb9-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb9-21">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age (years)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Systolic blood pressure"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-24">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb9-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb9-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>),</span>
<span id="cb9-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)</span>
<span id="cb9-28">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/reconciling-regression-equation-spline-terms/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The estimated curve didn’t take the shape of what we suspected (and maybe with more flexibility (i.e., knots), it would), but we’ll run with it anyway.</p>
</section>
<section id="writing-the-regression-equation" class="level3">
<h3 class="anchored" data-anchor-id="writing-the-regression-equation">Writing the regression equation</h3>
<p>The question is: <em>how do we write out the formula for this model such that we input an age (in years) and get a predicted blood pressure?</em></p>
<p>If we did what we did before with <a href="https://en.wikipedia.org/wiki/Simple_linear_regression">simple linear regression</a> and just blindly plug in age to what is given from the model output above, we’d have:</p>
<p><img src="https://latex.codecogs.com/png.latex?BP%20=%2094.8%20+%200.70%20%5Ctimes%20Age%20-%200.19%20%5Ctimes%20Age%20"></p>
<p>Now if we again compare the output of that equation with what the correct fitted values are from the <code>predict</code> function:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Gather set of predicted values</span></span>
<span id="cb10-2">preds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb10-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">BP1 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(mod2, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> dat),</span>
<span id="cb10-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">BP2 =</span> mod2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mod2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mod2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Age</span>
<span id="cb10-6">  )</span>
<span id="cb10-7"></span>
<span id="cb10-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check concordance</span></span>
<span id="cb10-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> preds, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">near</span>(BP1, BP2))), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"% of fitted values match."</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "0% of fitted values match."</code></pre>
</div>
</div>
<p>It turns out <em>none</em> of them are correct. So obviously something is wrong.</p>
</section>
<section id="find-the-knot-locations" class="level3">
<h3 class="anchored" data-anchor-id="find-the-knot-locations">Find the knot locations</h3>
<p>First, we need to figure out what gets inputted into the equation. The coefficient for the second age term in the model output (-0.185) is not multiplied by the raw age value, but rather by some transformation of it.</p>
<p>Specifically, we can <a href="https://www.zajichekstats.com/post/the-evasive-spline/">recall</a> that age on the original scale will be transformed by a truncated power basis <em>at each knot</em>:</p>
<p><img src="https://latex.codecogs.com/png.latex?h(x,%5Cnu)%20=%20(x-%5Cnu)%5E3_+"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Cnu"> is the knot location and <img src="https://latex.codecogs.com/png.latex?+"> means we take <img src="https://latex.codecogs.com/png.latex?(x-%5Cnu)%5E3"> if <img src="https://latex.codecogs.com/png.latex?x%3E%5Cnu"> and 0 otherwise.</p>
<p>In our example, we have 3 knot locations:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract knot locations</span></span>
<span id="cb12-2">knots <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(rms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rcs</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Age, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"parms"</span>)</span>
<span id="cb12-3">knots</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 42 56 66</code></pre>
</div>
</div>
<p>We can verify that these are the <img src="https://latex.codecogs.com/png.latex?10%5E%7Bth%7D">, <img src="https://latex.codecogs.com/png.latex?50%5E%7Bth%7D"> and <img src="https://latex.codecogs.com/png.latex?90%5E%7Bth%7D"> percentiles of the age distribution (which is the default).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quantile</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Age, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>10% 50% 90% 
 42  56  66 </code></pre>
</div>
</div>
<p>Then, we can write out the full transformation for the spline term using the <a href="https://support.sas.com/resources/papers/proceedings16/5621-2016.pdf">formula</a>:</p>
<p><img src="https://latex.codecogs.com/png.latex?X_%7Btrans%7D%20=%20(x-%5Cnu_1)%5E3_+%20-%20%5Cfrac%7B%5Cnu_3%20-%20%5Cnu_1%7D%7B%5Cnu_3%20-%20%5Cnu_2%7D(x-%5Cnu_2)%5E3_+%20+%20%5Cfrac%7B%5Cnu_2%20-%20%5Cnu_1%7D%7B%5Cnu_3%20-%20%5Cnu_2%7D(x-%5Cnu_3)%5E3_+"></p>
<p>Plugging in our quantities, we get:</p>
<p><img src="https://latex.codecogs.com/png.latex?Age_%7Bspline%7D%20=%20(age%20-%2042)%5E3_+%20-%20%5Cfrac%7B66-42%7D%7B66-56%7D(age%20-%2056)%5E3_+%20+%20%5Cfrac%7B56-42%7D%7B66-56%7D(age%20-%2066)%5E3_+"></p>
<p>Ahhh okay. So we need to take our raw age value, first plug it into that formula, and <em>then</em> multiply it by the coefficient from the model’s output. In sloppy notation, something like this:</p>
<p><img src="https://latex.codecogs.com/png.latex?BP%20=%2094.8%20+%200.70%20%5Ctimes%20Age%20-%200.19%20%5Ctimes%20Age_%7Bspline%7D"></p>
<p>So we’ll do that, again comparing with the correct output of the <code>predict</code> function:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the spline value</span></span>
<span id="cb16-2">age_spline <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>((dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> </span>
<span id="cb16-4">  (knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>((dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb16-5">  (knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>((dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Age<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb16-6"></span>
<span id="cb16-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add new calculation</span></span>
<span id="cb16-8">preds<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>BP3 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mod2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mod2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mod2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> age_spline</span>
<span id="cb16-9"></span>
<span id="cb16-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check concordance</span></span>
<span id="cb16-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> preds, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">near</span>(BP1, BP3))), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"% of fitted values match."</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "12% of fitted values match."</code></pre>
</div>
</div>
<p>We’re still having problems. It looks like <em>some</em> of the predictions from our new formula match the correct output, but most don’t.</p>
</section>
<section id="normalizing-the-transformation" class="level3">
<h3 class="anchored" data-anchor-id="normalizing-the-transformation">Normalizing the transformation</h3>
<p>In the <a href="https://www.rdocumentation.org/packages/Hmisc/versions/5.1-3/topics/rcspline.eval"><code>rms::rcs</code> documentation</a>, it states that the default behavior (seen by the <code>norm</code> argument) is to <em>“normalize by the square of the spacing between the first and last knots”</em>. Applying this to our age transformation, our normalization factor is:</p>
<p><img src="https://latex.codecogs.com/png.latex?Norm%20=%20(%5Cnu_3%20-%20%5Cnu_1)%5E2%20=%20(66%20-%2042)%5E2%20=%2024%5E2%20=%20576"></p>
<p>So in finding the basis vectors for the spline term, this value was implicitly multiplied through, causing our apparent equation above to be miscalibrated from the original age scale. To remedy this, we simply need to <em>divide</em> the model coefficient for the spline term (-0.185) by the normalization factor. So our equation becomes:</p>
<p><img src="https://latex.codecogs.com/png.latex?BP%20=%2094.8%20+%200.70%20%5Ctimes%20Age%20-%20%5Cfrac%7B0.19%7D%7BNorm%7D%20%5Ctimes%20Age_%7Bspline%7D"></p>
<p>We can again check to see how this compares to the (correct) output of the <code>predict</code> function:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the normalizing factor</span></span>
<span id="cb18-2">norm_factor <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb18-3"></span>
<span id="cb18-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add new calculation</span></span>
<span id="cb18-5">preds<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>BP4 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> mod2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mod2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> mod2<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> norm_factor <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> age_spline </span>
<span id="cb18-6"></span>
<span id="cb18-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check concordance</span></span>
<span id="cb18-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">with</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> preds, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">near</span>(BP1, BP4))), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"% of fitted values match."</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "100% of fitted values match."</code></pre>
</div>
</div>
<p>Finally, all of our calculated predicted values are correct!</p>
</section>
<section id="the-final-formula" class="level3">
<h3 class="anchored" data-anchor-id="the-final-formula">The final formula</h3>
<p>We already wrote this out above, if you want to piece together the various components, but we’ll do it again here in one fell swoop.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%5Cbegin%7Bsplit%7D%0ABP%20&amp;%20=%2094.8%20+%200.70%20%5Ctimes%20Age%20+%20%5C%5C%0A&amp;%20=%20%5Cfrac%7B-0.19%7D%7B(66-42)%5E2%7D%20%5Ctimes%20%5Cbigg%20(%20%5C%5C%0A&amp;%20=%20(Age%20-%2042)%5E3_+%20-%20%5C%5C%0A&amp;%20=%20%5Cfrac%7B66-42%7D%7B66-56%7D(Age%20-%2056)%5E3_+%20+%20%5C%5C%0A&amp;%20=%20%5Cfrac%7B56-42%7D%7B66-56%7D(Age%20-%2066)%5E3_+%20%5Cbigg%20)%20%5C%5C%0A%5Cend%7Bsplit%7D%0A%5Cend%7Bequation%7D%0A"></p>
<p>Now we have an equation that takes an age value as input (in years) and outputs the predicted systolic blood pressure. Finally, we understand exactly how <em>this</em> model works.</p>
</section>
<section id="why-is-this-useful" class="level2">
<h2 class="anchored" data-anchor-id="why-is-this-useful">Why is this useful?</h2>
<p>First, it’s obviously important to understand how modeling software is getting to the results it gives you, so that you can correctly interpret it, among other things. Second, from a pragmatic point of view, the ability to write out the full regression equation allows you embed your model into any application (even Excel if you wanted), instead of requiring the <code>predict</code> function to be run, which in turn would require <code>R</code> to be a part of the application’s server. In this case, it’s unnecessary for that to be a requirement, since we can simply reconcile our model into an easily understandable equation. Luckily, there are also <a href="https://www.rdocumentation.org/packages/rms/versions/6.8-2/topics/Function">some functions</a> that can extract these formulas for you for this exact purpose so you don’t <em>have</em> to go through the cumbersome calculations above.</p>
    <bluesky-comments post="at://did:plc:sh3av73hihgu72vx7k44kgv7/app.bsky.feed.post/3lbubbyx3v42m" config="{}"></bluesky-comments>
  


<!-- -->

</section>

 ]]></description>
  <category>Regression</category>
  <guid>https://www.zajichekstats.com/post/reconciling-regression-equation-spline-terms/</guid>
  <pubDate>Mon, 25 Nov 2024 06:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/reconciling-regression-equation-spline-terms/feature.png" medium="image" type="image/png" height="152" width="144"/>
</item>
<item>
  <title>Can you have a model without data?</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/can-you-have-a-model-without-data/</link>
  <description><![CDATA[ 




<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/bUerkVsCwtA" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>In <a href="https://en.wikipedia.org/wiki/Frequentist_inference">frequentist</a> statistics, the paradigm in which much of statistical practice is done, has a specific requirement: we need data <em>before</em> we can attribute estimates to (i.e., “fit”) our model. Yes, we might pre-specify it’s form, and be quite confident in what that looks like, but ultimately before we get an answer, we need the data.</p>
<p>For example, suppose we are interested in the proportion of individuals with heart disease. We can specify an assumed model:</p>
<p><img src="https://latex.codecogs.com/png.latex?X%20%5Csim%20Bernoulli(p)"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?X%20%5Cin%20%5C%7B0,1%5C%7D"> and <img src="https://latex.codecogs.com/png.latex?p%20%5Cin%20%5B0,1%5D">.</p>
<p>That is, we assume that whether an individual has heart disease is a coin flip with probability <img src="https://latex.codecogs.com/png.latex?p">. Our goal is to estimate what <img src="https://latex.codecogs.com/png.latex?p"> is.</p>
<p>We plan to use the <a href="https://en.wikipedia.org/wiki/Population_proportion">typical approach</a> for estimating a population proportion such that:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Chat%7Bp%7D%20=%20%5Cfrac%7B%5Csum_%7Bi=1%7D%5Enx_i%7D%7Bn%7D%20%5Chskip.2in%20Var(%5Chat%7Bp%7D)%20=%20%5Cfrac%7B%5Chat%7Bp%7D(1-%5Chat%7Bp%7D)%7D%7Bn%7D"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?x_i"> is the indicator of whether or not individual <img src="https://latex.codecogs.com/png.latex?i"> in the sample has heart disease, and <img src="https://latex.codecogs.com/png.latex?n"> is the total number of individuals in the sample. That is, we take the average, or sample proportion. The variance provides a window of uncertainty in our estimate.</p>
<p>Okay let’s do it.</p>
<p>But wait, in order for us to get a numerical quantity to work with, we need data to plug into these equations. <em>That is the point</em>. Our model in this paradigm becomes <em>data</em> focused, such that a sample is required. And a large enough one at that.</p>
<p><em>Our model of the world is completely dependent on collecting and entering a sample into the estimators, despite what we may already know about heart disease rates. Thus, it is only informed by the data at hand.</em></p>
<p>Okay, fine. So we find a dataset related to heart disease:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cheese<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>heart_disease</span>
<span id="cb1-2">dat</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 303 × 9
     Age Sex    ChestPain           BP Cholesterol BloodSugar MaximumHR
   &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;            &lt;dbl&gt;       &lt;dbl&gt; &lt;lgl&gt;          &lt;dbl&gt;
 1    63 Male   Typical angina     145         233 TRUE             150
 2    67 Male   Asymptomatic       160         286 FALSE            108
 3    67 Male   Asymptomatic       120         229 FALSE            129
 4    37 Male   Non-anginal pain   130         250 FALSE            187
 5    41 Female Atypical angina    130         204 FALSE            172
 6    56 Male   Atypical angina    120         236 FALSE            178
 7    62 Female Asymptomatic       140         268 FALSE            160
 8    57 Female Asymptomatic       120         354 FALSE            163
 9    63 Male   Asymptomatic       130         254 FALSE            147
10    53 Male   Asymptomatic       140         203 TRUE             155
# ℹ 293 more rows
# ℹ 2 more variables: ExerciseInducedAngina &lt;fct&gt;, HeartDisease &lt;fct&gt;</code></pre>
</div>
</div>
<p>And we plug our estimates into the formulas and get our result:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sample proportion</span></span>
<span id="cb3-2">p_hat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>HeartDisease <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yes"</span>)</span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sample size</span></span>
<span id="cb3-5">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat)</span>
<span id="cb3-6"></span>
<span id="cb3-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Standard error</span></span>
<span id="cb3-8">se <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>((p_hat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p_hat)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n)</span>
<span id="cb3-9"></span>
<span id="cb3-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Construct confidence interval</span></span>
<span id="cb3-11"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb3-12">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Estimate =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(p_hat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%"</span>),</span>
<span id="cb3-13">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Lower =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (p_hat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qnorm</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> se), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%"</span>),</span>
<span id="cb3-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Upper =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (p_hat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qnorm</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> se), <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%"</span>)</span>
<span id="cb3-15">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-16">  knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"html"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-17">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">full_width =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-18">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_header_above</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"92% Confidence Interval"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
92% Confidence Interval
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Lower</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">45.87%</td>
<td style="text-align: left;">40.86%</td>
<td style="text-align: left;">50.89%</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Despite what we may think of this result (which is certainly high in any general population context), there’s not much wiggle room with respect to the output. The data is what it is: we estimate that <img src="https://latex.codecogs.com/png.latex?p"> is somewhere between 41% and 51% with 92% confidence. And that’s it.</p>
<p>What if this sample wasn’t able to be gathered all at once? What if we already knew stuff about the rate of heart disease? What if we wanted our estimates to be informed by prior information we had?</p>
<p>When we consider our data being sequentially collected, we run into problems early on.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set grid</span></span>
<span id="cb4-2">n_obs <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat))</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set values</span></span>
<span id="cb4-5">p_hat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>()</span>
<span id="cb4-6">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>()</span>
<span id="cb4-7">se <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>()</span>
<span id="cb4-8"></span>
<span id="cb4-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Iterate the grid</span></span>
<span id="cb4-10"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(n_obs)) {</span>
<span id="cb4-11">  </span>
<span id="cb4-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute estimates</span></span>
<span id="cb4-13">  temp_n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> n_obs[i]</span>
<span id="cb4-14">  temp_p_hat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>HeartDisease[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>temp_n] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yes"</span>)</span>
<span id="cb4-15">  temp_se <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>((temp_p_hat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> temp_p_hat)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> temp_n)</span>
<span id="cb4-16">  </span>
<span id="cb4-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add to lists</span></span>
<span id="cb4-18">  p_hat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(p_hat, temp_p_hat)</span>
<span id="cb4-19">  n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(n, temp_n)</span>
<span id="cb4-20">  se <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(se, temp_se)</span>
<span id="cb4-21">  </span>
<span id="cb4-22">}</span>
<span id="cb4-23"></span>
<span id="cb4-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb4-25"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb4-26"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb4-27">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p_hat =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, p_hat), </span>
<span id="cb4-28">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, n),</span>
<span id="cb4-29">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NA</span>, se)</span>
<span id="cb4-30">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb4-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb4-33">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb4-34">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(n),</span>
<span id="cb4-35">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> p_hat</span>
<span id="cb4-36">    ),</span>
<span id="cb4-37">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb4-38">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_linerange</span>(</span>
<span id="cb4-40">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb4-41">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(n),</span>
<span id="cb4-42">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> p_hat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qnorm</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> se,</span>
<span id="cb4-43">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> p_hat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">qnorm</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">96</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> se</span>
<span id="cb4-44">    ),</span>
<span id="cb4-45">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb4-46">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb4-49">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb4-50">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>),</span>
<span id="cb4-51">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),</span>
<span id="cb4-52">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>)</span>
<span id="cb4-53">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-54">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimated p (92% CI)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>percent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-55">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sample size"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/can-you-have-a-model-without-data/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>First, when we have no data, we can’t get <em>any</em> estimate (obviously). We have to pretend we know <em>nothing</em> about what the rate of heart disease is. After adding only 1 observation, our estimate for <img src="https://latex.codecogs.com/png.latex?p"> is 0% with a 92% confidence interval ranging from 0% to 0%. This is not useful or informative, as that estimate was based on a single individual. Then, when we just add 4 more observations, our estimate of <img src="https://latex.codecogs.com/png.latex?p"> becomes wildly uncertain (40% with a 92% confidence interval from 2% to 78%). This accumulated information is inconsistent and counter-intuitive (of course I’m using large sample methods, so we could use more appropriate small sample approaches, but that’s part of the point). Eventually as more data is added, the estimate gets more precise, but, again, completely driven by the data.</p>
<p>The bottom line being that in the frequentist paradigm, we are handcuffed. We can’t mathematically provide estimates until there is sufficient data collected, despite what our intuition or prior knowledge tells us about the parameter of interest beforehand.</p>
<p>What if we have no data, or very little? What if we need to make decisions along the way before all of the data is collected, using our best estimate as of <em>now</em>? As we saw above, we need to wait to have sufficient data to get something reliable.</p>
<p>Is there a way to provide a starting point about what we <em>think</em> the true rate of heart disease is, and then have our estimates be informed or augmented by evidence?</p>
<p>Yes, by being a Bayesian.</p>
<section id="bayesian-thinking" class="level1">
<h1>Bayesian Thinking</h1>
<p>The way I like to think about how <a href="https://en.wikipedia.org/wiki/Bayesian_statistics">Bayesian statistics</a> differs from frequentist methods is that <em>the model is everything</em>. Here, we focus on the <em>model</em> and treat it as a living, breathing object. The data becomes secondary, sometimes an afterthought, and only used <em>as needed</em> in order to update our knowledge about the world as new information comes in.</p>
<section id="prior" class="level2">
<h2 class="anchored" data-anchor-id="prior">Specify a prior distribution</h2>
<p>Before any of the data is collected, we can use our subject matter knowledge about a phenomenon as to where we think a parameter value lies.</p>
<p>In the example above, suppose we thought it’s likely that the true parameter value <img src="https://latex.codecogs.com/png.latex?p"> is somewhere around 35% in this population, of course allowing for some uncertainty.</p>
<p>We can assign a <a href="https://en.wikipedia.org/wiki/Prior_probability">prior distribution</a> to <img src="https://latex.codecogs.com/png.latex?p"> using the <a href="https://en.wikipedia.org/wiki/Beta_distribution">Beta</a> distribution (you could use anything you wanted that adheres to your prior knowledge, it just happens that this distribution works nicely in the case of proportions, an example of the <a href="https://en.wikipedia.org/wiki/Conjugate_prior">conjugate prior</a>):</p>
<p><img src="https://latex.codecogs.com/png.latex?p%20%5Csim%20Beta(%5Calpha%20=%204.5,%20%5Cbeta%20=%207.5)"></p>
<p>where the <a href="https://en.wikipedia.org/wiki/Probability_density_function">probability density function (PDF)</a> is defined as:</p>
<p><img src="https://latex.codecogs.com/png.latex?f(x%7C%5Calpha,%20%5Cbeta)%20=%20%5Cfrac%7B%5CGamma(%5Calpha+%5Cbeta)%7D%7B%5CGamma(%5Calpha)%5CGamma(%5Cbeta)%7Dx%5E%7B%5Calpha-1%7D(1-x)%5E%7B%5Cbeta-1%7D"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?x%20%5Cin%20%5B0,1%5D">, <img src="https://latex.codecogs.com/png.latex?%5Calpha,%20%5Cbeta%20%3E%200">, and <img src="https://latex.codecogs.com/png.latex?%5CGamma(n)%20=%20(n-1)!">.</p>
<p>And we can construct a plot to visualize our initial beliefs about the parameter <img src="https://latex.codecogs.com/png.latex?p">:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the density values</span></span>
<span id="cb5-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">01</span>)</span>
<span id="cb5-3">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbeta</span>(x, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.5</span>)</span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make the plot</span></span>
<span id="cb5-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(x, y) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(</span>
<span id="cb5-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb5-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x,</span>
<span id="cb5-11">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y</span>
<span id="cb5-12">    )</span>
<span id="cb5-13">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(</span>
<span id="cb5-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),</span>
<span id="cb5-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span></span>
<span id="cb5-17">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb5-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),</span>
<span id="cb5-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),</span>
<span id="cb5-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb5-25">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(</span>
<span id="cb5-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span>,</span>
<span id="cb5-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>percent</span>
<span id="cb5-29">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/can-you-have-a-model-without-data/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>So initially we think there is a 72% chance that the true value of <img src="https://latex.codecogs.com/png.latex?p"> is between 20% and 50% (taken as the area under the curve between those two points), with more probability mass towards the center.</p>
<p>In this sense, we <em>have</em> our model estimate already in its complete form. If the current state of information isn’t sufficient, <em>then</em> we can collect data to help guide/inform our prior belief. So instead of requiring a (large enough) sample to realize any numerical estimate, we have one with zero data points. As we add data, our model will update proportionally/appropriately to the amount of new information it contains. Therefore, we can think of this <em>prior</em> distribution as equivalent to our <em>current</em> <a href="https://en.wikipedia.org/wiki/Posterior_probability">posterior distribution</a>, whether we got here from prior data, intuition, or a plain guess, it doesn’t really matter. Our current knowledge of <img src="https://latex.codecogs.com/png.latex?p"> captures all that we know about it, and will only change as new information is added. <em>Thus, we have constructed a model with no data.</em></p>
</section>
<section id="updating-the-model-with-data" class="level2">
<h2 class="anchored" data-anchor-id="updating-the-model-with-data">Updating the model with data</h2>
<p>Now we want a way to update our prior (or current) knowledge of the parameter of interest as new information comes in. The result of this is called the <a href="https://en.wikipedia.org/wiki/Posterior_probability">posterior distribution</a>, which tells us where the parameter value(s) are most likely to be, given our prior beliefs + new data. The derivation of this distribution is done through <a href="https://en.wikipedia.org/wiki/Bayes%27_theorem">Bayes’ theorem</a>.</p>
<p>In our example (and any analysis), the posterior distribution is written as:</p>
<p><img src="https://latex.codecogs.com/png.latex?P(p%7Cdata)%20=%20%5Cfrac%7BP(p)P(data%7Cp)%7D%7BP(data)%7D"></p>
<p>The <img src="https://latex.codecogs.com/png.latex?P(p)"> is the prior distribution, which we saw above, <img src="https://latex.codecogs.com/png.latex?P(data%7Cp)"> is the <em>likelihood</em> of observing our data given a particular value of <img src="https://latex.codecogs.com/png.latex?p">, and <img src="https://latex.codecogs.com/png.latex?P(data)"> is the probability of observing our dataset across all values of <img src="https://latex.codecogs.com/png.latex?p"> (i.e., the <a href="https://en.wikipedia.org/wiki/Law_of_total_probability">law of total probability</a>). In general, the denominator is not dependent on the parameter, and since we’re conditioned on the <img src="https://latex.codecogs.com/png.latex?data">, this just amounts to a normalizing constant to ensure the posterior distribution is a <a href="https://study.com/skill/learn/how-to-determine-if-a-probability-distribution-is-valid-explanation.html">valid probability distribution</a>. Thus, we only need to concern ourselves with the form of the numerator, and can write the posterior as <em>proportional</em> to the product of the prior and likelihood:</p>
<p><img src="https://latex.codecogs.com/png.latex?P(p%7Cdata)%20%5Cpropto%20P(p)P(data%7Cp)"></p>
<section id="define-the-likelihood" class="level3">
<h3 class="anchored" data-anchor-id="define-the-likelihood">Define the likelihood</h3>
<p>Similar to what we saw in the frequentist approach above, the <a href="https://en.wikipedia.org/wiki/Likelihood_function">likelihood</a> of the data in our Bayesian model can be thought of as a <a href="https://en.wikipedia.org/wiki/Bernoulli_distribution">Bernoulli</a> random variable, where each patient has heart disease or they don’t, for a given probability <img src="https://latex.codecogs.com/png.latex?p">. Because our observations are independent, the collection of these “coin flips” can be summarized using the <a href="https://en.wikipedia.org/wiki/Binomial_distribution">Binomial distribution</a>:</p>
<p><img src="https://latex.codecogs.com/png.latex?H%7Cn,%20p%20%5Csim%20Binomial(n,p)"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?n"> is the sample size, <img src="https://latex.codecogs.com/png.latex?p"> is the probability of heart disease (the parameter of concern), and <img src="https://latex.codecogs.com/png.latex?H"> is the total number of patients with heart disease in a sample. The <a href="https://en.wikipedia.org/wiki/Probability_mass_function">probability mass function (PMF)</a> for this distribution looks like:</p>
<p><img src="https://latex.codecogs.com/png.latex?P(data%7Cp)%20=%20P(H%7Cn,p)%20=%20%5Cfrac%7Bn!%7D%7BH!(n-H)!%7Dp%5EH(1-p)%5E%7Bn-H%7D"></p>
<p>So for a given sample size and probability, we can compute the likelihood of observing any number of patients with heart disease.</p>
</section>
<section id="derive-the-posterior" class="level3">
<h3 class="anchored" data-anchor-id="derive-the-posterior">Derive the posterior</h3>
<p>As mentioned, the posterior is derived by taking the prior distribution multiplied by the likelihood function.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%5Cbegin%7Bsplit%7D%0AP(p%7Cdata)%20&amp;%20%5Cpropto%20P(p)P(data%7Cp)%20%5C%5C%0A&amp;%20=%20P(p)P(H%7Cn,%20p)%5C%5C%0A&amp;%20=%20%5Cfrac%7B%5CGamma(%5Calpha+%5Cbeta)%7D%7B%5CGamma(%5Calpha)%5CGamma(%5Cbeta)%7Dp%5E%7B%5Calpha-1%7D(1-p)%5E%7B%5Cbeta-1%7D%20%5Cfrac%7Bn!%7D%7BH!(n-H)!%7Dp%5EH(1-p)%5E%7Bn-H%7D%20%5C%5C%0A&amp;%20%5Cpropto%20p%5E%7B%5Calpha%20-%201%20+%20H%7D(1-p)%5E%7B%5Cbeta%20-%201%20+%20n%20-%20H%7D%0A%5Cend%7Bsplit%7D%0A%5Cend%7Bequation%7D%0A"></p>
<p>It turns out this is just another Beta distribution with a different parameterization (note the * to differentiate from the prior parameter values):</p>
<p><img src="https://latex.codecogs.com/png.latex?p%7CN,Y%20%5Csim%20Beta(%5Calpha%5E*%20=%20%5Calpha%20+%20H,%20%5Cbeta%5E*%20=%20%5Cbeta%20+%20n%20-%20H)"></p>
<p>Notice that we only needed the <a href="https://en.wikipedia.org/wiki/Kernel_(statistics)">kernel</a> to classify this distribution, because that part was dependent on the parameter <img src="https://latex.codecogs.com/png.latex?p">. The rest is just a constant that normalizes it to be a valid probability distribution (as mentioned earlier), meaning it sums (integrates) to 1. Thus, since we know it’s a Beta, we can write out the full posterior PDF:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%5Cbegin%7Bsplit%7D%0Af(p%7C%5Calpha%5E*,%20%5Cbeta%5E*)%20&amp;%20=%20%5Cfrac%7B%5CGamma(%5Calpha%5E*%20+%20%5Cbeta%5E*)%7D%7B%5CGamma(%5Calpha%5E*)%5CGamma(%5Cbeta%5E*)%7Dp%5E%7B%5Calpha%5E*-1%7D(1-p)%5E%7B%5Cbeta%5E*-1%7D%20%5C%5C%0A&amp;%20=%20%5Cfrac%7B%5CGamma(%5Calpha%20+%20%5Cbeta%20+%20n)%7D%7B%5CGamma(%5Calpha%20+%20H)%5CGamma(%5Cbeta%20+%20n%20-%20H)%7Dp%5E%7B%5Calpha%20+%20H-1%7D(1-p)%5E%7B%5Cbeta%20+%20n%20-%20H-1%7D%20%5C%5C%0A%5Cend%7Bsplit%7D%0A%5Cend%7Bequation%7D%0A"></p>
<p>What this tells us is that from our initial model, the posterior distribution is just moved/shifted as new data comes in. Also notice the effect of sample size as clearly indicated by the equation: as more data comes in (i.e., higher <img src="https://latex.codecogs.com/png.latex?H"> and <img src="https://latex.codecogs.com/png.latex?N"> values), the more the prior distribution will be drowned out. Meaning that we are only straying away from the initial/prior belief “proportional” to how much new information is coming in. <em>This</em> is what allows us to have perfectly valid models and estimates, even with a single observation or no data at all.</p>
</section>
<section id="plug-in-the-data" class="level3">
<h3 class="anchored" data-anchor-id="plug-in-the-data">Plug in the data</h3>
<p>The hard part is done. Now all we need to do is plug in our data into the posterior distribution. In our sample of 303 patients (<img src="https://latex.codecogs.com/png.latex?n">), we observed 139 patients with heart disease (<img src="https://latex.codecogs.com/png.latex?H">). Plotting it across the range of possible values for <img src="https://latex.codecogs.com/png.latex?p"> looks like this:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set sample stats</span></span>
<span id="cb6-2">H <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>HeartDisease <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yes"</span>)</span>
<span id="cb6-3">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat)</span>
<span id="cb6-4"></span>
<span id="cb6-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the density values</span></span>
<span id="cb6-6">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">01</span>)</span>
<span id="cb6-7">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbeta</span>(x, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> H, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> n <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> H)</span>
<span id="cb6-8"></span>
<span id="cb6-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make the plot</span></span>
<span id="cb6-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(x, y) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(</span>
<span id="cb6-13">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb6-14">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> x,</span>
<span id="cb6-15">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y</span>
<span id="cb6-16">    )</span>
<span id="cb6-17">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(</span>
<span id="cb6-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),</span>
<span id="cb6-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span></span>
<span id="cb6-21">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb6-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb6-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),</span>
<span id="cb6-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),</span>
<span id="cb6-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb6-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb6-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb6-29">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb6-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(</span>
<span id="cb6-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span>,</span>
<span id="cb6-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>percent</span>
<span id="cb6-33">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/can-you-have-a-model-without-data/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>After our update using the data set (appended to our prior belief), we now estimate there is a 94% chance that the true value of <img src="https://latex.codecogs.com/png.latex?p"> is between 40% and 50% (taken as the area under the curve between those two points), again with more probability mass towards the center.</p>
</section>
<section id="incremental-updates" class="level3">
<h3 class="anchored" data-anchor-id="incremental-updates">Incremental updates</h3>
<p>To drive the point home, we’ll now revisit how our estimates change when data is added <em>sequentially</em>, and contrast that with what we saw from the frequentist approach above. To do this, we can just evaluate the posterior distribution at incremental chunks of our dataset to see how it changes as more data is added (assuming some sort of chronological structure to the data).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set values</span></span>
<span id="cb7-2">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">01</span>)</span>
<span id="cb7-3">results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbeta</span>(p, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.5</span>))</span>
<span id="cb7-4"></span>
<span id="cb7-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Iterate the grid</span></span>
<span id="cb7-6"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(n_obs)) {</span>
<span id="cb7-7">  </span>
<span id="cb7-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute estimates</span></span>
<span id="cb7-9">  temp_n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> n_obs[i]</span>
<span id="cb7-10">  temp_H<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>HeartDisease[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>temp_n] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yes"</span>)</span>
<span id="cb7-11">  temp_y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbeta</span>(p, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">4.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> temp_H, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">7.5</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> temp_n <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> temp_H)</span>
<span id="cb7-12">  </span>
<span id="cb7-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Store values</span></span>
<span id="cb7-14">  results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb7-15">    results <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbind</span>(</span>
<span id="cb7-17">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(</span>
<span id="cb7-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> temp_n,</span>
<span id="cb7-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> p,</span>
<span id="cb7-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> temp_y</span>
<span id="cb7-21">      )</span>
<span id="cb7-22">    )</span>
<span id="cb7-23">  </span>
<span id="cb7-24">}</span>
<span id="cb7-25"></span>
<span id="cb7-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make the plot</span></span>
<span id="cb7-27">results <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(</span>
<span id="cb7-30">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb7-31">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> p,</span>
<span id="cb7-32">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> y</span>
<span id="cb7-33">    )</span>
<span id="cb7-34">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb7-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"n = "</span>, n) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> forcats<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_reorder</span>(y, max)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_vline</span>(</span>
<span id="cb7-37">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xintercept =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),</span>
<span id="cb7-38">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"red"</span></span>
<span id="cb7-39">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-40">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb7-41">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb7-42">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb7-43">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),</span>
<span id="cb7-44">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb7-45">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb7-46">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb7-47">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb7-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(</span>
<span id="cb7-49">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span>,</span>
<span id="cb7-50">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>percent</span>
<span id="cb7-51">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/can-you-have-a-model-without-data/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As done before, the red lines indicate the amount of the posterior distribution between 40% and 50%.</p>
<p>First, we actually have an estimate before there is any data collected (when <img src="https://latex.codecogs.com/png.latex?n=0">). As we add a few observations, it only changes a little, but our estimates still retain our prior information about <img src="https://latex.codecogs.com/png.latex?p">. Then as more data is collected, we see the posterior distribution become much more precise in where it estimates <img src="https://latex.codecogs.com/png.latex?p"> to be.</p>
<p>This smooth integration of, and transition from, the prior knowledge we incorporate into the model to the information augmented by the data we collect is one reason why I think Bayesian thinking is better suited for scientific modeling. A more natural accumulation of knowledge, erasing the boundaries between what we already know (which should be considered a form of “data” itself) and hard data collected on a spreadsheet. It changes the way you approach the problem: instead of focusing right away on the data, which will be exhausted once it’s used, you focus on conceptualizing the living, breathing <em>model</em> of the world that generated it, and thus allow <em>data</em> to only contribute to that model as seen fit.</p>
    <bluesky-comments post="at://did:plc:sh3av73hihgu72vx7k44kgv7/app.bsky.feed.post/3lbzdwct5222m" config="{}"></bluesky-comments>
  


<!-- -->

</section>
</section>
</section>

 ]]></description>
  <category>Bayesian Statistics</category>
  <guid>https://www.zajichekstats.com/post/can-you-have-a-model-without-data/</guid>
  <pubDate>Tue, 29 Oct 2024 05:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/can-you-have-a-model-without-data/feature.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>You should have a data science blog</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/you-should-have-a-data-science-blog/</link>
  <description><![CDATA[ 




<p>One thing I would highly recommend to anyone with an interest in statistics/data science, whether you’re a student just starting out or a professional increasing your skills, is to create a blog. In <em>this</em> blog post, we’ll cover some of the benefits of doing so and touch on our preferred workflow to get one up and running (for free).</p>
<section id="benefits" class="level1">
<h1>Benefits</h1>
<section id="software-developmentdeployment" class="level2">
<h2 class="anchored" data-anchor-id="software-developmentdeployment">1. Software development/deployment</h2>
<p>You might think that the logistics/maintenance of a blog sounds cumbersome. You just want to stick to the content. However, learning how to create, develop, maintain, and deploy the blog, regardless of its content, provides in itself exposure to essential skills for data science: software development and deployment. Simply knowing the math or the R/Python commands to run a model is one thing, but if you want to deliver effective analytical solutions, those results probably need to be delivered to the end user in a useful way. Building a blog (website) forces you to learn about things such as <a href="https://www.atlassian.com/git/tutorials/what-is-version-control">version control</a>, <a href="https://www.synopsys.com/glossary/what-is-cicd.html">CI/CD</a>, <a href="https://en.wikipedia.org/wiki/Web_hosting_service">web hosting</a>, <a href="https://www.cloudflare.com/learning/dns/dns-records/">DNS records</a>, <a href="https://www.geeksforgeeks.org/web-development/">web development</a>…the list goes on, which are all components of creating a data science <em>product</em>. Marrying these things to the content creation itself provides you an arsenal of tools that can be exploited in all sorts of contexts.</p>
</section>
<section id="solidify-concepts" class="level2">
<h2 class="anchored" data-anchor-id="solidify-concepts">2. Solidify concepts</h2>
<p>There are a lot of topics to keep track of when you’re learning statistics/data science, and one very effective way to solidify your understanding is to write it out coherently. For example, you may be learning about <a href="">linear regression</a> but there may be nuances surrounding it that are fuzzy, such as why a <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> parameter is interpreted the way that it is. So, you may opt to write a blog post that goes through this derivation in an applied example with a coherent, structured narrative–by the end, you’ll generally grasp the thing you set out for. You just need to start with an outline of thing you want to understand and then learn it as you write. This is exactly the type of thing I do as well when I want to fully vet my understanding of something, such as in <a href="https://www.zajichekstats.com/post/the-evasive-spline/">this post</a>. Not only does this help with becoming a better writer, which is a great skill in and of itself, but it forces you to articulate a topic thoroughly, as if someone else is going to read it (which they hopefully will!). More importantly, it allows you to have permanent, easily accessible place to put your work.</p>
</section>
<section id="reference-repository" class="level2">
<h2 class="anchored" data-anchor-id="reference-repository">3. Reference repository</h2>
<p>On a related note of conceptual understanding: your blog posts are now just public web pages on the internet. That means you can use your collection of articles simply as an accessible repository for you to refer back to when you need them. If you took the time to write an article to help yourself solidify a concept (#2), then it was probably (a) tricky enough that over time you may lose your intuition on it occasionally, and (b) important enough that it was worth writing out. So, having a place where you’ve written out your thought process about a topic, in your own words, is an invaluable resource for you to refer back to. I can’t tell you the number of times I’ve referred back to articles I’ve written to remember little things. The beauty of it is that when my curiosity comes at a random part of the day, I know exactly where to look, and I can whip out my phone, remember the thing, and then stop thinking about it.</p>
</section>
<section id="portfolio-to-showcase" class="level2">
<h2 class="anchored" data-anchor-id="portfolio-to-showcase">4. Portfolio to showcase</h2>
<p>The fact that you even have a website is impressive. It shows that you can figure out how to do things, but more importantly, that you have the drive/initiative to create projects related to your craft. The skills in creating and maintaining the website are undoubtedly transferable to the work you’d do in data science. Add in interesting content you are producing in the blog posts themselves, such as code tutorials, analyses, method exploration, whatever it may be, then you have something that can prove your capabilities, and set you apart from other candidates. The convenience and security of having that all accessible through a simple web URL that you can quickly share with someone is a real advantage, as if someone asks you for work samples or something like that, you can confidently respond knowing the work was already done.</p>
</section>
<section id="engaging-in-public-discourse" class="level2">
<h2 class="anchored" data-anchor-id="engaging-in-public-discourse">5. Engaging in public discourse</h2>
<p>Having your own blog means you can write about whatever you’d like, however you want to say it, providing an avenue to contribute your own unique thoughts and perspectives. You may read a book or another article on some data science (or other) topic, and have strong thoughts, questions, or opinions about what was said. Or you just want to dig a little deeper into a certain aspect of it. Or reframe it in a way that is more understandable for yourself. Write it out and share it! Others may find your take interesting (or not, who cares). It only adds thought diversity, and makes you more connected to your field, as a peer.</p>
</section>
</section>
<section id="a-blog-workflow" class="level1">
<h1>A blog workflow</h1>
<p>In short, my preferred approach is based on the <a href="https://quarto.org/">Quarto</a> framework, and you can see a step-by-step tutorial <a href="https://quarto.org/docs/websites/website-blog.html">here</a>. That’s actually how this very website is built/maintained, which you can find the source code for <a href="https://github.com/centralstatz/centralstatz">here</a>. I’ll just touch on some of the steps involved:</p>
<section id="install-software" class="level2">
<h2 class="anchored" data-anchor-id="install-software">1. Install software</h2>
<p>I prefer to use <a href="https://posit.co/download/rstudio-desktop/">RStudio</a> as my IDE for developing my websites, so you’ll also need to <a href="https://www.r-project.org/">install R</a>. Then, you can <a href="https://quarto.org/docs/get-started/">install Quarto</a> and you’ll have what you need.</p>
</section>
<section id="store-code-on-github" class="level2">
<h2 class="anchored" data-anchor-id="store-code-on-github">2. Store code on GitHub</h2>
<p>The source code for the blog should be <a href="https://www.atlassian.com/git/tutorials/what-is-version-control">version controlled</a> and stored in a remote repository. I prefer <a href="https://www.github.com/">GitHub</a>. It’s not actually necessary to do this, but creates a much cleaner workflow and promotes better software development practices, as it retains all history to your code changes. As you develop your website locally, you’ll commit and push changes as you get to good stopping points, and GitHub will serve as your website’s source of truth.</p>
</section>
<section id="host-your-site-on-netlify" class="level2">
<h2 class="anchored" data-anchor-id="host-your-site-on-netlify">3. Host your site on Netlify</h2>
<p>Your code is on GitHub, but you need a server that will actually host the live application. That is where <a href="https://www.netlify.com/">Netlify</a> comes in, where you can host your website for free. To make it very easy, you can configure Netlify to update your website everytime code changes are made to GitHub (#2), automatically. So when I develop my website (like this very blog post), I just commit and push my changes to GitHub (from RStudio) and that will automatically trigger Netlify to grab changes from the repository and update the live website. By default, your website URL will be something like <code>website.netlify.app</code>, but Netlify also has a great domain management system where you can point your website to a custom URL that you own (which you’ll likely have to pay for). Nevertheless, if you don’t mind the default URL, it is completely free.</p>
</section>
</section>
<section id="get-started" class="level1">
<h1>Get started</h1>
<p>My advice is to get your website workflow up and running first: create the local (default) application, push the code to GitHub, configure Netlify to host the website, and, if you choose, set up your custom domain (again, this last part costs money). Then you can start to make tweaks to your website and make sure everything operates as expected for general maintenance. From there, you can then focus on customizing your website in any way you want, and more importantly, developing the actual content for your blog.</p>
    <bluesky-comments post="at://did:plc:sh3av73hihgu72vx7k44kgv7/app.bsky.feed.post/3lc73hlfqyk2t" config="{}"></bluesky-comments>
  


<!-- -->

</section>

 ]]></description>
  <category>Deployment</category>
  <category>Learning</category>
  <category>Software Development</category>
  <guid>https://www.zajichekstats.com/post/you-should-have-a-data-science-blog/</guid>
  <pubDate>Wed, 25 Sep 2024 05:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/you-should-have-a-data-science-blog/feature.png" medium="image" type="image/png" height="145" width="144"/>
</item>
<item>
  <title>Low cost ways to build and deploy analytical web apps</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/low-cost-ways-to-build-and-deploy-apps/</link>
  <description><![CDATA[ 




<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/vttykZnwIbA" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>In the era of <a href="https://en.wikipedia.org/wiki/Artificial_intelligence">artificial intelligence</a> (AI), organizations are often told they must <a href="https://medium.com/@markkloepfel/artificial-intelligence-adopt-or-get-left-behind-6e7387e695b9">buy in or get left behind</a>. I’ve attended various presentations like this. The presenters discuss how things are changing, provide some high-level overview of AI, and then convey that the organization must develop a strategy for it. However, the feeling left in the room is usually that of confusion and ambiguity. They understand that they should be <em>thinking</em> about it, but it’s totally unclear what (if anything) they should actually <em>do</em>.</p>
<p>First, it’s not really clear what is meant by “AI”, as it can mean <a href="https://hai.stanford.edu/sites/default/files/2020-09/AI-Definitions-HAI.pdf">many things</a> (I often don’t know what they mean by it either). Second, the implication seems to be pointed toward AI in the context of tools that can be <em>purchased</em> from vendors, therefore adding a financial stressor to decision makers when figuring out how to act. It also conveys a one-sided message: that AI <em>is</em> products that you buy, never really discussing the technical foundation, and thus foregoing the idea of taking these concepts and building incrementally.</p>
<p>Sure, there are all sorts of obscure ways organizations can use tools like <a href="">ChatGPT</a>, for example, but I would venture to guess that in the bigger picture, much of the target audience is at a relatively early stage of their data science journey, and unaware of all of the opportunity that is available using low-cost, or free, programming languages and technologies that can get them well on their way to a mature advanced analytics function, without making a direct jump to cost-intensive solutions in hopes that they “work”. There’s a better way.</p>
<p>Data science is all about asking the right questions and figuring out ways to provide answers to those questions to the people who need them at the right time so they can take action. This is somewhat arbitrary, but that also means it leaves the door open to an infinite number of ways to develop solutions for it, many of which can be solved (a) by going back to the fundamentals: data quality, data collection, data storage, infrastructure, reporting workflows, etc., and (b) with, at least to start, freely-available software, tools and programming languages. AI is simply hyperbole for data and analytical strategy. There’s lots of ways to start using data better, and that doesn’t necessarily mean opening your wallet.</p>
<section id="a-shiny-intro" class="level1">
<h1>A Shiny intro</h1>
<p>One of those tools, which I use almost everyday, is <a href="https://shiny.posit.co/">Shiny</a>. It is a <strong>free</strong> toolkit built primarily for the <a href="https://www.r-project.org/">R programming language</a> (also <strong>free</strong>), but has recently been made <a href="https://shiny.posit.co/py/">available in Python</a> as well (another <strong>free</strong> <a href="https://www.python.org/">programming language</a>), that enables you to build completely custom analytical web applications for whatever your purpose may be, whether that is for data exploration, dashboards, reporting, predictive modeling, mapping…the possibilities are endless.</p>
<p>Given these are code-first data science tools, there is of course a learning curve. It will take some effort to figure out. The main advantage is that it is <strong>free</strong>, allowing you to start slow, learn as you go, and progress iteratively. You can start realizing incremental, tangible impact without having to invest tons of money in a product upfront. Additionally, doing this can build the fundamental skills needed to continue maturing the path toward advanced analytics. Cost incurs as it financially makes sense from a value perspective, because you are in total control of what you are producing. In this article, we provide a brief overview of where you can start building and sharing these applications for <strong>free</strong>.</p>
</section>
<section id="where-can-i-share-my-app" class="level1">
<h1>Where can I share my app?</h1>
<p>This is not a tutorial on how to <em>build</em> Shiny apps, as there are <a href="https://shiny.posit.co/r/articles/">tons of resources</a> available to help you begin doing so. However, a big hurdle is often how to get that app off of your computer and in the hands of others for consumption. I’m here to tell you that even that part can be easily done with no cost.</p>
<p><strong>Bottom line:</strong> <em>There is infrastructure out there that allows you to easily build and share completely custom, powerful web applications for $0</em>.</p>
<p>Thus, if you are an individual, part of a small team, someone in a big organization, a leader, etc., and want to find better ways to interact with your data, you can begin developing and <em>sharing</em> useful applications with people (or the world). All for free. Which makes it feasible for anyone to begin experimenting, prototyping, and building with minimal risk. Here some of the options for doing so:</p>
<section id="locally" class="level2">
<h2 class="anchored" data-anchor-id="locally">1. Locally</h2>
<p>We already said that the primary goal of sharing an application is to get it off of your local machine, but this is still worth mentioning, because it is how you start. Once you install <a href="https://www.r-project.org/">R</a>, <a href="https://posit.co/download/rstudio-desktop/">RStudio</a>, and the <a href="https://shiny.posit.co/r/getstarted/shiny-basics/lesson1/index.html"><code>shiny</code> package</a>, you’ll have everything you need to begin developing and running apps. This is of course a great way to <em>develop</em>, and often the way you would do it regardless, because you can write the code, run the app to see how it works, make changes, test, and repeat.</p>
<p>But once it’s finalized and you want to share it, without other infrastructure in place, you would need to send the code files to someone else and have them run it on their own machine, which means they need to have all the software installed as well. This can be a totally legitimate approach in certain cases. It is certainly a starting point, but it’s far from ideal.</p>
<section id="side-note" class="level3">
<h3 class="anchored" data-anchor-id="side-note">Side note</h3>
<p>Another reason I mention local “deployment” is because I actually use this approach quite often. When I am analyzing a dataset, it is extremely useful to be able to spin up an application for my own usage to easily explore certain aspects of it, among many other uses. In this case, the audience is me, and I can make it work however I need it to serve my purposes. You can do this too, and don’t need it to run anywhere but your own computer, yet it is still very useful.</p>
</section>
</section>
<section id="shinyapps" class="level2">
<h2 class="anchored" data-anchor-id="shinyapps">2. shinyapps.io</h2>
<p>The most obvious location to deploy a <em>Shiny</em> app is the place specifically purposed for it: <a href="https://www.shinyapps.io/">shinyapps.io</a>. It is a cloud-based server built and maintained by <a href="https://posit.co/">Posit</a> (who we’ll see come up a lot in this article) that is made for hosting apps built in this framework. It has been around for quite a while, and, as we’ll see, there have been other platforms developed for hosting these apps that may be a better fit. Nevertheless, this is a totally viable option and great way to start deploying things, and they have a free tier that allows you to deploy up to five (5) applications with 25 hours of active usage per month.</p>
<section id="the-basics" class="level3">
<h3 class="anchored" data-anchor-id="the-basics">The Basics</h3>
<p>The concept is simple: develop your app on your local machine (e.g., in RStudio) and then run the <code>rsconnect::deployApp</code> function to deploy it to <a href="https://www.shinyapps.io/">shinyapps.io</a>. You can create an account with your email address or sign up through GitHub (like I did), among other options. Here is an outline of the steps I took to deploy <a href="https://tgzz86-alex0zajichek.shinyapps.io/readmissionriskpool/">this app</a>:</p>
<section id="make-an-application" class="level4">
<h4 class="anchored" data-anchor-id="make-an-application">1. Make an application</h4>
<p>First you just need to code up an app. This could be very simple like the one found <a href="https://shiny.posit.co/r/getstarted/shiny-basics/lesson1/index.html">here</a> to get started.</p>
<p>I’m using an <a href="https://github.com/centralstatz/ExampleApps/tree/main/ReadmissionRiskPool">existing demo app</a> we have in <a href="https://github.com/centralstatz">our GitHub page</a>. From Terminal we can execute (and you can too):</p>
<pre><code>git clone https://github.com/centralstatz/ExampleApps.git</code></pre>
<p>The app we want is located at <code>ExampleApps/ReadmissionRiskPool</code>.</p>
</section>
<section id="configure-connection-to-shinyapps.io" class="level4">
<h4 class="anchored" data-anchor-id="configure-connection-to-shinyapps.io">2. Configure connection to <a href="https://www.shinyapps.io/">shinyapps.io</a></h4>
<p>When you sign up, you’ll get a basic list of instructions for getting started. Assuming you are doing it with R, you need to install the <code>rsconnect</code> R package and register your account information, which includes tokens/secrets that are provided with your <a href="https://www.shinyapps.io/">shinyapps.io</a> account.</p>
<pre><code># Install the configuration library
install.packages("rsconnect")

# Setup account information
my_user_name &lt;- "&lt;GET_FROM_ACCOUNT&gt;"
my_token &lt;- "&lt;GET_FROM_ACCOUNT&gt;"
my_secret &lt;- "&lt;GET_FROM_ACCOUNT&gt;"
rsconnect::setAccountInfo(
  name = my_user_name,         
  token = my_token,     
  secret = my_secret
)</code></pre>
</section>
<section id="deploy-the-application" class="level4">
<h4 class="anchored" data-anchor-id="deploy-the-application">3. Deploy the application</h4>
<p>Once your account is configured, you can call <code>rsconnect::deployApp()</code> with the application specified and it will be uploaded to the host server.</p>
<pre><code># Assume we're working in the repo just cloned
rsconnect::deployApp("ReadmissionRiskPool")</code></pre>
<p>And just like that we have a custom, interactive web application <a href="https://tgzz86-alex0zajichek.shinyapps.io/readmissionriskpool/">available to the world</a>.</p>
<p>One thing you might notice is the web URL: <a href="https://tgzz86-alex0zajichek.shinyapps.io/readmissionriskpool/">https://tgzz86-alex0zajichek.shinyapps.io/readmissionriskpool/</a></p>
<p>It is obviously not very nice looking. One way to clean this up would be to have a better username (the first part of it). Then, once you start getting into the <a href="https://www.shinyapps.io/">shinyapps.io</a> paid plans, they allow for custom domains.</p>
<p>Another part of this is security. The app we just deployed is publicly available, which is definitely not always what is desired. Again, with the paid tiers you can begin introducing authentication into the applications for restricted access.</p>
</section>
</section>
</section>
<section id="posit-cloud" class="level2">
<h2 class="anchored" data-anchor-id="posit-cloud">3. Posit Cloud</h2>
<p>This platform takes it up a notch. <a href="https://posit.cloud/">Posit Cloud</a>, developed and maintained by the <a href="https://posit.co/">same company</a>, is not only a place to share applications, but a cloud-based service where you can <em>develop</em> your code as well, so everything is accessed in your web browser. As the <a href="https://posit.cloud/">website describes</a> it is a great platform for collaboration, teaching, etc. in a more all-encompassing environment.</p>
<p>You can organize content into “spaces”, which are disjointed areas for separate work streams. Within each space, and at the content item level, you can control settings for who has access, to what, and how much. Each user creates a login to the platform, and is able to access the spaces that they have created or have been shared with them. The free tier enables you a single shared space (which you can invite other users to) with up to 25 projects/outputs and limited computation usage. There is also infrastructure in place to establish connections to databases, among other things, that make it a feasible home for full-fledged data solutions. The other very important thing to note is that it is not only <a href="https://shiny.posit.co/">Shiny</a> applications that can be deployed here, but all sorts of other analytical content such as <a href="https://rmarkdown.rstudio.com/">R Markdown</a> and <a href="https://quarto.org/">Quarto</a> documents, <a href="https://www.rplumber.io/">API’s</a>, etc. Here is an introductory video for more information straight from the source:</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/-fzwm4ZhVQQ" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<section id="how-we-use-posit-cloud" class="level3">
<h3 class="anchored" data-anchor-id="how-we-use-posit-cloud">How we use Posit Cloud</h3>
<p>With the paid plans of <a href="https://posit.cloud/">Posit Cloud</a>, you are allowed an unlimited number of spaces, as well as beefed-up compute. This is what enables us to take advantage of this platform as an offering for client engagements. Each client gets their own private space which all of their analytical content we are collaborating on lives, and only we (us and the client) have access. Here’s one possible example of how a client engagement could work:</p>
<ol type="1">
<li><p>A client reaches out because they want to build a web application that enables them to interactively explore data related to their customer base on a reactive map, among other functionality.</p></li>
<li><p>We initialize a new space in <a href="https://posit.cloud/">Posit Cloud</a> and invite the client via email. They receive the invitation link that takes them to the space upon login, creating an account if they have not done so already.</p></li>
<li><p>We initialize a new private (or public, if applicable) <a href="https://github.com/">GitHub</a> repository on our <a href="https://github.com/centralstatz">organization’s page</a> to hold all of the application’s source code and its change-tracking history. Optionally, the client can be added as a member with viewing privileges of these files as well for full transparency.</p></li>
<li><p>We initialize a new RStudio project within the workspace sourced from the created GitHub repository. This serves as the development environment for the application.</p></li>
<li><p>The client has a dataset in a large Excel file that we would like to use as the source for the application. It gets uploaded into the application’s project by us after the client sends it in an email (or alternatively, the client goes in and uploads it themselves).</p></li>
<li><p>The app development work begins. We work iteratively with the client to construct it most optimally to fit their needs (occassionally pushing code to <a href="https://github.com/">GitHub</a> to track changes). Because they have direct access to the space, they can see it anytime. We can quickly <em>show</em> progress updates, bounce ideas back and forth, test functionality, and answer questions in a timely manner, until it is satisfactory. Then, we deploy the final application, and the client is enabled to go into it on-demand and use it as seen fit.</p></li>
<li><p>Over time, the data becomes stale so the client would like it to be updated on a recurring monthly basis. One option would be to send a new Excel file each month and we will manually update and re-deploy the application. Instead, we decide to use Posit Cloud’s <a href="https://docs.posit.co/cloud/guide/data/#external-databases">built-in data integration</a> capabilities. So we establish a connection to a SQL database in which the Excel file was sourced from, and build the queries directly into the application’s source code so that the application itself is sourced directly from the database. No middleman required.</p></li>
</ol>
<p>Overall, <a href="https://posit.cloud/">Posit Cloud</a> is a highly recommended tool to use for individuals and/or teams of people to get started with application development and deployment. Or even if you’re a seasoned Shiny developer, the infrastructure you get out of the box is amazing. And again, it is free.</p>
</section>
</section>
<section id="connect-cloud" class="level2">
<h2 class="anchored" data-anchor-id="connect-cloud">4. Connect Cloud</h2>
<p><a href="https://posit.co/">Posit</a> <a href="https://posit.co/blog/introducing-posit-connect-cloud/">just recently</a> launched the <a href="https://docs.posit.co/connect-cloud/user/">Alpha release</a> of their newest platform, called <a href="https://connect.posit.cloud/">Connect Cloud</a>. It is in its early phase, and it’s all about easy deployment. As the <a href="https://connect.posit.cloud/">home page</a> states, there are three (3) steps to get an application up and running with a shareable link that can be accessed from anywhere:</p>
<ol type="1">
<li>Create a new account by authenticating with <a href="https://github.com/">GitHub</a> (so you must have a GitHub account)</li>
<li>Link to a public repository (from GitHub) containing the code for a <a href="https://shiny.posit.co/">Shiny</a> application (or whatever other type of content you’re deploying)</li>
<li>Deploy the application and share the link</li>
</ol>
<p>We did this with the application deployed in #2, and yes, it’s that easy (and, once again, free). The link for the app on <em>this</em> platform is <a href="https://connect.posit.cloud/zajichek/content/01912861-8be7-59e2-215a-cdeffdd549f2">here</a>.</p>
<p>The main thing you have to remember to do before making your final commit to <a href="https://github.com/">GitHub</a>, and subsequently configuring the app connection to the repository, is to create the <code>manifest.json</code> file in your application’s root directory to capture the environment parameters that need to be created (automatically by <a href="">Connect Cloud</a>) for it to run. This can be done with a simple command:</p>
<pre><code>rsconnect::writeManifest()</code></pre>
<p>You can watch this video to get a more thorough introduction:</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/HWCPLURWYgY" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>We don’t quite yet know where this platform is going to go given that it is in such early stages. Although the infrastructure it already provides, and the ease at which it is done, is magic-like, there are of course a lot of things it <em>doesn’t</em> have (yet): login without GitHub, source apps from private repositories, private content, authentication, security, etc. These were the things I wondered about when I attended the live webinar above, which in turn had me thinking how it exactly compares with the purpose of <a href="https://posit.cloud/">Posit Cloud</a> (in the <a href="https://www.youtube.com/live/HWCPLURWYgY">video</a>, I explicitly asked this at <a href="https://youtu.be/HWCPLURWYgY?t=1766">29:26</a>). It sounds like these “commercial” considerations are all part of the roadmap, so we are very excited to see where it goes.</p>
<p>Nevertheless, even in its current state, <a href="https://connect.posit.cloud/">Connect Cloud</a> is a highly recommended platform to start using for anyone wanting to build a data science portfolio and deploy <em>public</em> content.</p>
</section>
<section id="shiny-server" class="level2">
<h2 class="anchored" data-anchor-id="shiny-server">5. Shiny Server</h2>
<p>Want total control over the infrastructure? If yes, <a href="https://posit.co/products/open-source/shiny-server/">Shiny Server</a> might be for you.</p>
<p>This is an <em>open-source</em> server configuration that can be installed on-premises (or wherever you’d like). The huge advantage is that it is <em>always</em> free–you just need to install the software. The disadvantage is that you need a server bulky enough to handle the desired compute <em>and</em> you need people who know how to manage it. Compared to the others, this option is like the wild west. It provides you the basic skeleton to get stuff working, but from there you have ultimate freedom to do with it what you wish, which can easily get out of hand as the developer/user bases grow and you’re trying to maintain environments as new software package versions are constantly being released.</p>
<p>I always consider this a fantastic option for relatively large organizations who are early in their data science journeys. They likely have mature information technology (IT) teams supporting existing systems, but have not yet invested heavily in advanced analytics infrastructure. This provides an opportunity to leverage those mature systems admin teams to setup up and manage the backend of this infrastructure that then enables data scientists in the organization to deliver great analytic content (and prove its value) without spending tons of money on acquiring the software. Low risk with huge potential.</p>
<section id="amazon-web-services-aws" class="level3">
<h3 class="anchored" data-anchor-id="amazon-web-services-aws">Amazon Web Services (AWS)</h3>
<p>Despite it being open-source, most individuals (or small companies for that matter) probably don’t have adequate server space to implement <a href="https://posit.co/products/open-source/shiny-server/">Shiny Server</a> in the way they’d like. However, you <em>can</em> do it if you use external compute resources. <a href="https://aws.amazon.com/ec2/">Amazon EC2</a> is one way to make it happen. And still for free.</p>
<p>The way it works is that you spin up an EC2 instance of your choice (essentially a computer, ranging from very low to very high compute power, the <code>t2.micro</code> being the one that you can use for <strong>free</strong>), install <a href="https://posit.co/products/open-source/shiny-server/">Shiny Server</a> on the instance, and then have all the freedom in the world to deploy applications to it and access them on the web. <a href="https://www.charlesbordet.com/en/guide-shiny-aws/">This</a> is an excellent resource that I followed when learning how to do this, which you can see a detailed account of my steps <a href="https://github.com/zajichek/shinydemo-aws/issues/1">here</a> as well.</p>
<p>The real cool thing about this setup is that you can take it wherever you want to go. You have unlimited ability to customize the design of your server pages, integrate it with other software/tools, assign custom domains, etc. The possibilities are endless. When <a href="https://github.com/zajichek/shinydemo-aws/issues/1">I learned how to do this</a>, I was able to quickly get it to a state where my server is live and accessible at a subdomain of one of my websites: <a href="http://apps.zajichekstats.com/">http://apps.zajichekstats.com/</a>. Clicking that link takes you to the home page of my Shiny Server on an AWS EC2 <code>t2.micro</code> instance, where subsequent applications are found at subpages of that (e.g., <a href="http://apps.zajichekstats.com/shinydemo-aws/">http://apps.zajichekstats.com/shinydemo-aws/</a>). This entire setup, including the subdomain assignment, was done for free, and it is barely scratching the surface of what <em>can</em> be done with it.</p>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>There are many different ways (and this list probably doesn’t come close to covering the possible ones (e.g., <a href="https://azure.microsoft.com/en-us/products/app-service">Azure App Service</a>)) to start building and sharing data science products for no cost. So, what are you waiting for? Give them a try!</p>
    <bluesky-comments post="at://did:plc:sh3av73hihgu72vx7k44kgv7/app.bsky.feed.post/3lc73mgu5ns2t" config="{}"></bluesky-comments>
  


</section>

 ]]></description>
  <category>Web applications</category>
  <category>Deployment</category>
  <guid>https://www.zajichekstats.com/post/low-cost-ways-to-build-and-deploy-apps/</guid>
  <pubDate>Tue, 20 Aug 2024 05:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/low-cost-ways-to-build-and-deploy-apps/feature.png" medium="image" type="image/png" height="150" width="144"/>
</item>
<item>
  <title>A prediction system for managing the hospital readmission risk pool</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/managing-the-readmission-risk-pool/</link>
  <description><![CDATA[ 




<p>Each year hospitals across the United States get <a href="https://www.cms.gov/medicare/payment/prospective-payment-systems/acute-inpatient-pps/hospital-readmissions-reduction-program-hrrp">penalized by CMS</a>, withholding up to 3% of all Medicare reimbursement for an entire fiscal year, for having excess <a href="https://www.healthcare.gov/glossary/hospital-readmissions/">readmissions</a>. Additionally, there are implications from <a href="https://www.uhcprovider.com/content/dam/provider/docs/public/health-plans/medicare/MA-Readmission-Program-Clinical-Guidelines.pdf">commercial payors</a>, <a href="https://www.ncqa.org/hedis/measures/plan-all-cause-readmissions/">quality programs</a>, etc. that make it a focal point of the general <a href="https://www.cms.gov/priorities/innovation/key-concepts/value-based-care#:~:text=What%20is%20value%2Dbased%20care,what%20an%20individual%20values%20most.">value-based care</a> landscape. Not to mention the obvious patient burden (both financially and <a href="https://pubmed.ncbi.nlm.nih.gov/34544571/">psychologically</a>) of being hospitalized twice in a short period of time. Thus, it has become a <a href="https://www.definitivehc.com/blog/top-10-hospital-performance-metrics-you-need-to-know">key area</a> of focus for hospitals in monitoring the overall health of their clinical and financial operations.</p>
<p>In turn, the day-to-day discussion becomes one of strategy: what interventions, processes, and workflows should be put in place to proactively prevent hospital readmissions from occurring? This is not totally straightforward. Do we focus on preventing the <em>readmission</em>, or the initial hospitalization altogether? You can’t have a readmission without an index stay. For which patients? Who needs which resources? There can be conflicting priorities. Hospitals <em>depend</em> on admissions (mostly from <a href="https://www.definitivehc.com/resources/healthcare-insights/breaking-down-us-hospital-payor-mixes">commercial payors</a>) to keep the lights on. Also, programs like the <a href="https://www.cms.gov/medicare/payment/prospective-payment-systems/acute-inpatient-pps/hospital-readmissions-reduction-program-hrrp">Hospital Readmissions Reduction Program (HRRP)</a> (<a href="https://www.cms.gov/">CMS</a>’ penalty program) only apply to Medicare beneficiaries, which is a subset of the overall hospital population (and sometimes the <a href="https://www.aha.org/system/files/media/file/2020/09/fact-sheet-billing-explained-0820.pdf">most unprofitable</a>). Should we just put our resources towards preventing admissions for the unprofitable patients? Probably not. Obviously, we are constrained morally (and probably legally) from giving payor-based, preferential treatment, but this is simply the reality of the things stakeholders need to sift through. In my view, the best you can do to balance things, at least to start, is to be <em>meticulously aware</em> of what is happening–through data.</p>
<p>In this realm, one component of particular interest is using <a href="https://en.wikipedia.org/wiki/Predictive_analytics">predictive analytics</a> to anticipate and intervene on high-risk patients in order to prevent a subsequent hospitalization. Despite there being a <a href="https://pubmed.ncbi.nlm.nih.gov/?term=predicting+readmissions">large body of work</a> by researchers developing creative and innovative approaches for preventing readmissions, the reality is that many hospitals do not leverage all the literature that is available because (a) most of it is just that–research, and it’s difficult to confidently translate and tailor that to an actionable program for any one hospital, and (b) it is simply too difficult to parse and organize <em>because</em> there is so much of it.</p>
<p>So, when hospitals do go down the route of implementing predictive tools for readmissions, it seems to be more readily available, yet sub-optimal modeling frameworks that are used. For example, <a href="https://www.epic.com/">Epic</a> has <a href="https://www.epicshare.org/tips-and-tricks/use-predictive-risk-score-to-reduce-readmission">their own</a> readmission risk predictor native to its EHR platform for this very purpose. The common thing I notice about the tools used in practice (and in the way <a href="https://qualitynet.cms.gov/inpatient/measures/readmission">CMS does it</a>) is the modeling setup: they predict the likelihood of readmission based on the state of the patient at the time of <em>hospital discharge</em>. Yet, it is <a href="https://www.aha.org/system/files/2018-02/11sep-tw-readmissions.pdf">well known</a>, and frankly just common sense, that the actual drivers, the real, preventable reasons, for a readmission are circumstances of the patient <em>after</em> being discharged from the hospital. That’s not to say these scores aren’t <em>correlated</em> with the rates of readmission, or can’t provide a useful marker; but with the complexities of managing a diverse hospital population, it makes it difficult to figure out what to do with a rapidly stale risk score that only reflects how the patient was when they left the hospital, and ignores everything that happened after.</p>
<p>Thus, a reframing of the modeling problem is in order. And in fact, it’s more than that. In this effort, <em>how</em> the information is displayed, propagated and relayed between clinical teams and leadership is as (if not more) important than the shear goal of accurate risk estimation (according to statistical metrics). It requires cross-functional involvement (from the get-go), strategic design, attention to nuance and rigor, and a flexible scope in order to tie hospital-wide impact down to the individual patient.</p>
<p>This is my idea of how you might build a tool to effectively manage the readmission risk pool.</p>
<section id="riskpooldefinition" class="level1">
<h1>First, what is the <em>readmission risk pool</em>?</h1>
<p>We’ll go with a very simple definition:</p>
<blockquote class="blockquote">
<p>All patients at risk for hospital readmission at a given point in time.</p>
</blockquote>
<p>Let’s use 30-day readmissions as an example. This would be all patients who were discharged from the hospital in the past 30 days who are still at risk for readmission. Meaning that up until the <em>current</em> point in time (i.e., <em>now</em>), they have not already been readmitted or had an otherwise exclusionary event. These are the patients we can still do something about.</p>
<p>From here on out, when we talk about the <em>risk pool</em>, this is what we mean. You can assume in general we’re talking about 30-day readmissions, although nothing about this framework necessarily restricts us to that.</p>
</section>
<section id="whathappened" class="level1">
<h1>Step 1: Build a (near) real-time data tool</h1>
<p>This is simply a data problem.</p>
<p>Before we even begin the conversation about <em>prediction</em>, we should exhaust all efforts to optimize the ability to know what <em>has already happened</em> as close to <em>now</em> as we can. That means purposefully designing a tool that encapsulates the full picture of readmissions for the hospital (system), tying the contributions of individual patients back to aggregated hospital metrics, in (near) real-time. We can think of the types of questions that this would facilitate on-demand, up-to-date answers to, from different areas of hospital administration:</p>
<p><strong>Care Management</strong></p>
<ul>
<li>Who is currently in the <em>risk pool</em>?</li>
<li>Has a patient already received, or is going to receive, a certain intervention?</li>
<li>What are the patient’s socioeconomic conditions?</li>
<li>Have they filled their prescriptions?</li>
<li>What are the payor rules for the services they may need?</li>
</ul>
<p><strong>Coding/Billing</strong></p>
<ul>
<li>Which patients contribute towards the <a href="https://www.cms.gov/medicare/payment/prospective-payment-systems/acute-inpatient-pps/hospital-readmissions-reduction-program-hrrp">HRRP</a> and/or other relevant metrics?</li>
<li>What is the readmission risk according to <a href="https://www.cms.gov/">CMS</a>’ (or other programs’) models?</li>
<li>What risk factors from <a href="https://www.cms.gov/">CMS</a> (or other programs) are currently documented (and are there discrepancies)?</li>
</ul>
<p><strong>Executive/Leadership</strong></p>
<ul>
<li>What is the current (estimated) <a href="https://www.cms.gov/medicare/payment/prospective-payment-systems/acute-inpatient-pps/hospital-readmissions-reduction-program-hrrp">HRRP</a> penalty amount?</li>
<li>What share of patients in the (past and present) risk pool affect readmission penalty?</li>
<li>What is the <em>real-time</em> readmission rate, where has it been, and how will it change under various scenarios with the patients who may affect it?</li>
</ul>
<p>The goal is to make it actionable for all stakeholders involved by giving them the most pertinent information they need when they need to know it. But doing so in a common, representative, well-connected tool so that the lineage is clear, and everyone is working from the same source of information. I strongly believe that putting in the cross-functional time, nuance, and rigor needed to design and implement tools like this, that mostly consists of figuring out how to move existing data points to a certain location at the right time, would relieve a lot of disconnect and probably give people most of what they need to make effective, informed decisions in a timely manner. Note that <em>existing</em> data points may include determining new ways to collect information as well, not necessarily only sticking with systems in place, as time may be better well-spent establishing new data collection mechanisms that actually measure the thing of interest, rather than jumping through hoops to force conformity of existing sources.</p>
<section id="prototype" class="level2">
<h2 class="anchored" data-anchor-id="prototype">A prototype</h2>
<p>So what might such a tool look like? Well here’s one possibility (the source code for this is <a href="https://github.com/centralstatz/ExampleApps/tree/main/ReadmissionRiskPool">here</a>):</p>
<p><img src="https://www.zajichekstats.com/post/managing-the-readmission-risk-pool/app1.png" class="img-fluid"></p>
<p>Not too fancy, but it’s a start. The focal point being the interactive map widget. Suppose your service area was the state of Wisconsin. Each dot represents a patient in the risk pool at their home address (i.e., they were recently discharged from the hospital), and the relative size/color of the dot represents the amount of risk. For example, in the popup box, Patient 240 was discharged 13 days ago with a 47% readmission risk, and has 17 days remaining in the risk pool.</p>
<p>It gives a simple and intuitive way to view the current risk pool for the hospital (system). Care managers can use it to identify patients for intervention in real-time, while leadership can use it to quickly get a pulse on the total volume of patients across the system at risk for readmission and how that would affect aggregated metrics over a period of time. Of course, there can be many enhancements to this for better utility, such as functionality to filter patients by disease categories, service lines, discharge location, PCP location (if they have one), whether they have a visit scheduled, payor, who will contribute to the <a href="https://www.cms.gov/medicare/payment/prospective-payment-systems/acute-inpatient-pps/hospital-readmissions-reduction-program-hrrp">HRRP</a> (and who will not)…the list goes on. The goal is to have a readily-available, cohesive tool that can provide day-to-day actionable information for all parties involved.</p>
</section>
<section id="subsequent-impact" class="level2">
<h2 class="anchored" data-anchor-id="subsequent-impact">Subsequent impact</h2>
<p>The effect of this as a starting point is that the jump to <em>predictive</em> analytics becomes much more intentional. You get what you can from understanding what has already happened, which I think is a lot, and then proceed to a more advanced (i.e., predictive) solution that is much more well-defined once processes have been optimized with the current state and its capabilities have reached their limit. Then when you want to add that additional feature, the focus can be on that, making it much more clear for everyone who needs to be involved (e.g., IT, data analytics, clinicians, managers, etc.) what the specific goals are.</p>
<p>For example, if a care management team can already quickly and intuitively answer all the questions they have about an individual or group of patients with respect to things that already occurred in order to manage the risk pool on a day-to-day basis, then naturally the predictive piece only arises when the need is necessary (and predictably, it’s probably related to resource utilization). In a world with unlimited resources, they could just continually intervene on the entire risk pool everyday, until they know each patient is not going to be readmitted (and ideally after). But in our world, they’ll be faced with scenarios like:</p>
<ul>
<li>There are 500 patients in the risk pool, but I only have time to intervene on 50 of them. Which ones should I choose?</li>
<li>Which patients are currently at the highest risk of being readmitted?</li>
<li>Patient A was discharged 20 days ago, and patient B was discharged 10 days ago. Which one should I intervene on today?</li>
</ul>
<p>At which point the necessary personnel can be convened, and an enhancement can be implemented for that specific purpose.</p>
<p>All-in-all, going back to the introduction, this is about being <em>meticulously aware</em>.</p>
</section>
</section>
<section id="whatwillhappen" class="level1">
<h1>Step 2: What is going to happen?</h1>
<p>Now suppose in the tool above, when we click on an individual patient, we want to know what their <em>current</em> risk of readmission is, given everything that has happened since they were discharged. Some patients may only have 5 days left in the risk pool, while others were just recently discharged. Some have had post-discharge clinic visits, some have not. Things have changed since they left the hospital, and we want to find a way to prioritize which ones still need our attention the most. This is where predictive analytics comes in.</p>
<section id="build-the-pipelines" class="level2">
<h2 class="anchored" data-anchor-id="build-the-pipelines">Build the pipelines</h2>
<p>From a technological perspective, we can first consider putting in a random number as a placeholder for the risk. This allows us to build the data pipelines, infrastructure and workflows needed to support the models once we’re ready for the real thing. Some key things to think about:</p>
<ul>
<li>Will it be delivered through an API?</li>
<li>What databases need to be accessed, and when, in order to evaluate the models and produce a prediction?</li>
<li>How will we monitor the model’s accuracy, and have the ability to iterate/update it?</li>
<li>How will administrators and clinical teams interact with it?</li>
<li>Where/how should the number(s) be displayed in the application?</li>
</ul>
<p>Hashing these things out enables a plan to be put in place for the product as a whole, and ensures the buy in from all of the teams that will be needed to use and maintain it.</p>
<p>At this point, it’s still just a systems, logistical, and personnel problem. Once everyone understands <em>how</em> it’s going to work, then the focus (for the data science teams) can transition to the math.</p>
</section>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">The model</h2>
<p>We’re going to get a little technical here.</p>
<p>Let</p>
<p><img src="https://latex.codecogs.com/png.latex?D%20=%20%5Ctext%7BReadmission%20duration%20of%20interest%20(e.g.,%2030%20days)%7D"> <img src="https://latex.codecogs.com/png.latex?T%20=%20%5Ctext%7BTime%20since%20discharge%20to%20the%20current%20time%20point%7D"> <img src="https://latex.codecogs.com/png.latex?R%20=%20%5Ctext%7BTime%20that%20the%20patient%20is%20readmitted%20(if%20at%20all)%7D"></p>
<p>Then what we want to estimate is:</p>
<p><img src="https://latex.codecogs.com/png.latex?P(R%20%5Cleq%20D%20%7C%20R%20%3E%20T)"> In layman’s terms, were simply asking this: if, as of <em>now</em>, a patient is still at risk for readmission (i.e., in the risk pool), what is the probability that they will be readmitted in the remaining window of interest, given they have not been readmitted up to this point?</p>
<p>So if a patient was discharged 20 days ago, and they still have not been readmitted, we want to know how likely it is that they will be readmitted in the next 10 days (assuming we care about 30 day readmissions), given what has happened since discharge.</p>
</section>
<section id="how-do-we-estimate-it" class="level2">
<h2 class="anchored" data-anchor-id="how-do-we-estimate-it">How do we estimate it?</h2>
<p>Notice that the model is actually quite general, which leaves the door open to <em>many</em> possible ways to structure the data and choose statistical methodologies as seen fit. We’re basically needing some modeling process, however defined, that can produce a predicted probability at an arbitrary point in time, accounting for what has happened up to that point. Intuitively, I think some sort of <a href="https://en.wikipedia.org/wiki/Bayesian_statistics">Bayesian</a> approach would be pretty cool, since you can conceptually think of updating <em>yesterday’s</em> risk with the new information you’ve gathered about the patient up to <em>today</em> (e.g., maybe they just completed an office visit). In that sense the information is more naturally accumulating. But since I haven’t thought that one through yet, I’ll propose a simpler way to start:</p>
<section id="baselinerisk" class="level3">
<h3 class="anchored" data-anchor-id="baselinerisk">1. Start with the baseline risk</h3>
<p>We’re not trying to totally recreate the wheel here. Those discharge-based risk estimates we talked about in the introduction can still be valuable <em>at that point in time</em>. Since they already account for many patient/clinical characteristics before and during the hospitalization, we might as well use it. Additionally, if a hospital (system) is already using, say, an <a href="https://www.epicshare.org/tips-and-tricks/use-predictive-risk-score-to-reduce-readmission">Epic readmission risk score</a>, this can just be seen as a day-to-day updating of that. However, if you don’t have/want this, this framework will still work.</p>
<p>We just want an estimate of the patient’s risk of readmission when they leave the hospital, however that may be generated. If you want to pretend you know nothing at that time, then just think of starting everyone at the overall average risk.</p>
</section>
<section id="denominator" class="level3">
<h3 class="anchored" data-anchor-id="denominator">2. Define the denominators</h3>
<p>Let’s assume we’ll generate one prediction per day for each patient over the course of the 30-days after they are discharged. So, we’re going to train separate models for each of those days: 1, 2, …, 30. Thus, we need to define the set of patients who were in the risk pool at each of those points in time over whatever period our training data will cover. For example, for the Day 5 model, our denominator will consist of patients who were readmitted <em>after</em> 5 days from discharge or were not readmitted at all. For the Day 20 model, patients could not have been readmitted before 20 days post-discharge. And so on. So, these denominators get smaller and smaller for increasing time points.</p>
</section>
<section id="numerator" class="level3">
<h3 class="anchored" data-anchor-id="numerator">3. Define the numerators</h3>
<p>Analogously, we need to indicate whether the patient was in fact readmitted or not. For the Day 5 denominator, we want to indicate if they were readmitted in the following 25 days. For the Day 20 denominator, we want to indicate if they were readmitted in the following 10 days.</p>
<section id="choosing-an-outcome-distribution" class="level4">
<h4 class="anchored" data-anchor-id="choosing-an-outcome-distribution">Choosing an outcome distribution</h4>
<p>As defined, the numerator sets us up for a <a href="https://en.wikipedia.org/wiki/Binary_classification">binary classification</a> model, like <a href="https://en.wikipedia.org/wiki/Logistic_regression">logistic regression</a>, or other more complex <a href="https://en.wikipedia.org/wiki/Machine_learning">machine learning</a> (ML) algorithms. However, we may alternatively think of keeping track of the actual number of days until the readmission, which conforms more to a <a href="https://en.wikipedia.org/wiki/Survival_analysis">time-to-event</a> model, like <a href="https://en.wikipedia.org/wiki/Proportional_hazards_model">Cox-proportional hazards</a> (or an <a href="https://www.randomforestsrc.org/articles/survival.html">ML equivalent</a>). In the latter case, we could choose to <a href="https://en.wikipedia.org/wiki/Censoring_(statistics)">censor</a> patients at the <img src="https://latex.codecogs.com/png.latex?D-T"> time point (e.g., 30 days), or a later time point.</p>
<p>The thing I like about the time-to-event setup is that it allows us to more easily estimate risks for any future time points, like 60 days or 90 days, and doesn’t try to equate a patient who was readmitted at 31 days with a patient who was not readmitted at all, as a binary outcome would. We know practically that these patients are not the same.</p>
</section>
</section>
<section id="append-the-predictors" class="level3">
<h3 class="anchored" data-anchor-id="append-the-predictors">4. Append the predictors</h3>
<p>Now the fun part. At a given point in time, what do we think are the main indicators/events that occur during follow-up that will impact the risk that a patient will ultimately be readmitted? Here I’m mostly focused on interventions, assuming most of the demographics and clinical history is already accounted for in the baseline risk (and we can actually use this risk as a predictor in all of the models too). This might include things like:</p>
<ul>
<li>Did they complete a follow-up visit?</li>
<li>Do they have a visit scheduled?</li>
<li>Did they fill their prescription?</li>
<li>Do they have transportation means?</li>
<li>…the list goes on…</li>
</ul>
<p>We need to define these at time point <img src="https://latex.codecogs.com/png.latex?T"> for each model. Now this list might vary by time point (e.g., if the things impacting readmission risk at Day 1 are different than those at Day 25), by disease (e.g., readmission risk factors for a post-surgical patient are presumably different than a COPD patient), or a host of other things. We might have different models by these different subgroups, so all of these nuances should be discussed as a preparatory step to modeling.</p>
</section>
<section id="calibrate-to-baseline-risk" class="level3">
<h3 class="anchored" data-anchor-id="calibrate-to-baseline-risk">5. Calibrate to baseline risk</h3>
<p>We can think of what we’re constructing as a <em>risk trajectory</em> over follow-up, so if we’re using an already-established baseline risk score at discharge, then each of our subsequent predictions can just be transformed to be relative to that, making a smooth transition from discharge through follow-up.</p>
<p>Now, you can train the models. It would also be a good idea to concurrently setup a model monitoring mechanism, to be able to continually track and evaluate model performance over time, and perform ad-hoc analysis related to the effectiveness of the tool in its intent. Setting up this infrastructure in advance allows agility in the ability to iterate and update models as needed to ensure that they stay relevant.</p>
</section>
</section>
<section id="an-updated-prototype" class="level2">
<h2 class="anchored" data-anchor-id="an-updated-prototype">An updated prototype</h2>
<p>Now suppose we have built our models and integrated them into the tool above, such that each patient gets attached to them their current risk of readmission as of <em>now</em> (the source code for this is <a href="https://github.com/centralstatz/ExampleApps/tree/main/ReadmissionRiskPool">here</a>).</p>
<p><img src="https://www.zajichekstats.com/post/managing-the-readmission-risk-pool/app2.png" class="img-fluid"></p>
<p>For example, in the popup box, Patient 254 was discharged from the hospital 12 days ago with a readmission risk of 14.1%, and has 18 days left in the risk pool. However, we now see that this patient’s <em>current</em> risk of readmission has been reduced to 2.4%, presumably due to the various interventions and events that have taken place since then. Additionally, we can see that, as a group, we expected 37 (7.4%) patients to be readmitted once discharged, but now we only expect 23 (4.6%) to be, indicating that as a hospital (system) our interventions seem to be effectively reducing risk. But we do still have the ability to identify those individuals <em>still currently</em> at high risk, by finding the dots on the map that are largest and closer to red in gradient.</p>
<p>The aggregated expected readmission rate could be a useful metric for hospital leadership to keep a “global” pulse with, being able to see when an influx of readmissions may be coming, but is driven by the individual risk estimates that the front line care teams are working with, so it’s all tied together. The longitudinal look at these metrics would also be useful in the same vein for answering questions like, “How many readmissions are we expecting in the next week?”, which would allow you to promptly allocate extra resources to put out that fire in real-time. Analogously, we could add <em>risk trajectories</em> for individual patients, such that you can view how a patient’s risk has changed each day since discharge, to get a better feel for which interventions helped reduce it (or didn’t have any effect).</p>
<p>Now we have a tool in place to proactively identify high-risk patients in real-time that is optimally integrated into clinical/operational workflows. We also have a real-time pulse on the bigger picture, such as what the overall readmission rate is, how it is changing over time, the expected <a href="https://www.cms.gov/medicare/payment/prospective-payment-systems/acute-inpatient-pps/hospital-readmissions-reduction-program-hrrp">HRRP</a> penalty amount, etc. Again, although there has been a significant improvement in the overall management of readmissions, these components may reach their limit of intended purpose, and people might start asking questions like: <em>“We can accurately identify <em>who</em> is at highest risk, but what is the best intervention to use?”</em> That’s where the last part comes in.</p>
</section>
</section>
<section id="step-3-what-should-we-do-about-it" class="level1">
<h1>Step 3: What should we do about it?</h1>
<p>If we’ve gotten to this point, there’s probably some good stuff happening, but we can always go further. Readmission reduction doesn’t necessarily have a one-size-fits-all solution, across different hospital systems or even patient populations within a hospital. Process improvement is a big component of how hospitals operate, and it would be beneficial to have the ability to customize and “try out” various interventions to see what does and doesn’t work and on which patients. Thus, we can use experimentation to rapidly test interventions to help inform <em>what</em> should done for an individual patient. Then, as this data is collected, can feed back into subsequent iterations of the predictive models to better quantify risk for individual patients.</p>
<p>For example, we may want to know whether a text or a phone call is more effective, or if we should auto-schedule follow-up appointments, or send transportation resources to be able to get patients’ prescriptions filled. In considering these things, we want to carefully design a robust infrastructure and data collection mechanisms to enable teams to rapidly test new ideas, but ensure it feeds seamlessly into the overall readmission management strategy, the central tool, and maintains statistical soundness.</p>
</section>
<section id="some-considerations" class="level1">
<h1>Some considerations</h1>
<ul>
<li><p>It is important to identify the guiding measures that will objectively indicate if these efforts are paying off. Whether it’s just the overall readmission rate, the <a href="https://www.cms.gov/medicare/payment/prospective-payment-systems/acute-inpatient-pps/hospital-readmissions-reduction-program-hrrp">HRRP</a> penalty amount, or a much more complex calculation of cost/benefit–allow that to guide development.</p></li>
<li><p>Having cross-functional involvement and buy in is essential. Someone can grab data from a database and build a model on their computer that is really accurate (statistically), but if it doesn’t fit into any clinical/operational workflow or doesn’t have the support it needs to work well in the system, does it really have value? Most of the success of a model in realizing real impact probably has little to do with the math, and mostly to do with the people and implementation.</p></li>
<li><p>Finding ways to leverage previously-established information can provide a head start. If another hospital has developed models that <em>partially</em> work for your patients, can we develop methods such that we <em>augment</em> that with what is needed for our purposes, instead of starting from scratch?</p></li>
</ul>
    <bluesky-comments post="at://did:plc:sh3av73hihgu72vx7k44kgv7/app.bsky.feed.post/3lcicrrlvgc2k" config="{}"></bluesky-comments>
  


<!-- -->

</section>

 ]]></description>
  <category>Healthcare</category>
  <category>Modeling</category>
  <category>Prediction</category>
  <guid>https://www.zajichekstats.com/post/managing-the-readmission-risk-pool/</guid>
  <pubDate>Fri, 26 Jul 2024 05:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/managing-the-readmission-risk-pool/feature.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>How do you assess the proportional-odds assumption? Directly.</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/how-to-assess-the-proportional-odds-assumption/</link>
  <description><![CDATA[ 




<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/9q_0tWT89W4" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>This dataset comes from the <a href="https://data.world/durhamnc/2011-resident-survey">2011 Annual Resident Survey</a> in Durham, NC.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import the dataset</span></span>
<span id="cb1-5">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_delim</span>(</span>
<span id="cb1-6">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://query.data.world/s/zr3uaxpaagbzddttoreosktj2zy7lm?dws=00000"</span>, </span>
<span id="cb1-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delim =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span>,</span>
<span id="cb1-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N/A"</span>)</span>
<span id="cb1-9">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-10">  </span>
<span id="cb1-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep a few columns</span></span>
<span id="cb1-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transmute</span>(</span>
<span id="cb1-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">QOL =</span> </span>
<span id="cb1-14">      q3f_quality_of_life_in_city <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-15">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-16">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_relevel</span>(</span>
<span id="cb1-17">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Very Dissatisfied"</span>,</span>
<span id="cb1-18">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Dissatisfied"</span>,</span>
<span id="cb1-19">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Neutral"</span>,</span>
<span id="cb1-20">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Satisfied"</span>,</span>
<span id="cb1-21">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Very Satisfied"</span></span>
<span id="cb1-22">      ),</span>
<span id="cb1-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">18_34_years</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"(?i)</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">syears$"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(),</span>
<span id="cb1-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Income =</span> </span>
<span id="cb1-25">      q38_annual_household_income <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-26">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-27">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_relevel</span>(</span>
<span id="cb1-28">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Under $30,000"</span>,</span>
<span id="cb1-29">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$30,000 to $59,999"</span>,</span>
<span id="cb1-30">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$60,000 to $99,999"</span>,</span>
<span id="cb1-31">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"$100,000 or more"</span></span>
<span id="cb1-32">      ),</span>
<span id="cb1-33">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sex =</span> q34_respondents_gender</span>
<span id="cb1-34">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-35">  </span>
<span id="cb1-36">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Remove missing cases</span></span>
<span id="cb1-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">na.omit</span>()</span></code></pre></div>
</details>
</div>
<p>Suppose we are interested in understanding the relationship between resident age and their perceived quality of life in the city, after adjusting for gender and annual household income. We have the following observed distribution (note that we’ve removed missing data for simplicity):</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-2">  </span>
<span id="cb2-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute group summaries</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(</span>
<span id="cb2-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb2-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> </span>
<span id="cb2-7">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb2-8">        QOL,</span>
<span id="cb2-9">        Age</span>
<span id="cb2-10">      )</span>
<span id="cb2-11">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span>  </span>
<span id="cb2-12">  </span>
<span id="cb2-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flip the order</span></span>
<span id="cb2-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">QOL =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_rev</span>(QOL)</span>
<span id="cb2-16">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-17">  </span>
<span id="cb2-18">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb2-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb2-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(</span>
<span id="cb2-21">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb2-22">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Age,</span>
<span id="cb2-23">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> N,</span>
<span id="cb2-24">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> QOL</span>
<span id="cb2-25">    ),</span>
<span id="cb2-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb2-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span></span>
<span id="cb2-28">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb2-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb2-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>),</span>
<span id="cb2-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>,</span>
<span id="cb2-33">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb2-34">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb2-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),</span>
<span id="cb2-36">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),</span>
<span id="cb2-37">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb2-38">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-39">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Respondent Age (years)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-40">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Quality of life in the city"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/how-to-assess-the-proportional-odds-assumption/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Overall, it looks like older respondents tend to report more pessimistic views of quality of life.</p>
<section id="forming-a-model" class="level1">
<h1>Forming a model</h1>
<p>A typical approach for modeling <a href="https://en.wikipedia.org/wiki/Likert_scale">likert-like</a> data is to use a <a href="https://en.wikipedia.org/wiki/Ordered_logit">proportional-odds logistic regression model</a>. It is an extension of the widely-used binary <a href="https://en.wikipedia.org/wiki/Logistic_regression">logistic regression</a> model, with one key assumption: <em>the ratio of odds between two groups (e.g., ages 35-44 versus 18-34) of being at or above a response level (e.g., satisfied or very satisfied versus neutral, dissatisfied, or very dissatisfied) are <strong>proportional</strong> (i.e., the same) regardless of where we make that comparison in the outcome</em>. So this odds ratio would also be the same if we instead compared, for example, very satisfied versus everything else.</p>
<section id="what-does-that-mean" class="level2">
<h2 class="anchored" data-anchor-id="what-does-that-mean">What does that mean?</h2>
<p>Let’s clarify this by using our model output directly. We’ll fit the model, adjusted for annual household income and gender, using the <code>MASS::polr</code> function. The age group 18-34 will serve as the reference category in which all other age groups will be compared against. <em>Note: By default the package computes odds ratios in the opposite direction to what we what we want, so we invert them.</em></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit the model</span></span>
<span id="cb3-2">mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb3-3">  MASS<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">polr</span>(</span>
<span id="cb3-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> QOL <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Income <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Sex,</span>
<span id="cb3-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> dat,</span>
<span id="cb3-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Hess =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb3-7">  )</span>
<span id="cb3-8"></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a table of odds-ratios</span></span>
<span id="cb3-10">mod<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-11">  </span>
<span id="cb3-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame</span></span>
<span id="cb3-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enframe</span>(</span>
<span id="cb3-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Term"</span>,</span>
<span id="cb3-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimate"</span></span>
<span id="cb3-16">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-17">  </span>
<span id="cb3-18">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join to get the CI</span></span>
<span id="cb3-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(</span>
<span id="cb3-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> </span>
<span id="cb3-21">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the 95% confidence intervals</span></span>
<span id="cb3-22">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confint</span>(mod) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-23">      </span>
<span id="cb3-24">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to tibble, add the coefficient names</span></span>
<span id="cb3-25">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-26">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Term =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(mod<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients)),</span>
<span id="cb3-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Term"</span></span>
<span id="cb3-28">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-29">  </span>
<span id="cb3-30">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter to age factor only</span></span>
<span id="cb3-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(Term, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^Age"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-32">  </span>
<span id="cb3-33">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clean up</span></span>
<span id="cb3-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb3-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Term =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove</span>(Term, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^Age"</span>),</span>
<span id="cb3-36">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(</span>
<span id="cb3-37">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric),</span>
<span id="cb3-38">      \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sprintf</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%.2f"</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x))</span>
<span id="cb3-39">    )</span>
<span id="cb3-40">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-41">  </span>
<span id="cb3-42">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename</span></span>
<span id="cb3-43">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(</span>
<span id="cb3-44">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age (years)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Term,</span>
<span id="cb3-45">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Odds-ratio</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Estimate,</span>
<span id="cb3-46">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Lower =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">97.5 %</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,</span>
<span id="cb3-47">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Upper =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">2.5 %</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span></span>
<span id="cb3-48">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-49">  </span>
<span id="cb3-50">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Change location</span></span>
<span id="cb3-51">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relocate</span>(Lower, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.before =</span> Upper) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-52">  </span>
<span id="cb3-53">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the reference row</span></span>
<span id="cb3-54">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb3-55">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age (years)</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"18-34"</span>,</span>
<span id="cb3-56">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Odds-ratio</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>,</span>
<span id="cb3-57">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Lower =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>,</span>
<span id="cb3-58">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Upper =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"-"</span>,</span>
<span id="cb3-59">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.before =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb3-60">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-61">  </span>
<span id="cb3-62">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a table</span></span>
<span id="cb3-63">  knitr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"html"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-64">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">kable_styling</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-65">  kableExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_header_above</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"95% CI"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
</details>
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide; border-bottom: hidden;"></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
95% CI
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th">Age (years)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Odds-ratio</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Lower</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">18-34</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
</tr>
<tr class="even">
<td style="text-align: left;">35-44</td>
<td style="text-align: left;">1.24</td>
<td style="text-align: left;">0.67</td>
<td style="text-align: left;">2.30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">45-54</td>
<td style="text-align: left;">1.13</td>
<td style="text-align: left;">0.64</td>
<td style="text-align: left;">1.98</td>
</tr>
<tr class="even">
<td style="text-align: left;">55-64</td>
<td style="text-align: left;">1.74</td>
<td style="text-align: left;">0.97</td>
<td style="text-align: left;">3.12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">65-74</td>
<td style="text-align: left;">3.02</td>
<td style="text-align: left;">1.40</td>
<td style="text-align: left;">6.54</td>
</tr>
<tr class="even">
<td style="text-align: left;">75+</td>
<td style="text-align: left;">0.93</td>
<td style="text-align: left;">0.30</td>
<td style="text-align: left;">2.88</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Generally, the estimates pan out roughly how we suspected. In particular, the estimated odds of <em>worse</em> perceived quality of life in the city for 65-74 year olds are 3 times that of 18-34 year olds, after adjusting for annual household income and gender (with a 95% <a href="https://en.wikipedia.org/wiki/Confidence_interval">confidence interval</a> of 1.4 to 6.5).</p>
<p>Again, this interpretation is assumed to hold true if “worse” is defined as <em>very dissatisfied</em> versus everything else, or <em>very dissatisfied</em> through <em>satisfied</em> versus <em>very satisfied</em>, and everything in between.</p>
</section>
</section>
<section id="does-the-assumption-hold" class="level1">
<h1>Does the assumption hold?</h1>
<p>The question becomes whether that big assumption of proportional-odds actually holds. We may have reason to think, from the data or gut instinct, that it might not. Well, one simple way to check is by <em>directly</em> assessing what it implies.</p>
<section id="continue" class="level2">
<h2 class="anchored" data-anchor-id="continue">Continue…</h2>
<p>We said earlier that the model assumes the same odds ratios for any mutually exclusive comparison of the ordered response categories. Thus, we can free up this constraint by thinking of constructing a collection of <em>binary</em> logistic regression models: one for each of those ordinal comparisons. Specifically,</p>
<ul>
<li><em>Very Dissatisfied</em> versus everything else</li>
<li><em>Very Dissatisfied</em> or <em>Dissatisfied</em> versus everything else</li>
<li><em>Very Dissatisfied</em>, <em>Dissatisfied</em>, or <em>Neutral</em> versus <em>Satisfied</em> or <em>Very Satisfied</em></li>
<li><em>Very Dissatisfied</em> through <em>Satisfied</em> versus <em>Very Satisfied</em></li>
</ul>
<p>Then, we simply just look to see if the resulting odds ratios are reasonably similar across all of those models. If so, then we can be somewhat confident that it <em>can</em> be reduced to a single model, and stick with our original proportional-odds estimates.</p>
<p>My preference is to do this in a plot.</p>
</section>
<section id="making-the-plot" class="level2">
<h2 class="anchored" data-anchor-id="making-the-plot">Making the plot</h2>
<p>We’ll cycle through the response categories, iteratively define the binary outcomes as described above, and then fit a logistic regression model for each definition. Once we do this, we get the following plot:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the number of comparisons</span></span>
<span id="cb4-2">n_comp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n_distinct</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>QOL) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make each data set</span></span>
<span id="cb4-5"><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n_comp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-6">  </span>
<span id="cb4-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For each set</span></span>
<span id="cb4-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(</span>
<span id="cb4-9">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(.index) {</span>
<span id="cb4-10">      </span>
<span id="cb4-11">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract the current response set</span></span>
<span id="cb4-12">      temp_resp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>QOL)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>.index]</span>
<span id="cb4-13">      </span>
<span id="cb4-14">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create binary outcome in the data</span></span>
<span id="cb4-15">      temp_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb4-16">        dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-17">        </span>
<span id="cb4-18">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create target</span></span>
<span id="cb4-19">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb4-20">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Response =</span> </span>
<span id="cb4-21">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb4-22">              QOL <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> temp_resp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb4-23">              <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb4-24">            )</span>
<span id="cb4-25">        )</span>
<span id="cb4-26">      </span>
<span id="cb4-27">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit the binary logistic regression model</span></span>
<span id="cb4-28">      temp_mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb4-29">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(</span>
<span id="cb4-30">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> Response <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Income <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> Sex,</span>
<span id="cb4-31">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> temp_dat,</span>
<span id="cb4-32">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"binomial"</span></span>
<span id="cb4-33">        )</span>
<span id="cb4-34">      </span>
<span id="cb4-35">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a table of odds-ratios</span></span>
<span id="cb4-36">      temp_mod<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-37">        </span>
<span id="cb4-38">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to data frame</span></span>
<span id="cb4-39">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">enframe</span>(</span>
<span id="cb4-40">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Term"</span>,</span>
<span id="cb4-41">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">value =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimate"</span></span>
<span id="cb4-42">        ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-43">        </span>
<span id="cb4-44">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join to get the CI</span></span>
<span id="cb4-45">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(</span>
<span id="cb4-46">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> </span>
<span id="cb4-47">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the 95% confidence intervals</span></span>
<span id="cb4-48">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confint.default</span>(temp_mod) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-49">            </span>
<span id="cb4-50">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to tibble, add the coefficient names</span></span>
<span id="cb4-51">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as_tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-52">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Term =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(temp_mod<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients)),</span>
<span id="cb4-53">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Term"</span></span>
<span id="cb4-54">        ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-55">        </span>
<span id="cb4-56">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter to age factor only</span></span>
<span id="cb4-57">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_detect</span>(Term, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^Age"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-58">        </span>
<span id="cb4-59">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clean up</span></span>
<span id="cb4-60">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb4-61">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Term =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_remove</span>(Term, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^Age"</span>),</span>
<span id="cb4-62">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(</span>
<span id="cb4-63">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric),</span>
<span id="cb4-64">            \(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x)</span>
<span id="cb4-65">          )</span>
<span id="cb4-66">        ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-67">        </span>
<span id="cb4-68">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rename</span></span>
<span id="cb4-69">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(</span>
<span id="cb4-70">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age =</span> Term,</span>
<span id="cb4-71">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">OR =</span> Estimate,</span>
<span id="cb4-72">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Lower =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">2.5 %</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,</span>
<span id="cb4-73">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Upper =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">97.5 %</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span></span>
<span id="cb4-74">        ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-75">        </span>
<span id="cb4-76">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the reference row</span></span>
<span id="cb4-77">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_row</span>(</span>
<span id="cb4-78">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"18-34"</span>,</span>
<span id="cb4-79">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">OR =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb4-80">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Lower =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb4-81">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Upper =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb4-82">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.before =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb4-83">        ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-84">        </span>
<span id="cb4-85">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Attach outcome level</span></span>
<span id="cb4-86">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">QOL =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">levels</span>(dat<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>QOL)[.index])</span>
<span id="cb4-87">      </span>
<span id="cb4-88">    },</span>
<span id="cb4-89">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.id =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Order"</span></span>
<span id="cb4-90">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-91">  </span>
<span id="cb4-92">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make the factor</span></span>
<span id="cb4-93">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb4-94">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Order =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(Order),</span>
<span id="cb4-95">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">QOL =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(QOL) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_reorder</span>(Order)</span>
<span id="cb4-96">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-97">  </span>
<span id="cb4-98">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb4-99">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb4-100">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb4-101">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> QOL,</span>
<span id="cb4-102">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> OR,</span>
<span id="cb4-103">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb4-104">    )</span>
<span id="cb4-105">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-106">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(</span>
<span id="cb4-107">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb4-108">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> Age</span>
<span id="cb4-109">    ),</span>
<span id="cb4-110">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span></span>
<span id="cb4-111">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-112">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb4-113">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb4-114">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> Age</span>
<span id="cb4-115">    ),</span>
<span id="cb4-116">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb4-117">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-118">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ribbon</span>(</span>
<span id="cb4-119">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb4-120">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> Lower,</span>
<span id="cb4-121">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> Upper,</span>
<span id="cb4-122">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Age</span>
<span id="cb4-123">    ),</span>
<span id="cb4-124">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span></span>
<span id="cb4-125">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-126">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-127">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(Age, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" years"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-128">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_cartesian</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-129">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb4-130">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb4-131">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>),</span>
<span id="cb4-132">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,</span>
<span id="cb4-133">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),</span>
<span id="cb4-134">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>),</span>
<span id="cb4-135">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">angle =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">45</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb4-136">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>),</span>
<span id="cb4-137">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>)</span>
<span id="cb4-138">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-139">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Response"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-140">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Odds-ratio (95% CI) for being at or below response level"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/how-to-assess-the-proportional-odds-assumption/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Unfortunately we’re quite plagued by variability here, especially in the lower-end (i.e., <em>very dissatisfied</em> versus everything else), due to scanty event volumes, but you get the picture. Actually, for 65-74 year olds, the proportional-odds assumption seems to be a reasonable one: it was estimated earlier at 3.02, and we see the point estimates across these binary models vary between 2.5-3.5.</p>
<p>For other age categories, it may not be so good of an assumption. It looks like 35-44 and 55-64 year olds tend to have a much higher odds of responding <em>very dissatisfied</em> relative to 18-34 year olds, but there is much less of a difference (in all age categories) for the odds of responding <em>very satisfied</em>, suggesting something like older residents may make a point to select the least favorable response but don’t see much difference between being <em>satisfied</em> or <em>very satisfied</em>.</p>
</section>
<section id="so-what-do-we-do-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="so-what-do-we-do-in-practice">So what do we do in practice?</h2>
<p>First, the same proportional-odds assumptions hold for all covariates in the model, so we would also want to assess this for annual household income and gender. Second, if the assumption is not met, then we need to accommodate that by introducing more flexibility into the model. That may be by being clever with interaction terms, defining sensible groups to create, or by using separate binary models for each possible comparison, as we’ve done here. It’s really a judgement call.</p>
    <bluesky-comments post="at://did:plc:sh3av73hihgu72vx7k44kgv7/app.bsky.feed.post/3lc73sgvuqk2t" config="{}"></bluesky-comments>
  


<!-- -->

</section>
</section>

 ]]></description>
  <category>Regression</category>
  <guid>https://www.zajichekstats.com/post/how-to-assess-the-proportional-odds-assumption/</guid>
  <pubDate>Fri, 19 Jul 2024 05:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/how-to-assess-the-proportional-odds-assumption/feature.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>A simple example why statistical significance is insufficient for action</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/simple-example-why-statistical-significance-is-insufficient/</link>
  <description><![CDATA[ 




<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/IWWONFhgVY4" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>When we see the phrase <em>statistically significant</em>, we’re often meant to believe it means that the result matters, but that is not the case. Here is a simple example why.</p>
<blockquote class="blockquote">
<p><span style="text-decoration: underline;">Context</span>: <em>Suppose we are trying to hone in on a market segment that yields higher sales so that we can develop better strategies for acquiring customers in that group.</em></p>
</blockquote>
<p>We decide to correlate the customer age with the sales amount. Suppose there are two scenarios from a sample of 500 customers:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="do" style="color: #5E5E5E;
background-color: null;
font-style: italic;">## Simulate some data</span></span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the seed for reproducibility</span></span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123456789</span>)</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sample size</span></span>
<span id="cb1-10">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span></span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create the data set</span></span>
<span id="cb1-13">sim_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb1-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb1-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">18</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rgamma</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>)),</span>
<span id="cb1-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sales_Large =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (Age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Age)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb1-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sales_Small =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (Age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Age)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-18">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-19">  </span>
<span id="cb1-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send down the rows</span></span>
<span id="cb1-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb1-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales"</span>),</span>
<span id="cb1-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Effect"</span>,</span>
<span id="cb1-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales"</span>,</span>
<span id="cb1-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_prefix =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales_"</span></span>
<span id="cb1-26">  ) </span>
<span id="cb1-27"></span>
<span id="cb1-28">sim_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-29">  </span>
<span id="cb1-30">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a paneled scatterplot</span></span>
<span id="cb1-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb1-33">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb1-34">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Age,</span>
<span id="cb1-35">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Sales,</span>
<span id="cb1-36">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Effect</span>
<span id="cb1-37">    ),</span>
<span id="cb1-38">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,</span>
<span id="cb1-39">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb1-40">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb1-41">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb1-42">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-43">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Effect, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb1-45">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb1-46">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,</span>
<span id="cb1-47">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb1-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb1-49">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb1-50">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),</span>
<span id="cb1-51">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>),</span>
<span id="cb1-52">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.spacing.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>)</span>
<span id="cb1-53">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-54">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Customer Age (years)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-55">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales ($)"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/simple-example-why-statistical-significance-is-insufficient/index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>At a glance these graphs look very similar, such that age is positively correlated with the sales amount. We fit a <a href="https://en.wikipedia.org/wiki/Linear_regression">linear regression</a> model, or “best-fit line”, to summarize and describe the relationship.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit the models</span></span>
<span id="cb2-2">sim_models <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb2-3">  sim_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-4">  </span>
<span id="cb2-5">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nest the data</span></span>
<span id="cb2-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nest</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> Effect) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-7">  </span>
<span id="cb2-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit a linear model for each data set; get p-values</span></span>
<span id="cb2-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-10">    </span>
<span id="cb2-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit the model</span></span>
<span id="cb2-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">model =</span> </span>
<span id="cb2-13">      data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-14">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(</span>
<span id="cb2-15">        \(.dat) </span>
<span id="cb2-16">        </span>
<span id="cb2-17">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(</span>
<span id="cb2-18">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> Sales <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Age,</span>
<span id="cb2-19">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> .dat</span>
<span id="cb2-20">        )</span>
<span id="cb2-21">        </span>
<span id="cb2-22">      ),</span>
<span id="cb2-23">    </span>
<span id="cb2-24">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the p-value</span></span>
<span id="cb2-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pvalue =</span> </span>
<span id="cb2-26">      model <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-27">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(</span>
<span id="cb2-28">        \(.model) </span>
<span id="cb2-29">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pt</span>(</span>
<span id="cb2-30">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">q =</span> .model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sqrt</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">diag</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vcov</span>(.model))), </span>
<span id="cb2-31">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">df =</span> .model<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>df.residual, </span>
<span id="cb2-32">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lower.tail =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb2-33">        )[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]]</span>
<span id="cb2-34">      )</span>
<span id="cb2-35">  )</span>
<span id="cb2-36"></span>
<span id="cb2-37">sim_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-38">  </span>
<span id="cb2-39">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a paneled scatterplot</span></span>
<span id="cb2-40">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb2-42">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb2-43">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Age,</span>
<span id="cb2-44">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Sales,</span>
<span id="cb2-45">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Effect</span>
<span id="cb2-46">    ),</span>
<span id="cb2-47">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,</span>
<span id="cb2-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb2-49">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb2-50">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb2-51">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-52">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(</span>
<span id="cb2-53">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb2-54">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Age,</span>
<span id="cb2-55">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Sales</span>
<span id="cb2-56">    ),</span>
<span id="cb2-57">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>x,</span>
<span id="cb2-58">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,</span>
<span id="cb2-59">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb2-60">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb2-61">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-62">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(</span>
<span id="cb2-63">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> </span>
<span id="cb2-64">      sim_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-65">      </span>
<span id="cb2-66">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract the p-value</span></span>
<span id="cb2-67">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> pvalue) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-68">      </span>
<span id="cb2-69">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clean up p-value</span></span>
<span id="cb2-70">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-71">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pvalue =</span> </span>
<span id="cb2-72">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb2-73">            pvalue <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;0.001"</span>,</span>
<span id="cb2-74">            <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(pvalue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span>
<span id="cb2-75">          )</span>
<span id="cb2-76">      ),</span>
<span id="cb2-77">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb2-78">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>,</span>
<span id="cb2-79">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">160</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">496.5</span>),</span>
<span id="cb2-80">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P-value: "</span>, pvalue)</span>
<span id="cb2-81">    )</span>
<span id="cb2-82">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-83">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Effect, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-84">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb2-85">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb2-86">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,</span>
<span id="cb2-87">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb2-88">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb2-89">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb2-90">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),</span>
<span id="cb2-91">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>),</span>
<span id="cb2-92">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.spacing.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>)</span>
<span id="cb2-93">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-94">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Customer Age (years)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb2-95">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales ($)"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/simple-example-why-statistical-significance-is-insufficient/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The <a href=""><em>p-values</em></a> for both of these models are extremely, and <em>equally</em>, small (&lt;0.1%), indicating <a href="">statistical significance</a>. In fact, the evidence is so strong that some might say it is <em>very</em> significant–much smaller than the standard (and <a href="">infamous</a>) rule of thumb threshold of 5%.</p>
<p><strong>It is based on this information alone that often would elicit the conclusion/statement/finding that <em>age is significantly associated with sales</em></strong>.</p>
<p>You hear this language all the time, especially in research. It brings with it certain implications of importance, as if it has now become a meaningful fact that should warrant attention and/or action.</p>
<p>The problem?</p>
<p>Watch what happens when we add the actual scales for sales to these graphs (if you’ve noticed, they’ve been missing this whole time):</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">sim_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-2">    </span>
<span id="cb3-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a paneled scatterplot</span></span>
<span id="cb3-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb3-6">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb3-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Age,</span>
<span id="cb3-8">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Sales,</span>
<span id="cb3-9">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Effect</span>
<span id="cb3-10">        ),</span>
<span id="cb3-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,</span>
<span id="cb3-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb3-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb3-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb3-15">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(</span>
<span id="cb3-17">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb3-18">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Age,</span>
<span id="cb3-19">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Sales</span>
<span id="cb3-20">        ),</span>
<span id="cb3-21">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>x,</span>
<span id="cb3-22">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,</span>
<span id="cb3-23">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb3-24">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb3-25">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-26">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(</span>
<span id="cb3-27">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> </span>
<span id="cb3-28">            sim_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-29">            </span>
<span id="cb3-30">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract the p-value</span></span>
<span id="cb3-31">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> pvalue) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-32">            </span>
<span id="cb3-33">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clean up p-value</span></span>
<span id="cb3-34">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb3-35">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pvalue =</span> </span>
<span id="cb3-36">                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb3-37">                        pvalue <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;0.001"</span>,</span>
<span id="cb3-38">                        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(pvalue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span>
<span id="cb3-39">                    )</span>
<span id="cb3-40">            ),</span>
<span id="cb3-41">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb3-42">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>,</span>
<span id="cb3-43">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">160</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">496.5</span>),</span>
<span id="cb3-44">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P-value: "</span>, pvalue)</span>
<span id="cb3-45">        )</span>
<span id="cb3-46">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-47">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Effect, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free_y"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-48">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb3-49">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb3-50">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,</span>
<span id="cb3-51">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb3-52">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),</span>
<span id="cb3-53">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>),</span>
<span id="cb3-54">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.spacing.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>)</span>
<span id="cb3-55">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-56">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Customer Age (years)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb3-57">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(</span>
<span id="cb3-58">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales ($)"</span>,</span>
<span id="cb3-59">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> \(x) scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dollar</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">accuracy =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb3-60">    )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/simple-example-why-statistical-significance-is-insufficient/index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>On the left panel, the range of sales goes from approximately $200 to $1000 per customer in an increasing fashion with age. On the right panel, it goes from about $497 to $503–a few dollars. See the issue yet? To solidify this, let’s look at the graphs when they are on the <em>same</em> scale:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">sim_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-2">    </span>
<span id="cb4-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a paneled scatterplot</span></span>
<span id="cb4-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb4-6">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb4-7">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Age,</span>
<span id="cb4-8">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Sales,</span>
<span id="cb4-9">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Effect</span>
<span id="cb4-10">        ),</span>
<span id="cb4-11">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">21</span>,</span>
<span id="cb4-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb4-13">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb4-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb4-15">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-16">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(</span>
<span id="cb4-17">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb4-18">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Age,</span>
<span id="cb4-19">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Sales</span>
<span id="cb4-20">        ),</span>
<span id="cb4-21">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>x,</span>
<span id="cb4-22">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lm"</span>,</span>
<span id="cb4-23">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb4-24">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">se =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb4-25">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-26">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(</span>
<span id="cb4-27">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> </span>
<span id="cb4-28">            sim_models <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-29">            </span>
<span id="cb4-30">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract the p-value</span></span>
<span id="cb4-31">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> pvalue) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-32">            </span>
<span id="cb4-33">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clean up p-value</span></span>
<span id="cb4-34">            <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb4-35">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pvalue =</span> </span>
<span id="cb4-36">                    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb4-37">                        pvalue <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.001</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"&lt;0.001"</span>,</span>
<span id="cb4-38">                        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.character</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(pvalue, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>))</span>
<span id="cb4-39">                    )</span>
<span id="cb4-40">            ),</span>
<span id="cb4-41">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb4-42">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>,</span>
<span id="cb4-43">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">160</span>,</span>
<span id="cb4-44">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P-value: "</span>, pvalue)</span>
<span id="cb4-45">        )</span>
<span id="cb4-46">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-47">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Effect) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-48">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb4-49">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb4-50">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,</span>
<span id="cb4-51">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb4-52">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),</span>
<span id="cb4-53">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>),</span>
<span id="cb4-54">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.spacing.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>)</span>
<span id="cb4-55">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-56">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Customer Age (years)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb4-57">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(</span>
<span id="cb4-58">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sales ($)"</span>,</span>
<span id="cb4-59">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> \(x) scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dollar</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">accuracy =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb4-60">    )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/simple-example-why-statistical-significance-is-insufficient/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The line in the right panel is basically flat.</p>
<p>It turns out that although these two graphs have the <strong>same</strong> amount of <em>statistical</em> significance, they clearly tell much different stories about how age relates to sales. The lines can be summarized as follows:</p>
<ul>
<li><p><span style="text-decoration: underline;">Left panel</span>: The average sales increases by $104.55 on average for every 10 year increase in customer age.</p></li>
<li><p><span style="text-decoration: underline;">Right panel</span>: The average sales increases by $0.94 on average for every 10 year increase in customer age.</p></li>
</ul>
<p>In the context of performing market segmentation for increased revenue (or whatever else it may be), these magnitudes certainly matter. Statistically, they don’t.</p>
<section id="some-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="some-takeaways">Some takeaways</h2>
<ol type="1">
<li><p>Statistical significance only pertains to the <em>existence</em> of a relationship (under the implied assumptions), not the size of it.</p></li>
<li><p>You must pay attention to the <em>magnitude</em> of the relationship to gain any meaningful insight.</p></li>
<li><p>The magnitudes should be translated to the <em>real-world</em> implications of using the information for different decisions or courses of action. In the example above, the market age distribution looks like this:</p></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">sim_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-2">  </span>
<span id="cb5-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a paneled scatterplot</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_histogram</span>(</span>
<span id="cb5-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb5-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Age</span>
<span id="cb5-8">    ),</span>
<span id="cb5-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>,</span>
<span id="cb5-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb5-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb5-12">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb5-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>,</span>
<span id="cb5-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strip.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb5-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">14</span>),</span>
<span id="cb5-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">16</span>)</span>
<span id="cb5-19">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Customer Age (years)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Customers"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/simple-example-why-statistical-significance-is-insufficient/index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Although older customers yield higher sales, it may cost more marketing dollars to acquire any given individual from such a small segment, ultimately making the juice not worth the squeeze. Feeding estimates into cost-benefit or what-if scenarios can greatly increase confidence in how a proposed course of action would actually play out, instead of implementing things on the basis of mere existence (i.e., statistical significance).</p>
    <bluesky-comments post="at://did:plc:sh3av73hihgu72vx7k44kgv7/app.bsky.feed.post/3lc73zfajos2t" config="{}"></bluesky-comments>
  


<!-- -->

</section>

 ]]></description>
  <category>Statistical Significance</category>
  <category>Decision Making</category>
  <guid>https://www.zajichekstats.com/post/simple-example-why-statistical-significance-is-insufficient/</guid>
  <pubDate>Wed, 19 Jun 2024 05:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/simple-example-why-statistical-significance-is-insufficient/feature.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>5 ways to help ensure success of a statistical project</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/ways-to-ensure-success-of-statistical-project/</link>
  <description><![CDATA[ 




<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/blO16Uuo68E" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>Sometimes stats projects don’t go as planned. There are delays, setbacks, surprises, ambiguity, scope creep…the list goes on. All of these things can lead to a seemingly longer list of questions than what was started with: <em>Did we answer the research question? Are we confident in the result? What do we do now?</em> It’s a sense of dissatisfaction.</p>
<p>Many of these issues stem from the early phases of the project, and (maybe I should collect data on this) they can largely be alleviated when more care is taken at that stage. Actually, the <a href="https://theeffectbook.net/">book I’m currently reading</a> summed it up perfectly, <em>“Well-designed research is research capable of answering the question it’s trying to answer”</em>. Sounds obtuse, but it is undoubtedly true, even for projects outside of what you may define as “research”. This is about proper planning. So here are 5 things that can help increase the likelihood of a successful statistical project:</p>
<section id="assembleteam" class="level1">
<h1>1. Assemble your team…early</h1>
<p>It’s often a misconception that the statistician’s role is to simply analyze, or “run the tests on”, the data at the end once it is collected. This is far from optimal. Statistical analysis is not systematic or mechanical. Rather, it requires knowledge and intuition about the subject matter context. Add in a lack of transparency to the data collection itself, the chances of lost insight definitely increase. In fact, it might be the case that a few poor design choices end up adding huge complexities in answering the original question, or maybe even make it impossible altogether. So, if you have a project idea, consult your statistician! Early and often during the development phase.</p>
<p>Now, data people are certainly not the only ones you need involved early. Far from it. Who better to help shape the final product than the end-users—the people who will actually be using the information <em>and</em> know what works? If you want to integrate models into your operational workflow, what sort of resource or technical constraints may there be? Well, we probably have to talk to systems and IT people who will also likely need to commit their own resources for upkeep. And it comes full circle, because all of these nuances may even affect the statistical choices made from a mathematical perspective (i.e., design, modeling framework, etc.). There are plenty more important roles that could be described here, but the bottom line is that cross-functional collaboration, from the beginning, is crucial.</p>
</section>
<section id="make-the-goals-clear-then-plan-accordingly" class="level1">
<h1>2. Make the goals clear, then plan accordingly</h1>
<p>There is a common issue in data projects of ambiguous or non-specific objectives. Statistics is inherently “gray”, by definition, because there is no right answer. Uncertainty always exists. So unless you already know exactly what you’re looking for in the data, without a clearly defined goal, you can find yourself spinning in circles and never know when what you’ve done is sufficient to move on.</p>
<p>My recommendation is to have multiple levels: the <em>statistical</em> goals and the real-world goals that they are supporting. The statistical goals should be stated as clear, specific questions with quantitative answers that data (among other things) will be used to estimate. However, we have to think about how these statistical quantities will be <em>used</em> afterwards. For example, the approach taken to estimate the likelihood of a customer buying a product (a statistical goal) may differ if we’re trying to decrease costs versus increase retention, especially when thinking about the solution as a whole. The question comes down to what we are trying to accomplish with the new information. Once that is clear, we can envision the roadmap for how it will be used, which can be an anchor for developing the right methodology, making analytic decisions easier to manage.</p>
</section>
<section id="think-about-taking-action" class="level1">
<h1>3. Think about taking action</h1>
<p>Once you obtain the new information you set out to find, what are you going to do about it? Under what circumstances? Based on which results? Having some inkling as to what it is going to enable (or disable) someone to do–not just in general, but a specific example–adds clarity to the practical implications of investing the time and money into finding the answers. These things can unravel many of the nuances that were originally an oversight, and may end up causing changes to how the information gets disseminated, who gets involved and when, or even the math itself. All in all, it allows for more proper design at the beginning, a reduction of wasted time/resources, and a better chance of finding the right solution. The reason we perform statistical analysis is (or should be) to inform some action or decision. If it doesn’t, then you may need to think about why that is and adjust. My favorite way to frame this to someone is by asking a simple question: <em>“If you knew X at time Y then you could do Z. What are X, Y and Z?”</em>.</p>
</section>
<section id="create-a-tangible-product" class="level1">
<h1>4. Create a tangible product</h1>
<p>It may sound trivial, but it’s worth thinking about (and even explicitly defining). By what means will the result or solution be delivered? To whom? When? How? Is it going to be a comprehensive report or just a number sent in an email? It might even be a model deployed in the organization’s systems and workflows, or an application hosted on the web. These tell you all sorts of things about who should get involved (see #1) and what it will take to get there. It is about ensuring that the right information gets to the right people at the right time in an expected and predictable manner. It can be the case that a data project fails not because of bad statistics or models, but because it wasn’t disseminated optimally. Having a tangible end-product that you can work towards keeps everyone’s eye on the ball, exposes where the problems are, helps you plan deliverables, create milestones, and makes it clear when you are veering off course.</p>
</section>
<section id="answer-the-question-did-it-work" class="level1">
<h1>5. Answer the question, “did it work?”</h1>
<p>Oftentimes when you look at a statistic like a p-value, it leaves an empty feeling like you haven’t been convinced. That’s because it does not yet directly translate to the real-world impact the new insight is supposed to address. Maybe it’s useful during data analysis, but we should be thinking beyond the inferences made from the sample at hand to what we need to see to convince us that the results really matter. If the information we’ve garnered is actually useful, then we should expect improvements to play out where the rubber meets the road once it is utilized. The most direct way to do this: test it.</p>
    <bluesky-comments post="at://did:plc:sh3av73hihgu72vx7k44kgv7/app.bsky.feed.post/3lc747wvce22t" config="{}"></bluesky-comments>
  


</section>

 ]]></description>
  <category>Project Management</category>
  <guid>https://www.zajichekstats.com/post/ways-to-ensure-success-of-statistical-project/</guid>
  <pubDate>Thu, 16 May 2024 05:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/ways-to-ensure-success-of-statistical-project/feature.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Quantum entanglement from a statistician’s perspective</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/quantum-entanglement-from-statistical-perspective/</link>
  <description><![CDATA[ 




<p><em>Quantum entanglement</em> is an intimidating phrase to encounter when you barely know what <em>quantum</em> means (and maybe it is even if you do). My daughter’s book, <a href="https://www.amazon.com/Quantum-Entanglement-Babies-Baby-University/dp/1492656232"><em>Quantum Entanglement for Babies</em></a>, also does a good job of keeping the mystery alive:</p>
<p><img src="https://www.zajichekstats.com/post/quantum-entanglement-from-statistical-perspective/QEPage.png" class="img-fluid"></p>
<p>Now I’ve just barely scratched the surface in quantum computing (and I mean <em>barely</em>, like I’ve gotten so far as to understand how to build a circuit to add two bits together. Yes, 1 + 1 = 2). But as I was going through the section on quantum entanglement in <a href="https://github.com/Qiskit/textbook/tree/main/notebooks/intro">this tutorial</a>, I immediately noticed something familiar that it was getting at (albeit in an unfamiliar, roundabout way). And that was <em>statistical independence</em>.</p>
<section id="some-background" class="level1">
<h1>Some background</h1>
<p>We can represent the state of <a href="https://en.wikipedia.org/wiki/Qubit"><em>qubits</em></a> (like a <a href="https://en.wikipedia.org/wiki/Bit"><em>bit</em></a>, but in quantum), at a given point in time, as <em>state vectors</em>, which (loosely) correspond to the probability they will be measured in a particular state.</p>
<p>For example, suppose we have a qubit, <img src="https://latex.codecogs.com/png.latex?q_0">, that has the following state vector:</p>
<p><img src="https://latex.codecogs.com/png.latex?q_0%20=%20%7C0%5Crangle%20=%20%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D%201%20%5C%5C%200%20%5C%5C%20%5Cend%7Barray%7D%5Cright%5D"></p>
<p>The <em>positions</em> of the vector represent the possible states the qubit can be in. Namely, since it’s basically just a <a href="https://en.wikipedia.org/wiki/Bit">bit</a>, 0 (position 1) or 1 (position 2). The <em>entries</em> in the vector represent (again, loosely) the probability that the qubit will take on that state when measured. So in this example,</p>
<p><img src="https://latex.codecogs.com/png.latex?P(q_0%20=%200)%20=%201%20%5Chskip.1in%20P(q_0=1)=0"> It will <em>always</em> be measured in the 0 state.</p>
<p>Now suppose we introduce another qubit, <img src="https://latex.codecogs.com/png.latex?q_1">. And remember, computers just store information as sequences of bits. This qubit can also only be measured in states 0 or 1. Thus, the possible <a href="https://en.wikipedia.org/wiki/Binary_code">bit strings</a> are:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><img src="https://latex.codecogs.com/png.latex?q_1q_0"></th>
<th>Represents the number…</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>00</td>
<td><img src="https://latex.codecogs.com/png.latex?(0%5Ctimes2%5E1)%20+%20(0%20%5Ctimes%202%5E0)%20=%200"></td>
</tr>
<tr class="even">
<td>01</td>
<td><img src="https://latex.codecogs.com/png.latex?(0%5Ctimes2%5E1)%20+%20(1%20%5Ctimes%202%5E0)%20=%201"></td>
</tr>
<tr class="odd">
<td>10</td>
<td><img src="https://latex.codecogs.com/png.latex?(1%5Ctimes2%5E1)%20+%20(0%20%5Ctimes%202%5E0)%20=%202"></td>
</tr>
<tr class="even">
<td>11</td>
<td><img src="https://latex.codecogs.com/png.latex?(1%5Ctimes2%5E1)%20+%20(1%20%5Ctimes%202%5E0)%20=%203"></td>
</tr>
</tbody>
</table>
<p>So one possible two-qubit state vector is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%7C01%5Crangle%20=%20%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D%200%20%5C%5C%201%20%5C%5C%200%20%5C%5C%200%20%5C%5C%20%5Cend%7Barray%7D%5Cright%5D"></p>
<p>where, again, the <em>positions</em> represent the possible sequences of qubits (00, 01, 10, 11; there will always be <img src="https://latex.codecogs.com/png.latex?2%5En"> possible states, where <img src="https://latex.codecogs.com/png.latex?n"> is the number of qubits), and the entries (for the third time, loosely) represent the probability of measuring that sequence. In this case,</p>
<p><img src="https://latex.codecogs.com/png.latex?P(q_0%20=%201%20%5Ccap%20q_1%20=%200)%20=%201;%20%5Chskip.1in%20P(%5Ctext%7Bother%20combos%7D)%20=%200"> So now we can imagine the more interesting case where more than one entry is non-zero, that is, multiple different states have a positive probability of being measured. Given it still has to lead to a valid probability distribution, this means that the 100% must be distributed amongst the possibilities.</p>
<p>The final thing I’ll leave here is that the entries actually represent the <em>square root</em> of the probability, which is why I’ve been emphasizing probability “loosely”. So the “valid probability distribution” constraint applies to the <em>square</em> of the vector entries. In the first example above, a more complete way to write this would be:</p>
<p><img src="https://latex.codecogs.com/png.latex?P(q_0%20=%200)%20=%201%5E2%20=%201%20%5Chskip.1in%20P(q_0=1)%20=%200%5E2%20=%200"></p>
</section>
<section id="what-is-entanglement" class="level1">
<h1>What is entanglement?</h1>
<p>The <a href="https://github.com/Qiskit/textbook/blob/main/notebooks/intro/entangled-states.ipynb">tutorial</a> has us consider a couple of two-qubit state vectors:</p>
<p><img src="https://latex.codecogs.com/png.latex?%7C%5CPhi%5E+%5Crangle%20=%20%5Cfrac%7B1%7D%7B%5Csqrt%7B2%7D%7D%20%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D%201%20%5C%5C%200%20%5C%5C%200%20%5C%5C%201%20%5C%5C%20%5Cend%7Barray%7D%5Cright%5D%20%5Chskip.2in%20%7C+0%5Crangle%20=%20%5Cfrac%7B1%7D%7B%5Csqrt%7B2%7D%7D%20%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D%201%20%5C%5C%200%20%5C%5C%201%20%5C%5C%200%20%5C%5C%20%5Cend%7Barray%7D%5Cright%5D"></p>
<p>If we let <img src="https://latex.codecogs.com/png.latex?X%20=%20q_1q_0">, that is, the bit string measured from the qubits, these imply the following:</p>
<p><img src="https://latex.codecogs.com/png.latex?P_%7B%7C%5CPhi%5E+%5Crangle%7D(X%20=%2000)%20=%20P_%7B%7C%5CPhi%5E+%5Crangle%7D(X%20=%2011)%20=%20%5Cfrac%7B1%7D%7B2%7D"></p>
<p><img src="https://latex.codecogs.com/png.latex?P_%7B%7C+0%5Crangle%7D(X%20=%2000)%20=%20P_%7B%7C+0%5Crangle%7D(X%20=%2010)%20=%20%5Cfrac%7B1%7D%7B2%7D"></p>
<p>Notice how both bits change in <img src="https://latex.codecogs.com/png.latex?%7C%5CPhi%5E+%5Crangle">, but only one changes in <img src="https://latex.codecogs.com/png.latex?%7C+0%5Crangle">. The former is <em>entangled</em>, the latter is not. This is because we cannot separate <img src="https://latex.codecogs.com/png.latex?%7C%5CPhi%5E+%5Crangle"> into <a href="https://en.wikipedia.org/wiki/Quantum_superposition">superpositions</a> of two individual, one-qubit state vectors. But in <img src="https://latex.codecogs.com/png.latex?%7C+0%5Crangle">, we can:</p>
<p><img src="https://latex.codecogs.com/png.latex?q_0%20=%20%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D%201%20%5C%5C%200%20%5C%5C%20%5Cend%7Barray%7D%5Cright%5D%20=%20%7C0%5Crangle"> <img src="https://latex.codecogs.com/png.latex?q_1%20=%20%5Cfrac%7B1%7D%7B%5Csqrt%7B2%7D%7D%20%5Cleft%5B%5Cbegin%7Barray%7D%7Bc%7D%201%20%5C%5C%201%20%5C%5C%20%5Cend%7Barray%7D%5Cright%5D%20=%20%7C+%5Crangle"></p>
<p>Implying that <img src="https://latex.codecogs.com/png.latex?q_0"> will always be measured to 0, and all uncertainty (random variability) lies in measuring <img src="https://latex.codecogs.com/png.latex?q_1">. This is known as a <em>product</em> state, because the probabilities in the two-qubit state vector can be determined by a cross-product of the individual ones.</p>
</section>
<section id="its-just-independence" class="level1">
<h1>It’s just independence</h1>
<p><a href="https://en.wikipedia.org/wiki/Independence_(probability_theory)">Statistical independence</a> occurs when the probability of observing an event does not change once we know something about another one. In our case, we can pretty clearly see this holds for <img src="https://latex.codecogs.com/png.latex?%7C+0%5Crangle"> but not <img src="https://latex.codecogs.com/png.latex?%7C%5CPhi%5E+%5Crangle">. Let’s look at the latter case.</p>
<p>From the the two-qubit state vector, we know the possible measurements are 00 or 11. Thus,</p>
<p><img src="https://latex.codecogs.com/png.latex?P_%7B%7C%5CPhi%5E+%5Crangle%7D(q_0%20=%200)%20=%20P_%7B%7C%5CPhi%5E+%5Crangle%7D(q_0%20=%201)%20=%20%5Cfrac%7B1%7D%7B2%7D"> <img src="https://latex.codecogs.com/png.latex?P_%7B%7C%5CPhi%5E+%5Crangle%7D(q_1%20=%200)%20=%20P_%7B%7C%5CPhi%5E+%5Crangle%7D(q_1%20=%201)%20=%20%5Cfrac%7B1%7D%7B2%7D"></p>
<p>Marginally, each qubit has an equal chance of being measured 0 or 1. But once we know something about the state of the other qubit, this changes:</p>
<p><img src="https://latex.codecogs.com/png.latex?P_%7B%7C%5CPhi%5E+%5Crangle%7D(q_1%20=%200%7Cq_0%20=%200)%20=%201"> <img src="https://latex.codecogs.com/png.latex?P_%7B%7C%5CPhi%5E+%5Crangle%7D(q_1%20=%200%7Cq_0%20=%201)%20=%200"> <img src="https://latex.codecogs.com/png.latex?P_%7B%7C%5CPhi%5E+%5Crangle%7D(q_1%20=%201%7Cq_0%20=%200)%20=%200"> <img src="https://latex.codecogs.com/png.latex?P_%7B%7C%5CPhi%5E+%5Crangle%7D(q_1%20=%201%7Cq_0%20=%201)%20=%201"></p>
<p>We could flip those around and condition <img src="https://latex.codecogs.com/png.latex?q_0"> on <img src="https://latex.codecogs.com/png.latex?q_1"> and we’d end up with the same result. What this shows is that in the entangled state,</p>
<p><img src="https://latex.codecogs.com/png.latex?P(q_0%7Cq_1)%20%5Cneq%20P(q_0)"> implying</p>
<p><img src="https://latex.codecogs.com/png.latex?P(q_0%20%5Ccap%20q_1)%20%5Cneq%20P(q_0)P(q_1)"></p>
<p>and therefore are not independent. Once we know (measure) one qubit, we automatically know what the other one will be. If you go through the same math for <img src="https://latex.codecogs.com/png.latex?%7C+0%5Crangle">, you’ll see the marginal and conditional probabilities are in fact equal, and thus independent.</p>
<p>Now I don’t know if/how this might change once you start introducing more qubits or allow for the full range of <a href="https://github.com/Qiskit/textbook/blob/main/notebooks/intro/what-is-quantum.ipynb">phase</a>, but to keep things intuitive, my working definition of quantum entanglement is:</p>
<p><strong><em>Does the probability of a qubit being measured to a particular state depend on the state of another qubit? If yes, they are entangled; otherwise, they are not.</em></strong></p>


<!-- -->

</section>

 ]]></description>
  <category>Quantum</category>
  <category>Probability</category>
  <guid>https://www.zajichekstats.com/post/quantum-entanglement-from-statistical-perspective/</guid>
  <pubDate>Fri, 16 Feb 2024 06:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/quantum-entanglement-from-statistical-perspective/feature.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>On the Creation of Classical Statistics</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/on-the-creation-of-classical-statistics/</link>
  <description><![CDATA[ 




<p>I used to have a somewhat cynical view of <a href="https://en.wikipedia.org/wiki/Ronald_Fisher">R.A. Fisher</a>, especially on the motivation for statistical significance (see my <a href="https://www.zajichekstats.com/post/statistical-significance-is-insignificant/">previous article</a>). Even though he did explicitly advocate for the use of the 5% threshold:</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 14px; color: #2e5c46">“If P is between .1 and .9 there is certainly no reason to suspect the hypothesis tested. If it is below .02 it is strongly indicated that the hypothesis fails to account for the whole of the facts. We shall not often be astray if we draw a conventional line at .05 and consider that higher values of [the statistic] indicate a real discrepancy.”</span><sub>1</sub></p>
</blockquote>
<p>and</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 14px; color: #2e5c46">“If one in twenty does not seem high enough, we may, if we prefer, draw the line at one in fifty (the 2 percent point), or one in a hundred (the 1 percent point). Personally, the writer prefers to set a low standard at the 5 percent point, and ignore entirely all results which fail this level.”</span><sub>2</sub></p>
</blockquote>
<p>After reading Erich Lehmann’s book, <a href="https://link.springer.com/book/10.1007/978-1-4419-9500-1"><em>Fisher, Neyman, and the Creation of Classical Statistics</em></a>, I realize there is much more nuance to it, and he probably meant well in his <em>statistical</em> work (his <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2942659/">other work</a>, maybe a different story). I’m fairly convinced that he never imagined, nor would approve of, how statistical significance would be used and abused since then.</p>
<section id="an-experimentation-context" class="level1">
<h1>An experimentation context</h1>
<p>Much of the methodology related to hypothesis testing that Fisher developed (along with other fundamental concepts (in 1922) like <em>consistency</em>, <em>efficiency</em>, and <em>sufficiency</em>) was motivated by the specific context he started out in as an agricultural statistician in 1919 at <a href="https://www.rothamsted.ac.uk/"><em>Rothamstead Experimental Station</em></a>: that of small-sample, randomized experimentation. It is clear in his writings, though maybe implicit, that there were practical things he considered that played into the overall validity of inference, not <em>only</em> whether the p-value crossed a threshold:</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 14px; color: #2e5c46">“…it is not known whether heterogeneity [of the soil] will be more pronounced in the one or the other direction in which the field is ordinarily cultivated…The effects are sufficiently widespread to make apparent the importance of eliminating the major effects of soil heterogeneity not only in one direction across the field, but at the same time in the direction at right angles to it.”</span><sub>3</sub></p>
</blockquote>
<p>He wasn’t proposing that his methods be mechanically applied, or that the <em>method</em> itself is what proves valid inference. Rather, inherent in that quote is the intuition Fisher had about the subject, the “soil heterogeneity”, that made the <em>implications</em> of the design <em>useful</em> for that situation. This, in combination with his obviously deep statistical knowledge, is what I believe ultimately made the usage of seemingly arbitrary significance thresholds valid in Fisher’s eyes. It’s not that he didn’t want statistical analysis to be “easier” for researchers (and he was somewhat back and forth on this):</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 14px; color: #c79c00">“However, his early recommendation and life-long practice prevailed. The desire for standardization trumped the advantages of considering each case on its own merit.”</span><sub>4</sub></p>
</blockquote>
<p>I think he probably just put too much confidence in the implementers of his work to be as critical, meticulous, and simply as brilliant as he was. He never conceived of the erroneous ways his statistical and design principles would later be used.</p>
</section>
<section id="he-had-a-mentor" class="level1">
<h1>He had a mentor</h1>
<p>One of the most fascinating aspects of the history of classical statistics is the role of <a href="https://en.wikipedia.org/wiki/William_Sealy_Gosset">William Sealy Gosset</a> (a.k.a. “Student”, as in <a href="https://en.wikipedia.org/wiki/Student%27s_t-test"><em>Student’s t-test</em></a>). For his entire career, he was a beer brewer at <a href="https://en.wikipedia.org/wiki/Guinness_Brewery"><em>Arthur Guinness Son and Co.</em></a> (one of my favorites), yet he is credited with putting forth, through his own curiosity, intelligence, and need of practical solutions for quality control efforts, the ideas of which Fisher would ultimately bring to fruition:</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 14px; color: #c79c00">“After a small-sample (”exact”) approach to testing was initiated by Gosset (“Student”) in 1908 with his t-test, Fisher in the 1920’s, under frequent prodding by Gosset, developed a battery of such tests, all based on the assumption of normality. These tests today still constitute the bread and butter of much of statistical practice.”</span><sub>4</sub></p>
</blockquote>
<p>That “frequent prodding” Lehmann is talking about, in addition to the timeline, is why I characterize Gosset more like a mentor. Fisher was 14 years younger, but incredibly gifted intellectually.</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 14px; color: #c79c00">“He [Gosset] then had the crucial insight that exact results [for a t-test] could be obtained by making an additional assumption…although he was not able to give a rigorous proof. The first proof was obtained (although not published) by Fisher in 1912…as a result of constant prodding and urging by Gosset, he found a number of additional small-sample distributions, and in 1925 presented the totality of these results in his book…getting Fisher to develop this methodology much further than he (Fisher) had originally intended.”</span><sub>4</sub></p>
</blockquote>
<p>Fisher was only 22 years old in 1912. It seems Gosset’s wisdom helped him pinpoint the arguments he would come to make, and ultimately gave him the encouragement and motivation to see it through. Without that, who knows if any of it would have been done.</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 14px; color: #c79c00">“This passage suggests that Fisher thought these problems to be difficult, and that he had no plans to work on them himself. However, in April 1922 he received two letters from Gosset that apparently changed his mind.”</span><sub>4</sub></p>
</blockquote>
<p>Not to mention Gosset’s influence on Neyman’s (and Egon Pearson’s) foundational work regarding the <em>“consideration of the alternatives (suggested by Gosset)”</em>, Fisher did acknowledge his contributions and spoke highly of him.</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 14px; color: #2e5c46">“…an exact solution of the distribution of regression coefficients…has been outstanding for many years; but the need for its solution was recently brought home to the writer by correspondence with ‘Student’, whose brilliant researches in 1908 form the basis of the exact solution”</span><sub>5</sub></p>
</blockquote>
</section>
<section id="he-was-in-fact-a-genius" class="level1">
<h1>He was in fact, a genius</h1>
<p>Despite their <em>“disdain”</em> for one another:</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 14px; color: #c79c00">“Both Fisher and Neyman believed that they had made important contributions to the philosophy of science, but each felt that the other’s views were completely wrong-headed.”</span><sub>4</sub></p>
</blockquote>
<p>Much of their foundational work was complimentary. Fisher supplied the methodology, Neyman put the rubber stamp on it with mathematical proofs.</p>
<p>The thing that caught my attention that Lehmann mentions multiple times in the book is the way Fisher came up with those methods.</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 14px; color: #c79c00">“Fisher’s tests were solely based on his intuition. The right choice of test statistics was obvious to him. A theory that would justify his choices was developed by Neyman and Pearson in their papers in 1928 and 1933.”</span><sub>4</sub></p>
</blockquote>
<p>As you read about the progression of his work, it’s like all the fundamental statistical concepts pop-up one by one, and you realize the breadth and depth of Fisher’s accomplishments. The idea that this can be attributed to his “intuition” is just remarkable. It wasn’t just in testing, but also in design:</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 14px; color: #c79c00">“…the designs in DOE [The Design of Experiments, 1935] were presented without much justification, based entirely on his intuitive understanding of what the situation demanded. But again later writers found justifications by showing that Fisher’s procedures possessed certain optimality properties.”</span><sub>4</sub></p>
</blockquote>
<p>Even when you read Fisher’s passages directly, you get the feeling that it just rolled off his tongue and he was writing down what flowed from his mind. Though what he was writing turned out to be fundamental to statistical practice:</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 14px; color: #2e5c46">“…much caution should be used before claiming significance for special comparisons… Comparisons suggested by scrutiny of the results themselves are open to suspicion; for if the variants are numerous, a comparison of the highest with the lowest observed value will often appear to be significant, even from undifferentiated material.”</span><sub>3</sub></p>
</blockquote>
<p>In this case, the problem with <a href="https://en.wikipedia.org/wiki/Multiple_comparisons_problem">multiple comparisons</a>. This is the general tone of Fisher’s writings, just nonchalantly bringing up things like <a href="https://en.wikipedia.org/wiki/Power_of_a_test">power</a>, creating <a href="https://en.wikipedia.org/wiki/Blocking_(statistics)">block designs</a>, etc. as “obvious” considerations.</p>
<p>Unfortunately, despite all Fisher did achieve, his stubbornness prevented him from achieving more.</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 14px; color: #c79c00">“…Fisher rarely gave an inch. Those holding different views from his own had ‘misread’ him and their statements were ‘incorrect’.”</span><sub>4</sub></p>
</blockquote>
<p>And subsequently, even though he hinted at it with his idea of “sensitiveness”:</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 14px; color: #c79c00">“By not utilizing the idea of power, Fisher deprives himself of the ability to resolve one of the most important issues of experimental design, the determination of sample size.”</span><sub>4</sub></p>
</blockquote>
<p>It seems he grew bitter and resentful in older age. For one, Fisher, “the creator of modern statistics”, in his role at University College under Egon Pearson, was <em>“not permitted to teach statistics”</em>. Also, all the progress and innovation in statistics shifted to the United States after Neyman moved there in 1938. People appreciated his foundational work, but they were taking it in a different direction and he was too far away to continue having influence. Nevertheless, his legacy is set in stone.</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ol type="1">
<li><p>Fisher, R.A. (1925). <a href="https://link.springer.com/chapter/10.1007/978-1-4612-4380-9_6"><em>Statistical methods for research workers</em></a>. Oliver and Boyd: Edinburgh.</p></li>
<li><p>Fisher, R.A. (1926). <a href="https://link.springer.com/chapter/10.1007/978-1-4612-4380-9_8"><em>The arrangement of field experiments</em></a>. J. Min. Agric. G. Br. 33:503-513</p></li>
<li><p>Fisher, R.A. (1935). <a href="https://en.wikipedia.org/wiki/The_Design_of_Experiments"><em>The Design of Experiments</em></a>. Oliver and Boyd: Edinburgh.</p></li>
<li><p>Lehmann, Erich L (2011). <a href="https://link.springer.com/book/10.1007/978-1-4419-9500-1"><em>Fisher, Neyman, and the Creation of Classical Statistics</em></a>. Springer New York, NY. https://doi.org/10.1007/978-1-4419-9500-1</p></li>
<li><p>Fisher, R.A. (1922). <a href="https://www.jstor.org/stable/2341124"><em>The goodness of fit of regression formulae, and the distribution of regression coefficients</em></a>. J. Roy. Statist. Soc., 85: 597-612</p></li>
</ol>


<!-- -->

</section>

 ]]></description>
  <category>History</category>
  <category>Philosophy</category>
  <guid>https://www.zajichekstats.com/post/on-the-creation-of-classical-statistics/</guid>
  <pubDate>Sat, 10 Feb 2024 06:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/on-the-creation-of-classical-statistics/feature.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Statistical significance is…insignificant</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/statistical-significance-is-insignificant/</link>
  <description><![CDATA[ 




<p>The longer I’ve been practicing as a statistician, maybe paradoxically, the more skeptical I’ve become of statistical significance (#1). It manifests as a feeling of dissatisfaction, as if, even though you’ve stated what you “found”, you don’t <em>actually</em> believe it to be true. I recently finished reading <a href="https://press.umich.edu/Books/T/The-Cult-of-Statistical-Significance2"><em>The Cult of Statistical Significance: How the Standard Error Costs Us Jobs, Justice, and Lives</em></a>–it instantly became one of my favorite books (here are my favorite quotes and passages). It affirms a lot of what I’ve come to suspect, with deep articulation about the vastness of the issue, backed by a thorough historical foundation. I can’t help but wonder about the broader scientific, political, and societal implications this has had over the years (and continues to have). It really lit a fire in me to continue learning about and unraveling statistical history to connect those dots.</p>
<section id="my-take" class="level1">
<h1>My take</h1>
<p>The <em>significance</em> of a statistical result cannot be mechanically, mathematically, or systematically determined. It must be driven by a <em>practical</em> relevance, or importance, which is inherently subjective, and a product of the values, beliefs, interests, and/or goals of the individual(s) interpreting the data. That result is always subject to dispute, critique, replication, and refinement, whether those reasons are process error (#2), or the value of the information itself. The chance occurrence of a sampling probability crossing an arbitrary threshold is actually irrelevant.</p>
</section>
<section id="whatisstatsig" class="level1">
<h1>What is statistical significance?</h1>
<blockquote class="blockquote">
<p><span style="font-family: Garamond, serif; font-size: 20px; color: #2e5c46">“It’s embedded like a tax code in the bureaucracy of science.”</span><sub>1</sub></p>
</blockquote>
<p>Technically speaking, it is when the likelihood of observing our data, <em>if</em> an hypothesized state of the world were true (known as the <em>p-value</em>), is so small (<a href="https://www.tandfonline.com/doi/full/10.1080/00031305.2019.1583913">notoriously</a>, and most often, less than 5%), that the hypothetical state of the world must be false, and therefore, we have “significant” statistical evidence to say so. It positions itself as an objective tool to <em>decide</em> (on the basis of this probability threshold) whether a statistical relationship is “real”, and, often, subsequently that it “matters”.</p>
<p>Take this <a href="https://jamanetwork.com/journals/jamanetworkopen/fullarticle/2808358">recent study</a>, for example, which is meant to characterize physician-propagated misinformation about the COVID-19 pandemic. The authors outline a set of <a href="https://cdn.jamanetwork.com/ama/content_public/journal/jamanetworkopen/939195/zoi230834supp1_prod_1697557763.1365.pdf?Expires=1704642946&amp;Signature=nxggsGG3f~BQcev3DoFQmbURh3vsb1CtFrP4rSviM1XaF8Y9vtyGPmRRBTRDAXyvYzrGvW6vrJFsphYDRTI9LSJD35NYEc8RUdkZK8fJkKcSpr-AbsW1wyhe30CUf-x8GGPI2For6nZNLWoZhBn0m~GrC3JlmuTmCswv~3RH7HolcYV10ZTVgSh4ZvGaBOUKDdNhmITsHrocrTct-xvMnohwhM~6~nHZMATo6~grFfhnPrhgsDHRVkYdLr9o8yFEae4-ylEnzkulOfigZIKZJsj1s5iBbyPAB60k2KYYkXlBZnNAUpkrKSP33m9BiG8YY047fQOSRrqMrap-PaA45w__&amp;Key-Pair-Id=APKAIE5G5CRDK6RD3PGA">basic premises</a> that are used as a basis for classifying contrarian statements as <em>misinformation</em> (#3). At least some of this is built upon the attainment of statistical significance (or lack thereof).</p>
<p>As an example, in the category of <strong>Promoting Unapproved Medications for Prevention or Treatment</strong> (in the Results section), the authors state:</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 12px; color: #9e3634">“The 2 most prominent medications promoted were ivermectin and hydroxychloroquine, which have been found to not be effective at treating COVID-19 infections in randomized clinical trials.”</span><sub>2</sub></p>
</blockquote>
<p>This premise drove them to classify social media posts like this:</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 12px; color: #45A4CE">“Two of my toughest COVID patients–showed up with oxygen stats of 68% and 84% and would not go to the hospital. We treated them with IVM, steroids, and breathing treatments and here they are now.”</span><sub>2</sub></p>
</blockquote>
<p>as misinformation (see all <a href="https://cdn.jamanetwork.com/ama/content_public/journal/jamanetworkopen/939195/zoi230834t4_1697557763.5423.png?Expires=1704648605&amp;Signature=vIdMdVOE4XQ76IbpK3v-OY0EzN5zbPooMwAeWZTXhWDu5fJnx4hpErMTWryrzYEaJOYO6YckYQIvSqmFFHp7LJ~8NughK380U2JDc2PBtonwbYYmVcXzRXT~oLftOZEXNxq0MWHqDFs1Ov7KNUdoqd1TuhYxCgFKWUvhdb5pXzB0zliNP-28kjQwZF9KLM70oerRsri0XM-HVfdKkPKrM1idAtUBFAZzBDg05y5BBQD8cLzgW4Fa7cINV-~1Dhyg9HpncVHeRACdc-tJwqqs4Z-VQfJPXMgzxP2-eyL6nhSA3IqIW9ax8CYgcYrha6yqq80wqaR4zTTGmXzf~rTWmQ__&amp;Key-Pair-Id=APKAIE5G5CRDK6RD3PGA">supportive quotes</a>). This is an actual doctor saying the drug helped <em>their</em> patients, but the authors have deemed it ineffective. What justifies them making such a universal claim?</p>
<p>If you look at <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8394824/">one of their references</a>, the <a href="https://en.wikipedia.org/wiki/Meta-analysis">meta-analysis</a> shows the <a href="https://en.wikipedia.org/wiki/Relative_risk">relative risk</a> for all-cause mortality was estimated to be 37%. That is, the risk of death was 63% lower in patients who received ivermectin versus placebo or standard of care. However, because the 95% <a href="https://en.wikipedia.org/wiki/Confidence_interval">confidence interval</a> ranged from 12% to 113% (i.e., there was <em>plausibility</em> that ivermectin could produce up to a 13% <em>worse</em> mortality rate, but equally plausible an 88% risk reduction), it was deemed <em>not</em> statistically significant, and as the authors state:</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 12px; color: #3d2f2f">“IVM [ivermectin], compared with control treatment, did not have an effect on the all-cause mortality rate.”</span><sub>3</sub></p>
</blockquote>
<p>and ultimately,</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 12px; color: #3d2f2f">“Ivermectin is not a viable treatment option for COVID-19.”</span><sub>3</sub></p>
</blockquote>
<p>In other words, because the probability of observing this data, under the assumption of no difference in mortality risk (our p-value definition above), was not less than 5% (it was 31%), that gives reason to conclude <em>no difference at all</em> (#4). Furthermore, if the confidence interval crossed 100% by any amount, no matter how small, the p-value would have remained above 5% and not reached the threshold for statistical significance.</p>
</section>
<section id="why-is-it-flawed" class="level1">
<h1>Why is it flawed?</h1>
<blockquote class="blockquote">
<p><span style="font-family: Garamond, serif; font-size: 20px; color: #2e5c46">“Real science changes one’s mind. That’s one way to see that the proliferation of unpersuasive significance tests is not real science.”</span><sub>1</sub></p>
</blockquote>
<section id="arbitrarythreshold" class="level2">
<h2 class="anchored" data-anchor-id="arbitrarythreshold">An arbitrary threshold</h2>
<p>The 5% threshold is arbitrary. Despite that common acknowledgement, willful ignorance tends to prevail due to tradition and adherence to norms. The fact that the perceived significance of a result can suddenly change from minute differences speaks to the lack of robustness in the logic. In <a href="https://press.umich.edu/Books/T/The-Cult-of-Statistical-Significance2">the book</a>, the authors frequently discuss the importance of a <em>loss function</em>, which focuses on the potential consequences and implications of the result on the real-world decisions that are sought to be made from the information, rather than a predefined threshold based on sampling error probability. In this sense, the allowable risk tolerance can’t be objectively or mechanically determined. It is context-dependent, and not all decisions are created equal. Yes, the p-value above was 31%, but that error rate, along with the plausible range of risks (and benefits), may be sufficient to someone needing to make a treatment decision <em>now</em>.</p>
<section id="risks-are-subjective" class="level3">
<h3 class="anchored" data-anchor-id="risks-are-subjective">Risks are subjective</h3>
<blockquote class="blockquote">
<p><span style="font-family: Garamond, serif; font-size: 18px; color: #2e5c46">“It always depends on the loss, measured in side effects, treatment cost, death rates. The loss to a cool, scientific, impartial spectator will not be the same as the loss to the patient in question…[the balance between Type I/II errors] ‘must be left to the patient, friends, and family’.”</span><sub>1</sub></p>
</blockquote>
<p>Beyond the statistical significance of a result is the question of what to do about it. In the <a href="https://jamanetwork.com/journals/jamanetworkopen/fullarticle/2808358">same article</a>, the authors state the following, still in the context of misinformation:</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 12px; color: #9e3634">“Claims that myocarditis was common in children who received the vaccine and that the risks of myocarditis outweighed the risk of vaccination were also unfounded.”</span><sub>2</sub></p>
</blockquote>
<p>Nevermind the fact that the <a href="https://jamanetwork.com/journals/jama/fullarticle/2782900">study they reference</a> <em>does</em> show an increase in monthly case volume of myocarditis and pericarditis between pre/post-vaccine periods and the authors state:</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 12px; color: #9e8a39">“Myocarditis developed rapidly in younger patients, mostly after the second vaccination. Pericarditis affected older patients later, after either the first or second dose.”</span><sub>4</sub></p>
</blockquote>
<p>The more important point is that the weight individuals place on statistical results to inform their decision making is subjective. The risk may be low, maybe even lower than the alternative, but that doesn’t inform <em>how</em> someone should weigh it.</p>
<blockquote class="blockquote">
<p><span style="font-family: Garamond, serif; font-size: 14px; color: #2e5c46">“Imagine that you and your infant child are standing on a sidewalk near a busy street. You have just purchased a hot dog from the street vendor and have safely crossed the street. Scenario 1: You suddenly realize you have forgotten the mustard and if you scurry across the busy street, dodging vehicles, there is a 95% probability you’ll return safe with your mustard. Scenario 2: You forgot your child and you watch as she tries to cross the street herself, if you scurry across the busy street, dodging vehicles, there is a 95% probabiliity you’ll return safe with your child. The sizeless scientist in effect declares ‘they are equally important reasons for crossing the street’”</span><sub>1</sub></p>
</blockquote>
</section>
</section>
<section id="samplesize" class="level2">
<h2 class="anchored" data-anchor-id="samplesize">It can’t depend on sample size</h2>
<blockquote class="blockquote">
<p><span style="font-family: Garamond, serif; font-size: 18px; color: #2e5c46">“At high sample sizes, all null hypotheses are rejected, by mathematical fact, without having to look at the data.”</span><sub>1</sub></p>
</blockquote>
<p>One pretty simple argument is that of <a href="https://www.omniconvert.com/what-is/sample-size/">sample size</a>. In most contexts, a statistical test is, by definition, more likely to be declared <em>significant</em> by simply <a href="https://en.wikipedia.org/wiki/Standard_error">amassing more data</a>, regardless of what the actual effect size is. This, on the other hand, <em>is</em> completely mechanical and dissociated from the real-world context in which the test is being run. Thus, it prioritizes quantity over substance, and when blindly used, potentially promotes results that may lack practical meaning.</p>
<blockquote class="blockquote">
<p><span style="font-family: Garamond, serif; font-size: 14px; color: #2e5c46">“…some cause of natural selection may have a high probability of replicability in additional samples but be trivial. Yet a cause may have a low probability of replicability but be important. This is what we mean when we say that a test of significance is neither necessary nor sufficient for a finding of importance”</span><sub>1</sub></p>
</blockquote>
<p>It also tends to shift focus to attaining statistical significance and using it as a filter, causing the potential to miss meaningful insights that didn’t reach this level.</p>
</section>
<section id="we-dont-believe-in-zero-sized-effects" class="level2">
<h2 class="anchored" data-anchor-id="we-dont-believe-in-zero-sized-effects">We don’t believe in “zero-sized” effects</h2>
<blockquote class="blockquote">
<p><span style="font-family: Garamond, serif; font-size: 18px; color: #2e5c46">“Real scientists draw a line between what is large and small.”</span><sub>1</sub></p>
</blockquote>
<p>There is a major contradiction that arises.</p>
<p>The typical hypothesis test is conducted under the assumption of a <a href="https://en.wikipedia.org/wiki/Null_hypothesis">null hypothesis</a> positing <em>no effect</em>. For example, in calculating the p-value above, it is assumed that there is <em>no</em> difference in all-cause mortality rates between the treatment groups. However, I would argue that in any practical context, it’s rare that someone would genuinely believe in the existence of precisely zero effect. Rather, it would stand to reason that what they really mean is “effectively zero” effect, something so small that it is considered inconsequential.</p>
<p>Herein lies the contradiction: they have now acknowledged some level of substantive significance, albeit undefined. If the true effect happens to be smaller than this threshold, as we just explained, the estimate will still eventually be declared statistically significant with mathematical certainty no matter how minuscule, thus inevitably crossing the unspoken threshold of substantive meaning. Therefore, this begs into question the value of attaining statistical significance at all in favor of the need for explicit consideration of the real-world implications (i.e., the loss function). At the <em>very least</em>, the substantive threshold should be identified and reflected in the null hypothesis so that the p-value is calibrated for substance.</p>
</section>
<section id="fallacy" class="level2">
<h2 class="anchored" data-anchor-id="fallacy">The fallacy of the transposed conditional</h2>
<p>This is where it gets especially interesting. There are logical errors with the conclusions drawn from hypothesis testing. I think the best way to describe it is jumping into the classic example that arises in Jacob Cohen’s <a href="https://doi.org/10.1037/0003-066X.49.12.997"><em>The Earth Is Round (p &lt; .05)</em></a> from 1994:</p>
<blockquote class="blockquote">
<p><span style="font-family: Verdana, sans-serif; font-style: italic; font-size: 12px; color: #45A4CE">“The incidence of schizophrenia in adults is about 2%. A proposed screening test is estimated to have at least 95% accuracy in making the positive diagnosis (sensitivity) and about 97% accuracy in declaring normality (specificity)…With a positive test for schizophrenia at hand, given the more than .95 assumed accuracy of the test, the probability of a positive test given that the case is normal is less than .05, that is, significant at p &lt; .05. One would reject the hypothesis that the case is normal and conclude that the case has schizophrenia, as it happens mistakenly, but within the .05 alpha error. But that’s not the point. The probability of the case being normal, given a positive test, is not what has just been discovered however much it sounds like it and however much it is wished to be. It is not true that the probability that the case is normal is less than .05, nor is it even unlikely that it is a normal case. By a Bayesian maneuver, this inverse probability, the probability that the case is normal, given a positive test for schizophrenia, is about .60!”</span><sub>5</sub></p>
</blockquote>
<p>The desired interpretation of a statistically significant result induces a technical problem. The p-value provides the likelihood of observing the data under the assumption that the null hypothesis is true (a single state of the world), yet we <em>want</em> to interpret it as evidence about the parameter of interest given the data. After all, we did collect it, and want that to be the basis of our conclusions. But that is not the probability we have concerned ourselves with. Using the p-value as a singular basis to determine significance disregards all other possibilities that the true parameter could be. When those possibilities are imbalanced (as they were here, since only 2% of the population had schizophrenia), it confuses which state of the world is most likely given the data with how likely the data is given a state of the world (#5).</p>
</section>
</section>
<section id="what-to-do-instead" class="level1">
<h1>What to do instead?</h1>
<blockquote class="blockquote">
<p><span style="font-family: Garamond, serif; font-size: 20px; color: #2e5c46">“Real science, unlike significance-testing science, is difficult. If it were not, it would not be real science, but instead it would be already established routine. Real science asks you to make real scientific judgements and real scientific arguments within a community of other scientists. It asks you to be quantitatively persuasive, not to be irrelevantely mechanical. Life is hard.”</span><sub>1</sub></p>
</blockquote>
<p>It’s a scary thing to think about. Suppose statistical significance isn’t there to bail you out. What are you supposed to do? How do you know if your results matter or not? I think this passage gives a pretty clear answer:</p>
<blockquote class="blockquote">
<p><span style="font-family: Garamond, serif; font-size: 16px; color: #2e5c46; font-weight: bold">“She can test her belief in the price effect by looking at the magnitudes, using, for example, the highly advanced technique common in data-heavy articles in physics journals: ‘interocular trauma’. That is, she can look and see if the result hits her between the eyes.”</span><sub>1</sub></p>
</blockquote>
<p>The premise of this article has been that the implications of statistical results are context-dependent, so there isn’t a one-size-fits-all alternative to replace statistical significance. Rather than seeking a systematic approach, the emphasis should be placed on cultivating understanding of the subject matter. It’s akin to relying on intuition, like a feeling of “knowing” that you’ve gotten what you needed. Take this simple analogy: a tape measure is a tool that quantifies information needed to inform subsequent action, and the precision of the measurement is tailored to the specific needs of the task at hand. Sometimes a rough estimate is sufficient, while other times meticulous precision is necessary. The goal is to reach the point where, intuitively, you “know” that you’ve obtained the necessary information to move forward confidently. I see statistics as the same thing. Merely a <em>tool</em> to be used to quantify the desired information needed to <em>inform</em> (i.e., augment, not determine) a decision.</p>
<p>Now I’m not going to claim that I haven’t repeatedly violated the practices I’m arguing against, it’s hard not to, but these are things that I’m going to focus more on moving forward instead of p-values and statistical significance:</p>
<section id="estimation-magnitude" class="level3">
<h3 class="anchored" data-anchor-id="estimation-magnitude">1. Estimation &amp; magnitude</h3>
<p>This is probably the easiest change to start making because it doesn’t require an overhaul of statistical methods, but rather just a shift in focus to the magnitude of the estimates. By deliberately avoiding p-value calculations (and, when reading and consuming research, simply ignoring the concept of statistical significance altogether), the interpretation is governed by (a plausible range of) effect sizes, untainted by arbitrary, context-agnostic significance thresholds, and thus forces a scientific argument to be made on that basis. With a little extra brain power (and humility), this creates a much more contextually-rich, informative interpretation.</p>
</section>
<section id="bayesian-thinking-causal-modeling" class="level3">
<h3 class="anchored" data-anchor-id="bayesian-thinking-causal-modeling">2. Bayesian thinking &amp; causal modeling</h3>
<p>Richard McElreath’s <a href="https://github.com/rmcelreath/stat_rethinking_2023"><em>Statistical Rethinking</em></a> really convinced me that causal inference powered by Bayesian estimation is probably the best framework out there for scientific modeling (and I’ve only made it through the <a href="https://www.zajichekstats.com/post/statistical-rethinking-2023-class-notes/">first couple of chapters</a> so far). It completely shifts the focus from the data itself to the data-generating <em>process</em>, putting the bulk of the hard work upfront, before data is collected, with a focus on mechanism and structure. It also addresses the fallacy problem. However, it’s definitely harder to start doing on a whim.</p>
<p>First of all, the <a href="https://en.wikipedia.org/wiki/Bayesian_statistics">math itself</a> is different from typical <a href="https://en.wikipedia.org/wiki/Frequentist_inference">frequentist</a> methods, so there is a learning curve there. More difficult though is navigating the <em>practical</em> complexities, such as properly eliciting the necessary subject matter expertise and piecing that together into coherent <a href="https://en.wikipedia.org/wiki/Prior_probability">prior distributions</a> and <a href="https://en.wikipedia.org/wiki/Causal_model">causal models</a>. Nevermind the technical reasons why that is hard, it is simply more demanding from a time, brainpower, and collaboration perspective–and everyone is busy. Nevertheless I think it is a worthy pursuit (#6).</p>
</section>
<section id="decision-making-course-of-action" class="level3">
<h3 class="anchored" data-anchor-id="decision-making-course-of-action">3. Decision-making &amp; course of action</h3>
<p>This is where the loss function is most relevant.</p>
<p>Instead of contorting a generic statistical result to tenuously align with real-world implications, I want to be more deliberate. The first step is to target and understand the tangible decision-making processes that the estimates seek to inform, with an identification of the current standards including practical constraints and nuances. Then, rather than passively using standard techniques, deriving tailored statistical methods to facilitate that usage, which may prompt more rigor, customization, or reframing of the statistical problem entirely to suit the specific context at hand. Estimation uncertainty can be fed as input into hypothetical scenarios to gain insight into where/what actions will be triggered and their subsequent downstream effects on the hard outcomes intended to be impacted. At that point, the <em>significance</em> will be clear.</p>
<section id="focus-on-the-end-product" class="level4">
<h4 class="anchored" data-anchor-id="focus-on-the-end-product">Focus on the end-product</h4>
<p>I think a critical piece to this endeavor is to not only focus on the statistics, but also <em>how</em> they will be disseminated. This means specifying the vehicle that will deliver the information to the right person at the right time. The emphasis on something tangible elicits certain practical and technological constraints that may be otherwise unbounding when focusing solely on the math. Further, this perspective acknowledges that the statistical methods are only a fragment of the overall data product, and may be direct cause for further refinement of the statistical approach itself. That is, even with robust statistical methods or results, the information may lose its utility if poorly conveyed or implemented. This could be due to anything from data pipelines and visualization to deployment and computing resources. This also enables the ability to be more forward-thinking about success measures and accountability/validation schemes like continuous monitoring to ensure sustained yet impactful presence in the intended decision-making context.</p>
</section>
</section>
</section>
<section id="some-historical-gold" class="level1">
<h1>Some historical gold</h1>
<p>To conclude this, I wanted to highlight an excerpt from the chapter <em>The Psychology of Psychological Significance Testing</em> in <a href="https://press.umich.edu/Books/T/The-Cult-of-Statistical-Significance2">the book</a> that I found especially fascinating about the propagation of statistical significance across university education in the United States (pages 142-143):</p>
<blockquote class="blockquote">
<span style="font-family: Garamond, serif; font-size: 14px; color: #2e5c46">
<p>
“In this context the 5 percent science was promoted by the new leaders of quantitative psychology and education. European humanists can score themselves by how many generations they are removed from Hegel–that is, in being taught by a teacher who was taught by a teacher who was taught by a teacher who was taught by Hegel at the University of Berlin. Likewise, statisticians can score themselves by how many generations they are from Fisher. Quinn McNemar, for example, of Stanford University, was an important teacher of psychologists who had himself studied statistical methods at Stanford with Harold Hotelling, the chief American disciple of Fisher. Hotelling had worked directly with Fisher. McNemar then taught L.G. Humphreys, Allen Edwards, David Grant, and scores of others. As early as 1935 all graduate students in psychology at Stanford, following the model of Iowa State, were required to master Fisher’s crowning achievement, analysis of variance. Already by 1950, Gigerenzer et al.&nbsp;reckon, about half of the leading departments of psychology required training in Fisherian methods.
</p>
<p>
Even rebels against Fisher were close to him, starting with [William Sealy] Gosset himself. Palmer Johnson of the University of Minnesota studied with Fisher in England, though he later had the bad taste to write articles with Fisher’s erstwhile colleague and eternal enemy Jerzy Neyman, whom Fisher had cast into outer darkness. George Snedecor, an agricultural scientist at Iowa State University at Ames, was a cofounder of the first department of statistics in the United States. His important book <em>Statistical Methods</em> was influenced directly by Fisher himself, who somewhat surprisingly was in the 1930s a visiting professor of statistics at Iowa State. One can think of the Iowa schools then [1940s and 1950s] as one thinks of London’s Gower Street in the 1920s and 1930s–a crucial crossroads of statistical methods and training. In a eulogy for S.S. Wilks, a student in the late 1920s of Henry L. Rietz and Allen T. Craig at the University of Iowa, Frederick Mostellar said that Iowa was then “the center of statistical study in the United States of America”. Rietz, Craig, and Wilks worked closely with Fisher. E.F. Lindquist, the American leader of standardized testing for educators, also of the University of Iowa, was deeply influenced by Snedecor. Lindquist invented the Iowa Test of Basic Skills for schoolchildren. He too spent time with the great man.
</p>
<p>
Some psychologists knew about the work of Neyman and Pearson and some even about that of the Bayesian Harold Jeffreys. But textbook authors, editors, and teachers–inspirited by Fisher’s promise of raising their fields to the level of hard science–helped Fisher win the day. Statistical education narrowed at the same time as it spread. Decision theory and inverse probability, and Gosset’s views on substantive significance, alternative hypotheses, and power, were pushed aside. Too introspective for the hard-boiled.”
</p>
</span></blockquote>
<p>It seems as if Fisher’s mechanization of statistical significance is what ultimately enabled <em>statistics</em> to branch out as its own field of study (and that it took place in Iowa is a fun fact). It makes you wonder how this separation contributed to the subsequent growth of scientific inquiry, results, and knowledge by disrupting the synergy between the intuition held by the practitioner and the intricacies of statistical nuance. While the popular notion of “playing in everyone’s backyard” is commonly portrayed as an advantage (which it is pretty cool), upon closer reflection, it might be a fundamental issue. <a href="https://en.wikipedia.org/wiki/William_Sealy_Gosset">William Sealy Gosset</a>, a.k.a <em>Student</em>, and the inventor of the <a href="https://en.wikipedia.org/wiki/Student%27s_t-test"><em>t-test</em></a>, was first and foremost, a brewer of Guinness beer, and clearly prioritized substantive meaning:</p>
<blockquote class="blockquote">
<p><span style="font-family: Garamond, serif; font-size: 14px; color: #2e5c46">“Fisher, not the great transcendent, invented the 5 percent philosophy. By contrast, Gosset’s economic approach to uncertainty prevented him from being able to stop thinking at .05 for fear he’d lose too much information, and profits.”</span><sub>1</sub></p>
</blockquote>
<blockquote class="blockquote">
<p><span style="font-family: Garamond, serif; font-size: 14px; color: #2e5c46">“World War I had been under way for more than a year when Gosset–who wanted to serve in the war but was rejected because of nearsightedness–wrote to his elderly friend, the great Karl Pearson: ‘My own war work is obviously to brew Guinness stout in such a way as to waste as little labor and material as possible, and I am hoping to help to do something fairly creditible in that way.’ It seems he did.”</span><sub>1</sub></p>
</blockquote>
<p>He had a problem to solve: <em>“to brew the best tasting stout at a satisfying price.”</em>. My takeaway: be like Gosset.</p>
</section>
<section id="sidenotes" class="level1">
<h1>Side notes</h1>
<ol type="1">
<li>I don’t think this has much to do with <em>statistical</em> advancement, but rather the experience of observing its implications over time. <br><br></li>
<li>By <em>error</em>, I’m talking about the inevitable consequences of statistical analysis in the real-world. Data is messy and inaccurate, samples contain unintended biases and nuances, and estimation methods always produce a much more simplified version of reality. It probably doesn’t need to be repeated, but as George Box <a href="https://en.wikipedia.org/wiki/All_models_are_wrong">famously said</a>, <em>“all models are wrong, some are useful”</em>. <br><br></li>
<li>In the article, they defined <em>COVID-19 misinformation</em> as <em>“assertions unsupported by or contradicting US Centers for Disease Control and Prevention (CDC) guidance on COVID-19 prevention and treatment during the period assessed or contradicting the existing state of scientific evidence for any topics not covered by the CDC”</em>. <br><br></li>
<li>To give them the benefit of the doubt, they also use a “certainty of evidence” criteria in their decision making which is meant to rate the confidence they have in the result with respect to estimation accuracy, risk of bias, etc. However, the conclusion that there is <em>“no effect”</em> seems questionable to say the least, and that suggesting otherwise is <em>misinformation</em> is asinine. <br><br></li>
<li>Search for the <em>‘Quinn is dead’</em> quote below for another intuitive example of the <em>fallacy of the transposed conditional</em>. <br><br></li>
<li>A couple other points on Bayesian modeling. First, on sample size. The required number of samples needed to estimate something is <em>N=0</em>. That is, I can get parameter estimates solely based on the prior distributions that are driven by what is already known. Thinking of it this way, the data becomes secondary to the model, and is merely collected as a way to nudge parameters one way or another as more of it comes in. The <em>model</em> always exists, relaying the best available information at that point in time, and I don’t need to wait to cross arbitrary sample size thresholds in order to obtain my estimates. This seems to naturally lend itself better to the scientific process. Second, a criticism of Bayesian modeling is that it is too subjective because individual judgement is being used to inform prior distributions. However, I see this as an unequivocal strength. Frequentist methods (and noninformative priors) are not “objective”. They carry assumptions that we probably wouldn’t see as realistic, it is just convenient to use them. In that sense, they become <em>more</em> arbitrary than utilizing pre-existing knowledge. There is an excellent <a href="https://learnbayesstats.com/episode/45-biostats-clinical-trial-design-frank-harrell/">podcast episode</a> where this is discussed.</li>
</ol>
</section>
<section id="favoritequotes" class="level1">
<h1>My favorite quotes</h1>
<p>These are my favorite quotes and passages from <a href="https://press.umich.edu/Books/T/The-Cult-of-Statistical-Significance2">the book</a>:</p>
<ul>
<li><em>“The sizeless scientists have adopted a method of deciding which numbers are significant that has little to do with humanly significant numbers…Imagine that you and your infant child are standing on a sidewalk near a busy street. You have just purchased a hot dog from the street vendor and have safely crossed the street. Scenario 1: You suddenly realize you have forgotten the mustard and if you scurry across the busy street, dodging vehicles, there is a 95% probability you’ll return safe with your mustard. Scenario 2: You forgot your child and you watch as she tries to cross the street herself, if you scurry across the busy street, dodging vehicles, there is a 95% probabiliity you’ll return safe with your child. The sizeless scientist in effect declares ‘they are equally important reasons for crossing the street’”</em> (chapter 0, page 10) <br><br></li>
<li><em>“…since the arrival of the desktop computer with its ability to invert big matrices at the punch of a key, ‘checking’ on sampling variability effortlessly…electronic computation of statistical significance has cheapened to near zero…‘Decision’ has become socialized and bureaucratized–heedless of the social margins.”</em> (chapter 0, page 13) <br><br></li>
<li><em>“It’s hard to do, unlike calculating t-statistics, which is a simpleton’s parlor game. But actual science at the frontier is supposed to be difficult. If it wasn’t, you wouldn’t be at the frontier.”</em> (chapter 0, page 16) <br><br></li>
<li><em>“…some cause of natural selection may have a high probability of replicability in additional samples but be trivial. Yet a cause may have a low probability of replicability but be important. This is what we mean when we say that a test of significance is neither necessary nor sufficient for a finding of importance”</em> (chapter 1, page 26) <br><br></li>
<li><em>“Unreasoning anger is a quite common reaction to challenges to the Fisherian orthodoxy.”</em> (chapter 1, page 31) <br><br></li>
<li><em>“Significance unfortunately is a useful means toward personal ends in the advance of science…Precision, knowledge, and control. In a narrow and cynical sense statistical significance is the way to achieve these. Design experiment. Then calculate statistical significance. Publish articles showing ‘significant’ results. Enjoy promotion.”</em> (chapter 1, page 32) <br><br></li>
<li><em>“An arbitrary level of statistical significance is the only standard in force–regardless of size, of loss, of cost, of ethics, of scientific persuasiveness. That is, regardless of oomph.”</em> (chapter 2, page 41) <br><br></li>
<li><em>“Gosset’s economic approach to uncertainty prevented him from be able to stop thinking at .05 for fear he’d lose too much information, and profits…[Fisher] turned away from Gosset and sought a mechanical, uniform, and bureaucratic line of demarcation–an ‘impenetrable’ end, to scientific argument. So the insecure sciences, eager to establish an ‘objective basis’ for their research ‘communicable to other rational minds’, were pleased and materially rewarded by Fisher’s 5 percent philosophy…With the low fee he set for them to rise to the rank of Sciences with a big S…”</em> (chapter 3, page 46) <br><br></li>
<li><em>“Fisher’s procedure appeals to scientists uncomfortable with any sort of argument…To avoid debate they seek certitude such as statistical significance. The unhappy result is that mere opinion and unargued crankery are <strong>more</strong> likely to rule the sizeless sciences, not less…A technique that was supposed to end arguments has in fact merely concealed the arguments behind a facade of testing that does not test.”</em> (chapter 3, page 47) <br><br></li>
<li><em>“‘The goal of an empirical economist should not be to determine the truthfulness of a model but rather the domain of its usefulness’ [Edward Leamer]”</em> (chapter 3, page 52) <br><br></li>
<li><em>“Ten million tests of significance, in economics, done annually. If the ten million tests were in fact as conclusive as their own rhetoric requires, whether accepting or rejecting, then nearly every issue in economics would long since have been settled. By now there would therefore be far fewer tests per year, not, as is the case, more and more.”</em> (chapter 3, page 53) <br><br></li>
<li><em>“Real scientists draw a line between what is large and small.”</em> (chapter 3, page 54) <br><br></li>
<li><em>“Real science, unlike significance-testing science, is difficult. If it were not, it would not be real science, but instead it would be already established routine. Real science asks you to make real scientific judgements and real scientific arguments within a community of other scientists. It asks you to be quantitatively persuasive, not to be irrelevantely mechanical. Life is hard.”</em> (chapter 3, page 55) <br><br></li>
<li><em>“…seems to be today’s prepublication attitude: merely increase the N [sample size] to get a still lower [standard error]…Notice the implication of such reasoning. It implies that something must be very wrong with the notion that statistical significance is <strong>necessary</strong> for substantive significance, a preliminary screen in which one puts one’s data.”</em> (chapter 5, page 67) <br><br></li>
<li><em>“She can test her belief in the price effect by looking at the magnitudes, using, for example, the highly advanced technique common in data-heavy articles in physics journals: ‘interocular trauma’. That is, she can look and see if the result hits her between the eyes.”</em> (chapter 5, page 72) <br><br></li>
<li><em>“‘Pushing’ an economically large <strong>though noisily estimated</strong> effect is not a misuse–or a ‘stretch’ of professional ethics. It is precisely the ethical thing to do. To argue otherwise is to fall into the mistaken belief that statistical significance <strong>can</strong> provide a screen through which the results can be put, to be examined then for <strong>substantive</strong> significance if they make it through the significance screen.”</em> (chapter 7, page 86) <br><br></li>
<li><em>“‘Young people have to have careers’ [former editor of the American Economic Review]”</em> (chapter 8, page 89) <br><br></li>
<li><em>“Any scientific hypothesis is a matter of being close enough. The decisions the scientist makes on what constitutes ‘closeness’ ‘depend entirely on the special purposes of the investigator’.”</em> (chapter 8, page 97) <br><br></li>
<li><em>“Real scientific tests are always a matter of how close to zero or how close to large or how close to some parameter value, and the standard of how close must be a substantive one, inclusive of tolerable loss.”</em> (chapter 9, page 98) <br><br></li>
<li><em>“…‘the overall benefit-cost ratio for the Employer Experiment is 4.29, but it is not statistically different from zero. The benefit-cost ratio for white women…however, is 7.07, and is statistically different from zero…The Employer Experiment affected only white women.’ The 7.07 ratio <strong>affects</strong>, they said, the 4.29 did not. This is a mistake. The best guess of the researchers was that the state got $4.29 for every dollar spent. The estimate was fuzzy, speaking of random sampling error alone. But that <strong>does not mean it is to be taken as zero</strong>.”</em> (chapter 9, page 99) <br><br></li>
<li><em>“Notice the respect for the approximate nature of social statistics in his very phrasing of ‘around 0.4’ instead of the 0.40768934 that his computer undoubtedly spewed out.”</em> (chapter 9, page 101) <br><br></li>
<li><em>“Real science changes one’s mind. That’s one way to see that the proliferation of unpersuasive significance tests is not real science.”</em> (chapter 9, page 101) <br><br></li>
<li><em>“At high sample sizes, all null hypotheses are rejected, by mathematical fact, without having to look at the data. No magic of instrumental variables is going to change that.”</em> (chapter 9, page 104) <br><br></li>
<li><em>“‘Caution, common sense, and patience…are quite likely to keep [the experimenter] more free from error…than the man of little caution and common sense who guides himself by a mechanical application of sampling rules. He will be more likely to remember that there are sources of error more important than fluctuations of sampling.’”</em> (chapter 10, page 114) <br><br></li>
<li><em>“‘It is possible for a result to be useful and possess wide standard error. A result obtained by definitions and techniques drawn up with care, and carried out by excellent interviewing and supervision may have wide standard error because the sample was small; yet such a result might be well preferable to one obtained with a bigger sample, with a smaller standard error, but whose definitions, techniques, and interviewing were out of line with best practice and knowledge of the subject matter.’ [W. Edwards Deming]”</em> (chapter 10, page 117) <br><br></li>
<li><em>“It’s embedded like a tax code in the bureaucracy of science.”</em> (chapter 11, page 124) <br><br></li>
<li><em>“…why actually replicate when the logic of Fisherian procedures gives you a virtual replication without the bother and expense? Why not go ahead and use the alloys F1 and F2 in airplanes? After all, p&lt;.05.”</em> (chapter 11, page 127) <br><br></li>
<li><em>“In denying the plurality of overlapping hypotheses, the Fisherian tester asks very little of the data. She sees the world through the lens of one hypothesis–the null.”</em> (chapter 12, page 133) <br><br></li>
<li><em>“If you are a Fisherian, the fact of a large sample becomes your problem. You’re deluded, thinking you’ve proved oomph before you’ve considered what it is.”</em> (chapter 12, page 135) <br><br></li>
<li><em>“It always depends on the loss, measured in side effects, treatment cost, death rates. The loss to a cool, scientific, impartial spectator will not be the same as the loss to the patient in question…[the balance between Type I/II errors] ‘must be left to the patient, friends, and family’.”</em> (chapter 12, page 137) <br><br></li>
<li><em>“Designing experiments to find the maximal and minimal effect size is a better way to get powerful results and to keep the focus where is should be, on the effect size itself…[William Sealy Gosset]: ‘We tend to think of effect size (when we think of it at all) as a fixed and immutable quantity that we attempt to detect. It may be more useful to think of effect size as a manipulable parameter than can, in a sense, be made larger through greater measurement accuracy.’”</em> (chapter 12, page 139) <br><br></li>
<li><em>“Some psychologists knew about the work of Neyman and Pearson and some even about that of the Bayesian Harold Jeffreys. But textbook authors, editors, and teachers–inspirited by Fisher’s promise of raising their fields to the level of hard science–helped Fisher win the day. Statistical education narrowed at the same time as it spread. Decision theory and inverse probability, and Gosset’s views on substantive significance, alternative hypotheses, and power, were pushed aside. Too introspective for the hard-boiled.”</em> (chapter 13, page 143) <br><br></li>
<li><em>“Fisher wrote in 1955, ‘In the US also the great importance of organized technology has I think made it easy to confuse the process appropriate for drawing correct conclusions, with those aimed rather at , let us say, speeding production, or saving money’. Notice the sneer by the new aristocracy of merit, as the clerisy fancied itself. Bourgeois production and money making, Fisher avers, are <strong>not</strong> the appropriate currencies of science.”</em> (chapter 13, page 145) <br><br></li>
<li><em>“Early on in an elementary statistics or psychometrics or econometrics book there might appear a loss function–‘what if it rains the day of the company picnic?’. But the loss function disappears when the book gets down to producing a formula for science.”</em> (chapter 13, page 146) <br><br></li>
<li><em>“Power, simulation, a variety of experiments, triangulation, actual replication, and exploratory data analysis leading to interocular trauma from the effect of magnitudes are different modes of affirming the consequent and are more generally a reasonable program of Gosset or Bayesian and Feynman confirmationism than is the dogma of Fisherian or Popperian falsificationism.”</em> (chapter 13, page 153) <br><br></li>
<li><em>“The Fisher test can shed light on the probability that ‘Quinn is dead’ given that ‘Quinn was hanged’. What the Fisher test wants to know and claims to measure is the opposite, the probability that Quinn was hanged, given that Quinn is dead…this probability is close to zero…In a nonhanging society people die for many reasons other than hanging…therefore being dead is very weak evidence indeed that Quinn was hanged…Being dead is ‘consistent with’ the hypothesis that Quinn was hanged as the positivist rhetoric of the Fisherian argument emphasizes. But so what? A myriad of other hypotheses…such as catching pneumonia or breaking your neck in a fall from your horse, are also consistent with it–‘it’ being the fact of being dead.”</em> (chapter 14, page 155) <br><br></li>
<li><em>“One of us has an elderly aunt who can sit in the garden of a hot, Indiana summer evening untouched by mosquitoes. She chalks up her immunity to a side effect of a ‘nuclear treatment’ received at midcentury to attack a tumor…Well, who’s to deny her? Medical science since the arrival of Fisher’s methods has had a problem with narrative…people believed that the use of p’s and t’s in the design and evaluation of clinical trials would mark an advance over old wive’s tales, crankery, anecdote, folkways, and fast-talking patent medicine salesmen. The dream of mechanization was as compelling in medicine as it was in war, social work, and philosophy of mind…‘Let the table decide’. At 5 percent the medical scientists suddenly submitted eyes locked hard in a sizeless stare. But the new method is just a mutation of old husband’s tales, statistical crankery, probabilistic anecdote, scientific folkways, and fast-talking, twenty-first-century, statistical patent medicine salesmen.”</em> (chapter 14, page 160) <br><br></li>
<li><em>“Even the rare courageous Fisherians do not deign to make a case for their procedures. They merely complain that the procedures are being criticized…being comfortably in control, appear inclined to leave things as they are…If you don’t have any arguments for an intellectual habit of a lifetime perhaps it is best to keep quiet”</em> (chapter 15, page 169) <br><br></li>
<li><em>“If one can see or hear the problem, one does not need to rely on correlations…doctors have lost many of their skills of physical assessment, even with the stethoscope (and certainly with their hands) and have come to rely on a medical literature deeply infected with Fisherianism.”</em> (chapter 15, page 175) <br><br></li>
<li><em>“The Fisherian tests of significance, the only tests employed by the original authors of the seventy-one studies, literally could not see the beneficial effects of the therapies under study, though staring at them.”</em> (chapter 16, page 179) <br><br></li>
<li><em>“The ‘sunshine herb’ [St.&nbsp;John’s wort] is frequently under attack (perhaps, one suspects, because it seems to be a cheap substitute for drugs)…the authors…concluded from the p-value that St.&nbsp;John’s-wort is not clinically effective. Doesn’t help, they said.”</em> (chapter 16, page 182) <br><br></li>
<li><em>“‘…They were made on different days at different hours. They all relate to the same nest’. Since Edgeworth had collected his own data, he knew his observations intimately; for example, he controlled exactly for nest and time-of-day heterogeneity, reducing error in observations that cannot be matched with a mere test of statistical significance on a data set downloaded from the Internet, no matter how mathematically advanced the ‘correction’.”</em> (chapter 17, page 189) <br><br></li>
<li><em>“Statistical significance can indicate the likelihood of the presence of an effect…But…so what?…Hoover an Siegler want to assign the responsibility to a man they call ‘practical’. Shades of Fisher: the scientist is replaced by a mechanical puppet who acknowledges a signal at p=.05, and the puppet–not the scientist who knows why it might matter–is called ‘practical’.”</em> (chapter 17, page 191) <br><br></li>
<li><em>“Statistics was not by any means the primary science on the Gower Street agenda. Biometry, but especially eugenics, was…Pearson’s papers and the archives of the Biometric and Galton labs survive. One finds in them the ephemera of a scientific racism common to the age, and to which Galton, Pearson, and Fisher were leading contributors…Value judgements–arguments about the arguments–and Gosset’s personal probability, were to be kept out of the neighborhood of their new sciences. Pearson would write in the 1920s against Jewish migration to Britain, and Fisher would write in the 1930s against material relief for poor people and literally in favor of relief for the rich on eugenic grounds. Such stuff was in the air…”</em> (chapter 18, page 199) <br><br></li>
<li><em>“An early case, applied to the eggs of the cuckoo bird, illustrates literally the feel of substantive as against statistical significance.”</em> (chapter 19, page 203) <br><br></li>
<li><em>“There are ways other than getting inside the mind of the victim to know what matters to her. For instance, one could measure with some difficulty and sacrifice (but good science is difficult and sacrificial)…”</em> (chapter 19, page 205) <br><br></li>
<li><em>“But Gosset in this study and others often found z or t beside the point. ‘You want to be able to say ’if farmers [or whomever] in general do this [i.e., follow a certain experimental method] they will make money by it’’. A criterion of merely statistical significance could not satisfy such taste.</em> (chapter 20, page 209) <br><br></li>
<li><em>“‘Fisher was vague. Karl Pearson was vague. Egon Pearson vague. Neyman vague. Fisher and Neyman were fiery. Silly! Egon Pearson was on the outside. They were all jealous of one another, afraid somebody would get ahead. Gosset didn’t have a jealous bone in his body. He asked the question [about power and alternative hypotheses]. Egon Pearson to a certain extent rephrased the question which Gosset had asked in statistical parlance. Neyman solved the problem mathematically.’ [Florence Nightingale David]”</em> (chapter 20, page 211) <br><br></li>
<li><em>“‘There must be essential similarity to ordinary practice…Experiments must be so arranged as to obtain the maximum possible correlation [not the maximum possible statistical significance] between figures which are to be compared [like Leamer and other oomph-ful scientists, Gosset thought in terms of upper and lower bound estimates, best and worst case scenarios]…Repetitions should be so arranged as to have the minimum possible correlation between repetitions (or the highest possible negative correlation)…There should be economy of effory [net pecuniary advantage in the 1905 sense]’ [Student (William Sealy Gosset)]. Fisher shrugged. The economic approach to the design of experiments was too difficult. He never did try Gosset’s way.”</em> (chapter 21, page 216) <br><br></li>
<li><em>“An ethical life of science seems to require an emotional life outside of it. ‘…he [Fisher] is glad to discuss…things early in the morning or late at night. But he is not glad or even willing to have others work on the purely theoretical aspects of his work. He expects others to accept his discoveries without even questioning them. He does <strong>not</strong> admit that anything he ever said or wrote was wrong. But he goes much further than that. He does not admit even that the <strong>way</strong> he said anything or the nomenclature he used could be improved in any way.’ [Raymond Birge]. Birge told Deming that Fisher was the most conceited man he ever met.”</em> (chapter 21, page 222) <br><br></li>
<li><em>“‘Though recognizable as a psychological condition of reluctance, or resistance to the acceptance of a proposition, the feeling induced by a test of significance has an objective basis in that the probability statement on which it is based is a fact communicable to and verifiable by, other rational minds. The level of significance in such cases fulfils the conditions of a measure of the rational grounds for the disbelief it engenders.’ [R.A. Fisher]”</em> (chapter 21, page 223) <br><br></li>
<li><em>“To evaluate size matters/how much would have forced Fisher to listen to and cooperate with others. Determining whether something matters to people depends on actually listening to people, as a heart surgeon listens to a radiologist, as a beer brewer listens to a customer. Admitting that size matters would have required Fisher to admit that regression coefficients ‘are capable of evaluation in any currency’. It would have put him in the unhappy position of having to communicate with others about the meaning of his findings. This, we have shown, he would not do.”</em> (chapter 21, page 224) <br><br></li>
<li><em>“Scientists, Fisher said, should ‘not assume’ their research is ‘capable of evaluation’. They must not work to ‘maximize profit’, he said in 1955, only for ‘faith’–a secular faith, he means, in the possibility that another mechanically calculated output of p-values by themselves could contribute to scientific progress. The scientist should not worry…whether their samples are random: just test, test, test, <strong>as if</strong> random. A 5 percent level of Type I error is, when ‘formally’ considered, says Fisher, the final judge of Science.”</em> (chapter 21, page 226) <br><br></li>
<li><em>“It is our experience that the more training a person has undergone in Fisherian methods the less easy it is for her to grasp our very elementary point…People who are highly trained in conventional economics have an especially difficult time. Most of them have no idea what we are talking about, though they are sure they do not approve. By contrast, undergraduates who have never had a statistics course, science and engineering professionals we work with or meet in our travels, businesspeople, musicians, activists, various colleagues in nonstatistical fields…as soon as they are able to grasp that we are <strong>not</strong> attacking statistics as such…these have no difficulty understanding our point and immediately begin wondering what the controversy is about.”</em> (chapter 23, page 239) <br><br></li>
<li><em>“One can take null-hypothesis significance testing as a sort of astrology, giving ‘decisions’ mechanically, justified within the system of astrology itself…Fisherisnism is <strong>bad</strong> input, straightforwardly misleading advice, erroneous astrology. Misleading advice is not made into good advice merely by its mechanical and pecuniary cheapness.”</em> (chapter 23, page 241/242) <br><br></li>
<li><em>“‘Adherence to the rules originally conceived as a means, becomes transformed into an end-in-itself’ [Robert Merton]. That seems about right: statistical significance, originally conceived as a means to substantive significance, became transformed by Fisher and then by bureaucracies of science into an end in itself. A t-tested certified fact will be ‘equally convincing to all rational minds, irrespective of any intentions they may have in utilizing knowledge inferred’.”</em> (chapter 23, page 243) <br><br></li>
<li><em>“If we were to assemble our socioeconomic observations into a single chain of thought its strongest link would be coupling Merton’s ‘bureaucracy’ with Hayek’s ‘scientism’. Scientism describes, ‘of course, an attitude which is decidedly unscientific in the true sense of the word, since it involves a mechanical and uncritical application of habits of thought to fields different from those in which they have been formed. The scentistic as distinguished from the scientific view is not an unprejudiced but a very prejudiced approach which, before it has considered its subject, claims to know what is the most appropriate way of investigating it’. [Hayek]. The trick is to unshackle the bureaucracy of scientism, to break its mechanical rules, change its prejudice incentives, create new rituals, train capacity. No simple trick.”</em> (chapter 23, page 244) <br><br></li>
<li><em>“They need to acquire the virtues necessary for performing repeated experiments on the same material. They need to hear that random error is one out of many dozens of errors and seldom the biggest.”</em> (chapter 24, page 246) <br><br></li>
<li><em>“In science, as against careerism or pure mathematics, it is better to be approximately correct and scientifically relevant than it is to be precisely correct but humanly irrelevant. Not even the fully specified power function, balancing the risk of errors from random sampling, provides a full solution to a scientific problem. In truth, as Kruskal never tired of remarking, statistical ‘significance’ poses no scientific problem at all. With the aid of a personal computer and a grant such significance is easy to achieve.”</em> (chapter 24, page 246) <br><br></li>
<li><em>“Statistical scientists can teach substance without sacrificing the rigor they so passionately seek. Real rigor will <strong>rise</strong> with increased attention to substance.”</em> (chapter 24, page 247) <br><br></li>
<li><em>“The textbooks are wrong. The teaching is wrong. The seminar you just attended is wrong. The most prestigious journal in your scientific field is wrong…Science is mainly a series of approximations to discovering the sources of error. Science is a systematic way of reducing wrongs or can be.”</em> (chapter 24, page 251) <br><br></li>
<li><em>“Perhaps you feel frustrated by the random epistemology of the mainstream but don’t know what to do. Perhaps you’ve been sedated by significance and lulled into silence. Perhaps you sense that the power of a Rothamsted test against a plausible Dublin alternative is statistically speaking low but are dazzled by the one-sided rhetoric of statistical significance. Perhaps you feel oppressed by the instrumental variable one should dare not to wield. Perhaps you feel frazzled by the ‘social psychological rhetoric of fear’ that keeps the abuse of significance in circulation. You want to come out of it. But perhaps you are cowed by the pretige of Fisherian dogma. Or, worse thought, perhaps you are cynically willing to be corrupted if it will keep a nice job. Repent, we say. Embrace your inner Gosset…‘Who are you going to believe–us or your own lying eyes?’”</em> (chapter 24, page 251)</li>
</ul>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ol type="1">
<li>Deirdre McCloskey, Steve Ziliak. <a href="https://press.umich.edu/Books/T/The-Cult-of-Statistical-Significance2"><em>The Cult of Statistical Significance: How the Standard Error Costs Us Jobs, Justice, and Lives</em></a>. University of Michigan Press. 2008. https://doi.org/10.3998/mpub.186351 (subtitle quote: chapter 10, page 112) <br><br></li>
<li>Sule S, DaCosta MC, DeCou E, Gilson C, Wallace K, Goff SL. <a href="https://jamanetwork.com/journals/jamanetworkopen/fullarticle/2808358">Communication of COVID-19 Misinformation on Social Media by Physicians in the US</a>. JAMA Netw Open. 2023;6(8):e2328928. doi:10.1001/jamanetworkopen.2023.28928 <br><br></li>
<li>Roman YM, Burela PA, Pasupuleti V, Piscoya A, Vidal JE, Hernandez AV. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8394824/">Ivermectin for the Treatment of Coronavirus Disease 2019: A Systematic Review and Meta-analysis of Randomized Controlled Trials.</a> Clin Infect Dis. 2022 Mar 23;74(6):1022-1029. doi: 10.1093/cid/ciab591. PMID: 34181716; PMCID: PMC8394824. <br><br></li>
<li>Diaz GA, Parsons GT, Gering SK, Meier AR, Hutchinson IV, Robicsek A. <a href="https://jamanetwork.com/journals/jama/fullarticle/2782900">Myocarditis and Pericarditis After Vaccination for COVID-19</a>. JAMA. 2021;326(12):1210–1212. doi:10.1001/jama.2021.13443 <br><br></li>
<li>Cohen, J. (1994). <a href="https://doi.org/10.1037/0003-066X.49.12.997">The earth is round (p &lt; .05)</a>. American Psychologist, 49(12), 997–1003. https://doi.org/10.1037/0003-066X.49.12.997</li>
</ol>


<!-- -->

</section>

 ]]></description>
  <category>History</category>
  <category>Philosophy</category>
  <category>Research</category>
  <guid>https://www.zajichekstats.com/post/statistical-significance-is-insignificant/</guid>
  <pubDate>Fri, 22 Dec 2023 06:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/statistical-significance-is-insignificant/feature.png" medium="image" type="image/png" height="145" width="144"/>
</item>
<item>
  <title>The overlap weight in survival analysis</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/the-overlap-weight/</link>
  <description><![CDATA[ 




<p>I was recently introduced to <a href="https://jamanetwork.com/journals/jama/article-abstract/2765748">overlap weighting</a>, which is part of a general family of methods for balancing covariates when estimating treatment effects with observational data. Specifically, it focuses on the <a href="https://www.sciencedirect.com/topics/medicine-and-dentistry/clinical-equipoise#:~:text=Clinical%20equipoise%20is%20defined%20as,Seminars%20in%20Vascular%20Surgery%2C%202022"><em>clinical equipoise</em></a>; that is, the patients in which the treatment decision is most uncertain. I find it more elegant than <a href="https://en.wikipedia.org/wiki/Propensity_score_matching">matching</a> (which I’ve <a href="https://jamanetwork.com/journals/jama/fullarticle/2749478">used in the past</a>), and figured a useful way to better understand the approach is to deconstruct, interpret, and translate a <a href="http://www2.stat.duke.edu/~fl35/OW/OW_survival_Demo.sas">SAS simulation</a> in the context of survival analysis implemented by the <a href="https://pubmed.ncbi.nlm.nih.gov/30189042/">original authors</a>. All code is written in (and translated to) <a href="https://www.r-project.org/"><code>R</code></a>. We’ll start by loading some packages.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(survival)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(reactable)</span></code></pre></div>
</details>
</div>
<section id="table-of-contents" class="level1">
<h1>Table of Contents</h1>
<ul>
<li>Setting up the potential outcomes
<ul>
<li>Simulate some patients</li>
<li>Define the treatment propensity</li>
<li>Generate the treatment assignment</li>
<li>Compute the (true) overlap weight</li>
<li>Set the treatment effect</li>
<li>Assign the observed outcome</li>
</ul></li>
<li>Estimating the weights
<ul>
<li>Model the propensity scores</li>
<li>Calculate the (estimated) overlap weight</li>
</ul></li>
<li>Estimating the treatment effect
<ul>
<li>A look at the true hazard ratio</li>
<li>The final estimate</li>
</ul></li>
</ul>
</section>
<section id="potentialoutcomes" class="level1">
<h1>Setting up the potential outcomes</h1>
<p>The theoretical underpinnings of <a href="https://pubmed.ncbi.nlm.nih.gov/30189042/">overlap weighting</a> live in the context of the <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5841618/#:~:text=The%20potential%20outcomes%20framework%20provides%20a%20way%20to%20quantify%20causal,exposure%20or%20intervention%20under%20consideration.">potential outcomes</a> paradigm of <a href="https://www.sciencedirect.com/topics/social-sciences/causal-inference">causal inference</a>. Basically, we wonder what <em>would have</em> happened had we been able to observe each patient under both treatments (known as the <a href="https://bmcmedresmethodol.biomedcentral.com/articles/10.1186/1471-2288-5-28">counterfactual</a>). If we knew the outcomes from the two worlds, the causal treatment effect would simply be the average difference across all patients. The problem of course is that in reality the outcome can only be observed for the treatment in which the patient was assigned (or chose), and so our goal is to work with the “incomplete” information that we do have to try to estimate what the outcome difference would have been had the counterfactual been observed as well.</p>
<section id="simulatepatients" class="level2">
<h2 class="anchored" data-anchor-id="simulatepatients">Simulate some patients</h2>
<p>The first thing we need to do is generate some (fake) patients to facilitate the simulation. Here we’ll focus on age, sex, and income as patient-identifying characteristics.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the sample size</span></span>
<span id="cb2-2">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span></span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the seed</span></span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb2-6"></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Build the population</span></span>
<span id="cb2-8">population <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb2-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb2-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb2-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zage =</span> (age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb2-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">male =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.6</span>),</span>
<span id="cb2-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">income =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>),</span>
<span id="cb2-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">zincome =</span> (income <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span></span>
<span id="cb2-15">  )</span>
<span id="cb2-16">population</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,000 × 5
     age    zage  male income zincome
   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;
 1  44.4 -0.560      0   36.5  -1.35 
 2  47.7 -0.230      1   44.2  -0.579
 3  65.6  1.56       1   41.4  -0.861
 4  50.7  0.0705     1   59.7   0.973
 5  51.3  0.129      0   56.2   0.619
 6  67.2  1.72       1   63.9   1.39 
 7  54.6  0.461      1   35.1  -1.49 
 8  37.3 -1.27       1   56.4   0.639
 9  43.1 -0.687      1   53.7   0.375
10  45.5 -0.446      1   53.7   0.370
# ℹ 9,990 more rows</code></pre>
</div>
</div>
<p>We’ve generated a sample of 10000 patients. We’ll assume <code>age</code> is measured in years, <code>income</code> in thousands of dollars ($), and <code>male</code> is 1 for <em>Male</em> and 0 for <em>Female</em>. The columns <code>zage</code> and <code>zincome</code> are just <a href="https://statisticsbyjim.com/glossary/standardization/#:~:text=In%20statistics%2C%20standardization%20is%20the,standard%20deviation%20for%20a%20variable.">standardized</a> versions of the originals to avoid scaling nuances (we’ll refer to these as <img src="https://latex.codecogs.com/png.latex?age_z"> and <img src="https://latex.codecogs.com/png.latex?income_z">).</p>
</section>
<section id="treatmentpropensity" class="level2">
<h2 class="anchored" data-anchor-id="treatmentpropensity">Define the treatment propensity</h2>
<p>Here’s where the important theory starts to creep in (already). We assume that there is a <em>true</em> propensity score, say <img src="https://latex.codecogs.com/png.latex?p_i%5EA">, that is the <em>true</em> probability that patient <em>i</em> receives treatment <em>A</em> given their specific characteristics (and let’s assume there are possible treatments <em>A</em> &amp; <em>B</em>). Further, we assume (some transformation of) this probability is a linear combination of all the characteristics that confound the crude treatment effect on the outcome. In this simulation, we’ll assume the <a href="https://en.wikipedia.org/wiki/Logistic_regression">logit</a> model:</p>
<p><img src="https://latex.codecogs.com/png.latex?log(%5Cfrac%7Bp_i%5EA%7D%7B1%20-%20p_i%5EA%7D)%20=%200.41%20%5Ctimes%20age_z%20-%200.22%20%5Ctimes%20male%20-%200.69%20%5Ctimes%20income_z%20-%200.40"></p>
<p>So let’s add this <em>true</em> propensity score to the <code>population</code> data set:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">population <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb4-2">  population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-3">  </span>
<span id="cb4-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the true propensity score (unknown quantity)</span></span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb4-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">log_odds_pA =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>zage <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>male <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>zincome,</span>
<span id="cb4-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pA =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>log_odds_pA))</span>
<span id="cb4-8">  )</span>
<span id="cb4-9">population</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,000 × 7
     age    zage  male income zincome log_odds_pA    pA
   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
 1  44.4 -0.560      0   36.5  -1.35        0.311 0.577
 2  47.7 -0.230      1   44.2  -0.579      -0.315 0.422
 3  65.6  1.56       1   41.4  -0.861       0.606 0.647
 4  50.7  0.0705     1   59.7   0.973      -1.27  0.219
 5  51.3  0.129      0   56.2   0.619      -0.777 0.315
 6  67.2  1.72       1   63.9   1.39       -0.888 0.292
 7  54.6  0.461      1   35.1  -1.49        0.595 0.644
 8  37.3 -1.27       1   56.4   0.639      -1.58  0.171
 9  43.1 -0.687      1   53.7   0.375      -1.16  0.238
10  45.5 -0.446      1   53.7   0.370      -1.06  0.257
# ℹ 9,990 more rows</code></pre>
</div>
</div>
<p>Obviously in practice we don’t know what <img src="https://latex.codecogs.com/png.latex?p_i%5EA"> is, so it must be <em>estimated</em> from the treatment assignments we observe in the data. Additionally, we aren’t strictly required to assume the <a href="https://en.wikipedia.org/wiki/Logistic_regression">logit</a> model, but when we use it to estimate the propensity score for <a href="https://pubmed.ncbi.nlm.nih.gov/30189042/">overlap weighting</a>, it has the advantageous property of perfect balance. That is, the weighted-mean differences for all covariates included in the logistic regression model will be zero across the treatment groups.</p>
</section>
<section id="treatmentassignment" class="level2">
<h2 class="anchored" data-anchor-id="treatmentassignment">Generate the treatment assignment</h2>
<p>The treatment assignment is one of the <em>known</em> quantities we would observe in a real life sample, and that is what would be used as the dependent variable for <em>estimating</em> propensity scores. However, since we are running a simulation, we need to generate the treatment assignments from the governing distribution. We assume that the observed treatment for patient <em>i</em> is the result of an (unfair) coin flip that has a probability equal to the true propensity score. In statistical notation,</p>
<p><img src="https://latex.codecogs.com/png.latex?A_i%20%5Csim%20Bernoulli(p_i%5EA)"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?A_i"> is the indicator of treatment A. Let’s add a <em>realized</em> treatment assignment to the <code>population</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">population <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb6-2">  population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-3">  </span>
<span id="cb6-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the realized treatment assignment (known quantity)</span></span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">A =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> pA),</span>
<span id="cb6-7">  )</span>
<span id="cb6-8">population</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,000 × 8
     age    zage  male income zincome log_odds_pA    pA     A
   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
 1  44.4 -0.560      0   36.5  -1.35        0.311 0.577     1
 2  47.7 -0.230      1   44.2  -0.579      -0.315 0.422     0
 3  65.6  1.56       1   41.4  -0.861       0.606 0.647     1
 4  50.7  0.0705     1   59.7   0.973      -1.27  0.219     0
 5  51.3  0.129      0   56.2   0.619      -0.777 0.315     1
 6  67.2  1.72       1   63.9   1.39       -0.888 0.292     1
 7  54.6  0.461      1   35.1  -1.49        0.595 0.644     0
 8  37.3 -1.27       1   56.4   0.639      -1.58  0.171     0
 9  43.1 -0.687      1   53.7   0.375      -1.16  0.238     0
10  45.5 -0.446      1   53.7   0.370      -1.06  0.257     0
# ℹ 9,990 more rows</code></pre>
</div>
</div>
<p>In this case, <code>A=1</code> represents treatment <em>A</em> and <code>A=0</code> represents treatment <em>B</em>. Again, this is the actual treatment we would observe the patient receiving in a sample.</p>
</section>
<section id="trueoverlapweight" class="level2">
<h2 class="anchored" data-anchor-id="trueoverlapweight">Compute the (true) overlap weight</h2>
<p>We need to define what the overlap weight is, and it’s actually quite simple: just assign the patient the probability they <em>did not</em> receive their observed treatment.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0AOW_i=%0A%20%20%20%20%5Cbegin%7Bcases%7D%0A%20%20%20%20%20%20%20%201-p_i%5EA%20&amp;%20%5Ctext%7Bif%20%7D%20A_i=1%5C%5C%0A%20%20%20%20%20%20%20%20p_i%5EA%20&amp;%20%5Ctext%7Bif%20%7D%20A_i=0%5C%5C%0A%20%20%20%20%5Cend%7Bcases%7D%0A%5Cend%7Bequation%7D%0A"></p>
<p>Notice the notation. Since it depends on the true propensity score, the overlap weight is another <em>unknown</em> quantity that is estimated from the data. It also depends on the realized treatment assignment, so the collection of weights across patients differ depending on the observed treatment distribution. We can add these weights to the <code>population</code> data set:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">population <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb8-2">  population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-3">  </span>
<span id="cb8-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the true overlap weight for the realized treatment (unknown quantity)</span></span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb8-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">OW =</span> A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>pA) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>A) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pA</span>
<span id="cb8-7">  )</span>
<span id="cb8-8">population</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,000 × 9
     age    zage  male income zincome log_odds_pA    pA     A    OW
   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
 1  44.4 -0.560      0   36.5  -1.35        0.311 0.577     1 0.423
 2  47.7 -0.230      1   44.2  -0.579      -0.315 0.422     0 0.422
 3  65.6  1.56       1   41.4  -0.861       0.606 0.647     1 0.353
 4  50.7  0.0705     1   59.7   0.973      -1.27  0.219     0 0.219
 5  51.3  0.129      0   56.2   0.619      -0.777 0.315     1 0.685
 6  67.2  1.72       1   63.9   1.39       -0.888 0.292     1 0.708
 7  54.6  0.461      1   35.1  -1.49        0.595 0.644     0 0.644
 8  37.3 -1.27       1   56.4   0.639      -1.58  0.171     0 0.171
 9  43.1 -0.687      1   53.7   0.375      -1.16  0.238     0 0.238
10  45.5 -0.446      1   53.7   0.370      -1.06  0.257     0 0.257
# ℹ 9,990 more rows</code></pre>
</div>
</div>
<p>In a real analysis, these weights are what we are ultimately after in order to estimate the average <em>causal</em> treatment effect on the outcome of interest while balancing differences in patient characteristics across the groups (i.e., removing the confounding factors).</p>
<section id="targetpopulation" class="level3">
<h3 class="anchored" data-anchor-id="targetpopulation">Target population</h3>
<p>Now we do end up normalizing the weights so they sum to one within each treatment group. But the intuition about what’s happening is that the focus of the treatment effect estimation is shifted to patients that are most likely in <em>either</em> treatment group. This is known as the <a href="https://www.sciencedirect.com/topics/medicine-and-dentistry/clinical-equipoise#:~:text=Clinical%20equipoise%20is%20defined%20as,Seminars%20in%20Vascular%20Surgery%2C%202022"><em>clinical equipoise</em></a>, and the resulting treatment effect is interpreted as the <em>average treatment effect in the overlap population</em>.</p>
<p>This makes a lot of sense. When we’re comparing treatments, we should focus most heavily on patients that could be candidates for either, and less so on patients that were bound for one. Thus, we up-weight patients who have the most overlap in characteristics with the opposing treatment group. The beautiful thing here is that we do this without throwing away any information; smoothly and proportionately weighting each subject just the amount that we should.</p>
</section>
</section>
<section id="treatmenteffect" class="level2">
<h2 class="anchored" data-anchor-id="treatmenteffect">Set the treatment effect</h2>
<p>We’ve generated the treatments and established how they are related to patient characteristics, but haven’t talked about the outcome in which we’re ultimately interested in estimating the treatment effect for. Since we’re focusing on <a href="https://www.publichealth.columbia.edu/research/population-health-methods/time-event-data-analysis">time-to-event</a> outcomes, we’ll stay in that context, but the general idea is that we assume there <em>exists</em> a realization of what a patient’s outcome would have been under each treatment scenario. Then if we compare the difference of those outcomes across all patients, the average difference must be caused by the treatment.</p>
<section id="defining-the-event-times" class="level3">
<h3 class="anchored" data-anchor-id="defining-the-event-times">Defining the event times</h3>
<p>In this simulation, we’ll generate event times from a <a href="https://en.wikipedia.org/wiki/Weibull_distribution">Weibull</a> distribution. Starting at treatment initiation, this might be the time until cancer recurrence, hospitalization, or something else; we’re just looking to see how long it takes for some event to occur. The <a href="https://en.wikipedia.org/wiki/Probability_density_function">PDF</a> for this distribution looks <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/Weibull.html">like this</a>:</p>
<p><img src="https://latex.codecogs.com/png.latex?f(t)%20=%20%5Cfrac%7B%5Calpha%7D%7B%5Csigma%7D%5Cleft(%5Cfrac%7Bt%7D%7B%5Csigma%7D%5Cright)%5E%7B%5Calpha-1%7De%5E%7B-%5Cleft(%5Cfrac%7Bt%7D%7B%5Csigma%7D%5Cright)%5E%5Calpha%7D"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?t"> is the event time, <img src="https://latex.codecogs.com/png.latex?%5Calpha"> is the <em>shape</em> parameter, and <img src="https://latex.codecogs.com/png.latex?%5Csigma"> is the <em>scale</em> parameter. In our example, we will say that:</p>
<p><img src="https://latex.codecogs.com/png.latex?T_i%5EA%20%5Csim%20Weibull(%5Calpha,%20%5Csigma_i%5EA)"> <img src="https://latex.codecogs.com/png.latex?T_i%5EB%20%5Csim%20Weibull(%5Calpha,%20%5Csigma_i%5EB)"> where <img src="https://latex.codecogs.com/png.latex?T_i%5EA"> and <img src="https://latex.codecogs.com/png.latex?T_i%5EB"> are the event times under treatments <em>A</em> and <em>B</em>, respectively. That is, the event times for each patient under each treatment follow a <a href="https://en.wikipedia.org/wiki/Weibull_distribution">Weibull</a> distribution with a common <em>shape</em> parameter (in this case, across both treatments), but a <em>scale</em> parameter that depends on the patient’s specific characteristics (in <em>log-linear</em> form) and differs by treatment, which captures the treatment effect. Specifically,</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Calpha%20=%201"> <img src="https://latex.codecogs.com/png.latex?%5Csigma_i%5EA%20=%20%5Clambda%20%5Ctimes%20e%5E%7B-(%5Cphi_i%20-%200.36)%7D"> <img src="https://latex.codecogs.com/png.latex?%5Csigma_i%5EB%20=%20%5Clambda%20%5Ctimes%20e%5E%7B-%5Cphi_i%7D"> <img src="https://latex.codecogs.com/png.latex?%5Cphi_i%20=%201.10%20%5Ctimes%20age_z%20-%200.22%20%5Ctimes%20male%20-%200.36%20%5Ctimes%20income_z"> <img src="https://latex.codecogs.com/png.latex?%5Clambda%20=%204055.56"></p>
<p>Basically, the <img src="https://latex.codecogs.com/png.latex?%5Cphi_i"> term does the baseline adjustment on the outcome risk for the patient’s specific characteristics, and the treatment effect is simply a fixed, additive deviation from that for all patients. The <img src="https://latex.codecogs.com/png.latex?%5Clambda"> term is the <a href="https://www.linkedin.com/advice/0/how-do-you-interpret-hazard-ratio-baseline-function">baseline hazard function</a>, providing the <em>scale</em> parameter when all covariate values are zero (for treatment <em>B</em>), which in this case is constant over time.</p>
<section id="interpretingtreatmenteffect" class="level4">
<h4 class="anchored" data-anchor-id="interpretingtreatmenteffect">Interpreting the treatment effect</h4>
<p>When setting <img src="https://latex.codecogs.com/png.latex?%5Calpha=1">, the mean of a <a href="https://en.wikipedia.org/wiki/Weibull_distribution">Weibull</a> distribution is equal to its scale parameter. That is,</p>
<p><img src="https://latex.codecogs.com/png.latex?E%5BT_i%5EA%5D%20=%20%5Csigma_i%5EA"> <img src="https://latex.codecogs.com/png.latex?E%5BT_i%5EB%5D%20=%20%5Csigma_i%5EB"> This gives us a very nice interpretation of the treatment effect. If we compare them <em>relatively</em>, we get:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%5Cbegin%7Bsplit%7D%0A%5Cfrac%7BE%5BT_i%5EA%5D%7D%7BE%5BT_i%5EB%5D%7D%20&amp;%20=%20%5Cfrac%7B%5Csigma_i%5EA%7D%7B%5Csigma_i%5EB%7D%20%5C%5C%0A&amp;%20=%20%5Cfrac%7B%5Clambda%20%5Ctimes%20e%5E%7B-(%5Cphi_i%20-%200.36)%7D%7D%7B%5Clambda%20%5Ctimes%20e%5E%7B-%5Cphi_i%7D%7D%20%5C%5C%0A&amp;%20=%20%5Cfrac%7Be%5E%7B-(%5Cphi_i%20-%200.36)%7D%7D%7Be%5E%7B-%5Cphi_i%7D%7D%20%5C%5C%0A&amp;%20=%20%5Cfrac%7Be%5E%7B0.36%7De%5E%7B-%5Cphi_i%7D%7D%7Be%5E%7B-%5Cphi_i%7D%7D%20%5C%5C%0A&amp;%20=%20e%5E%7B0.36%7D%20%5C%5C%0A&amp;%20%5Capprox%201.43%0A%5Cend%7Bsplit%7D%0A%5Cend%7Bequation%7D%0A"></p>
<p>So we can say that the <em>time to event for patients on treatment A is 1.43 times, or 43%, longer on average than those on treatment B, given a fixed age, sex, and income</em>. That is, treatment A is “better” than treatment B.</p>
</section>
</section>
<section id="samplingeventtimes" class="level3">
<h3 class="anchored" data-anchor-id="samplingeventtimes">Sampling the event times</h3>
<p>Next, we need to actually sample the times for our <code>population</code> (<em>note that it was confirmed that SAS and R have the same parameterizations</em>):</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">population <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb10-2">  population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-3">  </span>
<span id="cb10-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Sample outcome event times under each treatment (counterfactual)</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb10-6">    </span>
<span id="cb10-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Baseline hazard (constant over time)</span></span>
<span id="cb10-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lambda =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">365</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.09</span>,</span>
<span id="cb10-9">    </span>
<span id="cb10-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Define TRUE Weibull linear predictor</span></span>
<span id="cb10-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">phi =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> zage <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> male <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> zincome,</span>
<span id="cb10-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma_A =</span> lambda <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>(phi <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.70</span>))),</span>
<span id="cb10-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sigma_B =</span> lambda <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>phi),</span>
<span id="cb10-14">    </span>
<span id="cb10-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate REALIZED survival times under each treatment scenario (same parameterizations in SAS)</span></span>
<span id="cb10-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t_A =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rweibull</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale =</span> sigma_A),</span>
<span id="cb10-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t_B =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rweibull</span>(n, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale =</span> sigma_B), </span>
<span id="cb10-18">  )</span>
<span id="cb10-19">population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(lambda, phi, sigma_A, sigma_B, t_A, t_B)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,000 × 6
   lambda     phi sigma_A sigma_B    t_A   t_B
    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1  4056. -0.133    6617.   4632.  5689. 7760.
 2  4056. -0.269    7585.   5309.  1831. 9482.
 3  4056.  1.80      961.    673.   488.  300.
 4  4056. -0.493    9482.   6637. 23722.  255.
 5  4056. -0.0788   6269.   4388.  7649. 1800.
 6  4056.  1.17     1804.   1263.  1953. 1493.
 7  4056.  0.814    2568.   1797.  5462. 2652.
 8  4056. -1.84    36514.  25560. 38262. 2385.
 9  4056. -1.11    17604.  12323.  3577. 6894.
10  4056. -0.845   13485.   9439. 38541. 3743.
# ℹ 9,990 more rows</code></pre>
</div>
</div>
<p>Now we can make some density plots comparing the event time distributions across treatments (we’ll use <em>log</em> scaling for visual appeal):</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb12-2">  </span>
<span id="cb12-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send down the rows</span></span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb12-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t_"</span>),</span>
<span id="cb12-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Treatment"</span>,</span>
<span id="cb12-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"EventTime"</span>,</span>
<span id="cb12-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_prefix =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t_"</span></span>
<span id="cb12-9">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb12-10">  </span>
<span id="cb12-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb12-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(</span>
<span id="cb12-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb12-15">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">log</span>(EventTime),</span>
<span id="cb12-16">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Treatment</span>
<span id="cb12-17">    ),</span>
<span id="cb12-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span></span>
<span id="cb12-19">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb12-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(x) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(x))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb12-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb12-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb12-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb12-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb12-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span></span>
<span id="cb12-27">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb12-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Event Time"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/the-overlap-weight/index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notice the shift to the right in the distribution for treatment <em>A</em>. This is the treatment effect. In the hypothetical world where all patients received treatment <em>A</em>, the event times happened <em>later</em> than in the world where all patients received treatment <em>B</em> (and all event times were observed), indicating, on average, a “benefit” to treatment <em>A</em>, which was expected from our prior calculation.</p>
</section>
</section>
<section id="observedoutcome" class="level2">
<h2 class="anchored" data-anchor-id="observedoutcome">Assign the observed outcome</h2>
<p>The final step for simulation setup is to assign the event time as we might observe in a real data set. The event times generated in the previous section capture both treatment scenarios for all patients, but in reality we would only (potentially) observe the event time for the treatment the patient received. Additionally, we likely (or definitely) won’t be following all patients long enough to observe all events occur, meaning some patients will be <a href="https://en.wikipedia.org/wiki/Survival_analysis#:~:text=Censoring%20%2F%20Censored%20observation%3A%20Censoring%20occurs,after%20the%20time%20of%20censoring.">censored</a>. Let’s add the observed outcomes to the <code>population</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">population <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb13-2">  population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb13-3">  </span>
<span id="cb13-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the observed outcome</span></span>
<span id="cb13-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb13-6">    </span>
<span id="cb13-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The ACTUAL event time outcome depends on the treatment ACTUALLY observed for the patient</span></span>
<span id="cb13-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">actual_event_time =</span> t_B <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> A) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> t_A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> A,</span>
<span id="cb13-9">    </span>
<span id="cb13-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate a REALIZED censoring time (completely random)</span></span>
<span id="cb13-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">censor_time =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">500</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(n),</span>
<span id="cb13-12">    </span>
<span id="cb13-13">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate the OBSERVED time in the data set (known quantity)</span></span>
<span id="cb13-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmin</span>(actual_event_time, censor_time), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># They either had the event, or were censored first</span></span>
<span id="cb13-15">    </span>
<span id="cb13-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate the event status (TRUE if event observed, FALSE if censored)</span></span>
<span id="cb13-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">status =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(actual_event_time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> censor_time)</span>
<span id="cb13-18">  )</span>
<span id="cb13-19">population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(actual_event_time, censor_time, time, status)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,000 × 4
   actual_event_time censor_time  time status
               &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1             5689.        843.  843.      0
 2             9482.        814.  814.      0
 3              488.        882.  488.      1
 4              255.        936.  255.      1
 5             7649.        653.  653.      0
 6             1953.        890.  890.      0
 7             2652.        737.  737.      0
 8             2385.        703.  703.      0
 9             6894.        952.  952.      0
10             3743.        526.  526.      0
# ℹ 9,990 more rows</code></pre>
</div>
</div>
<p>Our final simulated data set has the following <em>observed</em> outcome summaries:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb15-2">  </span>
<span id="cb15-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute summary metrics</span></span>
<span id="cb15-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(</span>
<span id="cb15-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Patients =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb15-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Time =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(time),</span>
<span id="cb15-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(A, status)</span>
<span id="cb15-8">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb15-9">  </span>
<span id="cb15-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add shares within treatment</span></span>
<span id="cb15-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb15-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Percent =</span> Patients <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(Patients),</span>
<span id="cb15-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> A</span>
<span id="cb15-14">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb15-15">  </span>
<span id="cb15-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clean/rearrange</span></span>
<span id="cb15-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transmute</span>(</span>
<span id="cb15-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Treatment =</span> </span>
<span id="cb15-19">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb15-20">        A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>,</span>
<span id="cb15-21">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span></span>
<span id="cb15-22">      ),</span>
<span id="cb15-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Status =</span> </span>
<span id="cb15-24">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb15-25">        status <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Event"</span>,</span>
<span id="cb15-26">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Censored"</span></span>
<span id="cb15-27">      ),</span>
<span id="cb15-28">    Patients,</span>
<span id="cb15-29">    Percent,</span>
<span id="cb15-30">    Time</span>
<span id="cb15-31">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb15-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(Treatment, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Status)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb15-33">  </span>
<span id="cb15-34">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a table</span></span>
<span id="cb15-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactable</span>(</span>
<span id="cb15-36">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">groupBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Treatment"</span>,</span>
<span id="cb15-37">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> </span>
<span id="cb15-38">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb15-39">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Patients =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>),</span>
<span id="cb15-40">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Percent =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Percent of patients in treatment group (%)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">percent =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)),</span>
<span id="cb15-41">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Time =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Avg. time to outcome"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> zildge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rectbl_agg_wtd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb15-42">      ),</span>
<span id="cb15-43">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">striped =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb15-44">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">highlight =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb15-45">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bordered =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb15-46">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">resizable =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb15-47">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theme =</span> reactablefmtr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sandstone</span>()</span>
<span id="cb15-48">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb15-49">  reactablefmtr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Use arrows to expand table"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font_style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"italic"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item" id="htmlwidget-a2195d80fa4b22595ce8" style="width:auto;height:auto;"></div>
<p style="color:#000;background:#FFFFFF;text-align:left;font-size:12px;font-style:italic;font-weight:normal;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Use arrows to expand table</p>
<script type="application/json" data-for="htmlwidget-a2195d80fa4b22595ce8">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"Treatment":["A","A","B","B"],"Status":["Event","Censored","Event","Censored"],"Patients":[836,3046,1137,4981],"Percent":[0.215352910870685,0.784647089129315,0.185845047401111,0.814154952598888],"Time":[345.503703338068,745.228837321148,343.475165801799,746.272923924017]},"columns":[{"id":"Treatment","name":"Treatment","type":"character"},{"id":"Status","name":"Status","type":"character"},{"id":"Patients","name":"Patients","type":"numeric","aggregate":"sum","align":"center"},{"id":"Percent","name":"Percent of patients in treatment group (%)","type":"numeric","aggregate":"sum","format":{"cell":{"digits":1,"percent":true},"aggregated":{"digits":1,"percent":true}},"align":"center"},{"id":"Time","name":"Avg. time to outcome","type":"numeric","aggregate":"function(values, rows) {\n            var numerator = 0\n            var denominator = 0\n\n            rows.forEach(function(row, index) {\n                numerator += row['Patients'] * values[index]\n                denominator += row['Patients']\n            })\n\n            if('mean' == 'mean') {\n                return numerator / denominator\n            } else {\n                return numerator\n            }\n        }","format":{"cell":{"digits":1},"aggregated":{"digits":1}},"align":"center"}],"groupBy":["Treatment"],"resizable":true,"highlight":true,"bordered":true,"striped":true,"theme":{"color":"#3e3f3a","backgroundColor":"#ffffff","borderColor":"#f8f5f0","borderWidth":"1px","stripedColor":"#ededed","highlightColor":"#f8f5f0","cellPadding":6,"tableStyle":{"fontSize":15},"headerStyle":{"borderWidth":"2px","backgroundColor":"#f8f5f0","color":"#7c7a78","transitionDuration":"0.5s","&:hover[aria-sort]":{"color":"#000000"},"&[aria-sort='ascending'], &[aria-sort='descending']":{"color":"#000000"},"fontSize":16},"groupHeaderStyle":{"&:not(:empty)":{"color":"#3e3f3a","fontSize":16},"&:hover":{"fontWeight":"bold","transitionDuration":"1s","transitionTimingFunction":"ease-out","color":"#000000"}},"rowSelectedStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"inputStyle":{"backgroundColor":"#ffffff","borderColor":"#bcbfc1","color":"#3e3f3a"},"searchInputStyle":{"backgroundColor":"#ffffff","color":"#3e3f3a","borderColor":"#bcbfc1","&:focus":{"color":"#3e3f3a"}},"selectStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84","borderColor":"#ffffff","outlineColor":"#ffffff"},"pageButtonStyle":{"backgroundColor":"#f8f5f0","color":"#8e8c84","&:hover":{"backgroundColor":"#f3969a","color":"#8e8c84"}},"pageButtonHoverStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"pageButtonActiveStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"pageButtonCurrentStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"}},"dataKey":"803f0e909881888862e5822d6c0d5d1e"},"children":[]},"class":"reactR_markup"},"evals":["tag.attribs.columns.4.aggregate"],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<p>We can also look at the survival curves.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-2">  </span>
<span id="cb16-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nest by treatment</span></span>
<span id="cb16-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(A) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nest</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-6">  </span>
<span id="cb16-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Esimtate survival curves for each treatment</span></span>
<span id="cb16-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb16-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Surv =</span> </span>
<span id="cb16-10">      data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-11">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(</span>
<span id="cb16-12">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(.trt) {</span>
<span id="cb16-13">          </span>
<span id="cb16-14">          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit the model</span></span>
<span id="cb16-15">          mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">survfit</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Surv</span>(time, status) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> .trt)</span>
<span id="cb16-16">          </span>
<span id="cb16-17">          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract the elements</span></span>
<span id="cb16-18">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb16-19">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Time =</span> mod<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>time,</span>
<span id="cb16-20">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Survival =</span> mod<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>surv,</span>
<span id="cb16-21">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Lower =</span> mod<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>lower,</span>
<span id="cb16-22">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Upper =</span> mod<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>upper</span>
<span id="cb16-23">          )</span>
<span id="cb16-24">          </span>
<span id="cb16-25">        }</span>
<span id="cb16-26">      )</span>
<span id="cb16-27">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb16-28">  </span>
<span id="cb16-29">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Unnest the curves</span></span>
<span id="cb16-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>data) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unnest</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> Surv) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-33"></span>
<span id="cb16-34">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clean labels</span></span>
<span id="cb16-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb16-36">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Treatment =</span> </span>
<span id="cb16-37">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb16-38">        A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>,</span>
<span id="cb16-39">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span></span>
<span id="cb16-40">      )</span>
<span id="cb16-41">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb16-42">  </span>
<span id="cb16-43">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb16-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb16-45">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb16-46">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Time,</span>
<span id="cb16-47">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Survival</span>
<span id="cb16-48">    )</span>
<span id="cb16-49">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb16-50">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> Treatment)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-51">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_ribbon</span>(</span>
<span id="cb16-52">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb16-53">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymin =</span> Lower,</span>
<span id="cb16-54">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ymax =</span> Upper,</span>
<span id="cb16-55">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Treatment</span>
<span id="cb16-56">    ),</span>
<span id="cb16-57">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span></span>
<span id="cb16-58">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-59">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>percent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-60">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb16-61">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb16-62">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>),</span>
<span id="cb16-63">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span></span>
<span id="cb16-64">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-65">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Time since treatment"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb16-66">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Survival Probability"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/the-overlap-weight/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If we weren’t doing a simulation, we wouldn’t know how much of these differences are explained by the treatment. And actually, these crude survival curves suggest longer survival from treatment <em>B</em>, even though we know the opposite is true. The goal is to use this <em>known</em> information (along with patient characteristics) to estimate the causal treatment effect that is baked into all of the <em>unknown</em> quantities we have here that would be unavailable to us in a real-life analysis.</p>
</section>
</section>
<section id="estimatingweights" class="level1">
<h1>Estimating the weights</h1>
<p>Now that our simulation is set, we can start using the observed data (i.e., known quantities) to estimate the case-weights needed for treatment effect estimation. This is the process we’d go through in a real-life analysis, but here we have the benefit of knowing the truth, so we can see how close our estimations are to reality.</p>
<p>The intention of these weights is to <em>adjust</em> the observed sample to create a <em>pseudo-population</em> such that the patient characteristics that we believe are confounding the treatment effect are corrected for, or <em>balanced</em>, across the treatment groups. The term “pseudo” here is a little misleading. It’s simply referring to the fact that each patient will not contribute the same weight in estimating the treatment effect. In fact, the patients with the most <em>overlap</em> in characteristics across the treatment groups will contribute the most, with patients being proportionately down-weighted the less overlap they have (I’d argue this is the same thing that is done in <a href="https://en.wikipedia.org/wiki/Propensity_score_matching">matching</a>, it’s just that the weights for patients are either exactly <em>1</em> or <em>0</em>). This is done to tease out the portion of the outcome differences that is explained by the treatment, namely, the causal treatment effect.</p>
<section id="modelpropensityscores" class="level2">
<h2 class="anchored" data-anchor-id="modelpropensityscores">Model the propensity scores</h2>
<p>We’ve established that the overlap weights are quantities that need to be estimated from the data. In order to calculate those weights, we first need to estimate the propensity scores. We know what the true model is, but let’s assume we are only working with observable data:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(zage, male, zincome, A, time, status)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,000 × 6
      zage  male zincome     A  time status
     &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1 -0.560      0  -1.35      1  843.      0
 2 -0.230      1  -0.579     0  814.      0
 3  1.56       1  -0.861     1  488.      1
 4  0.0705     1   0.973     0  255.      1
 5  0.129      0   0.619     1  653.      0
 6  1.72       1   1.39      1  890.      0
 7  0.461      1  -1.49      0  737.      0
 8 -1.27       1   0.639     0  703.      0
 9 -0.687      1   0.375     0  952.      0
10 -0.446      1   0.370     0  526.      0
# ℹ 9,990 more rows</code></pre>
</div>
</div>
<p>Our goal is to obtain patient-specific probabilities of receiving treatment <em>A</em>. We’ll estimate this with a <a href="https://en.wikipedia.org/wiki/Logistic_regression">logistic regression</a> model, but we’ll allow for some flexibility in the shape of the relationships between the continuous variables (age and income) and the outcome with the use of <a href="https://www.nature.com/articles/s41409-019-0679-x">restricted cubic splines</a> (see my <a href="https://www.zajichekstats.com/post/the-evasive-spline/">other post</a> for another explanation):</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit the propensity score model</span></span>
<span id="cb19-2">ps_mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb19-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glm</span>(</span>
<span id="cb19-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> rms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rcs</span>(zage, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> rms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rcs</span>(zincome, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(male),</span>
<span id="cb19-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> population,</span>
<span id="cb19-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"binomial"</span></span>
<span id="cb19-7">  )</span>
<span id="cb19-8"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(ps_mod)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = A ~ rms::rcs(zage, 3) + rms::rcs(zincome, 3) + 
    factor(male), family = "binomial", data = population)

Coefficients:
                             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                  -0.30027    0.06527  -4.600 4.22e-06 ***
rms::rcs(zage, 3)zage         0.40206    0.05099   7.885 3.16e-15 ***
rms::rcs(zage, 3)zage'       -0.07337    0.05813  -1.262    0.207    
rms::rcs(zincome, 3)zincome  -0.63792    0.04950 -12.888  &lt; 2e-16 ***
rms::rcs(zincome, 3)zincome' -0.04020    0.06434  -0.625    0.532    
factor(male)1                -0.25432    0.04415  -5.760 8.41e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 13359  on 9999  degrees of freedom
Residual deviance: 12193  on 9994  degrees of freedom
AIC: 12205

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>The model seems to indicate that the non-linear terms for age and income don’t particularly matter (which is expected), but we’ll leave it as-is. Next, let’s attach the <em>estimated</em> propensity scores to the <code>population</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1">population <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb21-2">  population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb21-3">  </span>
<span id="cb21-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the estimated propensity score</span></span>
<span id="cb21-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb21-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pA_hat =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(ps_mod, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"response"</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># P(A = 1 | X)</span></span>
<span id="cb21-7">  )</span></code></pre></div>
</details>
</div>
<p>We can take a look at the estimated propensity score distribution across the treatment groups (we’ll also overlay the <em>true</em> distributions for comparison):</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-2">  </span>
<span id="cb22-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send PS scores down the rows</span></span>
<span id="cb22-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb22-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(pA, pA_hat),</span>
<span id="cb22-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span id="cb22-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Score"</span></span>
<span id="cb22-8">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-9"></span>
<span id="cb22-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clean labels</span></span>
<span id="cb22-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb22-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Treatment =</span> </span>
<span id="cb22-13">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb22-14">        A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>,</span>
<span id="cb22-15">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span></span>
<span id="cb22-16">      ),</span>
<span id="cb22-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type =</span> </span>
<span id="cb22-18">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb22-19">        Type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pA"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True"</span>,</span>
<span id="cb22-20">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimated"</span></span>
<span id="cb22-21">      )</span>
<span id="cb22-22">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb22-23">  </span>
<span id="cb22-24">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb22-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb22-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(</span>
<span id="cb22-27">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb22-28">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Score,</span>
<span id="cb22-29">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Treatment,</span>
<span id="cb22-30">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> Type</span>
<span id="cb22-31">    ),</span>
<span id="cb22-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span></span>
<span id="cb22-33">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>percent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb22-36">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb22-37">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb22-38">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb22-39">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb22-40">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span></span>
<span id="cb22-41">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb22-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P(A=1|X)"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/the-overlap-weight/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The model does a great job at estimating the true propensity scores. In a real analysis we probably wouldn’t be this close since we likely wouldn’t have only and all true confounders accounted for.</p>
<section id="visualizing-propensity-score-effects" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-propensity-score-effects">Visualizing propensity score effects</h3>
<p>In the same vein, we can explore the modeled relationships between each patient characteristic and the propensity scores.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1">plots <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb23-2">  population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-3">  </span>
<span id="cb23-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send PS scores down the rows</span></span>
<span id="cb23-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb23-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(pA, pA_hat),</span>
<span id="cb23-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span id="cb23-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Score"</span></span>
<span id="cb23-9">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-10">  </span>
<span id="cb23-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clean labels</span></span>
<span id="cb23-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb23-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Treatment =</span> </span>
<span id="cb23-14">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb23-15">        A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>,</span>
<span id="cb23-16">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span></span>
<span id="cb23-17">      ),</span>
<span id="cb23-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type =</span> </span>
<span id="cb23-19">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb23-20">        Type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pA"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True"</span>,</span>
<span id="cb23-21">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimated"</span></span>
<span id="cb23-22">      )</span>
<span id="cb23-23">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-24">  </span>
<span id="cb23-25">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send covariates down the rows</span></span>
<span id="cb23-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb23-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(zage, zincome, male),</span>
<span id="cb23-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_prefix =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"^z"</span></span>
<span id="cb23-29">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-30">  </span>
<span id="cb23-31">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make groups</span></span>
<span id="cb23-32">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb23-33">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Group =</span> </span>
<span id="cb23-34">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb23-35">        name <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"male"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"categorical"</span>,</span>
<span id="cb23-36">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"continuous"</span></span>
<span id="cb23-37">      )</span>
<span id="cb23-38">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-39">  </span>
<span id="cb23-40">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a nested frame</span></span>
<span id="cb23-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Group) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nest</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-43">  </span>
<span id="cb23-44">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make plot depending on type</span></span>
<span id="cb23-45">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb23-46">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot =</span> </span>
<span id="cb23-47">      data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-48">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(</span>
<span id="cb23-49">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(.group) {</span>
<span id="cb23-50">          </span>
<span id="cb23-51">          <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check condition</span></span>
<span id="cb23-52">          <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n_distinct</span>(.group<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) {</span>
<span id="cb23-53">            </span>
<span id="cb23-54">            .group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-55">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(</span>
<span id="cb23-56">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Rate =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Score),</span>
<span id="cb23-57">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(Treatment, Type, name, value)</span>
<span id="cb23-58">              ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-59">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb23-60">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sex =</span> </span>
<span id="cb23-61">                  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb23-62">                    value <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Male"</span>,</span>
<span id="cb23-63">                    <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Female"</span></span>
<span id="cb23-64">                  ),</span>
<span id="cb23-65">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sex"</span></span>
<span id="cb23-66">              ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb23-67">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-68">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb23-69">                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb23-70">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Sex,</span>
<span id="cb23-71">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Rate,</span>
<span id="cb23-72">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> Treatment,</span>
<span id="cb23-73">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> Type,</span>
<span id="cb23-74">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> Type</span>
<span id="cb23-75">                )</span>
<span id="cb23-76">              ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-77">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(</span>
<span id="cb23-78">                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb23-79">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Sex,</span>
<span id="cb23-80">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Rate,</span>
<span id="cb23-81">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> Treatment,</span>
<span id="cb23-82">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> Type,</span>
<span id="cb23-83">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">interaction</span>(Type, Treatment)</span>
<span id="cb23-84">                )</span>
<span id="cb23-85">              ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-86">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-87">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-88">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>percent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-89">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb23-90">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb23-91">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>),</span>
<span id="cb23-92">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>,</span>
<span id="cb23-93">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb23-94">              ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-95">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P(A=1|X)"</span>)</span>
<span id="cb23-96">            </span>
<span id="cb23-97">          } <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> {</span>
<span id="cb23-98">            </span>
<span id="cb23-99">            .group <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb23-100">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb23-101">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_smooth</span>(</span>
<span id="cb23-102">                <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb23-103">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> value,</span>
<span id="cb23-104">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> Score,</span>
<span id="cb23-105">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> Treatment,</span>
<span id="cb23-106">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Treatment,</span>
<span id="cb23-107">                  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> Type</span>
<span id="cb23-108">                ),</span>
<span id="cb23-109">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span></span>
<span id="cb23-110">              ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-111">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>name) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-112">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>percent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-113">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb23-114">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb23-115">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>),</span>
<span id="cb23-116">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span></span>
<span id="cb23-117">              ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-118">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Z-Score"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb23-119">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P(A=1|X)"</span>)</span>
<span id="cb23-120">          }</span>
<span id="cb23-121">          </span>
<span id="cb23-122">        } </span>
<span id="cb23-123">      )</span>
<span id="cb23-124">  ) </span>
<span id="cb23-125"></span>
<span id="cb23-126">gridExtra<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">grid.arrange</span>(plots<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>plot[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]], plots<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>plot[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]])</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/the-overlap-weight/index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As known from the true model, patients who received treatment <em>A</em> tend to be older, female patients with lower income. We can also see slight miscalibration in the estimates for patients who are older in that the model tends to <em>underestimate</em> the true propensity score in these patients. We see similar miscalibration for sex.</p>
</section>
</section>
<section id="estimatedoverlapweight" class="level2">
<h2 class="anchored" data-anchor-id="estimatedoverlapweight">Calculate the (estimated) overlap weight</h2>
<p>We’ve already defined how to calculate the overlap weights. The only difference here is that we’ll do it from the <em>estimated</em> propensity scores instead of the true ones. First, we’ll apply the formula to add the estimated weights to the <code>population</code>:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1">population <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb24-2">  population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb24-3">  </span>
<span id="cb24-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the estimated overlap weight for the realized treatment (known quantity)</span></span>
<span id="cb24-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb24-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">OW_hat =</span> A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>pA_hat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>A) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> pA_hat</span>
<span id="cb24-7">  )</span></code></pre></div>
</details>
</div>
<p>As we’ve mentioned earlier, we will then <em>normalize</em> the weights <em>within</em> each treatment group so they have the same cumulative contribution for estimating the treatment effect in the outcome model.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1">population <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb25-2">  population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb25-3">  </span>
<span id="cb25-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the normalized weights (adding true and estimated)</span></span>
<span id="cb25-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb25-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">OW_norm =</span> OW <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(OW),</span>
<span id="cb25-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">OW_hat_norm =</span> OW_hat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(OW_hat),</span>
<span id="cb25-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> A</span>
<span id="cb25-9">  )</span>
<span id="cb25-10">population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(A, pA, pA_hat, OW, OW_norm, OW_hat, OW_hat_norm)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,000 × 7
       A    pA pA_hat    OW   OW_norm OW_hat OW_hat_norm
   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;
 1     1 0.577  0.583 0.423 0.000202   0.417   0.000198 
 2     0 0.422  0.427 0.422 0.000201   0.427   0.000202 
 3     1 0.647  0.610 0.353 0.000168   0.390   0.000185 
 4     0 0.219  0.226 0.219 0.000105   0.226   0.000107 
 5     1 0.315  0.329 0.685 0.000327   0.671   0.000318 
 6     1 0.292  0.265 0.708 0.000338   0.735   0.000348 
 7     0 0.644  0.628 0.644 0.000307   0.628   0.000297 
 8     0 0.171  0.181 0.171 0.0000814  0.181   0.0000856
 9     0 0.238  0.250 0.238 0.000114   0.250   0.000118 
10     0 0.257  0.268 0.257 0.000123   0.268   0.000127 
# ℹ 9,990 more rows</code></pre>
</div>
</div>
<p>To get a sense of the impact of these weights, let’s first look at their distributions (again, adding the true weights for comparison):</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1">population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb27-2">  </span>
<span id="cb27-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send overlap weight down the rows</span></span>
<span id="cb27-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb27-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(OW_norm, OW_hat_norm),</span>
<span id="cb27-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span id="cb27-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weight"</span></span>
<span id="cb27-8">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb27-9">  </span>
<span id="cb27-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clean labels</span></span>
<span id="cb27-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb27-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Treatment =</span> </span>
<span id="cb27-13">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb27-14">        A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>,</span>
<span id="cb27-15">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span></span>
<span id="cb27-16">      ),</span>
<span id="cb27-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type =</span> </span>
<span id="cb27-18">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb27-19">        Type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OW_norm"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True"</span>,</span>
<span id="cb27-20">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimated"</span></span>
<span id="cb27-21">      )</span>
<span id="cb27-22">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb27-23">  </span>
<span id="cb27-24">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb27-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb27-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(</span>
<span id="cb27-27">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb27-28">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Weight,</span>
<span id="cb27-29">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Treatment,</span>
<span id="cb27-30">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> Type</span>
<span id="cb27-31">    ),</span>
<span id="cb27-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span></span>
<span id="cb27-33">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb27-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb27-36">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb27-37">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb27-38">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb27-39">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span></span>
<span id="cb27-40">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Normalized Overlap Weight"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/the-overlap-weight/index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In aggregate, the groups will have equal weight. The distribution shift has to do with the sampled treatment distribution. Only 38.8% of patients have treatment <em>A</em> so at an individual level each patient will contribute more on average.</p>
<section id="cumulative-patient-contribution" class="level3">
<h3 class="anchored" data-anchor-id="cumulative-patient-contribution">Cumulative patient contribution</h3>
<p>We can also look at the accumulation of <em>patients</em> (i.e., when each patient contributes equally) as a function of the cumulative <em>overlap weight</em> in each group. This allows us to understand how much (or little) the treatment effect estimation will be dominated by smaller concentrations of patients.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1">population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb28-2">  </span>
<span id="cb28-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send overlap weight down the rows</span></span>
<span id="cb28-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb28-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(OW_norm, OW_hat_norm),</span>
<span id="cb28-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span id="cb28-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weight"</span></span>
<span id="cb28-8">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb28-9">  </span>
<span id="cb28-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clean labels</span></span>
<span id="cb28-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb28-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Treatment =</span> </span>
<span id="cb28-13">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb28-14">        A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>,</span>
<span id="cb28-15">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span></span>
<span id="cb28-16">      ),</span>
<span id="cb28-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Type =</span> </span>
<span id="cb28-18">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb28-19">        Type <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"OW_norm"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"True"</span>,</span>
<span id="cb28-20">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Estimated"</span></span>
<span id="cb28-21">      ),</span>
<span id="cb28-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">NullWeight =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb28-23">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb28-24">  </span>
<span id="cb28-25">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rearrange</span></span>
<span id="cb28-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(Treatment, Type, Weight) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb28-27">  </span>
<span id="cb28-28">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the cumulative weight</span></span>
<span id="cb28-29">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb28-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Weight =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(Weight) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(Weight),</span>
<span id="cb28-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">NullWeight =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cumsum</span>(NullWeight) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(NullWeight),</span>
<span id="cb28-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(Treatment, Type)</span>
<span id="cb28-33">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb28-34">  </span>
<span id="cb28-35">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb28-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb28-37">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(</span>
<span id="cb28-38">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb28-39">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Weight,</span>
<span id="cb28-40">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> NullWeight,</span>
<span id="cb28-41">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> Treatment,</span>
<span id="cb28-42">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linetype =</span> Type</span>
<span id="cb28-43">    ),</span>
<span id="cb28-44">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb28-45">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-46">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>percent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>percent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb28-49">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb28-50">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>),</span>
<span id="cb28-51">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>),</span>
<span id="cb28-52">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span></span>
<span id="cb28-53">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-54">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cumulative percent of overlap weight (%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-55">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cumulative percent of patients (%)"</span>) </span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/the-overlap-weight/index_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see that for treatment <em>B</em>, about 40% of the outcome model weight will be accounted for by only 25% of patients. The weights for treatment <em>A</em> are slightly more evenly spread across the patients.</p>
</section>
<section id="weighted-mean-differences" class="level3">
<h3 class="anchored" data-anchor-id="weighted-mean-differences">Weighted-mean differences</h3>
<p>It was previously mentioned that the overlap weight methodology leads to perfect balance among the covariates used in the propensity score model. We can verify by looking at the group means for each model factor before and after weighting.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1">population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb29-2">  </span>
<span id="cb29-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add uniform weights</span></span>
<span id="cb29-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">NullWeight =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb29-5">  </span>
<span id="cb29-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send weights down the rows</span></span>
<span id="cb29-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb29-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(NullWeight, OW_hat_norm),</span>
<span id="cb29-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span id="cb29-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weight"</span></span>
<span id="cb29-11">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb29-12">  </span>
<span id="cb29-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send factors down the rows</span></span>
<span id="cb29-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb29-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(age, income, male),</span>
<span id="cb29-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Factor"</span>,</span>
<span id="cb29-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Value"</span></span>
<span id="cb29-18">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb29-19">  </span>
<span id="cb29-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For each </span></span>
<span id="cb29-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(</span>
<span id="cb29-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Patients =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb29-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(Weight <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Value) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(Weight),</span>
<span id="cb29-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(Factor, Type, A)</span>
<span id="cb29-25">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb29-26">  </span>
<span id="cb29-27">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clean up</span></span>
<span id="cb29-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">transmute</span>(</span>
<span id="cb29-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Factor =</span> </span>
<span id="cb29-30">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb29-31">        Factor <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"age"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age (years)"</span>,</span>
<span id="cb29-32">        Factor <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"income"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Income ($)"</span>,</span>
<span id="cb29-33">        Factor <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"male"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Male (%)"</span></span>
<span id="cb29-34">      ),</span>
<span id="cb29-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Treatment =</span> </span>
<span id="cb29-36">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb29-37">        A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>,</span>
<span id="cb29-38">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span></span>
<span id="cb29-39">      ),</span>
<span id="cb29-40">    Type,</span>
<span id="cb29-41">    Patients,</span>
<span id="cb29-42">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean =</span> </span>
<span id="cb29-43">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb29-44">        Factor <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Male (%)"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> Mean,</span>
<span id="cb29-45">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Mean</span>
<span id="cb29-46">      )</span>
<span id="cb29-47">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb29-48">  </span>
<span id="cb29-49">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send over the columns</span></span>
<span id="cb29-50">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(</span>
<span id="cb29-51">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> Type,</span>
<span id="cb29-52">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(Patients, Mean)</span>
<span id="cb29-53">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb29-54">  </span>
<span id="cb29-55">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rearrange</span></span>
<span id="cb29-56">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(Factor, Treatment) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb29-57">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(Factor, Treatment, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NullWeight"</span>), Mean_OW_hat_norm) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb29-58">  </span>
<span id="cb29-59">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a table</span></span>
<span id="cb29-60">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactable</span>(</span>
<span id="cb29-61">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">groupBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Factor"</span>,</span>
<span id="cb29-62">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> </span>
<span id="cb29-63">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb29-64">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Patients_NullWeight =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>),</span>
<span id="cb29-65">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean_NullWeight =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Before Weighting"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> zildge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rectbl_agg_wtd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients_NullWeight"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb29-66">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Mean_OW_hat_norm =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"After Weighting"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> zildge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rectbl_agg_wtd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients_NullWeight"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>))</span>
<span id="cb29-67">      ),</span>
<span id="cb29-68">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columnGroups =</span> </span>
<span id="cb29-69">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb29-70">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colGroup</span>(</span>
<span id="cb29-71">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean Value"</span>,</span>
<span id="cb29-72">          <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean_NullWeight"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Mean_OW_hat_norm"</span>)</span>
<span id="cb29-73">        )</span>
<span id="cb29-74">      ),</span>
<span id="cb29-75">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">striped =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb29-76">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">highlight =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb29-77">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bordered =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb29-78">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">resizable =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb29-79">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theme =</span> reactablefmtr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sandstone</span>()</span>
<span id="cb29-80">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb29-81">  reactablefmtr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Use arrows to expand table"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font_style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"italic"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item" id="htmlwidget-858fd2eb03b0c0ded5eb" style="width:auto;height:auto;"></div>
<p style="color:#000;background:#FFFFFF;text-align:left;font-size:12px;font-style:italic;font-weight:normal;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Use arrows to expand table</p>
<script type="application/json" data-for="htmlwidget-858fd2eb03b0c0ded5eb">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"Factor":["Age (years)","Age (years)","Income ($)","Income ($)","Male (%)","Male (%)"],"Treatment":["A","B","A","B","A","B"],"Patients_NullWeight":[3882,6118,3882,6118,3882,6118],"Mean_NullWeight":[51.8724351584411,48.7731344443606,46.152542137955,52.1470439747779,55.7444616177228,61.7522066034652],"Mean_OW_hat_norm":[50.6909470423481,50.6909470423472,48.480546358988,48.4805463589892,58.1435359891369,58.1435359891387]},"columns":[{"id":"Factor","name":"Factor","type":"character"},{"id":"Treatment","name":"Treatment","type":"character"},{"id":"Patients_NullWeight","name":"Patients","type":"numeric","aggregate":"sum","align":"center"},{"id":"Mean_NullWeight","name":"Before Weighting","type":"numeric","aggregate":"function(values, rows) {\n            var numerator = 0\n            var denominator = 0\n\n            rows.forEach(function(row, index) {\n                numerator += row['Patients_NullWeight'] * values[index]\n                denominator += row['Patients_NullWeight']\n            })\n\n            if('mean' == 'mean') {\n                return numerator / denominator\n            } else {\n                return numerator\n            }\n        }","format":{"cell":{"digits":1},"aggregated":{"digits":1}},"align":"center"},{"id":"Mean_OW_hat_norm","name":"After Weighting","type":"numeric","aggregate":"function(values, rows) {\n            var numerator = 0\n            var denominator = 0\n\n            rows.forEach(function(row, index) {\n                numerator += row['Patients_NullWeight'] * values[index]\n                denominator += row['Patients_NullWeight']\n            })\n\n            if('mean' == 'mean') {\n                return numerator / denominator\n            } else {\n                return numerator\n            }\n        }","format":{"cell":{"digits":1},"aggregated":{"digits":1}},"align":"center"}],"columnGroups":[{"name":"Mean Value","columns":["Mean_NullWeight","Mean_OW_hat_norm"]}],"groupBy":["Factor"],"resizable":true,"highlight":true,"bordered":true,"striped":true,"theme":{"color":"#3e3f3a","backgroundColor":"#ffffff","borderColor":"#f8f5f0","borderWidth":"1px","stripedColor":"#ededed","highlightColor":"#f8f5f0","cellPadding":6,"tableStyle":{"fontSize":15},"headerStyle":{"borderWidth":"2px","backgroundColor":"#f8f5f0","color":"#7c7a78","transitionDuration":"0.5s","&:hover[aria-sort]":{"color":"#000000"},"&[aria-sort='ascending'], &[aria-sort='descending']":{"color":"#000000"},"fontSize":16},"groupHeaderStyle":{"&:not(:empty)":{"color":"#3e3f3a","fontSize":16},"&:hover":{"fontWeight":"bold","transitionDuration":"1s","transitionTimingFunction":"ease-out","color":"#000000"}},"rowSelectedStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"inputStyle":{"backgroundColor":"#ffffff","borderColor":"#bcbfc1","color":"#3e3f3a"},"searchInputStyle":{"backgroundColor":"#ffffff","color":"#3e3f3a","borderColor":"#bcbfc1","&:focus":{"color":"#3e3f3a"}},"selectStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84","borderColor":"#ffffff","outlineColor":"#ffffff"},"pageButtonStyle":{"backgroundColor":"#f8f5f0","color":"#8e8c84","&:hover":{"backgroundColor":"#f3969a","color":"#8e8c84"}},"pageButtonHoverStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"pageButtonActiveStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"pageButtonCurrentStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"}},"dataKey":"0e103bb7f71d932df5c23f1aa11d9ef7"},"children":[]},"class":"reactR_markup"},"evals":["tag.attribs.columns.3.aggregate","tag.attribs.columns.4.aggregate"],"jsHooks":[]}</script>
</div>
</div>
<p>We can see that, overall, the weighted sample is <em>slightly</em> older and female with lower income.</p>
</section>
<section id="confounder-weight-shifts" class="level3">
<h3 class="anchored" data-anchor-id="confounder-weight-shifts">Confounder weight shifts</h3>
<p>Similar to looking at weight attributions as a whole, we can explore weight shifts within subgroups of patient characteristics. This helps build intuition about which patients the subsequent treatment effect estimates will focus on most (and least).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb30-2">  </span>
<span id="cb30-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add uniform weights</span></span>
<span id="cb30-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_column</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">NullWeight =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb30-5">  </span>
<span id="cb30-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to quntiles</span></span>
<span id="cb30-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb30-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(</span>
<span id="cb30-9">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(age, income),</span>
<span id="cb30-10">      \(x) Hmisc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cut2</span>(x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">g =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb30-11">    ),</span>
<span id="cb30-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age =</span> age,</span>
<span id="cb30-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Income =</span> income,</span>
<span id="cb30-14">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Sex =</span> </span>
<span id="cb30-15">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb30-16">        male <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Male"</span>,</span>
<span id="cb30-17">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Female"</span></span>
<span id="cb30-18">      ),</span>
<span id="cb30-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Treatment =</span> </span>
<span id="cb30-20">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb30-21">        A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>,</span>
<span id="cb30-22">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"B"</span></span>
<span id="cb30-23">      )</span>
<span id="cb30-24">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb30-25">  </span>
<span id="cb30-26">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send weights down the rows</span></span>
<span id="cb30-27">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb30-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(NullWeight, OW_hat_norm),</span>
<span id="cb30-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Type"</span>,</span>
<span id="cb30-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weight"</span></span>
<span id="cb30-31">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb30-32">  </span>
<span id="cb30-33">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send factors down the rows</span></span>
<span id="cb30-34">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb30-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(Age, Income, Sex),</span>
<span id="cb30-36">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Factor"</span>,</span>
<span id="cb30-37">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Level"</span></span>
<span id="cb30-38">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb30-39">  </span>
<span id="cb30-40">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute total weights</span></span>
<span id="cb30-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(</span>
<span id="cb30-42">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Weight =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(Weight),</span>
<span id="cb30-43">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(Factor, Level, Type, Treatment)</span>
<span id="cb30-44">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb30-45">  </span>
<span id="cb30-46">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find percent of weight</span></span>
<span id="cb30-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb30-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Weight =</span> Weight <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(Weight),</span>
<span id="cb30-49">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(Factor, Type, Treatment)</span>
<span id="cb30-50">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb30-51">  </span>
<span id="cb30-52">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send over columns</span></span>
<span id="cb30-53">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_wider</span>(</span>
<span id="cb30-54">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_from =</span> Type,</span>
<span id="cb30-55">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_from =</span> Weight</span>
<span id="cb30-56">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb30-57">  </span>
<span id="cb30-58">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Clean up</span></span>
<span id="cb30-59">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb30-60">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Level =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(Level) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fct_rev</span>(),</span>
<span id="cb30-61">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Factor =</span> </span>
<span id="cb30-62">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb30-63">        Factor <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Age (years)"</span>,</span>
<span id="cb30-64">        Factor <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Income"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Income ($)"</span>,</span>
<span id="cb30-65">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Factor</span>
<span id="cb30-66">      )</span>
<span id="cb30-67">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb30-68">  </span>
<span id="cb30-69">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb30-70">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-71">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(</span>
<span id="cb30-72">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb30-73">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Level,</span>
<span id="cb30-74">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> NullWeight,</span>
<span id="cb30-75">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> Treatment</span>
<span id="cb30-76">    ),</span>
<span id="cb30-77">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb30-78">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>,</span>
<span id="cb30-79">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>,</span>
<span id="cb30-80">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dodge"</span></span>
<span id="cb30-81">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb30-82">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(</span>
<span id="cb30-83">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb30-84">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Level,</span>
<span id="cb30-85">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> OW_hat_norm,</span>
<span id="cb30-86">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> Treatment,</span>
<span id="cb30-87">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> Treatment</span>
<span id="cb30-88">    ),</span>
<span id="cb30-89">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_dodge</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb30-90">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span></span>
<span id="cb30-91">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-92">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(</span>
<span id="cb30-93">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb30-94">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> Level,</span>
<span id="cb30-95">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> OW_hat_norm,</span>
<span id="cb30-96">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> Treatment,</span>
<span id="cb30-97">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">group =</span> Treatment</span>
<span id="cb30-98">    ),</span>
<span id="cb30-99">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_dodge</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>),</span>
<span id="cb30-100">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb30-101">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-102">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>Factor, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scales =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"free"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-103">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-104">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>percent) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-105">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb30-106">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb30-107">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>),</span>
<span id="cb30-108">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span></span>
<span id="cb30-109">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-110">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Level"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-111">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Share of weight within group (%)"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-112">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb30-113">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Before Weighting"</span>,</span>
<span id="cb30-114">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"After Weighting"</span>,</span>
<span id="cb30-115">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"After Weighting"</span></span>
<span id="cb30-116">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/the-overlap-weight/index_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can see the balancing take place. After overlap weighting, the contribution to treatment effect estimation is reduced in older patients with lower income for treatment <em>A</em>, and vice-versa for treatment <em>B</em>, with some levels in the middle having increased weight for <em>both</em> treatments. This is where the most overlap is between the groups.</p>
<p>It is also useful to look at these plots for factors that were <em>not</em> included in the propensity score model. We may find drastic weight shifts which might indicate significant co-variation among factors already accounted for.</p>
</section>
</section>
</section>
<section id="estimatingtreatmenteffect" class="level1">
<h1>Estimating the treatment effect</h1>
<p>We’re now ready to estimate the causal treatment effect. Although we generated our data from a <a href="https://en.wikipedia.org/wiki/Weibull_distribution">Weibull</a> distribution, we will use a <a href="https://en.wikipedia.org/wiki/Proportional_hazards_model">Cox proportional-hazards model</a> for estimation, which is a <em>semi-parametric</em> method, and tends to be the default choice for modeling survival data, especially in healthcare.</p>
<section id="truehazardratio" class="level2">
<h2 class="anchored" data-anchor-id="truehazardratio">A look at the true hazard ratio</h2>
<p>The treatment effect will be quantified by a <a href="https://en.wikipedia.org/wiki/Hazard_ratio"><em>hazard ratio</em></a>, which is an estimate of the ratio of instantaneous event rates between the treatment groups (this is what is done in <a href="https://www2.stat.duke.edu/~fl35/OW/OW_survival_Demo.sas">the original simulation</a>). This measure is different than the effect we interpreted from the true data-generating process, so, although we won’t expect them to provide the same numerical result, we should still get a similar conclusion, in that treatment <em>A</em> is superior to treatment <em>B</em>.</p>
<p>To start, we can compute the actual hazard ratio had we been able to observe each potential outcome (i.e., the counterfactual). To do this, we need to transform our data such that we have two rows of data per patient–one for each treatment. Then, we fit the Cox model, using the <em>true</em> overlap weights as case weights.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit the model</span></span>
<span id="cb31-2">true_hr_mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb31-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coxph</span>(</span>
<span id="cb31-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Surv</span>(time, status) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(A),</span>
<span id="cb31-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> </span>
<span id="cb31-6">      population <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb31-7">      </span>
<span id="cb31-8">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep columns needed</span></span>
<span id="cb31-9">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(</span>
<span id="cb31-10">        OW_norm, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># True (normalized) overlap weight (could use un-normalized version here)</span></span>
<span id="cb31-11">        t_A, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># True event time under treatment A</span></span>
<span id="cb31-12">        t_B, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># True event time under treatment B</span></span>
<span id="cb31-13">        censor_time <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># When the patient was censored</span></span>
<span id="cb31-14">      ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb31-15">      </span>
<span id="cb31-16">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send true event times down the rows</span></span>
<span id="cb31-17">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb31-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(t_A, t_B),</span>
<span id="cb31-19">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"A"</span>,</span>
<span id="cb31-20">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span></span>
<span id="cb31-21">      ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb31-22">      </span>
<span id="cb31-23">      <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check if censored first</span></span>
<span id="cb31-24">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb31-25">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">A =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"t_A"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Replace with our notation</span></span>
<span id="cb31-26">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">time =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmin</span>(time, censor_time),</span>
<span id="cb31-27">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">status =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(time <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> censor_time)</span>
<span id="cb31-28">      ),</span>
<span id="cb31-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weights =</span> OW_norm</span>
<span id="cb31-30">  )</span>
<span id="cb31-31"></span>
<span id="cb31-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract the result</span></span>
<span id="cb31-33">true_hr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(true_hr_mod<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients)[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb31-34">true_hr</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7284168</code></pre>
</div>
</div>
<p>If we could compare the worlds in which we observe all patients under each treatment, the hazard ratio is 0.73, suggesting that the instantaneous event rate is 27% lower with treatment <em>A</em> than with treatment <em>B</em>. This aligns with what we’ve established as the true effect. Our hope is that the estimate from the observable data (in the next section) will contain this value within some margin of sampling error.</p>
</section>
<section id="estimatedhazardratio" class="level2">
<h2 class="anchored" data-anchor-id="estimatedhazardratio">Our estimate of the treatment effect</h2>
<p>Finally, we can obtain our estimate of the treatment effect using only the observable quantities we have in our data set, which is what we would have in a real-life analysis. Similar to the previous section, we are just fitting a Cox model with the treatment as a covariate. Except this time we only observe one outcome per patient as a result of the treatment they actually received, and use the <em>estimated</em> overlap weight to balance the confounding factors (age, sex, and income). We will also use <a href="https://rdrr.io/cran/survival/man/coxph.html">robust</a> standard error estimates.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Fit the model</span></span>
<span id="cb33-2">estimated_hr_mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb33-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coxph</span>(</span>
<span id="cb33-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">formula =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">Surv</span>(time, status) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(A),</span>
<span id="cb33-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> population,</span>
<span id="cb33-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weights =</span> OW_hat_norm,</span>
<span id="cb33-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">robust =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb33-8">  )</span>
<span id="cb33-9"></span>
<span id="cb33-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract the result</span></span>
<span id="cb33-11">estimated_hr <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(estimated_hr_mod<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>coefficients)[[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]]</span>
<span id="cb33-12">estimated_hr</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7423806</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract the confidence interval</span></span>
<span id="cb35-2">estimated_hr_ci <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">exp</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confint</span>(estimated_hr_mod))</span>
<span id="cb35-3">estimated_hr_ci</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               2.5 %    97.5 %
factor(A)1 0.6756889 0.8156548</code></pre>
</div>
</div>
<p>Our estimate for the hazard ratio is 0.74, with a 95% confidence interval ranging from 0.68 to 0.82, suggesting that the instantaneous event rate for treatment <em>A</em> is between 18% and 32% lower compared to treatment <em>B</em> (note that this captures the true hazard ratio). Under the assumption that we’ve correctly specified all confounding factors (which we did), we can interpret this as the <em>causal</em> treatment effect, and, assuming the magnitude of improvement is of practical importance (when considering things like cost, resources, clinical outcomes, etc.), we can reliably conclude that there is a benefit to treatment <em>A</em> over treatment <em>B</em>, on average.</p>
</section>
</section>
<section id="resources" class="level1">
<h1>Resources</h1>
<p>Some additional resources I’ve come across while learning the methodology:</p>
<ul>
<li>Original paper for overlap weighting (<a href="https://pubmed.ncbi.nlm.nih.gov/30189042/">link</a>)</li>
<li>Paper extending overlap weighting to survival analysis (<a href="https://arxiv.org/abs/2108.04394">link</a>)</li>
<li>Example simulation of overlap weighting in the survival setting in SAS (<a href="http://www2.stat.duke.edu/~fl35/OW/OW_survival_Demo.sas">link</a>)</li>
<li>R package for implementing overlap weight methods (<a href="https://github.com/thuizhou/PSweight">link</a>)</li>
<li>R functions for overlap weighting in the survival setting (<a href="https://github.com/chaochengstat/OW_Survival">link</a>)</li>
<li>Author’s web page dedicated to overlap weighting (<a href="https://www2.stat.duke.edu/~fl35/OW.html">link</a>)</li>
</ul>


<!-- -->

</section>

 ]]></description>
  <category>Causal Inference</category>
  <category>Survival Analysis</category>
  <category>Propensity Scores</category>
  <category>Weighting</category>
  <guid>https://www.zajichekstats.com/post/the-overlap-weight/</guid>
  <pubDate>Mon, 02 Oct 2023 05:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/the-overlap-weight/feature.png" medium="image" type="image/png" height="146" width="144"/>
</item>
<item>
  <title>Removing higher-order aggregation text in {reactable}</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/quickly-removing-higher-order-aggregation-text-in-reactable/</link>
  <description><![CDATA[ 




<p>Often when I’m building a <a href="https://glin.github.io/reactable/"><code>reactable</code></a> I have potentially many aggregation levels but only want to display data in a lower subset of those. Here is a quick way to eliminate text using cell styling.</p>
<p>First let’s load some packages and look at an example data set.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(reactable)</span>
<span id="cb1-3">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cheese<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>heart_disease</span>
<span id="cb1-4">dat</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 303 × 9
     Age Sex    ChestPain           BP Cholesterol BloodSugar MaximumHR
   &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;            &lt;dbl&gt;       &lt;dbl&gt; &lt;lgl&gt;          &lt;dbl&gt;
 1    63 Male   Typical angina     145         233 TRUE             150
 2    67 Male   Asymptomatic       160         286 FALSE            108
 3    67 Male   Asymptomatic       120         229 FALSE            129
 4    37 Male   Non-anginal pain   130         250 FALSE            187
 5    41 Female Atypical angina    130         204 FALSE            172
 6    56 Male   Atypical angina    120         236 FALSE            178
 7    62 Female Asymptomatic       140         268 FALSE            160
 8    57 Female Asymptomatic       120         354 FALSE            163
 9    63 Male   Asymptomatic       130         254 FALSE            147
10    53 Male   Asymptomatic       140         203 TRUE             155
# ℹ 293 more rows
# ℹ 2 more variables: ExerciseInducedAngina &lt;fct&gt;, HeartDisease &lt;fct&gt;</code></pre>
</div>
</div>
<p>Suppose we are interested in these outcomes:</p>
<ol type="1">
<li>The rate of heart disease</li>
<li>The rate of patients with a maximum heart rate &gt; 150</li>
</ol>
<p>And we want to summarize those, along with a few other patient characteristics, within a handful of important clinical factors. We might pivot our data into a long format to start:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">pivot_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb3-2">  dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-3">  </span>
<span id="cb3-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to character types</span></span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb3-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(</span>
<span id="cb3-7">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(ChestPain, ExerciseInducedAngina, BloodSugar),</span>
<span id="cb3-8">      as.character</span>
<span id="cb3-9">    ),</span>
<span id="cb3-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">MaximumHR =</span></span>
<span id="cb3-11">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb3-12">        MaximumHR <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yes"</span>,</span>
<span id="cb3-13">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No"</span></span>
<span id="cb3-14">      )</span>
<span id="cb3-15">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-16">  </span>
<span id="cb3-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send "important clinical factors" down the rows</span></span>
<span id="cb3-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb3-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(ChestPain, ExerciseInducedAngina, BloodSugar),</span>
<span id="cb3-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ClinicalFactor"</span>,</span>
<span id="cb3-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Level"</span></span>
<span id="cb3-22">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-23">  </span>
<span id="cb3-24">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send outcomes down the rows</span></span>
<span id="cb3-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb3-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(HeartDisease, MaximumHR),</span>
<span id="cb3-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Outcome"</span>,</span>
<span id="cb3-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HasOutcome"</span></span>
<span id="cb3-29">  )</span>
<span id="cb3-30">pivot_dat</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,818 × 8
     Age Sex      BP Cholesterol ClinicalFactor        Level  Outcome HasOutcome
   &lt;dbl&gt; &lt;fct&gt; &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;                 &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;     
 1    63 Male    145         233 ChestPain             Typic… HeartD… No        
 2    63 Male    145         233 ChestPain             Typic… Maximu… No        
 3    63 Male    145         233 ExerciseInducedAngina No     HeartD… No        
 4    63 Male    145         233 ExerciseInducedAngina No     Maximu… No        
 5    63 Male    145         233 BloodSugar            TRUE   HeartD… No        
 6    63 Male    145         233 BloodSugar            TRUE   Maximu… No        
 7    67 Male    160         286 ChestPain             Asymp… HeartD… Yes       
 8    67 Male    160         286 ChestPain             Asymp… Maximu… No        
 9    67 Male    160         286 ExerciseInducedAngina Yes    HeartD… Yes       
10    67 Male    160         286 ExerciseInducedAngina Yes    Maximu… No        
# ℹ 1,808 more rows</code></pre>
</div>
</div>
<p>We can then calculate some summary statistics. Our full patient population is replicated for each <code>ClinicalFactor</code> and <code>Outcome</code>, so we should account for that.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">summary_dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb5-2">  pivot_dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-3">  </span>
<span id="cb5-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Summarize characteristics</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarize</span>(</span>
<span id="cb5-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Patients =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>(),</span>
<span id="cb5-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">OutcomeRate =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(HasOutcome <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yes"</span>),</span>
<span id="cb5-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Age),</span>
<span id="cb5-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Female =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(Sex <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Female"</span>),</span>
<span id="cb5-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> </span>
<span id="cb5-11">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb5-12">        ClinicalFactor,</span>
<span id="cb5-13">        Level,</span>
<span id="cb5-14">        Outcome,</span>
<span id="cb5-15">        HasOutcome</span>
<span id="cb5-16">      )</span>
<span id="cb5-17">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-18">  </span>
<span id="cb5-19">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add counts within groups</span></span>
<span id="cb5-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb5-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PercentOfPatients =</span> Patients <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(Patients),</span>
<span id="cb5-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(ClinicalFactor, Outcome)</span>
<span id="cb5-23">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-24">  </span>
<span id="cb5-25">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make clean levels/labels</span></span>
<span id="cb5-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb5-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ClinicalFactor =</span> </span>
<span id="cb5-28">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb5-29">        ClinicalFactor <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BloodSugar"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Blood sugar &gt; 120 mg/dl?"</span>,</span>
<span id="cb5-30">        ClinicalFactor <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ChestPain"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chest pain type"</span>,</span>
<span id="cb5-31">        ClinicalFactor <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ExerciseInducedAngina"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Exercise-induced angina?"</span></span>
<span id="cb5-32">      ),</span>
<span id="cb5-33">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Level =</span> </span>
<span id="cb5-34">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb5-35">        Level <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"TRUE"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Yes"</span>,</span>
<span id="cb5-36">        Level <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"FALSE"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"No"</span>,</span>
<span id="cb5-37">        <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> Level</span>
<span id="cb5-38">      ),</span>
<span id="cb5-39">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Outcome =</span> </span>
<span id="cb5-40">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">case_when</span>(</span>
<span id="cb5-41">        Outcome <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HeartDisease"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Heart disease"</span>,</span>
<span id="cb5-42">        Outcome <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MaximumHR"</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Maximum HR &gt; 150"</span></span>
<span id="cb5-43">      )</span>
<span id="cb5-44">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-45">  </span>
<span id="cb5-46">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Rearrange</span></span>
<span id="cb5-47">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relocate</span>(PercentOfPatients, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.after =</span> Patients) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">relocate</span>(Outcome, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.before =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">everything</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb5-49">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(</span>
<span id="cb5-50">    Outcome,</span>
<span id="cb5-51">    ClinicalFactor,</span>
<span id="cb5-52">    Level,</span>
<span id="cb5-53">    HasOutcome</span>
<span id="cb5-54">  )</span>
<span id="cb5-55">summary_dat</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 × 9
   Outcome       ClinicalFactor      Level HasOutcome Patients PercentOfPatients
   &lt;chr&gt;         &lt;chr&gt;               &lt;chr&gt; &lt;chr&gt;         &lt;int&gt;             &lt;dbl&gt;
 1 Heart disease Blood sugar &gt; 120 … No    No              141            0.465 
 2 Heart disease Blood sugar &gt; 120 … No    Yes             117            0.386 
 3 Heart disease Blood sugar &gt; 120 … Yes   No               23            0.0759
 4 Heart disease Blood sugar &gt; 120 … Yes   Yes              22            0.0726
 5 Heart disease Chest pain type     Asym… No               39            0.129 
 6 Heart disease Chest pain type     Asym… Yes             105            0.347 
 7 Heart disease Chest pain type     Atyp… No               41            0.135 
 8 Heart disease Chest pain type     Atyp… Yes               9            0.0297
 9 Heart disease Chest pain type     Non-… No               68            0.224 
10 Heart disease Chest pain type     Non-… Yes              18            0.0594
# ℹ 22 more rows
# ℹ 3 more variables: OutcomeRate &lt;dbl&gt;, Age &lt;dbl&gt;, Female &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now we’re ready to build the table (note the use of the <a href="https://github.com/zajichek/zildge/blob/main/R/rectbl_agg_wtd.R"><code>zildge::rectbl_agg_wtd()</code></a> function to compute the weighted average, see <a href="https://www.zajichekstats.com/post/reactable-javascript/">my other post</a> for more information about this).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactable</span>(</span>
<span id="cb7-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> summary_dat,</span>
<span id="cb7-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">groupBy =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Outcome"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ClinicalFactor"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Level"</span>),</span>
<span id="cb7-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> </span>
<span id="cb7-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb7-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ClinicalFactor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Clinical factor"</span>),</span>
<span id="cb7-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">HasOutcome =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Has Outcome?"</span>),</span>
<span id="cb7-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Patients =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>),</span>
<span id="cb7-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PercentOfPatients =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Percent"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">percent =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)),</span>
<span id="cb7-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">OutcomeRate =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Outcome rate (%)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> zildge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rectbl_agg_wtd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">percent =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)),</span>
<span id="cb7-11">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Avg. age (years)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> zildge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rectbl_agg_wtd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)),</span>
<span id="cb7-12">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Female =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Female (%)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> zildge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rectbl_agg_wtd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">percent =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span>
<span id="cb7-13">    ),</span>
<span id="cb7-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columnGroups =</span> </span>
<span id="cb7-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb7-16">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colGroup</span>(</span>
<span id="cb7-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>,</span>
<span id="cb7-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PercentOfPatients"</span>)</span>
<span id="cb7-19">      )</span>
<span id="cb7-20">    ),</span>
<span id="cb7-21">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">striped =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb7-22">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">highlight =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb7-23">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bordered =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb7-24">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">resizable =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb7-25">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theme =</span> reactablefmtr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sandstone</span>()</span>
<span id="cb7-26">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb7-27">  reactablefmtr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Use arrows to expand table"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font_style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"italic"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item" id="htmlwidget-7dee0434196488165b3c" style="width:auto;height:auto;"></div>
<p style="color:#000;background:#FFFFFF;text-align:left;font-size:12px;font-style:italic;font-weight:normal;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Use arrows to expand table</p>
<script type="application/json" data-for="htmlwidget-7dee0434196488165b3c">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"Outcome":["Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150"],"ClinicalFactor":["Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Exercise-induced angina?","Exercise-induced angina?","Exercise-induced angina?","Exercise-induced angina?","Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Exercise-induced angina?","Exercise-induced angina?","Exercise-induced angina?","Exercise-induced angina?"],"Level":["No","No","Yes","Yes","Asymptomatic","Asymptomatic","Atypical angina","Atypical angina","Non-anginal pain","Non-anginal pain","Typical angina","Typical angina","No","No","Yes","Yes","No","No","Yes","Yes","Asymptomatic","Asymptomatic","Atypical angina","Atypical angina","Non-anginal pain","Non-anginal pain","Typical angina","Typical angina","No","No","Yes","Yes"],"HasOutcome":["No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes"],"Patients":[141,117,23,22,39,105,41,9,68,18,16,7,141,63,23,76,117,141,22,23,92,52,9,41,29,57,9,14,66,138,73,26],"PercentOfPatients":[0.465346534653465,0.386138613861386,0.0759075907590759,0.0726072607260726,0.128712871287129,0.346534653465347,0.135313531353135,0.0297029702970297,0.224422442244224,0.0594059405940594,0.0528052805280528,0.0231023102310231,0.465346534653465,0.207920792079208,0.0759075907590759,0.250825082508251,0.386138613861386,0.465346534653465,0.0726072607260726,0.0759075907590759,0.303630363036304,0.171617161716172,0.0297029702970297,0.135313531353135,0.0957095709570957,0.188118811881188,0.0297029702970297,0.0462046204620462,0.217821782178218,0.455445544554455,0.240924092409241,0.0858085808580858],"OutcomeRate":[0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],"Age":[52,56.3931623931624,56.1739130434783,57.8636363636364,54.0769230769231,56.3333333333333,50.0243902439024,57.4444444444444,52.4264705882353,58.5,56.1875,55.1428571428571,52.4184397163121,57.0952380952381,53.6086956521739,56.2368421052632,57.0769230769231,51.4326241134752,58.6363636363636,55.4347826086956,56.6086956521739,54.1538461538462,59.4444444444444,49.5853658536585,58.2068965517241,51.4035087719298,59.6666666666667,53.4285714285714,58.2121212121212,51.7826086956522,56.5205479452055,53.1153846153846],"Female":[0.468085106382979,0.162393162393162,0.260869565217391,0.272727272727273,0.461538461538462,0.20952380952381,0.390243902439024,0.222222222222222,0.5,0.0555555555555556,0.25,0,0.453900709219858,0.174603174603175,0.347826086956522,0.184210526315789,0.256410256410256,0.390070921985816,0.272727272727273,0.260869565217391,0.228260869565217,0.365384615384615,0.222222222222222,0.390243902439024,0.413793103448276,0.403508771929825,0.111111111111111,0.214285714285714,0.363636363636364,0.369565217391304,0.164383561643836,0.384615384615385]},"columns":[{"id":"Outcome","name":"Outcome","type":"character"},{"id":"ClinicalFactor","name":"Clinical factor","type":"character"},{"id":"Level","name":"Level","type":"character"},{"id":"HasOutcome","name":"Has Outcome?","type":"character"},{"id":"Patients","name":"Count","type":"numeric","aggregate":"sum","align":"center"},{"id":"PercentOfPatients","name":"Percent","type":"numeric","aggregate":"sum","format":{"cell":{"digits":2,"percent":true},"aggregated":{"digits":2,"percent":true}},"align":"center"},{"id":"OutcomeRate","name":"Outcome rate (%)","type":"numeric","aggregate":"function(values, rows) {\n            var numerator = 0\n            var denominator = 0\n\n            rows.forEach(function(row, index) {\n                numerator += row['Patients'] * values[index]\n                denominator += row['Patients']\n            })\n\n            if('mean' == 'mean') {\n                return numerator / denominator\n            } else {\n                return numerator\n            }\n        }","format":{"cell":{"digits":2,"percent":true},"aggregated":{"digits":2,"percent":true}},"align":"center"},{"id":"Age","name":"Avg. age (years)","type":"numeric","aggregate":"function(values, rows) {\n            var numerator = 0\n            var denominator = 0\n\n            rows.forEach(function(row, index) {\n                numerator += row['Patients'] * values[index]\n                denominator += row['Patients']\n            })\n\n            if('mean' == 'mean') {\n                return numerator / denominator\n            } else {\n                return numerator\n            }\n        }","format":{"cell":{"digits":2},"aggregated":{"digits":2}},"align":"center"},{"id":"Female","name":"Female (%)","type":"numeric","aggregate":"function(values, rows) {\n            var numerator = 0\n            var denominator = 0\n\n            rows.forEach(function(row, index) {\n                numerator += row['Patients'] * values[index]\n                denominator += row['Patients']\n            })\n\n            if('mean' == 'mean') {\n                return numerator / denominator\n            } else {\n                return numerator\n            }\n        }","format":{"cell":{"digits":2,"percent":true},"aggregated":{"digits":2,"percent":true}},"align":"center"}],"columnGroups":[{"name":"Patients","columns":["Patients","PercentOfPatients"]}],"groupBy":["Outcome","ClinicalFactor","Level"],"resizable":true,"highlight":true,"bordered":true,"striped":true,"theme":{"color":"#3e3f3a","backgroundColor":"#ffffff","borderColor":"#f8f5f0","borderWidth":"1px","stripedColor":"#ededed","highlightColor":"#f8f5f0","cellPadding":6,"tableStyle":{"fontSize":15},"headerStyle":{"borderWidth":"2px","backgroundColor":"#f8f5f0","color":"#7c7a78","transitionDuration":"0.5s","&:hover[aria-sort]":{"color":"#000000"},"&[aria-sort='ascending'], &[aria-sort='descending']":{"color":"#000000"},"fontSize":16},"groupHeaderStyle":{"&:not(:empty)":{"color":"#3e3f3a","fontSize":16},"&:hover":{"fontWeight":"bold","transitionDuration":"1s","transitionTimingFunction":"ease-out","color":"#000000"}},"rowSelectedStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"inputStyle":{"backgroundColor":"#ffffff","borderColor":"#bcbfc1","color":"#3e3f3a"},"searchInputStyle":{"backgroundColor":"#ffffff","color":"#3e3f3a","borderColor":"#bcbfc1","&:focus":{"color":"#3e3f3a"}},"selectStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84","borderColor":"#ffffff","outlineColor":"#ffffff"},"pageButtonStyle":{"backgroundColor":"#f8f5f0","color":"#8e8c84","&:hover":{"backgroundColor":"#f3969a","color":"#8e8c84"}},"pageButtonHoverStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"pageButtonActiveStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"pageButtonCurrentStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"}},"dataKey":"c12689269c1e419783d332983d8fb3c2"},"children":[]},"class":"reactR_markup"},"evals":["tag.attribs.columns.6.aggregate","tag.attribs.columns.7.aggregate","tag.attribs.columns.8.aggregate"],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<p>There are a few problems with this table:</p>
<ol type="1">
<li>The redundancy of the top-level (and second-level) summary statistics is unappealing</li>
<li>The top-level aggregation is just flat-out wrong because we’ve duplicated counts over the data set</li>
</ol>
<p>Maybe <em>1</em> is not a huge deal, but I’ve probably already established somewhere that there are 303 patients in the data set and the overall rate of heart disease is 45.9%. You still may choose to keep it as-is in this case as it’s not totally harmful. However, <em>2</em> needs to be addressed as the data is misleading and not really interpretable. <strong>So how can we remove the results from (at least) the top-level while maintaining the lower-level aggregation?</strong></p>
<p>We can define an <code>R</code> function that provides JavaScript <a href="https://glin.github.io/reactable/articles/conditional-styling.html">custom styling</a> to a cell.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">remove_text <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb8-2">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(col, threshold) {</span>
<span id="cb8-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">JS</span>(</span>
<span id="cb8-4">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(</span>
<span id="cb8-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"function(rowInfo) {</span></span>
<span id="cb8-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">          if(rowInfo.row['"</span>, col, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"'] &gt; "</span>, threshold, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">") {</span></span>
<span id="cb8-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            return {fontSize:0}</span></span>
<span id="cb8-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">          }</span></span>
<span id="cb8-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        }"</span></span>
<span id="cb8-10">      )</span>
<span id="cb8-11">    )</span>
<span id="cb8-12">  }</span></code></pre></div>
</details>
</div>
<p>All this function does is reduce the font size to zero for any cell where the value of <code>col</code> in the respective row is greater than <code>threshold</code>. Thus, since we are over-counting the number of patients in the top-level, we can just apply this function to rows in which the count exceeds 303, which is the patient count in our data set. We provide this function to the <code>style</code> argument of <code>colDef()</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactable</span>(</span>
<span id="cb9-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> summary_dat,</span>
<span id="cb9-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">groupBy =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Outcome"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ClinicalFactor"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Level"</span>),</span>
<span id="cb9-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> </span>
<span id="cb9-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb9-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ClinicalFactor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Clinical factor"</span>),</span>
<span id="cb9-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">HasOutcome =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Has Outcome?"</span>),</span>
<span id="cb9-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Patients =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remove_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>),</span>
<span id="cb9-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PercentOfPatients =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remove_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Percent"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">percent =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)),</span>
<span id="cb9-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">OutcomeRate =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remove_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Outcome rate (%)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> zildge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rectbl_agg_wtd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">percent =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)),</span>
<span id="cb9-11">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remove_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Avg. age (years)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> zildge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rectbl_agg_wtd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)),</span>
<span id="cb9-12">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Female =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remove_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Female (%)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> zildge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rectbl_agg_wtd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">percent =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span>
<span id="cb9-13">    ),</span>
<span id="cb9-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columnGroups =</span> </span>
<span id="cb9-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb9-16">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colGroup</span>(</span>
<span id="cb9-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>,</span>
<span id="cb9-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PercentOfPatients"</span>)</span>
<span id="cb9-19">      )</span>
<span id="cb9-20">    ),</span>
<span id="cb9-21">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">striped =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb9-22">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">highlight =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb9-23">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bordered =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb9-24">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">resizable =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb9-25">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theme =</span> reactablefmtr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sandstone</span>()</span>
<span id="cb9-26">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-27">  reactablefmtr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Use arrows to expand table"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font_style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"italic"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item" id="htmlwidget-f2b27ae6d30b4fc23737" style="width:auto;height:auto;"></div>
<p style="color:#000;background:#FFFFFF;text-align:left;font-size:12px;font-style:italic;font-weight:normal;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Use arrows to expand table</p>
<script type="application/json" data-for="htmlwidget-f2b27ae6d30b4fc23737">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"Outcome":["Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150"],"ClinicalFactor":["Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Exercise-induced angina?","Exercise-induced angina?","Exercise-induced angina?","Exercise-induced angina?","Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Exercise-induced angina?","Exercise-induced angina?","Exercise-induced angina?","Exercise-induced angina?"],"Level":["No","No","Yes","Yes","Asymptomatic","Asymptomatic","Atypical angina","Atypical angina","Non-anginal pain","Non-anginal pain","Typical angina","Typical angina","No","No","Yes","Yes","No","No","Yes","Yes","Asymptomatic","Asymptomatic","Atypical angina","Atypical angina","Non-anginal pain","Non-anginal pain","Typical angina","Typical angina","No","No","Yes","Yes"],"HasOutcome":["No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes"],"Patients":[141,117,23,22,39,105,41,9,68,18,16,7,141,63,23,76,117,141,22,23,92,52,9,41,29,57,9,14,66,138,73,26],"PercentOfPatients":[0.465346534653465,0.386138613861386,0.0759075907590759,0.0726072607260726,0.128712871287129,0.346534653465347,0.135313531353135,0.0297029702970297,0.224422442244224,0.0594059405940594,0.0528052805280528,0.0231023102310231,0.465346534653465,0.207920792079208,0.0759075907590759,0.250825082508251,0.386138613861386,0.465346534653465,0.0726072607260726,0.0759075907590759,0.303630363036304,0.171617161716172,0.0297029702970297,0.135313531353135,0.0957095709570957,0.188118811881188,0.0297029702970297,0.0462046204620462,0.217821782178218,0.455445544554455,0.240924092409241,0.0858085808580858],"OutcomeRate":[0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],"Age":[52,56.3931623931624,56.1739130434783,57.8636363636364,54.0769230769231,56.3333333333333,50.0243902439024,57.4444444444444,52.4264705882353,58.5,56.1875,55.1428571428571,52.4184397163121,57.0952380952381,53.6086956521739,56.2368421052632,57.0769230769231,51.4326241134752,58.6363636363636,55.4347826086956,56.6086956521739,54.1538461538462,59.4444444444444,49.5853658536585,58.2068965517241,51.4035087719298,59.6666666666667,53.4285714285714,58.2121212121212,51.7826086956522,56.5205479452055,53.1153846153846],"Female":[0.468085106382979,0.162393162393162,0.260869565217391,0.272727272727273,0.461538461538462,0.20952380952381,0.390243902439024,0.222222222222222,0.5,0.0555555555555556,0.25,0,0.453900709219858,0.174603174603175,0.347826086956522,0.184210526315789,0.256410256410256,0.390070921985816,0.272727272727273,0.260869565217391,0.228260869565217,0.365384615384615,0.222222222222222,0.390243902439024,0.413793103448276,0.403508771929825,0.111111111111111,0.214285714285714,0.363636363636364,0.369565217391304,0.164383561643836,0.384615384615385]},"columns":[{"id":"Outcome","name":"Outcome","type":"character"},{"id":"ClinicalFactor","name":"Clinical factor","type":"character"},{"id":"Level","name":"Level","type":"character"},{"id":"HasOutcome","name":"Has Outcome?","type":"character"},{"id":"Patients","name":"Count","type":"numeric","aggregate":"sum","align":"center","style":"function(rowInfo) {\n          if(rowInfo.row['Patients'] > 303) {\n            return {fontSize:0}\n          }\n        }"},{"id":"PercentOfPatients","name":"Percent","type":"numeric","aggregate":"sum","format":{"cell":{"digits":2,"percent":true},"aggregated":{"digits":2,"percent":true}},"align":"center","style":"function(rowInfo) {\n          if(rowInfo.row['Patients'] > 303) {\n            return {fontSize:0}\n          }\n        }"},{"id":"OutcomeRate","name":"Outcome rate (%)","type":"numeric","aggregate":"function(values, rows) {\n            var numerator = 0\n            var denominator = 0\n\n            rows.forEach(function(row, index) {\n                numerator += row['Patients'] * values[index]\n                denominator += row['Patients']\n            })\n\n            if('mean' == 'mean') {\n                return numerator / denominator\n            } else {\n                return numerator\n            }\n        }","format":{"cell":{"digits":2,"percent":true},"aggregated":{"digits":2,"percent":true}},"align":"center","style":"function(rowInfo) {\n          if(rowInfo.row['Patients'] > 303) {\n            return {fontSize:0}\n          }\n        }"},{"id":"Age","name":"Avg. age (years)","type":"numeric","aggregate":"function(values, rows) {\n            var numerator = 0\n            var denominator = 0\n\n            rows.forEach(function(row, index) {\n                numerator += row['Patients'] * values[index]\n                denominator += row['Patients']\n            })\n\n            if('mean' == 'mean') {\n                return numerator / denominator\n            } else {\n                return numerator\n            }\n        }","format":{"cell":{"digits":2},"aggregated":{"digits":2}},"align":"center","style":"function(rowInfo) {\n          if(rowInfo.row['Patients'] > 303) {\n            return {fontSize:0}\n          }\n        }"},{"id":"Female","name":"Female (%)","type":"numeric","aggregate":"function(values, rows) {\n            var numerator = 0\n            var denominator = 0\n\n            rows.forEach(function(row, index) {\n                numerator += row['Patients'] * values[index]\n                denominator += row['Patients']\n            })\n\n            if('mean' == 'mean') {\n                return numerator / denominator\n            } else {\n                return numerator\n            }\n        }","format":{"cell":{"digits":2,"percent":true},"aggregated":{"digits":2,"percent":true}},"align":"center","style":"function(rowInfo) {\n          if(rowInfo.row['Patients'] > 303) {\n            return {fontSize:0}\n          }\n        }"}],"columnGroups":[{"name":"Patients","columns":["Patients","PercentOfPatients"]}],"groupBy":["Outcome","ClinicalFactor","Level"],"resizable":true,"highlight":true,"bordered":true,"striped":true,"theme":{"color":"#3e3f3a","backgroundColor":"#ffffff","borderColor":"#f8f5f0","borderWidth":"1px","stripedColor":"#ededed","highlightColor":"#f8f5f0","cellPadding":6,"tableStyle":{"fontSize":15},"headerStyle":{"borderWidth":"2px","backgroundColor":"#f8f5f0","color":"#7c7a78","transitionDuration":"0.5s","&:hover[aria-sort]":{"color":"#000000"},"&[aria-sort='ascending'], &[aria-sort='descending']":{"color":"#000000"},"fontSize":16},"groupHeaderStyle":{"&:not(:empty)":{"color":"#3e3f3a","fontSize":16},"&:hover":{"fontWeight":"bold","transitionDuration":"1s","transitionTimingFunction":"ease-out","color":"#000000"}},"rowSelectedStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"inputStyle":{"backgroundColor":"#ffffff","borderColor":"#bcbfc1","color":"#3e3f3a"},"searchInputStyle":{"backgroundColor":"#ffffff","color":"#3e3f3a","borderColor":"#bcbfc1","&:focus":{"color":"#3e3f3a"}},"selectStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84","borderColor":"#ffffff","outlineColor":"#ffffff"},"pageButtonStyle":{"backgroundColor":"#f8f5f0","color":"#8e8c84","&:hover":{"backgroundColor":"#f3969a","color":"#8e8c84"}},"pageButtonHoverStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"pageButtonActiveStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"pageButtonCurrentStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"}},"dataKey":"edf7478aaef4de899096f5154e62a4e6"},"children":[]},"class":"reactR_markup"},"evals":["tag.attribs.columns.4.style","tag.attribs.columns.5.style","tag.attribs.columns.6.aggregate","tag.attribs.columns.6.style","tag.attribs.columns.7.aggregate","tag.attribs.columns.7.style","tag.attribs.columns.8.aggregate","tag.attribs.columns.8.style"],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<p>If we want to remove text from the second level of aggregation, we can just adjust the <code>threshold</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactable</span>(</span>
<span id="cb10-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> summary_dat,</span>
<span id="cb10-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">groupBy =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Outcome"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ClinicalFactor"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Level"</span>),</span>
<span id="cb10-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> </span>
<span id="cb10-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb10-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ClinicalFactor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Clinical factor"</span>),</span>
<span id="cb10-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">HasOutcome =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Has Outcome?"</span>),</span>
<span id="cb10-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Patients =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remove_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Count"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>),</span>
<span id="cb10-9">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">PercentOfPatients =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remove_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Percent"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">percent =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)),</span>
<span id="cb10-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">OutcomeRate =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remove_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Outcome rate (%)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> zildge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rectbl_agg_wtd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">percent =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)),</span>
<span id="cb10-11">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remove_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Avg. age (years)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> zildge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rectbl_agg_wtd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)),</span>
<span id="cb10-12">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Female =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">remove_text</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nrow</span>(dat) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Female (%)"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> zildge<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rectbl_agg_wtd</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">percent =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>))</span>
<span id="cb10-13">    ),</span>
<span id="cb10-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columnGroups =</span> </span>
<span id="cb10-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb10-16">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colGroup</span>(</span>
<span id="cb10-17">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">name =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>,</span>
<span id="cb10-18">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Patients"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PercentOfPatients"</span>)</span>
<span id="cb10-19">      )</span>
<span id="cb10-20">    ),</span>
<span id="cb10-21">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">striped =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb10-22">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">highlight =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb10-23">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bordered =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb10-24">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">resizable =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb10-25">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theme =</span> reactablefmtr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sandstone</span>()</span>
<span id="cb10-26">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb10-27">  reactablefmtr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">add_source</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Use arrows to expand table"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">font_style =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"italic"</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item" id="htmlwidget-5f51993d07eb42406f25" style="width:auto;height:auto;"></div>
<p style="color:#000;background:#FFFFFF;text-align:left;font-size:12px;font-style:italic;font-weight:normal;text-decoration:;letter-spacing:px;word-spacing:px;text-transform:;text-shadow:;margin-top:0px;margin-right:0px;margin-bottom:0px;margin-left:0px">Use arrows to expand table</p>
<script type="application/json" data-for="htmlwidget-5f51993d07eb42406f25">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"Outcome":["Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Heart disease","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150","Maximum HR > 150"],"ClinicalFactor":["Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Exercise-induced angina?","Exercise-induced angina?","Exercise-induced angina?","Exercise-induced angina?","Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Blood sugar > 120 mg/dl?","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Chest pain type","Exercise-induced angina?","Exercise-induced angina?","Exercise-induced angina?","Exercise-induced angina?"],"Level":["No","No","Yes","Yes","Asymptomatic","Asymptomatic","Atypical angina","Atypical angina","Non-anginal pain","Non-anginal pain","Typical angina","Typical angina","No","No","Yes","Yes","No","No","Yes","Yes","Asymptomatic","Asymptomatic","Atypical angina","Atypical angina","Non-anginal pain","Non-anginal pain","Typical angina","Typical angina","No","No","Yes","Yes"],"HasOutcome":["No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes","No","Yes"],"Patients":[141,117,23,22,39,105,41,9,68,18,16,7,141,63,23,76,117,141,22,23,92,52,9,41,29,57,9,14,66,138,73,26],"PercentOfPatients":[0.465346534653465,0.386138613861386,0.0759075907590759,0.0726072607260726,0.128712871287129,0.346534653465347,0.135313531353135,0.0297029702970297,0.224422442244224,0.0594059405940594,0.0528052805280528,0.0231023102310231,0.465346534653465,0.207920792079208,0.0759075907590759,0.250825082508251,0.386138613861386,0.465346534653465,0.0726072607260726,0.0759075907590759,0.303630363036304,0.171617161716172,0.0297029702970297,0.135313531353135,0.0957095709570957,0.188118811881188,0.0297029702970297,0.0462046204620462,0.217821782178218,0.455445544554455,0.240924092409241,0.0858085808580858],"OutcomeRate":[0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],"Age":[52,56.3931623931624,56.1739130434783,57.8636363636364,54.0769230769231,56.3333333333333,50.0243902439024,57.4444444444444,52.4264705882353,58.5,56.1875,55.1428571428571,52.4184397163121,57.0952380952381,53.6086956521739,56.2368421052632,57.0769230769231,51.4326241134752,58.6363636363636,55.4347826086956,56.6086956521739,54.1538461538462,59.4444444444444,49.5853658536585,58.2068965517241,51.4035087719298,59.6666666666667,53.4285714285714,58.2121212121212,51.7826086956522,56.5205479452055,53.1153846153846],"Female":[0.468085106382979,0.162393162393162,0.260869565217391,0.272727272727273,0.461538461538462,0.20952380952381,0.390243902439024,0.222222222222222,0.5,0.0555555555555556,0.25,0,0.453900709219858,0.174603174603175,0.347826086956522,0.184210526315789,0.256410256410256,0.390070921985816,0.272727272727273,0.260869565217391,0.228260869565217,0.365384615384615,0.222222222222222,0.390243902439024,0.413793103448276,0.403508771929825,0.111111111111111,0.214285714285714,0.363636363636364,0.369565217391304,0.164383561643836,0.384615384615385]},"columns":[{"id":"Outcome","name":"Outcome","type":"character"},{"id":"ClinicalFactor","name":"Clinical factor","type":"character"},{"id":"Level","name":"Level","type":"character"},{"id":"HasOutcome","name":"Has Outcome?","type":"character"},{"id":"Patients","name":"Count","type":"numeric","aggregate":"sum","align":"center","style":"function(rowInfo) {\n          if(rowInfo.row['Patients'] > 302) {\n            return {fontSize:0}\n          }\n        }"},{"id":"PercentOfPatients","name":"Percent","type":"numeric","aggregate":"sum","format":{"cell":{"digits":2,"percent":true},"aggregated":{"digits":2,"percent":true}},"align":"center","style":"function(rowInfo) {\n          if(rowInfo.row['Patients'] > 302) {\n            return {fontSize:0}\n          }\n        }"},{"id":"OutcomeRate","name":"Outcome rate (%)","type":"numeric","aggregate":"function(values, rows) {\n            var numerator = 0\n            var denominator = 0\n\n            rows.forEach(function(row, index) {\n                numerator += row['Patients'] * values[index]\n                denominator += row['Patients']\n            })\n\n            if('mean' == 'mean') {\n                return numerator / denominator\n            } else {\n                return numerator\n            }\n        }","format":{"cell":{"digits":2,"percent":true},"aggregated":{"digits":2,"percent":true}},"align":"center","style":"function(rowInfo) {\n          if(rowInfo.row['Patients'] > 302) {\n            return {fontSize:0}\n          }\n        }"},{"id":"Age","name":"Avg. age (years)","type":"numeric","aggregate":"function(values, rows) {\n            var numerator = 0\n            var denominator = 0\n\n            rows.forEach(function(row, index) {\n                numerator += row['Patients'] * values[index]\n                denominator += row['Patients']\n            })\n\n            if('mean' == 'mean') {\n                return numerator / denominator\n            } else {\n                return numerator\n            }\n        }","format":{"cell":{"digits":2},"aggregated":{"digits":2}},"align":"center","style":"function(rowInfo) {\n          if(rowInfo.row['Patients'] > 302) {\n            return {fontSize:0}\n          }\n        }"},{"id":"Female","name":"Female (%)","type":"numeric","aggregate":"function(values, rows) {\n            var numerator = 0\n            var denominator = 0\n\n            rows.forEach(function(row, index) {\n                numerator += row['Patients'] * values[index]\n                denominator += row['Patients']\n            })\n\n            if('mean' == 'mean') {\n                return numerator / denominator\n            } else {\n                return numerator\n            }\n        }","format":{"cell":{"digits":2,"percent":true},"aggregated":{"digits":2,"percent":true}},"align":"center","style":"function(rowInfo) {\n          if(rowInfo.row['Patients'] > 302) {\n            return {fontSize:0}\n          }\n        }"}],"columnGroups":[{"name":"Patients","columns":["Patients","PercentOfPatients"]}],"groupBy":["Outcome","ClinicalFactor","Level"],"resizable":true,"highlight":true,"bordered":true,"striped":true,"theme":{"color":"#3e3f3a","backgroundColor":"#ffffff","borderColor":"#f8f5f0","borderWidth":"1px","stripedColor":"#ededed","highlightColor":"#f8f5f0","cellPadding":6,"tableStyle":{"fontSize":15},"headerStyle":{"borderWidth":"2px","backgroundColor":"#f8f5f0","color":"#7c7a78","transitionDuration":"0.5s","&:hover[aria-sort]":{"color":"#000000"},"&[aria-sort='ascending'], &[aria-sort='descending']":{"color":"#000000"},"fontSize":16},"groupHeaderStyle":{"&:not(:empty)":{"color":"#3e3f3a","fontSize":16},"&:hover":{"fontWeight":"bold","transitionDuration":"1s","transitionTimingFunction":"ease-out","color":"#000000"}},"rowSelectedStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"inputStyle":{"backgroundColor":"#ffffff","borderColor":"#bcbfc1","color":"#3e3f3a"},"searchInputStyle":{"backgroundColor":"#ffffff","color":"#3e3f3a","borderColor":"#bcbfc1","&:focus":{"color":"#3e3f3a"}},"selectStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84","borderColor":"#ffffff","outlineColor":"#ffffff"},"pageButtonStyle":{"backgroundColor":"#f8f5f0","color":"#8e8c84","&:hover":{"backgroundColor":"#f3969a","color":"#8e8c84"}},"pageButtonHoverStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"pageButtonActiveStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"pageButtonCurrentStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"}},"dataKey":"5d25476238b69669768efc4e544b1ea3"},"children":[]},"class":"reactR_markup"},"evals":["tag.attribs.columns.4.style","tag.attribs.columns.5.style","tag.attribs.columns.6.aggregate","tag.attribs.columns.6.style","tag.attribs.columns.7.aggregate","tag.attribs.columns.7.style","tag.attribs.columns.8.aggregate","tag.attribs.columns.8.style"],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<p>And that’s it.</p>
<p>I’ll acknowledge that I didn’t exhaust all options for this task and that there are <em>definitely</em> better ways to do this with more directed intention by accessing various properties of the table. Obviously this only works if you have a column in the table that only increases during the aggregation and does so to predictable amounts. But it did the trick here.</p>


<!-- -->


 ]]></description>
  <category>Tables</category>
  <category>Javascript</category>
  <guid>https://www.zajichekstats.com/post/quickly-removing-higher-order-aggregation-text-in-reactable/</guid>
  <pubDate>Thu, 29 Jun 2023 05:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/quickly-removing-higher-order-aggregation-text-in-reactable/feature.png" medium="image" type="image/png" height="141" width="144"/>
</item>
<item>
  <title>Nesting with {tidyr}</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/nesting-with-tidyr/</link>
  <description><![CDATA[ 




<p>I really love the elegance of the <a href="https://tidyr.tidyverse.org/reference/nest.html"><code>nest</code></a> functionality with the <a href="https://tidyr.tidyverse.org/"><code>tidyr</code></a> package. It really allows you to abstract the meaning of a data frame to not just contain rectangular data with scalars, but rather a generalization that has rectangular data of <em>objects</em>. The most intriguing part of it to me is the way we can continue to use typical <a href="https://dplyr.tidyverse.org/reference/mutate-joins.html"><code>join</code></a> operations even with complex objects in some of the columns, which makes it so smooth and intuitive to do complex data operations.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<p>For example, lets say we have a dataset.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> cheese<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>heart_disease</span>
<span id="cb3-2">dat</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 303 × 9
     Age Sex    ChestPain           BP Cholesterol BloodSugar MaximumHR
   &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;            &lt;dbl&gt;       &lt;dbl&gt; &lt;lgl&gt;          &lt;dbl&gt;
 1    63 Male   Typical angina     145         233 TRUE             150
 2    67 Male   Asymptomatic       160         286 FALSE            108
 3    67 Male   Asymptomatic       120         229 FALSE            129
 4    37 Male   Non-anginal pain   130         250 FALSE            187
 5    41 Female Atypical angina    130         204 FALSE            172
 6    56 Male   Atypical angina    120         236 FALSE            178
 7    62 Female Asymptomatic       140         268 FALSE            160
 8    57 Female Asymptomatic       120         354 FALSE            163
 9    63 Male   Asymptomatic       130         254 FALSE            147
10    53 Male   Asymptomatic       140         203 TRUE             155
# ℹ 293 more rows
# ℹ 2 more variables: ExerciseInducedAngina &lt;fct&gt;, HeartDisease &lt;fct&gt;</code></pre>
</div>
</div>
<p>And we want to compute age percentiles by sex for those who do and don’t have heart disease.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Nest data frames within sex, heart disease</span></span>
<span id="cb5-2">nested1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb5-3">  dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(Sex, HeartDisease) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">nest</span>()</span>
<span id="cb5-6">nested1</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
# Groups:   Sex, HeartDisease [4]
  Sex    HeartDisease data              
  &lt;fct&gt;  &lt;fct&gt;        &lt;list&gt;            
1 Male   No           &lt;tibble [92 × 7]&gt; 
2 Male   Yes          &lt;tibble [114 × 7]&gt;
3 Female No           &lt;tibble [72 × 7]&gt; 
4 Female Yes          &lt;tibble [25 × 7]&gt; </code></pre>
</div>
</div>
<p>We can see that there is now a separate dataset available within each combination of sex and heart disease status in the form of a <code>list</code> column.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get the empirical cumulative density function for age</span></span>
<span id="cb7-2">nested2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb7-3">  nested1 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb7-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ecdf_col =</span> data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ecdf</span>(.x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>Age))</span>
<span id="cb7-6">  )</span>
<span id="cb7-7">nested2</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
# Groups:   Sex, HeartDisease [4]
  Sex    HeartDisease data               ecdf_col
  &lt;fct&gt;  &lt;fct&gt;        &lt;list&gt;             &lt;list&gt;  
1 Male   No           &lt;tibble [92 × 7]&gt;  &lt;ecdf&gt;  
2 Male   Yes          &lt;tibble [114 × 7]&gt; &lt;ecdf&gt;  
3 Female No           &lt;tibble [72 × 7]&gt;  &lt;ecdf&gt;  
4 Female Yes          &lt;tibble [25 × 7]&gt;  &lt;ecdf&gt;  </code></pre>
</div>
</div>
<p>We then apply <code>list</code> operations as we normally would. In this case, we use <code>purrr::map</code> to create an empirical cumulative density function for age within each group. The result is then just a <code>list</code> of <code>ecdf</code> functions.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make an age grid</span></span>
<span id="cb9-2">age_grid <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb9-3">  dat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(Sex, HeartDisease) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">distinct</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(</span>
<span id="cb9-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Age =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">40</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">60</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>)),</span>
<span id="cb9-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">character</span>()</span>
<span id="cb9-9">  )</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `by = character()` to perform a cross join was deprecated in dplyr 1.1.0.
ℹ Please use `cross_join()` instead.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">age_grid</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 3
   Sex    HeartDisease   Age
   &lt;fct&gt;  &lt;fct&gt;        &lt;dbl&gt;
 1 Male   No              40
 2 Male   No              50
 3 Male   No              60
 4 Male   No              70
 5 Male   Yes             40
 6 Male   Yes             50
 7 Male   Yes             60
 8 Male   Yes             70
 9 Female No              40
10 Female No              50
11 Female No              60
12 Female No              70
13 Female Yes             40
14 Female Yes             50
15 Female Yes             60
16 Female Yes             70</code></pre>
</div>
</div>
<p>We then made an age grid for each sex/heart disease combination to evaluate the percentiles of each age in the respective groups. Now, we can compute the percentiles by joining to get the <code>ecdf</code> for the respective group, and plugging in each age into the function.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">age_grid <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb13-2">  </span>
<span id="cb13-3">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join to get the ecdf for the group</span></span>
<span id="cb13-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(</span>
<span id="cb13-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> nested2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>data),</span>
<span id="cb13-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Sex"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"HeartDisease"</span>)</span>
<span id="cb13-7">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb13-8">  </span>
<span id="cb13-9">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the percentile for the given age</span></span>
<span id="cb13-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb13-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Percentile =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map2</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.x =</span> ecdf_col, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.list</span>(Age), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.f =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">.x</span>(.y)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">flatten_dbl</span>()</span>
<span id="cb13-12">  )</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 5
   Sex    HeartDisease   Age ecdf_col Percentile
   &lt;fct&gt;  &lt;fct&gt;        &lt;dbl&gt; &lt;list&gt;        &lt;dbl&gt;
 1 Male   No              40 &lt;ecdf&gt;       0.0761
 2 Male   No              50 &lt;ecdf&gt;       0.424 
 3 Male   No              60 &lt;ecdf&gt;       0.859 
 4 Male   No              70 &lt;ecdf&gt;       1     
 5 Male   Yes             40 &lt;ecdf&gt;       0.0526
 6 Male   Yes             50 &lt;ecdf&gt;       0.246 
 7 Male   Yes             60 &lt;ecdf&gt;       0.719 
 8 Male   Yes             70 &lt;ecdf&gt;       0.991 
 9 Female No              40 &lt;ecdf&gt;       0.0694
10 Female No              50 &lt;ecdf&gt;       0.361 
11 Female No              60 &lt;ecdf&gt;       0.694 
12 Female No              70 &lt;ecdf&gt;       0.931 
13 Female Yes             40 &lt;ecdf&gt;       0     
14 Female Yes             50 &lt;ecdf&gt;       0.04  
15 Female Yes             60 &lt;ecdf&gt;       0.52  
16 Female Yes             70 &lt;ecdf&gt;       1     </code></pre>
</div>
</div>
<p>We can see, for example, that a 60 year old male is at the <img src="https://latex.codecogs.com/png.latex?86%5E%7Bth%7D"> percentile for those without heart disease, but at the <img src="https://latex.codecogs.com/png.latex?72%5E%7Bnd%7D"> for those who due, suggesting that the age distribution tends to be higher in patients with heart disease.</p>


<!-- -->


 ]]></description>
  <category>Data Wrangling</category>
  <guid>https://www.zajichekstats.com/post/nesting-with-tidyr/</guid>
  <pubDate>Thu, 02 Feb 2023 06:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/nesting-with-tidyr/feature.png" medium="image" type="image/png" height="146" width="144"/>
</item>
<item>
  <title>Some Takeaways from Effective Data Storytelling</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/some-takeaways-from-effective-data-storytelling/</link>
  <description><![CDATA[ 




<p>I’ve been reading through the book <a href="https://www.effectivedatastorytelling.com/"><em>Effective Data Storytelling: How to drive change with data, narrative, and visuals</em></a> by Brent Dykes and just wanted to document some thoughts/takeaways.</p>
<section id="importance-of-domain-knowledge" class="level1">
<h1>1. Importance of domain knowledge</h1>
<p>One of the biggest (and obvious) takeaways is the importance of domain knowledge is being able to craft an effective data story. You can have all the technical skills in world (e.g., math, statistics, programming, etc.), but if you aren’t able to relay that back to how it can impact things people care about, in simple terms, you’ll have trouble getting buy in. Thus, it is essential to be able to (i) acquire business knowledge and intuition for yourself, (ii) asking the right questions, and (iii) have subject matter experts (SMEs) who can <em>partner</em> with you to problem solve together. Domain knowledge is also incredibly important <em>in</em> the technical aspects as well (e.g., construction of useful statistical models generally requires assumptions about the context of the problem you are solving).</p>
</section>
<section id="organizational-culture-and-support" class="level1">
<h1>2. Organizational culture and support</h1>
<p>I think in order to put data professionals in a position to be able to craft effective data stories, there needs to be some level of forethought into the data culture and structure of the organization. Just from a logistical perspective, it would be very difficult for someone to be able to take the necessary time, delicacy, rigor and sophistication needed to truly create an effective data story (e.g., using the right data, in the right analysis, with the right methods, with the right communication of results) without the support of foundational data infrastructure, data governance, process/project management, defined roles/responsibilities, overall strategy, etc. These things should be in place (<em>or at least working towards it</em>) to be able to apply the appropriate amount of rigor and detail required in an efficient and timely manner.</p>
</section>
<section id="tailor-communication-of-results-to-your-audience" class="level1">
<h1>3. Tailor communication of results to your audience</h1>
<p>I often build analyses in the form of HTML documents (via <a href="https://rmarkdown.rstudio.com/">R Markdown</a>) where the intention is to lay out a story of the data in a particular order, such the the end-user would read through the document on their own to gain the messages of the analysis with interactive figures and tables (I believe the idea of <em>“scrollytelling”</em>). However, I would often get asked by stakeholders to instead present/explain the material for them instead of them (understandably) reading through the whole thing on their own. So I would attend a meeting, bring up the document, and begin walking them through the document. I quickly found that this didn’t work. The intention of the document was to be read, not presented, and so people would get bogged down/distracted by the narrative in the document while presenting. It just felt uncomfortable. This is <em>exactly</em> something that is talked about in the book of what not to do. So, before sharing with stakeholders or presenting, I started converting the information in the document into a slide deck, pulling out the most useful information that was tailored to the way I would present it. Also, recreating graphs, tables, and/or figures that point out just the most pertinent data, instead of using the exhaustive summaries built in the exploratory analysis. These strategies proved to be much more effective and satisfying both for myself and the stakeholders.</p>


<!-- -->

</section>

 ]]></description>
  <category>Communication</category>
  <guid>https://www.zajichekstats.com/post/some-takeaways-from-effective-data-storytelling/</guid>
  <pubDate>Sat, 14 Jan 2023 06:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/some-takeaways-from-effective-data-storytelling/feature.png" medium="image" type="image/png" height="175" width="144"/>
</item>
<item>
  <title>The Evasive Spline</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/the-evasive-spline/</link>
  <description><![CDATA[ 




<p>This one always gets me. I’ve learned and forgot how splines work many times over the years, and when I need to relearn it, I read the <em>Moving Beyond Linearity</em> chapter of <a href="https://www.statlearning.com/">An Introduction to Statistical Learning</a>.</p>
<p><strong>Basis Functions</strong> are just a general approach for transforming a simple model like:</p>
<p><img src="https://latex.codecogs.com/png.latex?Y_i%20=%20%5Cbeta_0%20+%20%5Cbeta_1X_i%20+%20%5Cepsilon_i"> into a linear combination of transformations of the <img src="https://latex.codecogs.com/png.latex?X_i"> of the form:</p>
<p><img src="https://latex.codecogs.com/png.latex?Y_i%20=%20%5Cbeta_0%20+%20%5Cbeta_1b_1(X_i)%20+%20%5Cbeta_2b_2(X_i)%20+%20...%20+%20%5Cbeta_Kb_k(X_i)%20+%20%5Cepsilon_i"> where <img src="https://latex.codecogs.com/png.latex?b_i"> is a known function that transforms the predictor variable. <em>Note: <img src="https://latex.codecogs.com/png.latex?%5Cbeta_1"> is not the same in both of these, they are just placeholders for an arbitrary parameter.</em> For example, in the case of a piecewise regression where the model is of the form:</p>
<p><img src="https://latex.codecogs.com/png.latex?Y_i%20=%20%5Cbeta_0%20+%20%5Cbeta_1I(X_i%20%3C%20c_1)%20+%20%5Cbeta_2I(c_1%20%3C%20X_i%20%3C%20c_2)%20+%20...%20+%20%5Cbeta_kI(c_%7Bk-1%7D%20%3C%20X_i%20%3C%20c_k)%20+%20%5Cepsilon_i"> the indicators are <em>basis functions</em> such that:</p>
<p><img src="https://latex.codecogs.com/png.latex?b_j(X_i)%20=%20I(c_%7Bj-1%7D%20%3C%20X_i%20%3C%20c_j)%20%5Chskip.1in%20%5Ctext%7Bfor%20j=1,..,k%7D"> or in a polynomial model, the basis functions are <img src="https://latex.codecogs.com/png.latex?b_j(X_i)%20=%20X_i%5Ej">.</p>
<p><strong>Knots</strong> are points (cutoffs) along <img src="https://latex.codecogs.com/png.latex?X_i"> that a <em>local</em> regression starts/ends. For example, we might fit a cubic model (e.g., with parameters <img src="https://latex.codecogs.com/png.latex?%5Cbeta_1,%20%5Cbeta_2,%20%5Cbeta_3">) where <img src="https://latex.codecogs.com/png.latex?X_i%20%3C%20C">, and another model (with a <em>separate</em> set of <img src="https://latex.codecogs.com/png.latex?%5Cbeta_1,%20%5Cbeta_2,%20%5Cbeta_3">) where <img src="https://latex.codecogs.com/png.latex?X_i%20%5Cgeq%20C">. <img src="https://latex.codecogs.com/png.latex?C"> is a <em>knot</em>. In this sense, the piecewise regression above was also a polynomial regression with degree 0, and knots at each value of <img src="https://latex.codecogs.com/png.latex?c_j">.</p>
<p>The general problem with an unconstrained polynomial model is that there are no restrictions that force a smooth function across <img src="https://latex.codecogs.com/png.latex?X">, so there are discontinuities. Thus, restrictions need to be put in place such as (1) making it continuous at the knot(s), and/or even further, (2) making the first and second derivatives continuous at the knots. These restrictions reduce the complexity of the model (i.e., the number of parameters we estimate).</p>
<section id="cubic-splines" class="level1">
<h1>Cubic Splines</h1>
<p>A cubic spline with <img src="https://latex.codecogs.com/png.latex?K"> knots uses <img src="https://latex.codecogs.com/png.latex?K+4"> parameters. The best way to do this is to use (1) the basis of a cubic polynomial (<img src="https://latex.codecogs.com/png.latex?x,%20x%5E2,%20x%5E3">) and (2) a truncated power basis <em>for each knot</em>:</p>
<p><img src="https://latex.codecogs.com/png.latex?h(x,%5Cnu)%20=%20%7B(x-%5Cnu)%7D_+%5E3"> where <img src="https://latex.codecogs.com/png.latex?%5Cnu"> is the knot location. Thus, a <em>one-knot</em> model looks like:</p>
<p><img src="https://latex.codecogs.com/png.latex?Y_i%20=%20%5Cbeta_0%20+%20%5Cbeta_1X_i%20+%20%5Cbeta_2X_i%5E2%20+%20%5Cbeta_3X_i%5E3%20+%20%5Cbeta_4h(X_i,%5Cnu_1)%20+%20%5Cepsilon_i"> We can add more knots as needed, and it simply adds <img src="https://latex.codecogs.com/png.latex?h(x,%5Cnu)"> terms only (so 1 more parameter per knot). A function of this form is guaranteed to have continuous first and second derivatives.</p>
<p><strong>So how does this relate to what is produced in the <code>rcs</code> function from the <code>rms</code> package?</strong></p>
<p>Well, the package actually fits a <em>restricted</em> cubic spline, which is a <em>natural spline</em>. This adds even more restrictions that the general cubic spline by forcing it to be <em>linear</em> where <img src="https://latex.codecogs.com/png.latex?X"> is less than the smallest knot and where <img src="https://latex.codecogs.com/png.latex?X"> is larger than the largest not (i.e., the boundaries). These add an additional <em>two</em> constraints at <em>each</em> boundary. So if we have a regular cubic spline model above with 3 knots (i.e., 7 parameters), then a <em>restricted</em> cubic spline model with 3 knots should have only 3 parameters.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb1-2">x <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb1-3">y <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>)</span>
<span id="cb1-4">x_trans <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rms<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rcs</span>(x, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(x_trans)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               x         x'
[1,] -0.56047565 0.02405534
[2,] -0.23017749 0.10816181
[3,]  1.55870831 2.14013743
[4,]  0.07050839 0.27135366
[5,]  0.12928774 0.31547103
[6,]  1.71506499 2.36735648
attr(,"class")
[1] "rms"
attr(,"name")
[1] "x"
attr(,"label")
[1] "x"
attr(,"assume")
[1] "rcspline"
attr(,"assume.code")
[1] 4
attr(,"parms")
[1] -1.06822046  0.06175631  1.26449867
attr(,"nonlinear")
[1] FALSE  TRUE
attr(,"colnames")
[1] "x"  "x'"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summary</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">lm</span>(y<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>x_trans))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x_trans)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.9888 -0.7341 -0.0803  0.6900  3.2215 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  -0.3838     0.1842  -2.084   0.0398 *  
x_transx     -1.6552     0.2449  -6.758 1.04e-09 ***
x_transx'     1.2922     0.2925   4.417 2.61e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9823 on 97 degrees of freedom
Multiple R-squared:  0.3805,    Adjusted R-squared:  0.3677 
F-statistic: 29.79 on 2 and 97 DF,  p-value: 8.214e-11</code></pre>
</div>
</div>
<p>We can see this model contains three estimated parameters as expected. The actual transformation completed for the restricted cubic spline in producing, in general, the <img src="https://latex.codecogs.com/png.latex?K-2"> additional predictors is more complex than the cubic spline (although similar). In this case, the 3 knot positions were selected to be:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">knots <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">attr</span>(x_trans, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"parms"</span>)</span>
<span id="cb5-2">knots</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.06822046  0.06175631  1.26449867</code></pre>
</div>
</div>
<p>Note, these are just the <img src="https://latex.codecogs.com/png.latex?10%5E%7Bth%7D,%2050%5E%7Bth%7D,%2090%5E%7Bth%7D"> percentiles:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">quantile</span>(x, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        10%         50%         90% 
-1.06822046  0.06175631  1.26449867 </code></pre>
</div>
</div>
<p>The following transformation is made (general solution <a href="https://support.sas.com/resources/papers/proceedings16/5621-2016.pdf">here</a>):</p>
<p><img src="https://latex.codecogs.com/png.latex?X_%7Btrans%7D%20=%20(x-%5Cnu_1)_+%5E3%20-%20(x-%5Cnu_2)_+%5E3%5Cfrac%7B%5Cnu_3-%5Cnu_1%7D%7B%5Cnu_3-%5Cnu_2%7D%20+%20(x-%5Cnu_3)_+%5E3%5Cfrac%7B%5Cnu_2-%5Cnu_1%7D%7B%5Cnu_3-%5Cnu_2%7D"> Let’s check out that transformation on our data:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">tibble<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb9-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(x_trans[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x"</span>]),</span>
<span id="cb9-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_trans_actual =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.numeric</span>(x_trans[,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"x'"</span>]),</span>
<span id="cb9-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x_trans_calculated =</span> </span>
<span id="cb9-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>((x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span></span>
<span id="cb9-6">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>((x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ((knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>])) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb9-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pmax</span>((x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> ((knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>])<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>(knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>knots[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>]))</span>
<span id="cb9-8">)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 3
         x x_trans_actual x_trans_calculated
     &lt;dbl&gt;          &lt;dbl&gt;              &lt;dbl&gt;
 1 -0.560          0.0241             0.131 
 2 -0.230          0.108              0.589 
 3  1.56           2.14              11.6   
 4  0.0705         0.271              1.48  
 5  0.129          0.315              1.72  
 6  1.72           2.37              12.9   
 7  0.461          0.634              3.45  
 8 -1.27           0                  0     
 9 -0.687          0.0102             0.0555
10 -0.446          0.0443             0.241 
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>For some reason this is close but off by a factor close to 5? Looking into the documentation/code, it is because of the <code>norm</code> argument in the <code>Hmisc::rcspline.eval</code> function. When we run this, we get the same result that we calculated (which is the original restricted cubic spline calculation):</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(Hmisc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rcspline.eval</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nk=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">norm =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]
[1,]  0.130899
[2,]  0.588571
[3,] 11.645726
[4,]  1.476592
[5,]  1.716660
[6,] 12.882156</code></pre>
</div>
</div>
<p>By default, this function uses <code>norm=2</code>, which <em>“normalizes by the square of the spacing between the first and last knots…has the advantage of making all nonlinear terms be on the x-scale”</em>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(Hmisc<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rcspline.eval</span>(x,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">nk=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">norm =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>))</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]
[1,] 0.02405534
[2,] 0.10816181
[3,] 2.14013743
[4,] 0.27135366
[5,] 0.31547103
[6,] 2.36735648</code></pre>
</div>
</div>


<!-- -->

</section>

 ]]></description>
  <category>Estimation</category>
  <category>Modeling</category>
  <guid>https://www.zajichekstats.com/post/the-evasive-spline/</guid>
  <pubDate>Fri, 13 Jan 2023 06:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/the-evasive-spline/feature.png" medium="image" type="image/png" height="145" width="144"/>
</item>
<item>
  <title>(Re)deriving a Bernoulli MLE</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/deriving-a-bernoulli-mle/</link>
  <description><![CDATA[ 




<p>Over time, I’ve found myself constantly learning new things or having new ideas, only to later forget them, then trying to relearn the same thing at a later date. So I thought it might be worthwhile to try to create a knowledge base for myself that I continually add to so that I can refer back when needed to maintain intuition. These might be little programming tricks, math and/or statistics concepts, general thoughts or ideas, etc.</p>
<p>I tried to derive the MLE for a set of Bernoulli responses just to see if I still could, and got stuck. The <em>probability mass function (PMF)</em> is</p>
<p><img src="https://latex.codecogs.com/png.latex?P(Y_i%20=%20y)%20=%20p%5Ey(1-p)%5E%7B1-y%7D"> First, we need to define the likelihood function:</p>
<p><img src="https://latex.codecogs.com/png.latex?L(p)%20=%20%5Cprod_%7Bi=1%7D%5EnP(Y_i=y)"> Then, convert ot a log likelihood:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%5Cbegin%7Bsplit%7D%0Alog(L(p))%0A&amp;=%20log(%5Cprod_%7Bi=1%7D%5EnP(Y_i=y))%20%5C%5C%0A&amp;=%20%5Csum_%7Bi=1%7D%5Enlog(P(Y_i=y))%20%5C%5C%0A&amp;=%20%5Csum_%7Bi=1%7D%5Enlog(p%5E%7By_i%7D(1-p)%5E%7B1-y_i%7D)%20%5C%5C%0A&amp;=%20log(p)%5Csum_%7Bi=1%7D%5Eny_i%20+%20log(1-p)(n%20-%20%5Csum_%7Bi=1%7D%5Eny_i)%0A%5Cend%7Bsplit%7D%0A%5Cend%7Bequation%7D%0A"> Next, we need to differentiate with respect to <img src="https://latex.codecogs.com/png.latex?p">.</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%5Cbegin%7Bsplit%7D%0A%5Cfrac%7Bd%7D%7Bdp%7Dlog(L(p))%0A&amp;=%20%5Cfrac%7Bd%7D%7Bdp%7D%20log(p)%5Csum_%7Bi=1%7D%5Eny_i%20+%20log(1-p)(n%20-%20%5Csum_%7Bi=1%7D%5Eny_i)%20%5C%5C%0A&amp;=%20%5Csum_%7Bi=1%7D%5Eny_i%20%5Cfrac%7Bd%7D%7Bdp%7D%20log(p)%20+%20(n%20-%20%5Csum_%7Bi=1%7D%5Eny_i)%20%5Cfrac%7Bd%7D%7Bdp%7D%20log(1-p)%20%5C%5C%0A&amp;=%20%5Csum_%7Bi=1%7D%5Eny_i%20%5Cfrac%7B1%7D%7Bp%7D%20+%20(n%20-%20%5Csum_%7Bi=1%7D%5Eny_i)%20%5Cfrac%7B1%7D%7B1-p%7D%20%5Cfrac%7Bd%7D%7Bdp%7D%20(1-p)%20%5C%5C%0A%5Cend%7Bsplit%7D%0A%5Cend%7Bequation%7D%0A"> This is where my problem was. I forgot about the <a href="https://en.wikipedia.org/wiki/Chain_rule">chain rule</a> when taking a derivative, so I wasn’t doing the additional step of taking multiplying by the derivative of <img src="https://latex.codecogs.com/png.latex?1-p">, thus things weren’t cancelling appropriately when solving for <img src="https://latex.codecogs.com/png.latex?p">. It should reduce to:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bi=1%7D%5Eny_i%20%5Cfrac%7B1%7D%7Bp%7D%20+%20(n%20-%20%5Csum_%7Bi=1%7D%5Eny_i)%20%5Cfrac%7B-1%7D%7B1-p%7D"> Finally, we just set that equal to zero:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Csum_%7Bi=1%7D%5Eny_i%20%5Cfrac%7B1%7D%7Bp%7D%20+%20(n%20-%20%5Csum_%7Bi=1%7D%5Eny_i)%20%5Cfrac%7B-1%7D%7B1-p%7D%20=%200"> After some algebra:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Chat%7Bp%7D%20=%20%5Cfrac%7B%5Csum_%7Bi=1%7D%5Eny_i%7D%7Bn%7D"></p>


<!-- -->


 ]]></description>
  <category>Estimation</category>
  <guid>https://www.zajichekstats.com/post/deriving-a-bernoulli-mle/</guid>
  <pubDate>Thu, 12 Jan 2023 06:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/deriving-a-bernoulli-mle/feature.png" medium="image" type="image/png" height="142" width="144"/>
</item>
<item>
  <title>Statistical Rethinking 2023 Class Notes</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/statistical-rethinking-2023-class-notes/</link>
  <description><![CDATA[ 




<p>This document is intended to be a repository for my (raw, unedited) notes, interpretations, examples, and summaries from the <a href="https://github.com/rmcelreath/stat_rethinking_2023">Statistical Rethinking 2023</a> course (which Richard McElreath has graciously made available for free (!) covering <a href="https://xcelab.net/rm/statistical-rethinking/">his book</a>). I’m not actually enrolled in the course, but just casually following the lectures and material. I have a strong interest in learning and incorporating Bayesian analysis and causal principles into my work, and this seemed like a great opportunity to build a foundation for that.</p>
<section id="table-of-contents" class="level1">
<h1>Table of Contents</h1>
<ol type="1">
<li>Science Before Statistics</li>
<li>Garden of Forking Data</li>
<li>Geocentric Models</li>
<li>Categories and Curves</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load some packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
</section>
<section id="lecture1" class="level1">
<h1>1. Science Before Statistics</h1>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Week #</th>
<th>Lecture #</th>
<th>Chapter(s)</th>
<th>Week End</th>
<th>Notes Taken</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>1</td>
<td>1/6/2023</td>
<td>1/3/2023</td>
</tr>
</tbody>
</table>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>This course focus is on scientific modeling via causal inference, which is focused on identifying causes in <em>observational</em> data. Causal Inference requires us to consider the mechanism of a phenomenon, and think about not only which variables cause other variables, but in what order–subject matter expertise is of utmost importance, and we don’t really depend on the data at hand until the very end of our inference process. Causal modeling must become the foundation to do analysis by–we can’t just do simple statistics in one project and then think about causal modeling in another–samples are from populations and there are causes associated with why we observed the sample we did, even if we’re answering very basic questions. Also, <em>Bayesian</em> modeling as a means to performing causal inference is not due to philosophical reasons (e.g., frequentist vs.&nbsp;Bayesian), it’s more so because a Bayesian framework provides the most natural tools to employ the specified causal model (i.e., if the frequentist model made sense for answering the causal question, we’d use it). The generative aspect of Bayesian modeling is one aspect in particular that makes it very inviting to represent the causal model in a statistical framework, and apply distributions. Finally, coding is not just a means to employ the math, but rather needs to be treated as part of the product, therefore employing software engineering principles, having documentation, making things reproducible. These things need to be employed if you really want to advance knowledge with confidence.</p>
</section>
<section id="notes" class="level2">
<h2 class="anchored" data-anchor-id="notes">Notes</h2>
<p><strong>Overview</strong></p>
<ul>
<li>Most interested in Causal Inference, focusing on the <em>science</em> before the <em>statistics</em></li>
<li>We must be able to talk about causes to obtain scientific knowledge, why else would we do it?</li>
<li>Causes can’t be extracted from data; must come from knowledge, assumptions</li>
</ul>
<p><strong>What is Causal Inference?</strong></p>
<ul>
<li>It is more than associations; associations are bi-directional, and correlation is only a basic measure of association;</li>
<li>It is all about intervention, directionality, and the <em>prediction</em> of the consequence of changing one variable on another (asking <em>what-if?</em>)</li>
</ul>
<p><strong>Causal Imputation</strong></p>
<ul>
<li>This is about being able to construct <em>counterfactual</em> outcomes</li>
<li>Asking the question, <em>what if I had done something else?</em></li>
<li>We only observe a single outcome, but we want to know what would have happened had a certain intervention not taken place</li>
</ul>
<p><strong>Directed Acyclic Graph (DAG)</strong></p>
<ul>
<li>Nothing more than an abstraction about which variables cause which other variables</li>
<li>Shows the direction at which variables cause each other, but doesn’t specify <em>how</em> (i.e., effect shapes, etc.)</li>
<li>We can use this to know which things to control for, answer hypothetical interventions, under the assumption that the model is true</li>
<li>It provides a tool to answer very specific questions (queries); not necessarily all questions lead to the same statistical model, but the appropriate statistical model can be derived from the causal model depending on the question</li>
<li><em>Intuition Pumps</em>: Gets the researcher to think about mechanism; great way to problem solve with SME’s without looking at the data (which is how it should be)</li>
</ul>
<p><strong>Golems (statistical models)</strong></p>
<ul>
<li>Metaphor for what a statistical model is; it’s a very useful machine that will do what it’s asked very well, but has no wisdom or forethought</li>
<li>Does not know the intent of the task</li>
<li>Statistical models are just objective tools, but we need causal models to know how and when certain models are actually appropriate</li>
</ul>
<p><strong>Statistical Models</strong></p>
<ul>
<li>Having a flowchart of tests is not useful, except maybe in the <em>experimental</em> setting (remember we’re talking observational data)</li>
<li>Statistical models/tests don’t make a clear relationship between the research and the data; it’s just math</li>
</ul>
<p><strong>Hypotheses &amp; Models</strong></p>
<ul>
<li>We need <em>generative</em> causal models that are guided by the DAG’s</li>
<li>We need <em>estimands</em> that are statistical models justified by the generative models (how do we quantify what we’re after?)</li>
<li>Introduce real data at the end–this is the easy part</li>
</ul>
<p><strong>Justifying Controls</strong></p>
<ul>
<li>Cannot just control for everything in your dataset like is done so much in current research (e.g., colliders have undesired effect)</li>
<li>Need the causal model (DAG) to be able to deduce what should be controlled for based on the specific question that is asked</li>
<li><em>Adjustment Set:</em> The variables determined appropriate to control for for a particular query</li>
</ul>
<p><strong>Why Bayesian?</strong></p>
<ul>
<li>Bayesian happens to be the easiest approach for generative models; it’s not because we’re stuck in a philosophical debate</li>
<li>Easiest way to take the scientific structure of the assumed model and generate it, since it naturally has <em>direction</em> (i.e., priors)</li>
<li>In most cases, Bayes can be appropriate (sometimes not–cut cake with chainsaw)
<ul>
<li>Measurement error, missing data, latent variables, regularization</li>
</ul></li>
<li>It is <em>practical</em>, not <em>philosophical</em></li>
</ul>
<p><strong>Owls</strong></p>
<ul>
<li>Classic joke: Step 1 = Draw two circles, Step 2 = draw remaining owl
<ul>
<li>Programming and technical things tend to be taught this way, but we want to avoid this and document all the intermediate steps</li>
</ul></li>
<li>We need to have an explicit workflow with clear steps</li>
<li>We need to treat coding/scripting seriously, not just a means to something (apply software engineering principles, documentation, quality control)</li>
<li>Understand what you are doing, document your work and reduce error, have a respectable scientific workflow, be professional and organized to maintain <em>reproducible</em> scientific knowledge, otherwise it’s all bullshit</li>
<li>Workflow
<ol type="1">
<li>Theoretical Estimand (what are we trying to do?)</li>
<li>Scientific (Causal) Model (DAG + Generative)</li>
<li>Use 1 &amp; 2 to build appropriate statistical model</li>
<li>Simulate from 2 to validate that 3 yields 1</li>
<li>Analyze the actual data</li>
</ol></li>
</ul>
</section>
</section>
<section id="lecture2" class="level1">
<h1>2. Garden of Forking Data</h1>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Week #</th>
<th>Lecture #</th>
<th>Chapter(s)</th>
<th>Week End</th>
<th>Notes Taken</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>2, 3</td>
<td>1/6/2023</td>
<td>1/6/2023</td>
</tr>
</tbody>
</table>
<section id="summary-1" class="level2">
<h2 class="anchored" data-anchor-id="summary-1">Summary</h2>
<p>This scientific modeling framework provides an <em>objective</em> process to incorporate <em>subjective</em> (expert, scientfic) knowledge into the modeling process, enabling us to incorporate all of the uncertainty associated with those processes, predicated on the assumption of the causal model. Further, one of the key takeaways was that <em>samples do not need to be representative of the population for us to provide good estimates</em>. This is profound because generally we are taught the opposite, but because of the process, we can explicitly account for how we know/assume the data was generated, and use that information to create a good estimate of the quantity we are interested in. This is much more <em>practical</em> than the assumptions that are made in a typical frequentist analysis–which tend to be blindly made which ironically makes them more wrong than the “subjective” information in the generative approach. We can then use sampling of our posterior distribution(s) to answer questions about what might happen if we do another experiment, etc. (e.g., what if we take 10 more samples?). Instead of relying on asymptotics for the sampling distribution of a statistic (frequentist), we can just take samples from the posterior for any complex quantity of interest and get the uncertainty surrounding that. This is especially important once we are dealing with analytically intractable posteriors that don’t have closed form solutions. Instead of needing expert-level calculus knowledge for such problem, we just have to follow the same workflow as in this basic problem. After years of frequentist modeling, that is always full of limitations and disatisfaction in the results, this approach will lead to much more rewarding scientific discovery and confidence in the conclusions of research.</p>
<section id="a-check-for-understanding" class="level3">
<h3 class="anchored" data-anchor-id="a-check-for-understanding">A check for understanding</h3>
<p>Let’s go through and reproduce some of the content/concepts from slides but using our own explanation, implementation and interpretation along the way.</p>
<section id="what-is-the-objective" class="level4">
<h4 class="anchored" data-anchor-id="what-is-the-objective">1. What is the objective?</h4>
<p>The main question asked in the demonstration was <em>what proportion of the globe is water?</em>. Thus, the quantity we are interested in is a single quantity: the <em>true</em> proportion of of the globe that is water.</p>
</section>
<section id="what-is-the-sampling-strategy" class="level4">
<h4 class="anchored" data-anchor-id="what-is-the-sampling-strategy">2. What is the sampling strategy?</h4>
<p>We want to collect data to try to answer the question of interest. This will be done by spinning the globe and dropping a pin at a random location to indicate if it is either land or water. Some initial assumptions are</p>
<ul>
<li>All points on the globe are equally-likely to be selected</li>
<li>Any given point on the globe is either land or water (only two possibilities)</li>
<li>There is no measurement error associated with indicating if the selected point was land or water</li>
</ul>
</section>
<section id="what-is-the-generative-model" class="level4">
<h4 class="anchored" data-anchor-id="what-is-the-generative-model">3. What is the generative model?</h4>
<p>We want to consider the different variables at play here as it relates to any observed sample we get as a result of the sampling strategy. First and foremost, the primary <em>unknown</em> parameter is:</p>
<p><img src="https://latex.codecogs.com/png.latex?p=%5Ctext%7Bproportion%20of%20water%20on%20the%20globe%7D"></p>
<p>The other two at play (under this simplistic model) are:</p>
<p><img src="https://latex.codecogs.com/png.latex?N=%5Ctext%7BNumber%20of%20globe%20spins%7D%20%5Chskip.5in%20W=%5Ctext%7BNumber%20of%20spins%20resulting%20in%20water%7D"> <em>Note that the number of spins resulting in land is just <img src="https://latex.codecogs.com/png.latex?N-W"></em></p>
<p>With the variables defined, the next step is determine how these variables relate to each other. We’ll use the following DAG:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  A(p) --&gt; C(W)
  B(N) --&gt; C
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>This assumes that the number of water spins observed in our sample is determined by:</p>
<ol type="1">
<li>The true proportion of water on the globe</li>
<li>The total number of spins of the globe made (samples)</li>
</ol>
</section>
<section id="what-is-the-statistical-modelestimation-procedure" class="level4">
<h4 class="anchored" data-anchor-id="what-is-the-statistical-modelestimation-procedure">4. What is the statistical model/estimation procedure?</h4>
<p>Let’s suppose we execute the sampling procedure which yields the following response vector:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">observed_sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1 = water; 0 = land</span></span>
<span id="cb3-2">W <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(observed_sample) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of water samples</span></span>
<span id="cb3-3">N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(observed_sample) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of spins</span></span>
<span id="cb3-4">W; N</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9</code></pre>
</div>
</div>
<p>We just need to <em>count</em> all of the ways that this sample could have arose across all of the different possibilities of <img src="https://latex.codecogs.com/png.latex?p">, and then estimate <img src="https://latex.codecogs.com/png.latex?p"> as that of where the sample was most likely to have occurred.</p>
<section id="basic-incorrect-solution-with-finite-possibilities" class="level5">
<h5 class="anchored" data-anchor-id="basic-incorrect-solution-with-finite-possibilities">Basic (incorrect) solution with finite possibilities</h5>
<p>We know that there are infinitely many possibilities for <img src="https://latex.codecogs.com/png.latex?p">. Let’s first go through this assuming the globe is that of a 4-sided die, such that each side is land or water, implying the only possibilities are <img src="https://latex.codecogs.com/png.latex?p%20%5Cin%20(0,.25,.50,.75,1)">. For each possible value of <img src="https://latex.codecogs.com/png.latex?p">, what is number of ways we could have observed our sequence of data? (thinking of the generative process, starting with <img src="https://latex.codecogs.com/png.latex?N"> and <img src="https://latex.codecogs.com/png.latex?p">).</p>
<p>First of all, we can set our <em>possible</em> set of parameter values, and the number of “sides” of the globe this implies (i.e., we’re saying that there are only 4 sides and each one is either Water or Land, so we have a limited number of <img src="https://latex.codecogs.com/png.latex?p"> values that could occur).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set possible values for p</span></span>
<span id="cb6-2">p <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of sides of globe</span></span>
<span id="cb6-5">sides <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(p) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span></code></pre></div>
</details>
</div>
<p>For each of the 5 possible values of <img src="https://latex.codecogs.com/png.latex?p">, how many combinations are there that produce our observed sequence of data?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of ways to observe sample for each p (this is the count of the possible sequences of indicators)</span></span>
<span id="cb7-2">ways <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> (sides<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>p)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>W <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (sides<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>p))<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>W)</span>
<span id="cb7-3">ways</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1]   0  27 512 729   0</code></pre>
</div>
</div>
<p>Now, of those possibilities, which was the most likely to occur?</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Posterior probability</span></span>
<span id="cb9-2">posterior_prob <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ways <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(ways)</span>
<span id="cb9-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(p, ways, posterior_prob)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        p ways posterior_prob
[1,] 0.00    0     0.00000000
[2,] 0.25   27     0.02129338
[3,] 0.50  512     0.40378549
[4,] 0.75  729     0.57492114
[5,] 1.00    0     0.00000000</code></pre>
</div>
</div>
<p>It looks like <img src="https://latex.codecogs.com/png.latex?p=0.75"> was the most likely value of those that are possible.</p>
<p>What is key to note about the posterior probabilities is that they are relative to the total across all values of <img src="https://latex.codecogs.com/png.latex?p">. We simply found all of the raw counts associated with each <img src="https://latex.codecogs.com/png.latex?p"> and then normalized them by the total to get the posterior probability. But this process was <em>exactly</em> the same thing as finding the <em>likelihood</em> of the data:</p>
<p><img src="https://latex.codecogs.com/png.latex?Likelihood%20=%20%5Cprod_%7Bi=1%7D%5ENP(X=x%7Cp)"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?X"> is the binary indicator from a single globe spin.</p>
<p>If we just look at all the <em>possible</em> sequences of indicators that could have occurred:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Total possible sequences of indicators (each one could be a 1 or a 0)</span></span>
<span id="cb11-2">total_possible_sequences <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> sides<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>N</span>
<span id="cb11-3">total_possible_sequences</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 262144</code></pre>
</div>
</div>
<p>And then divide our original combination counts by that, we’ll get <em>exactly</em> the likelihood of the data:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Divide the total number of combinations we could have saw our sample, by the total number of possibilities</span></span>
<span id="cb13-2">likelihood <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> ways <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> total_possible_sequences</span>
<span id="cb13-3">likelihood</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0000000000 0.0001029968 0.0019531250 0.0027809143 0.0000000000</code></pre>
</div>
</div>
<p>However, as stated above, this will <em>not</em> change the resulting posterior distribution because the number we divided by was just a normalizing constant:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">likelihood <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(likelihood)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.00000000 0.02129338 0.40378549 0.57492114 0.00000000</code></pre>
</div>
</div>
<p>So, we could also think of this problem in a different light (although it’s the SAME) and get the same result:</p>
<ol type="1">
<li>We could think of each observed value as an (unfair) coin flip (according to the value of <img src="https://latex.codecogs.com/png.latex?p">) and calculate the likelihood of the sequence of flips (which is actually what we already did, but this is more of the “traditional” way to think about it):</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Likelihood of sequence of observed sample</span></span>
<span id="cb17-2">likelihood2 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>W <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>p)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>W)</span>
<span id="cb17-3">likelihood</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0000000000 0.0001029968 0.0019531250 0.0027809143 0.0000000000</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute posterior</span></span>
<span id="cb19-2">likelihood2 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(likelihood2) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Same as before</span></span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.00000000 0.02129338 0.40378549 0.57492114 0.00000000</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>We could also think of this as finding the likelihood of observing the <em>total</em> number of water spins since each flip is <em>independent</em>. This is also the same as before, except we’re accounting for all of the combinations to observe the total number of water flips, not just the particular sequence:</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make the normalizing constant</span></span>
<span id="cb21-2">normalizing_constant <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factorial</span>(N) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factorial</span>(W)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factorial</span>(N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>W))</span>
<span id="cb21-3"></span>
<span id="cb21-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Multiply the likelihood by the normalizing constant by the likelihood to get the true probability of the observed sample for each value of p</span></span>
<span id="cb21-5">probability <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> normalizing_constant <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> likelihood</span>
<span id="cb21-6">probability</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.000000000 0.008651733 0.164062500 0.233596802 0.000000000</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the posterior</span></span>
<span id="cb23-2">probability <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(probability)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.00000000 0.02129338 0.40378549 0.57492114 0.00000000</code></pre>
</div>
</div>
<p>Note that the normalizing constant had no effect on the posterior, but it did calculate the correct probabilities of the observed sample. In fact, this was just a Binomial distribution:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># What is the probability of observing W water values in a sample of N globe spins for each p?</span></span>
<span id="cb25-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> W, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> N, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> p)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.000000000 0.008651733 0.164062500 0.233596802 0.000000000</code></pre>
</div>
</div>
<p>That is, the probability distribution for the number of water samples is:</p>
<p><img src="https://latex.codecogs.com/png.latex?W%7Cp%20%5Csim%20Binomial(N,%20p)"> <img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%5Cbegin%7Bsplit%7D%0AP(W%7Cp)%0A&amp;=%20%5Cbinom%7BN%7D%7BW%7Dp%5EW(1-p)%5E%7BN-W%7D%20%5C%5C%0A&amp;=%20%5Cfrac%7BN!%7D%7BW!(N-W)!%7Dp%5EW(1-p)%5E%7B(N-W)%7D%20%5C%5C%0A%5Cend%7Bsplit%7D%0A%5Cend%7Bequation%7D%0A"></p>
<p>So what is going on here? We are after the distribution of probability weights associated with each possible value of <img src="https://latex.codecogs.com/png.latex?p"> (which is what the posterior distribution is). In mathematical notation, we’re just applying Bayes’ formula:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%5Cbegin%7Bsplit%7D%0AP(p%7Csample)%0A&amp;%20=%20%5Cfrac%7BP(p)P(sample%7Cp)%7D%7BP(sample)%7D%20%5C%5C%0A&amp;%20=%20%5Cfrac%7BP(p)P(W%7Cp)%7D%7BP(W)%7D%20%5C%5C%0A&amp;%20=%20%5Cfrac%7BP(p)P(W%7Cp)%7D%7BP(W%20%5Ccap%20p%20=%200)%20+%20...%20+%20P(W%20%5Ccap%20p%20=%201)%7D%20%5C%5C%0A&amp;%20=%20%5Cfrac%7BP(p)P(W%7Cp)%7D%7BP(p=0)P(W%7Cp=0)%20+%20...%20+%20P(p=1)P(W%7Cp=1)%7D%20%5C%5C%0A%5Cend%7Bsplit%7D%0A%5Cend%7Bequation%7D%0A"> Each value of <img src="https://latex.codecogs.com/png.latex?p"> is equally-likely to occur (<em>uniform prior</em>), so we can factor out that term:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%5Cbegin%7Bsplit%7D%0A%5Ctext%7B(from%20previous)%7D%0A&amp;%20=%20%5Cfrac%7BP(W%7Cp)%7D%7BP(W%7Cp=0)%20+%20...%20+%20P(W%7Cp=1)%7D%20%5C%5C%0A(binomials)%20&amp;=%20%5Cfrac%7B%5Cbinom%7BN%7D%7BW%7Dp%5EW(1-p)%5E%7B(N-W)%7D%7D%7B%5Cbinom%7BN%7D%7BW%7D0%5EW(1-0)%5E%7B(N-W)%7D%20+%20...%20+%20%5Cbinom%7BN%7D%7BW%7D1%5EW(1-1)%5E%7B(N-W)%7D%7D%20%5C%5C%0A&amp;%20=%20%5Cfrac%7Bp%5EW(1-p)%5E%7B(N-W)%7D%7D%7B0%5EW(1-0)%5E%7B(N-W)%7D%20+%20...%20+%201%5EW(1-1)%5E%7B(N-W)%7D%7D%20%5C%5C%0A&amp;%20=%20%5Cfrac%7Bp%5EW(1-p)%5E%7B(N-W)%7D%7D%7B%5Ctext%7BNormalizing%20constant%7D%7D%20%5C%5C%0A%5Cend%7Bsplit%7D%0A%5Cend%7Bequation%7D%0A"> As you can see, the combination term also factors out, and the basic structure we’re left with is the <em>likelihood</em> piece that was found in <em>all three (3)</em> variations above: <img src="https://latex.codecogs.com/png.latex?p%5EW(1-p)%5E%7B(N-W)%7D">. So when computing the posterior probability, they are relative to only terms dependent on the parameter of interest, so doesn’t matter if we use the counts, base likelihood, or the probability distribution–they are all the SAME. The counting process and the “forking data” approach is simply a means to breakdown the process of what’s happening behind the scenes in the math, so instead of just saying “do this integral” or “compute this product of the likelihood”, you’re picking apart each step of that process to gain intuition about what is happening. I’d imagine this is exactly the point of the Owl reference in the prior lecture.</p>
</section>
<section id="full-solution-p-is-a-continuous-value" class="level5">
<h5 class="anchored" data-anchor-id="full-solution-p-is-a-continuous-value">Full solution: <em>p</em> is a continuous value</h5>
<p>As mentioned before, the actual proportion of water on the globe can be any number between zero and one (<img src="https://latex.codecogs.com/png.latex?p%20%5Cin%20%5B0,1%5D">), meaning that there are “infinite” sides to the globe. The derivation at the end of the previous section illustrates that the posterior distribution for <img src="https://latex.codecogs.com/png.latex?p"> not restricted to any particular set of values. If we pick up where we left off:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%5Cbegin%7Bsplit%7D%0AP(p%7Cdata)%0A&amp;%20=%20%5Cfrac%7Bp%5EW(1-p)%5E%7B(N-W)%7D%7D%7B%5Ctext%7BNormalizing%20constant%7D%7D%20%5C%5C%0A%5Cend%7Bsplit%7D%0A%5Cend%7Bequation%7D%0A"> All we would need to do for the continuous version of <img src="https://latex.codecogs.com/png.latex?p"> to make the posterior a formal probability distribution is to find the normalizing constant such that the integral over all possible values of <img src="https://latex.codecogs.com/png.latex?p"> equals 1. Formally, with respect to <img src="https://latex.codecogs.com/png.latex?p">,</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cint_0%5E1%20%5Cfrac%7Bp%5EW(1-p)%5E%7BN-W%7D%7D%7BConstant%7D%20=%201"> This will ensure that the probabilities across all possible values of <img src="https://latex.codecogs.com/png.latex?p"> sums to one. However, it doesn’t actually matter that we find that constant necessarily, because the posterior probability is just <em>relative</em> to the range of values of <img src="https://latex.codecogs.com/png.latex?p">. So all that really matters is:</p>
<p><img src="https://latex.codecogs.com/png.latex?P(p%7Cdata)%20%5Cpropto%20p%5EW(1-p)%5E%7BN-W%7D"> We can then plug in our data and graph the resulting distribution to make inferences about <img src="https://latex.codecogs.com/png.latex?p">.</p>
<p><img src="https://latex.codecogs.com/png.latex?P(p%7Cdata)%20%5Cpropto%20p%5E6(1-p)%5E3"></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb27-2">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">01</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Approximate the range of p values</span></span>
<span id="cb27-3">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">posterior =</span> p<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>W<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>p)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(N<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>W) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the posterior</span></span>
<span id="cb27-4">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb27-5">  </span>
<span id="cb27-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb27-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(</span>
<span id="cb27-9">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb27-10">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> p,</span>
<span id="cb27-11">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> posterior</span>
<span id="cb27-12">    )</span>
<span id="cb27-13">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb27-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb27-15">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb27-16">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb27-17">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/statistical-rethinking-2023-class-notes/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>After using our sample of 9, the probability weight for <img src="https://latex.codecogs.com/png.latex?p"> tends to focus near 0.70. Note that the scale of the y-axis was removed to emphasize that it doesn’t really matter what it is. We would just need to be able to calculate the area under the curve to be able to assign real probabilities to questions like <em>“what is the probability that the proportion of water is less than 0.5?”</em>.</p>
<p><em>Note: In some cases, if we used used a different priors on <img src="https://latex.codecogs.com/png.latex?p"> (e.g., Beta), the posterior will turn out to be an identifiable distribution which we know the normalizing constant.</em></p>
</section>
<section id="updating-the-posterior" class="level5">
<h5 class="anchored" data-anchor-id="updating-the-posterior">Updating the posterior</h5>
<p>So when we talk “Bayesian updates” or updating the posterior distribution, what does this mean? Since the point of it is to be able to update a model with new information, my gut used to tell me that we were somehow adding our current knowledge about the parameter into the new <em>prior</em> distribution, and then updating the new posterior with an updated prior and only using new data in the likelihood. While in a way this might be the right way to think about it (i.e., if I have a posterior right now, isn’t that the most current knowledge about the parameter, so if I want to collect more data, wouldn’t I want to use knowledge up to this point as the prior instead of reverting back to the original prior and just adding more data to the collective sample?), in these examples we were doing something different: we’re just seeing how the posterior changes as more data is added to the sample (i.e., observed sequence of data points).</p>
<p>Let’s start with just focusing on the basic example (i.e., 4 sided-globe) for now. We just need to loop through the observed sample, and calculate the posterior probabilities for each value of <img src="https://latex.codecogs.com/png.latex?p"> as a new observation comes in:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the prior probability (uniform over the possibly choices)</span></span>
<span id="cb28-2">prior <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(p), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(p))</span>
<span id="cb28-3"></span>
<span id="cb28-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the current posterior as the prior (before any data collected)</span></span>
<span id="cb28-5">last_posterior <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> prior</span>
<span id="cb28-6"></span>
<span id="cb28-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make result set</span></span>
<span id="cb28-8">results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>()</span>
<span id="cb28-9"></span>
<span id="cb28-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For each value in the observed sample </span></span>
<span id="cb28-11"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>N) {</span>
<span id="cb28-12">  </span>
<span id="cb28-13">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Get the sub-sample</span></span>
<span id="cb28-14">  sub_sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> observed_sample[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>i]</span>
<span id="cb28-15">  </span>
<span id="cb28-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Compute metrics (the number of water samples, and the total number of spins)</span></span>
<span id="cb28-17">  W_temp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(sub_sample)</span>
<span id="cb28-18">  N_temp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sub_sample)</span>
<span id="cb28-19">  </span>
<span id="cb28-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Compute the likelihood for each p</span></span>
<span id="cb28-21">  temp_likelihood <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>W_temp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(N_temp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> W_temp)</span>
<span id="cb28-22">  </span>
<span id="cb28-23">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. Posterior</span></span>
<span id="cb28-24">  temp_posterior <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> temp_likelihood <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(temp_likelihood)</span>
<span id="cb28-25">  </span>
<span id="cb28-26">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5. Add to results</span></span>
<span id="cb28-27">  results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb28-28">    results <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-29">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(</span>
<span id="cb28-30">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb28-31">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sample =</span> i,</span>
<span id="cb28-32">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sequence =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(sub_sample, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>),</span>
<span id="cb28-33">        p,</span>
<span id="cb28-34">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">likelihood =</span> temp_likelihood,</span>
<span id="cb28-35">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">current =</span> temp_posterior,</span>
<span id="cb28-36">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">last =</span> last_posterior</span>
<span id="cb28-37">      )</span>
<span id="cb28-38">    )</span>
<span id="cb28-39">  </span>
<span id="cb28-40">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the new last posterior</span></span>
<span id="cb28-41">  last_posterior <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> temp_posterior</span>
<span id="cb28-42"></span>
<span id="cb28-43">}</span>
<span id="cb28-44"></span>
<span id="cb28-45">results <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-46">  </span>
<span id="cb28-47">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send down the rows</span></span>
<span id="cb28-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb28-49">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(last, current)</span>
<span id="cb28-50">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb28-51">  </span>
<span id="cb28-52">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb28-53">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-54">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(</span>
<span id="cb28-55">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb28-56">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(p),</span>
<span id="cb28-57">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value,</span>
<span id="cb28-58">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> name</span>
<span id="cb28-59">    ),</span>
<span id="cb28-60">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb28-61">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span>,</span>
<span id="cb28-62">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">25</span>,</span>
<span id="cb28-63">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span></span>
<span id="cb28-64">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-65">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(</span>
<span id="cb28-66">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spin: "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(sample), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Sample: "</span>, sequence)</span>
<span id="cb28-67">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-68">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb28-69">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>,</span>
<span id="cb28-70">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb28-71">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>)</span>
<span id="cb28-72">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-73">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-74">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior Probability"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-75">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb28-76">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior"</span></span>
<span id="cb28-77">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb28-78">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(</span>
<span id="cb28-79">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgray"</span>)</span>
<span id="cb28-80">  ) </span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/statistical-rethinking-2023-class-notes/index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The blue bars show the posterior probability for each possible value of <img src="https://latex.codecogs.com/png.latex?p"> <em>after</em> the newest observation was made, and the gray bars show it <em>before</em> the newest observation was made. This illustrates the incremental impact of adding more data to the sample on the resulting posterior distribution.</p>
<p>We can apply this same process to the <em>continuous</em> (correct) possible set of values for <img src="https://latex.codecogs.com/png.latex?p"> (in fact, we’ll create the curves by performing the exact same procedure to a larger, discrete set of values but make the display appear continuous):</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Approximate the set of inifinite p-values by a large set of discrete ones</span></span>
<span id="cb29-2">p_continuous <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">01</span>)</span>
<span id="cb29-3"></span>
<span id="cb29-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the prior probability (uniform over the possibly choices)</span></span>
<span id="cb29-5">prior <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(p_continuous), <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(p_continuous))</span>
<span id="cb29-6"></span>
<span id="cb29-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the current posterior as the prior (before any data collected)</span></span>
<span id="cb29-8">last_posterior <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> prior</span>
<span id="cb29-9"></span>
<span id="cb29-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make result set</span></span>
<span id="cb29-11">results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>()</span>
<span id="cb29-12"></span>
<span id="cb29-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For each value in the observed sample </span></span>
<span id="cb29-14"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span>(i <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>N) {</span>
<span id="cb29-15">  </span>
<span id="cb29-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Get the sub-sample</span></span>
<span id="cb29-17">  sub_sample <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> observed_sample[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>i]</span>
<span id="cb29-18">  </span>
<span id="cb29-19">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Compute metrics (the number of water samples, and the total number of spins)</span></span>
<span id="cb29-20">  W_temp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(sub_sample)</span>
<span id="cb29-21">  N_temp <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(sub_sample)</span>
<span id="cb29-22">  </span>
<span id="cb29-23">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Compute the likelihood for each p</span></span>
<span id="cb29-24">  temp_likelihood <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> p_continuous<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>W_temp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> p_continuous)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(N_temp <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> W_temp)</span>
<span id="cb29-25">  </span>
<span id="cb29-26">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. Posterior</span></span>
<span id="cb29-27">  temp_posterior <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> temp_likelihood <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(temp_likelihood)</span>
<span id="cb29-28">  </span>
<span id="cb29-29">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 5. Add to results</span></span>
<span id="cb29-30">  results <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb29-31">    results <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb29-32">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">bind_rows</span>(</span>
<span id="cb29-33">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb29-34">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sample =</span> i,</span>
<span id="cb29-35">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sequence =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste</span>(sub_sample, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">collapse =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>),</span>
<span id="cb29-36">        p_continuous,</span>
<span id="cb29-37">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">likelihood =</span> temp_likelihood,</span>
<span id="cb29-38">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">current =</span> temp_posterior,</span>
<span id="cb29-39">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">last =</span> last_posterior</span>
<span id="cb29-40">      )</span>
<span id="cb29-41">    )</span>
<span id="cb29-42">  </span>
<span id="cb29-43">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set the new last posterior</span></span>
<span id="cb29-44">  last_posterior <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> temp_posterior</span>
<span id="cb29-45">  </span>
<span id="cb29-46">}</span>
<span id="cb29-47"></span>
<span id="cb29-48">results <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb29-49">  </span>
<span id="cb29-50">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Send down the rows</span></span>
<span id="cb29-51">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb29-52">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(last, current)</span>
<span id="cb29-53">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb29-54">  </span>
<span id="cb29-55">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb29-56">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-57">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_area</span>(</span>
<span id="cb29-58">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb29-59">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> p_continuous,</span>
<span id="cb29-60">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value,</span>
<span id="cb29-61">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> name</span>
<span id="cb29-62">    ),</span>
<span id="cb29-63">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>,</span>
<span id="cb29-64">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">65</span>,</span>
<span id="cb29-65">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"identity"</span></span>
<span id="cb29-66">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-67">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">facet_wrap</span>(</span>
<span id="cb29-68">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Spin: "</span>, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(sample), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\n</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">Sample: "</span>, sequence)</span>
<span id="cb29-69">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-70">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb29-71">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>,</span>
<span id="cb29-72">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.background =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb29-73">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gray"</span>),</span>
<span id="cb29-74">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb29-75">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb29-76">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-77">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-78">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior Probability"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-79">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb29-80">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior"</span></span>
<span id="cb29-81">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb29-82">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(</span>
<span id="cb29-83">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blue"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"darkgray"</span>)</span>
<span id="cb29-84">  ) </span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/statistical-rethinking-2023-class-notes/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Again, these curves are actually approximated here. In practice, we would need to calculate the area underneath the curve to get exact answers about probabilities. <em>Note: We could parameterize the Beta distribution to get the normalizing constant for calculating the actual posterior probabilities that fits this distribution.</em></p>
</section>
</section>
</section>
</section>
<section id="homework" class="level2">
<h2 class="anchored" data-anchor-id="homework">Homework</h2>
<ol type="1">
<li>Suppose the globe tossing data had turned out to be 4 water and 11 land. Construct the posterior distribution.</li>
</ol>
<p>We’ll cheat a little bit and use the approach of using a large, discrete list of possible values for <img src="https://latex.codecogs.com/png.latex?p">, and plot it as if it is continuous (we could also just use the Beta distribution). With that, all we need to do is change the values of <img src="https://latex.codecogs.com/png.latex?W"> and <img src="https://latex.codecogs.com/png.latex?N"> and use the same code as above.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1">W_new <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb30-2">N_new <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span></span>
<span id="cb30-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb30-4">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">01</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Approximate the range of p values</span></span>
<span id="cb30-5">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">posterior =</span> p<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>W_new<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>p)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">^</span>(N_new<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>W_new) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the posterior</span></span>
<span id="cb30-6">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb30-7">  </span>
<span id="cb30-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb30-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-10">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(</span>
<span id="cb30-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb30-12">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> p,</span>
<span id="cb30-13">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> posterior</span>
<span id="cb30-14">    )</span>
<span id="cb30-15">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb30-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb30-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb30-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb30-19">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/statistical-rethinking-2023-class-notes/index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li>Using the posterior distribution from (1), compute the posterior predictive distribution for the next 5 tosses of the same globe.</li>
</ol>
<p>Okay here I’ll finally acknowledge that the posterior can be written as a <a href="https://en.wikipedia.org/wiki/Beta_distribution">Beta</a> distribution, which gives us the normalizing constant needed to make it a real probability distribution (i.e., the area sums to 1). It has the following <em>probability density function (PDF)</em>:</p>
<p><img src="https://latex.codecogs.com/png.latex?f(x%7C%5Calpha,%20%5Cbeta)%20=%20%5Cfrac%7B%5CGamma(%5Calpha+%5Cbeta)%7D%7B%5CGamma(%5Calpha)%5CGamma(%5Cbeta)%7Dx%5E%7B%5Calpha-1%7D(1-x)%5E%7B%5Cbeta-1%7D"> where <img src="https://latex.codecogs.com/png.latex?x%20%5Cin%20%5B0,1%5D">, <img src="https://latex.codecogs.com/png.latex?%5Calpha,%20%5Cbeta%20%3E%200">, and <img src="https://latex.codecogs.com/png.latex?%5CGamma(n)%20=%20(n-1)!">. If we make the following reparameterizations from our set of variables:</p>
<p><img src="https://latex.codecogs.com/png.latex?p=x"> <img src="https://latex.codecogs.com/png.latex?W%20=%20%5Calpha%20-%201"> <img src="https://latex.codecogs.com/png.latex?N-W%20=%20%5Cbeta%20-%201"> we get:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%5Cbegin%7Bsplit%7D%0Af(p%7CW,N)%0A&amp;%20=%20%5Cfrac%7B%5CGamma(W+1+N-W+1)%7D%7B%5CGamma(W+1)%5CGamma(N-W+1)%7Dp%5EW(1-p)%5E%7BN-W%7D%20%5C%5C%0A&amp;%20=%20%5Cfrac%7B%5CGamma(N+2)%7D%7B%5CGamma(W+1)%5CGamma(N-W+1)%7Dp%5EW(1-p)%5E%7BN-W%7D%20%5C%5C%0A&amp;%20=%20%5Cfrac%7B(N+1)!%7D%7BW!(N-W)!%7Dp%5EW(1-p)%5E%7BN-W%7D%20%5C%5C%0A%5Cend%7Bsplit%7D%0A%5Cend%7Bequation%7D%0A"></p>
<p><em>Note that since <img src="https://latex.codecogs.com/png.latex?p"> is continuous, this function represents the probability density at any particular value of <img src="https://latex.codecogs.com/png.latex?p">. To get any positive probability, we must integrate this function over a range of <img src="https://latex.codecogs.com/png.latex?p"> values. Hence the <img src="https://latex.codecogs.com/png.latex?f"> notation.</em></p>
<p>Let’s quickly plug in <img src="https://latex.codecogs.com/png.latex?W=4"> and <img src="https://latex.codecogs.com/png.latex?N=15"> to confirm (at least visually) that this function produces the same posterior we made to answer the last question. We’ll do this by evaluating the density of the derived Beta distribution at range of possible <img src="https://latex.codecogs.com/png.latex?p"> values. <em>Note we’ll have to use the parameterizations for the Beta distribution that are built into <code>R</code></em>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Reparameterize</span></span>
<span id="cb31-2">alpha <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> W_new <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb31-3">beta <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> N_new <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> W_new <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb31-4"></span>
<span id="cb31-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a data frame</span></span>
<span id="cb31-6"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb31-7">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">01</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Approximate the range of p values (same as before)</span></span>
<span id="cb31-8">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">posterior =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbeta</span>(p, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape1 =</span> alpha, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape2 =</span> beta) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the actual posterior density</span></span>
<span id="cb31-9">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb31-10">  </span>
<span id="cb31-11">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb31-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb31-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(</span>
<span id="cb31-14">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb31-15">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> p,</span>
<span id="cb31-16">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> posterior</span>
<span id="cb31-17">    )</span>
<span id="cb31-18">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/statistical-rethinking-2023-class-notes/index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From inspection, it appears that they are essentially the same curves. <em>Note that this time I kept the y-axis labels because this is the density for the actual probability distribution</em>.</p>
<p>So back to the question: how do we find the posterior predictive distribution for the next 5 globe spins? Well, if the globe is spun 5 more times, then we can get water on 0, 1, 2, 3, 4, or all 5 spins. Our quest is to figure out the likelihood of each of those possible outcomes based on what we currently know about <img src="https://latex.codecogs.com/png.latex?p"> (i.e., the posterior distribution). To do this, we’ll use our posterior distribution to run a simulation of the experiment using the following steps:</p>
<ol type="i">
<li>Select a random value of <img src="https://latex.codecogs.com/png.latex?p"> from the posterior</li>
<li>Draw a random <img src="https://latex.codecogs.com/png.latex?binomial"> realization where <img src="https://latex.codecogs.com/png.latex?N=5"></li>
<li>Repeat steps i-ii 10000 times</li>
<li>Graph the results</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set some parameters</span></span>
<span id="cb32-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb32-3">n_experiment <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of new spins we're going to conduct</span></span>
<span id="cb32-4">s <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10000</span> <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of simulations</span></span>
<span id="cb32-5"></span>
<span id="cb32-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Draw random values of p from the posterior</span></span>
<span id="cb32-7">p_rand <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbeta</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> s, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape1 =</span> alpha, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape2 =</span> beta) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Same parameters as before</span></span>
<span id="cb32-8"></span>
<span id="cb32-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. For each p, run a binomial experiment (represents samples of W)</span></span>
<span id="cb32-10">w_rand <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> s, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> n_experiment, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> p_rand)</span>
<span id="cb32-11"></span>
<span id="cb32-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a data frame</span></span>
<span id="cb32-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb32-14">  <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">w =</span> w_rand</span>
<span id="cb32-15">) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-16">  </span>
<span id="cb32-17">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For each w</span></span>
<span id="cb32-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(w) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-19">  </span>
<span id="cb32-20">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the total</span></span>
<span id="cb32-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(</span>
<span id="cb32-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">count =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">n</span>()</span>
<span id="cb32-23">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-24">  </span>
<span id="cb32-25">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add proportion</span></span>
<span id="cb32-26">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb32-27">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">proportion =</span> count <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(count)</span>
<span id="cb32-28">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb32-29">  </span>
<span id="cb32-30">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb32-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb32-32">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb32-33">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(w)</span>
<span id="cb32-34">    )</span>
<span id="cb32-35">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(</span>
<span id="cb32-37">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb32-38">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> proportion</span>
<span id="cb32-39">    )</span>
<span id="cb32-40">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-41">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(</span>
<span id="cb32-42">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb32-43">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> proportion,</span>
<span id="cb32-44">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(proportion<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%"</span>)</span>
<span id="cb32-45">    ),</span>
<span id="cb32-46">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb32-47">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-48">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(</span>
<span id="cb32-49">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>percent</span>
<span id="cb32-50">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-51">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"W"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-52">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Probability"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb32-53">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb32-54">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior Predictive Distribution for "</span>, n_experiment, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" more spins."</span>)</span>
<span id="cb32-55">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/statistical-rethinking-2023-class-notes/index_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Another way to think about what we’re doing here is:</p>
<ol type="i">
<li>Find the collection of <em>density</em> values for all <img src="https://latex.codecogs.com/png.latex?p"> in the posterior distribution</li>
<li>Find the probability distribution of the possible outcomes from a Binomial distribution where <img src="https://latex.codecogs.com/png.latex?N=5"> for all possible values of <img src="https://latex.codecogs.com/png.latex?p"> (i.e., independent of our posterior)</li>
<li>Take the average probability value for each possible outcome in (ii) over all values of <img src="https://latex.codecogs.com/png.latex?p">, <em>weighted</em> by the posterior density in (i)</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a set of p representive of its domain</span></span>
<span id="cb33-2">p_alt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">seq</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">001</span>) <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Supposed to represent continuous p</span></span>
<span id="cb33-3"></span>
<span id="cb33-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Posterior density values for each p</span></span>
<span id="cb33-5">posterior_alt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbeta</span>(p_alt, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape1 =</span> alpha, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">shape2 =</span> beta)</span>
<span id="cb33-6"></span>
<span id="cb33-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Probability distribution for each outcome for each p</span></span>
<span id="cb33-8">possible_outcomes <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>n_experiment</span>
<span id="cb33-9">likelihood_alt <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb33-10">  possible_outcomes <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> </span>
<span id="cb33-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">map_df</span>(</span>
<span id="cb33-12">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span></span>
<span id="cb33-13">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb33-14">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">binomial_probability =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">dbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> .x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> n_experiment, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> p_alt),</span>
<span id="cb33-15">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> p_alt,</span>
<span id="cb33-16">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">outcome =</span> .x</span>
<span id="cb33-17">      )</span>
<span id="cb33-18">  )</span>
<span id="cb33-19"></span>
<span id="cb33-20"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Get the posterior predictive distribution</span></span>
<span id="cb33-21">posterior_predictive_distribution <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb33-22">  likelihood_alt <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-23">  </span>
<span id="cb33-24">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Join to attach the posterior density weight to each value of p</span></span>
<span id="cb33-25">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">inner_join</span>(</span>
<span id="cb33-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> </span>
<span id="cb33-27">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(</span>
<span id="cb33-28">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> p_alt,</span>
<span id="cb33-29">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">posterior_density =</span> posterior_alt</span>
<span id="cb33-30">      ),</span>
<span id="cb33-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">by =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"p"</span></span>
<span id="cb33-32">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-33">  </span>
<span id="cb33-34">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For each possible outcome</span></span>
<span id="cb33-35">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(outcome) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-36">  </span>
<span id="cb33-37">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the weighted-average probability</span></span>
<span id="cb33-38">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(</span>
<span id="cb33-39">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">posterior_probability =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(binomial_probability <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> posterior_density) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sum</span>(posterior_density)</span>
<span id="cb33-40">  )</span>
<span id="cb33-41"></span>
<span id="cb33-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 4. Make a plot</span></span>
<span id="cb33-43">posterior_predictive_distribution <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb33-44">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(</span>
<span id="cb33-45">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb33-46">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(outcome)</span>
<span id="cb33-47">    )</span>
<span id="cb33-48">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-49">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(</span>
<span id="cb33-50">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb33-51">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> posterior_probability</span>
<span id="cb33-52">    )</span>
<span id="cb33-53">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-54">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_text</span>(</span>
<span id="cb33-55">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb33-56">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> posterior_probability,</span>
<span id="cb33-57">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(posterior_probability<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>), <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"%"</span>)</span>
<span id="cb33-58">    ),</span>
<span id="cb33-59">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">vjust =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb33-60">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-61">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_y_continuous</span>(</span>
<span id="cb33-62">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>percent</span>
<span id="cb33-63">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-64">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"W"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-65">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ylab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Probability"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb33-66">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb33-67">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Posterior Predictive Distribution for "</span>, n_experiment, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" more spins."</span>)</span>
<span id="cb33-68">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/statistical-rethinking-2023-class-notes/index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The distributions from the two approaches are merely identical (slight differences due to simulation variability and inexact integration).</p>
<ol start="3" type="1">
<li>Use the posterior predictive distribution from (2) to calculate the probability of 3 or more water samples in the next 5 tosses.</li>
</ol>
<p>Using the posterior predictive distribution above, we can look at the percent of simulations that resulted in 3 or more water samples:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mean</span>(w_rand <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1771</code></pre>
</div>
</div>
<p>So there is a 0.177 probability of 3 or more water samples in the next 5 tosses. However, this point estimate is not totally sufficient because we haven’t reported any uncertainty associated with it. Since we know that <img src="https://latex.codecogs.com/png.latex?W%7Cp%20%5Csim%20Binomial(n,p)">, the <img src="https://latex.codecogs.com/png.latex?P(W%3E=3%7Cp,N)"> is already determined. In this case, we can just calculate it for each random value of <img src="https://latex.codecogs.com/png.latex?p"> sampled from the posterior:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Compute the binomial probability</span></span>
<span id="cb36-2">prob_binom <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pbinom</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">q =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> n_experiment, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> p_rand)</span>
<span id="cb36-3"></span>
<span id="cb36-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a plot</span></span>
<span id="cb36-5"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_density</span>(</span>
<span id="cb36-7">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(</span>
<span id="cb36-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> prob_binom</span>
<span id="cb36-9">    )</span>
<span id="cb36-10">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb36-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb36-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>()</span>
<span id="cb36-14">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb36-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">xlab</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"P(W&gt;=3|N=5)"</span>) </span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/statistical-rethinking-2023-class-notes/index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This one has been stumping me a bit, and I’m not totally confident this is the correct result. Another way I was thinking about it was similar the alternative in (2), namely that we are finding the <img src="https://latex.codecogs.com/png.latex?P(W%3E=3%7CN=5)"> for each value of <img src="https://latex.codecogs.com/png.latex?p">, and then weighting that by the posterior density of <img src="https://latex.codecogs.com/png.latex?p">. However, it seems like we should be sampling from the predictive distribution in (2) somehow, but if we do that it seems like the precision of our estimates would then just be determined by the number of simulations we run, not the data, which also doesn’t make sense.</p>
</section>
<section id="notes-1" class="level2">
<h2 class="anchored" data-anchor-id="notes-1">Notes</h2>
<p><strong>Goal: Estimate the percent of the globe that is covered in water</strong></p>
<ul>
<li>Think of spinning the globe and stopping on a point and repeating many times</li>
<li>How do we use that collection of points to come up with an estimate? That’s the goal of today’s lecture</li>
<li>First thought is just indicate each time whether land or water appear as the point; however, how does the shape of the globe impact the likelihood that I will come up with land or water on a “random” toss? Has to do with sampling strategy</li>
</ul>
<ol type="1">
<li>Define a generative model</li>
</ol>
<ul>
<li>Think conceptually about scientifically how the sample was produced (how do variables influence one another)</li>
<li>Variables: Things we <em>want</em> to observe/estimate or things we actually do observe</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbf%7Bp%7D%20=%20%5Ctext%7Bproportion%20of%20water%7D%5Chskip.5inW=%5Ctext%7Bwater%20observations%7D"> <img src="https://latex.codecogs.com/png.latex?N%20=%20%5Ctext%7Bnumber%20of%20tosses%7D%5Chskip.5inL=%5Ctext%7Bland%20observations%7D"></p>
<ol start="2" type="1">
<li>Define a specific estimand</li>
</ol>
<p>Were interested in the true proportion of water <strong>p</strong></p>
<ol start="3" type="1">
<li>Design a statistical way to produce estimate</li>
</ol>
<ul>
<li>How are these related to each other?
<ul>
<li>N influences W and L (the more tosses leads to change on other variables)</li>
<li>p also influences W and L (i.e., the true proportion dictates the number of water observations and land observations)</li>
<li>The DAG shows relationships, but not what the relationships <em>are</em>. We can say <img src="https://latex.codecogs.com/png.latex?W,L=f(p,N)">; what is <img src="https://latex.codecogs.com/png.latex?f">?</li>
</ul></li>
<li>Assume a model (e.g., <img src="https://latex.codecogs.com/png.latex?p"> = .25, then count likely the sample was under that model, do that for all possible models)</li>
</ul>
<ol start="4" type="1">
<li>Test (3) using (1)</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1">sim_globe <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb37-2">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>) {</span>
<span id="cb37-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sample</span>(</span>
<span id="cb37-4">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"W"</span>,<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"L"</span>), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Possible observations</span></span>
<span id="cb37-5">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> N, <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Number of tosses</span></span>
<span id="cb37-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prob =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(p, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span>p), <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># The probability of each possible observation</span></span>
<span id="cb37-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb37-8">  }</span>
<span id="cb37-9"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sim_globe</span>()</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "W" "W" "W" "W" "W" "W" "W" "W" "W"</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">replicate</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sim_globe</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">p =</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">N=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
 [1,] "W"  "L"  "W"  "W"  "L"  "W"  "L"  "W"  "L"  "W"  
 [2,] "L"  "L"  "L"  "W"  "L"  "L"  "W"  "L"  "L"  "W"  
 [3,] "L"  "L"  "W"  "W"  "W"  "W"  "W"  "W"  "W"  "W"  
 [4,] "W"  "W"  "W"  "L"  "W"  "L"  "L"  "W"  "W"  "W"  
 [5,] "W"  "L"  "W"  "W"  "L"  "W"  "W"  "W"  "W"  "L"  
 [6,] "W"  "W"  "L"  "W"  "L"  "W"  "L"  "L"  "W"  "W"  
 [7,] "L"  "L"  "W"  "W"  "W"  "W"  "L"  "L"  "L"  "W"  
 [8,] "W"  "L"  "L"  "W"  "L"  "W"  "W"  "W"  "W"  "W"  
 [9,] "W"  "L"  "W"  "L"  "L"  "W"  "L"  "W"  "W"  "L"  </code></pre>
</div>
</div>
<ul>
<li>Test the intent of the code first</li>
<li>If our procedure doesn’t work when <em>we know</em> the answer, it certainly won’t when we <em>don’t</em> know the answer</li>
</ul>
<p>Infinite sample:</p>
<p><img src="https://latex.codecogs.com/png.latex?p%5EW(1-p)%5EL"> Posterior probability:</p>
<p><img src="https://latex.codecogs.com/png.latex?p%20=%20%5Cfrac%7B(W+L+1)!%7D%7BW!L!%7Dp%5EW(1-p)%5EL"></p>
<ul>
<li>This is a <em>Beta</em> distribution, and the likelihood was a <em>Binomial</em>.</li>
<li>The minimum sample size for Bayesian analysis is 1.</li>
<li>The shape of the posterior distribution embodies the sample size</li>
<li>No point estimate, we work with the entire posterior distribution</li>
<li>The distribution <em>is</em> the estimate; always use the entire distribution, never a single point</li>
<li>The fact that an arbitrary interval contains an arbitrary value is not meaningful</li>
</ul>
<ol start="5" type="1">
<li>Analyze sample, summarize</li>
</ol>
<ul>
<li>Implications depend on entire posterior</li>
<li>Average over the uncertainty of the posterior</li>
<li>What can we do with the posterior distribution?
<ul>
<li>We can take samples from it, and then do calculations with the samples</li>
</ul></li>
<li>Posterior Prediction
<ul>
<li>Given what we’ve learned, what would happen if we took more samples?</li>
<li>Sampling distribution (predictive distribution) of draws represents the likelihood of each outcome in a new experiment for a particular value</li>
<li>The <em>posterior predictive</em> distribution then represents the entire distribution of the statistic of interest, and contains all the uncertainty around that estimate (analogous to the sampling distribution of a statistic (e.g., mean) in the frequentist paradigm, except this is completely model-driven by the posterior instead of based on asymptotics in the frequentist approach)</li>
<li>Sampling turns calculus into a data summary problem; this is important when models get complex and numerically intractable to compute by hand</li>
</ul></li>
<li>This generative, Bayesian framework is the optimal approach for causal estimation <em>if your model is correct</em>.</li>
<li>It honestly carries out the assumptions we put into it, using logical implications</li>
<li>Quantitative framework/asset that activates our qualitative knowledge as scientists, subject matter experts, etc. Let’s the subjective and objective work together. Subjectivity is expertise.</li>
</ul>
<p><strong>Misclassification</strong></p>
<ul>
<li><p>Use circles around variable in DAG to represent unobserved vs.&nbsp;observed variables</p></li>
<li><p>Imagine the true number of water samples (W) are unobserved (e.g., measurement error, data error, etc.)</p></li>
<li><p>We observe a <em>contaminated</em> W (called W*) that is the <em>misclassified</em> sample</p></li>
<li><p>W* is caused by the <em>measurement process</em> M. We can get get back to the correct posterior distribution for p if we use M through W*.</p></li>
<li><p>The posterior is honest about the uncertaintly induced by the misclassification process</p></li>
<li><p>When there is measurement error, model it instead of ignoring it (same for missing data, compliance, inclusion)</p></li>
<li><p><em>Key point: Samples do not need to be representative of population to provide good estimates, since we can correct them through our causal diagram (modeling the source, sampling process, etc.)</em></p></li>
<li><p>This concept may also arise if, for example, the globe was not spun equally likely for every point to be selected.</p></li>
</ul>
</section>
</section>
<section id="lecture3" class="level1">
<h1>3. Geocentric Models</h1>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Week #</th>
<th>Lecture #</th>
<th>Chapter(s)</th>
<th>Week End</th>
<th>Notes Taken</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>3</td>
<td>4</td>
<td>1/13/2023</td>
<td>1/10/2023</td>
</tr>
</tbody>
</table>
<section id="summary-2" class="level2">
<h2 class="anchored" data-anchor-id="summary-2">Summary</h2>
<p>We don’t actually need data to construct a model. Our prior distributions, which account for our baseline knowledge about what reasonable values for unknown parameters may be, can produce estimates on their own. A bare minimum strategy is to choose these such that before seeing data, the output of our model produces scientifically reasonable results–there is no reason to allow our model to produce results that we know cannot happen. Then, our data can be introduced to help guide the parameters to an area of focus. In this sense (thinking of the example of points bumping around in parameter space), the data we collect is really just a tool for our model–the model is the central focus, the data just helps the model go to where it needs to go. Also, the idea that there are no correct priors and that priors are just (normalized) posteriors from previous data, make the idea of Bayesian updating very intuitive. It will be interesting to see in coming lectures how we can extend this linear model framework to more “real life” problems with observational data that have potentially tens or hundreds or thousands of potential drivers, and strategies for accounting for the most important ones. Obviously these basic examples are great to build a foundation, but it seems like a huge (sometimes impossible) hurdle to have the time and resources to be able to fully vet out expert-driven causal diagrams and generative models that fully account for all the things, especially in fast-paced environments when everyone is just so busy and there are so many projects to attend to. I’d imagine this is one of the reasons why frequentist analysis persists so much (at least in medical research), because it’s the way it’s been done and therefore you can get more things done faster, even though in an ideal state a Bayesian approach <em>is</em> the right way to go. Definitely something I’ve thought about time and time again–how can we balance the rigor and detail needed to construct the appropriate models to achieve better inference while still being efficient with peoples’ time? Part of it probably has to do with proving to stakeholders that the inference gained from the “quicker” way is less informative (or just plain wrong) compared to the more involved approach.</p>
</section>
<section id="notes-2" class="level2">
<h2 class="anchored" data-anchor-id="notes-2">Notes</h2>
<ul>
<li>Statistical models can attain arbitrarily accurate predictions without having any explanation or accurate structure (i.e., the model is just plain wrong, but happens to produce accurate predictions at the right time)
<ul>
<li>Example of this is a previous explanation of orbit pattern of Mars: assuming Earth at the center (geocentric), Mars orbits around Earth but also it’s own local orbit (epi-cycles). Using this model, they got very accurate predictions, but this mechanism is completely wrong.</li>
<li>Orbits are actually elliptical and around the sun, not Earth</li>
<li>Even though the first one predicts accurately, because the structure/mechanism is wrong, it doesn’t extend or generalize to other things. However, the correct mechanism is able to explain orbit patterns of all planets in the solar system.</li>
</ul></li>
<li>Linear regression is a large class of statistical golems
<ul>
<li><strong>Geogentric</strong>: describes associations, makes good predictions; mechanistically always wrong (but useful), very good approximation; meaning doesn’t depend on the model, depends on an external causal model. Nothing wrong with it unless you actually believe it is the true mechanism.</li>
<li><strong>Gaussian</strong>: Abstracts away from detail of general error model; mechanistically silent. General argument about symmetry of error.</li>
</ul></li>
</ul>
<p><strong>Gaussian</strong></p>
<ul>
<li>Example: Flip coin, each person take a step to left or right depending on heads/tails, measure distance from center; makes a normal distribution. Why?
<ul>
<li>There are more ways for a sequence of coin tosses to get you close to the middle than there are to get you to the left or right</li>
<li>Many natural processes attract to this behavior because it is adding together small differences</li>
</ul></li>
<li>Two arguments:
<ul>
<li>Generative: summed fluctuations tend towards normal. Ex. growth–added fluctuations over time, same age weight tends to be gaussian</li>
<li>Inferential: estimating mean/variance. Best to use since least informative (maximum entropy)</li>
</ul></li>
<li>Variable does not need to be normally distributed for normal model to be useful. Machine for estimating mean/variance. Contains the least assumptions. (central limit theorem)</li>
</ul>
<p><strong>Skills/Goals for Lecture</strong></p>
<ol type="1">
<li>Learn a standardized language for representing models (generative and statistical)</li>
<li>Calculate posteriors with multiple unknown parameters</li>
<li>How to construct and understand linear models; how to construct posterior predictions from them</li>
</ol>
<p><strong>Reminder of the owl</strong></p>
<ol type="1">
<li>State a clear question; descriptive, causal, anything; but needs to be clear</li>
<li>Sketch causal assumptions using DAGs; good way for non-theorists to realize they have a lot of subject knowledge and can get it on paper</li>
<li>Define a generative model; generates synthetic observations</li>
<li>Use generative model to build estimator; causal/generative assumptions embedded</li>
<li>Test, analyze</li>
<li>Profit: we realize our model was useful, or terrible; either way we gain something</li>
</ol>
<p><strong>Describing models</strong></p>
<ol type="1">
<li>Lists variables</li>
<li>Define each variable as a deterministic or distributional function of other variables</li>
</ol>
<p><strong>Exercise</strong></p>
<ol type="1">
<li>Goal: Describe the association between adult weight and height</li>
<li>Height causes weight H–&gt;W&lt;–(U) (unobserved influences on body weight)</li>
<li>Generative/scientific model: <img src="https://latex.codecogs.com/png.latex?W=f(H,U)">, <img src="https://latex.codecogs.com/png.latex?W=%5Cbeta%20H%20+%20U"></li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1">sim_weight <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb41-2">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(H,b,sd) {</span>
<span id="cb41-3">    U <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(H),<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,sd)</span>
<span id="cb41-4">    W<span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span>b<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>H <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> U</span>
<span id="cb41-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">return</span>(W)</span>
<span id="cb41-6">  }</span>
<span id="cb41-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate height</span></span>
<span id="cb41-8">H <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">130</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">170</span>)</span>
<span id="cb41-9">W <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sim_weight</span>(H, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span>.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb41-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(W<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>H,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/statistical-rethinking-2023-class-notes/index_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><img src="https://latex.codecogs.com/png.latex?W_i=%5Cbeta%20H_i%20+%20U_i"> <img src="https://latex.codecogs.com/png.latex?U_i%20%5Csim%20Normal(0,%5Csigma)"> <img src="https://latex.codecogs.com/png.latex?H_i%20%5Csim%20Uniform(130,%20170)"> 4. Statistical model (estimator)</p>
<ul>
<li>We want to estimate how the average weight changes with height.</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?E(W_i%7CH_i)=%5Calpha%20+%20%5Cbeta%20H_i"></p>
<ul>
<li>Posterior distribution</li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?P(%5Calpha,%20%5Cbeta,%20%5Csigma%7CH_i,W_i)%20=%20%5Cfrac%7BP(W_i%7CH_i,%5Calpha,%5Cbeta,%5Csigma)P(%5Calpha,%5Cbeta,%5Csigma)%7D%7BZ%7D"></p>
<ul>
<li>Gives the posterior probability of a specific regression line
<ul>
<li>Likelihood: Number of ways we could produce <img src="https://latex.codecogs.com/png.latex?W_i">, given a line</li>
<li>Prior: The previous posterior distribution; normalized number of ways previous data could have been produced.</li>
</ul></li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?W_i%20%5Csim%20Normal(%5Cmu_i,%20%5Csigma)"> <img src="https://latex.codecogs.com/png.latex?%5Cmu_i%20=%20%5Calpha%20+%20%5Cbeta%20H_i"></p>
<ul>
<li><p>Generally more useful to look at the lines (parameter implications together), instead of individual parameters</p></li>
<li><p>Quadratic approximation</p>
<ul>
<li>Approximate the posterior distribution using a multivariate Gaussian distribution</li>
<li>Use the <code>quap</code> function in the <code>rethinking</code> package</li>
</ul></li>
</ul>
<p><strong>Prior Predictive Distribution</strong></p>
<ul>
<li>Should express scientific knowledge, but <em>softly</em></li>
<li>We can make the model make predictions without using data</li>
<li>Not make ranges that represent the data, but rather just those that make sense based on current knowledge</li>
<li>Account for basic reasonable constraints: In general, patients with more weight have more height, and the weight is less than the height, so <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> is probably between <img src="https://latex.codecogs.com/png.latex?%5B0,1%5D">.</li>
<li>Use these to define some lines based on the assumptions</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1">n <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span></span>
<span id="cb42-2">a <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(n,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb42-3">b <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(n,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb42-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(<span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">130</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">170</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylim=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>),<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xlab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"height(cm)"</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">ylab=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Weight(kg)"</span>)</span>
<span id="cb42-5"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (j <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>) <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">abline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span>a[j],<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span>b[j],<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lwd=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>,<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">col=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/statistical-rethinking-2023-class-notes/index_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Some of these are probably not plausible (e.g., high height with low weight). Slopes look good but not intercept</li>
<li>We can adjust as needed to create what makes sense</li>
<li>There are no correct priors; only scientifically justifiable priors</li>
</ul>
<ol start="5" type="1">
<li>Validate Model</li>
</ol>
<ul>
<li>Bare minimum to test statistical model</li>
<li>Not because you wrote it, more so to make sure your model works</li>
</ul>
<ol start="6" type="1">
<li>Analyze data</li>
</ol>
<ul>
<li>Plug in your data set into your process</li>
<li>Parameters are not independent, can’t interpret as such</li>
<li>Push out posterior predictions</li>
</ul>
</section>
</section>
<section id="lecture4" class="level1">
<h1>4. Categories and Curves</h1>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Week #</th>
<th>Lecture #</th>
<th>Chapter(s)</th>
<th>Week End</th>
<th>Notes Taken</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>4</td>
<td>4</td>
<td>1/13/2023</td>
<td>1/11/2023</td>
</tr>
</tbody>
</table>
<section id="summary-3" class="level2">
<h2 class="anchored" data-anchor-id="summary-3">Summary</h2>
<p>The idea of <em>total</em> vs.&nbsp;<em>direct</em> effects is about specifying the statistical model that will allow you to observe the complete effect (i.e., including differences that could be explained by something else in the model) compared to parsing out differences explained by the variable after adjusting for effects explained through other variables. In the lecture example, the total causal effect of sex on weight was determined by using a (Bayesian) intercept-only model, which showed considerable difference is mean weights between male/female. However, when assessing the direct causal effect, a parameter was added to fit separate slopes for male/female in order to block out the effect of sex on weight that is observed through other causes (in this case, height), such that the resulting estimator looked at mean differences in weight <em>at each height</em>–the posterior distribution for this difference yielded little to no direct effect, indicating that most of the difference in weight between male/females is due to height differences. Another interesting aspect of this lecture was how to think about which way an arrow should go when drawing the causal diagram. You should think of the interventions we are willing to consider, and which make logical sense. For example, we drew <img src="https://latex.codecogs.com/png.latex?H%20%5Crightarrow%20W"> because, given a height, it makes sense to employ interventions (such as weight loss program, exercise, etc.) that could presumably impact the resulting weight, but it doesn’t make a lot of sense to think of trying to change someone’s height given their weight. Also, declaring something as a <em>cause</em> of something, generally you first want to think about whether an intervention can be employed, but if not can still make sense if it is a proxy for something else (e.g., age encapsulates time, among many other things that presumably do cause height). We can use flexible curves to fit things (e.g., splines), but we want to make sure we vet out any erroneous areas where estimates don’t make sense, and add necessary restrictions to alleviate. So far, these lectures have given great optimism and excitement for how to approach modeling. I want to be confident in the models I produce, and I think the generative framework is the right approach to be able to believe in the results you are producing. I see so much published research from observational data that declare something statistically significant for a given research hypothesis and say “we adjusted for all these confounders”. Even if I feel fine about the math/statistical procedure, I’m always skeptical about the conclusions that are drawn from it, and quite frankly, don’t feel like it means much at all for really making a decision–there are just too many limitations about all sorts of things. The generative approach gives the tools and rigor to be much more confident in the results, and if we can be more demanding of that rigor, time and energy, it should yield more benefit in the long run. I’d rather spend more time getting to a confident conclusion than just pumping out results.</p>
<section id="a-check-for-understanding-1" class="level3">
<h3 class="anchored" data-anchor-id="a-check-for-understanding-1">A check for understanding</h3>
<p>During (and after) the lecture, it took me a while to gain intuition about what was happening in the generative simulation for the model:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  A(Sex) --&gt; C(Weight)
  A --&gt; B(Height)
  B --&gt; C
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>The code was written in the following way:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># S = 1 female, S = 2 male</span></span>
<span id="cb43-2">sim_HW <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(S,b,a) {</span>
<span id="cb43-3">  N <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">length</span>(S)</span>
<span id="cb43-4">  H <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ifelse</span>(S<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">160</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(N,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb43-5">  W <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> a[S] <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> b[S]<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>H <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(N,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb43-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">data.frame</span>(S,H,W)</span>
<span id="cb43-7">}</span>
<span id="cb43-8"></span>
<span id="cb43-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Generate data</span></span>
<span id="cb43-10"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb43-11">S <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rbinom</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb43-12">dat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sim_HW</span>(S, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">6</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">a=</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>,<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>))</span>
<span id="cb43-13"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(dat)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  S        H        W
1 1 151.2666 79.57199
2 2 159.8573 99.75957
3 1 149.7856 76.55384
4 2 166.8430 95.06392
5 2 158.8711 94.72542
6 1 157.5824 77.38920</code></pre>
</div>
</div>
<p>First, the indexing used here <code>b[S]</code> was odd because <code>b</code> is a vector of length 2, and <code>S</code> is a vector of length 100. But all it is doing is making a vector of length 100 by looking up the index of <code>b</code> at each spot (since <code>S</code> is either 1 or 2). I didn’t know you could index like that in <code>R</code> but I guess you learn something everyday. Anyway, that was not the real thing that confused me.</p>
<p>In the lecture, he states that the <code>a</code> term represents the <em>direct</em> effect of sex on weight, and the <code>b</code> term represents the <em>indirect</em> effect (i.e., proportionality/slope for each sex). It’s clear that there are separate lines created for each sex, and you can see the form of an intercept and slope for each one. In my mind, I’m thinking this has to be similar to an interaction in the model, but it wasn’t intuitive to me how this really played out and/or there was something different going on here. After some thought on a notepad, it is exactly what I was thinking–just a linear model with an interaction term between sex and height, though it is reparameterized a little to create the <em>symmetry</em> of effects as discussed in the lecture. Anyway, here is how it translates:</p>
<p>Currently, we have that the sex indicators are as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?S%20=%201%20(female),%202(male)"> Then, the effect of height on weight for each sex is as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?b=(b_%7BS_1%7D,b_%7BS_2%7D)%20=%20(0.5,%200.6)"> Finally, the intercept within each line is:</p>
<p><img src="https://latex.codecogs.com/png.latex?a=(a_%7BS_1%7D,a_%7BS_2%7D)=(0,0)"> This leads to:</p>
<p><img src="https://latex.codecogs.com/png.latex?W_%7BS_1%7D%20=%20a_%7BS_1%7D%20+%20b_%7BS_1%7DH%20+%20%5Cepsilon_i%20=%20.5H+%5Cepsilon_i"> <img src="https://latex.codecogs.com/png.latex?W_%7BS_2%7D%20=%20a_%7BS_2%7D%20+%20b_%7BS_1%7DH%20+%20%5Cepsilon_i%20=%20.6H%20+%20%5Cepsilon_i"> We could think of this as a single model equation with four (4) regression coefficients looking like the following:</p>
<p><img src="https://latex.codecogs.com/png.latex?W%20=%20%5Cbeta_1%20S_1%20+%20%5Cbeta_2%20S_2%20+%20%5Cbeta_3%20H%20%5Ctimes%20S_1%20+%20%5Cbeta_4%20H%20%5Ctimes%20S_2%20+%20%5Cepsilon_i"> where</p>
<p><img src="https://latex.codecogs.com/png.latex?S_1%20=%201%20%5Ctext%7B%20if%20female;%200%20otherwise%7D"> <img src="https://latex.codecogs.com/png.latex?S_2%20=%201%20%5Ctext%7B%20if%20male;%200%20otherwise%7D"> There is no intercept term in the model. Instead, there are <em>symmetric</em> parameterizations for males and females, instead of making the effects relative to one another (which, as mentioned in the lecture, makes it more intuitive to make priors for). The design matrix for this model would then look something like:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tribble</span>(</span>
<span id="cb45-2">  <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>S1, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>S2, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>H_S1, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>H_S2, <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>W,</span>
<span id="cb45-3">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">150</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">80</span>,</span>
<span id="cb45-4">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">160</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>,</span>
<span id="cb45-5">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">140</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">70</span>,</span>
<span id="cb45-6">  <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">165</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">75</span></span>
<span id="cb45-7">)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
     S1    S2  H_S1  H_S2     W
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1     1     0   150     0    80
2     0     1     0   160    90
3     0     1     0   140    70
4     1     0   165     0    75</code></pre>
</div>
</div>
<p>Basically, every time <code>S1</code> is <code>1</code> (female), then <code>S2</code> is <code>0</code> (male), as well as the corresponding value for <code>H</code>.</p>
<p><em>I may have to rethink what I just wrote a bit as the the <img src="https://latex.codecogs.com/png.latex?S_1"> and <img src="https://latex.codecogs.com/png.latex?S_2"> columns are actually completely redundant, so not sure if this is right yet</em></p>
<p>So how would we parameterize this in a more classical regression model? If we just rewrite a few things. Let:</p>
<p><img src="https://latex.codecogs.com/png.latex?S=(0(female),%201(male))"> Then we assume the model is:</p>
<p><img src="https://latex.codecogs.com/png.latex?W%20=%20%5Cbeta_0+%5Cbeta_1%20S+%5Cbeta_2%20H+%5Cbeta_3%20S%5Ctimes%20H%20+%20%5Cepsilon_i"> If we translate parameter values from the example,</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbeta_0%20=%200%20%5Chskip.1in%20%5Cbeta_1%20=%200"> <img src="https://latex.codecogs.com/png.latex?%5Cbeta_2%20=%20.5%20%5Chskip.1in%20%5Cbeta_3%20=%20.6-.5%20=%20.1"> We then get:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%5Cbegin%7Bsplit%7D%0AW_%7BS=0(female)%7D%0A&amp;=%20%5Cbeta_0%20+%20%5Cbeta_1(0)%20+%20%5Cbeta_2H+%5Cbeta_3%200%20%5Ctimes%20H%20+%20%5Cepsilon_i%20%5C%5C%0A&amp;=%200%20+%200(0)%20+%20.5H%20+%20.1(0%20%5Ctimes%20H)%20+%20%5Cepsilon_i%20%5C%5C%0A&amp;=%200.5H%20+%20%5Cepsilon_i%0A%5Cend%7Bsplit%7D%0A%5Cend%7Bequation%7D%0A"></p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%5Cbegin%7Bsplit%7D%0AW_%7BS=1(male)%7D%0A&amp;=%20%5Cbeta_0%20+%20%5Cbeta_1(1)%20+%20%5Cbeta_2H+%5Cbeta_3%201%20%5Ctimes%20H%20+%20%5Cepsilon_i%20%5C%5C%0A&amp;=%200%20+%200(1)%20+%20.5H%20+%20.1(1%20%5Ctimes%20H)%20+%20%5Cepsilon_i%20%5C%5C%0A&amp;=%200.5H%20+%200.1H%20+%20%5Cepsilon_i%20%5C%5C%0A&amp;=%200.6H%20+%20%5Cepsilon_i%0A%5Cend%7Bsplit%7D%0A%5Cend%7Bequation%7D%0A"></p>
<p>This makes it much more clear why the <em>direct</em> effect is zero, since the main effect of sex is zero in this model. We only see an effect from sex through the interaction with height, which is what is known as the <em>indirect</em> effect.</p>
</section>
</section>
<section id="homework-1" class="level2">
<h2 class="anchored" data-anchor-id="homework-1">Homework</h2>
<ol type="1">
<li>From the <code>Howell1</code> dataset, consider only the people younger than 13 years old. Estimate the causal association between age and weight. Assume age influences weight through two paths. First, age influences height, and height influences weight. Second, age directly influences weight through age-related changes in muscle growth and body proportions. Draw the DAG that represents these causal relationships. And then write a generative simulation that takes age as an input and simulates height and weight, obeying the relationships in the DAG.</li>
</ol>
<p>First, we’ll import the dataset directly from the package’s <a href="https://github.com/rmcelreath/rethinking">Github repository</a>. We will filter to those &lt; 13 years old, and convert height to inches, and weight to lbs:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1">howell1 <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb47-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_delim</span>(</span>
<span id="cb47-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://raw.githubusercontent.com/rmcelreath/rethinking/master/data/Howell1.csv"</span>,</span>
<span id="cb47-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">delim =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">";"</span></span>
<span id="cb47-5">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb47-6">  </span>
<span id="cb47-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep those younger than 13</span></span>
<span id="cb47-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(age <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb47-9">  </span>
<span id="cb47-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert the units (more intuitive for me)</span></span>
<span id="cb47-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb47-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">height =</span> height <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.54</span>,</span>
<span id="cb47-13">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight =</span> weight <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.205</span></span>
<span id="cb47-14">  )</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 544 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
dbl (4): height, weight, age, male

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1">howell1</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 146 × 4
   height weight   age  male
    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1   48     43.3  12       1
 2   41.5   30.8   8       0
 3   34     23.1   6.5     0
 4   43     35.3   7       0
 5   45     39.4  11       1
 6   48     45.0   8       1
 7   50.8   51.5  12       0
 8   38.5   29.3   5       0
 9   43.5   34.0   9       0
10   38.5   28.1   5       0
# ℹ 136 more rows</code></pre>
</div>
</div>
<p>Next, we can write the causal diagram as described:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  A(Age) --&gt; C(Weight)
  A --&gt; B(Height)
  B --&gt; C
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>If we let</p>
<p><img src="https://latex.codecogs.com/png.latex?A=Age%20%5Chskip.1in%20H=Height%20%5Chskip.1in%20W=Weight"></p>
<p>Then, we assume that:</p>
<p><img src="https://latex.codecogs.com/png.latex?H%20=%20f_H(A)%20%5Chskip.2in%20W%20=%20f_W(A,H)"> Finally, we can write the generative simulation to produce synthetic data governed by the DAG:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulating synthetic children</span></span>
<span id="cb51-2">sim_children <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb51-3">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(N) {</span>
<span id="cb51-4">    </span>
<span id="cb51-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 1. Generate uniform ages</span></span>
<span id="cb51-6">    A <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">runif</span>(N, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">13</span>)</span>
<span id="cb51-7">    </span>
<span id="cb51-8">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 2. Generate heights as a linear combination of age</span></span>
<span id="cb51-9">    H <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">22</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>A <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(N, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb51-10">    </span>
<span id="cb51-11">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 3. Generate weights as a linear combination of age and height</span></span>
<span id="cb51-12">    W <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>H <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rnorm</span>(N, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">mean =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">sd =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb51-13">    </span>
<span id="cb51-14">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Make a data frame</span></span>
<span id="cb51-15">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>(A, H, W)</span>
<span id="cb51-16">  }</span></code></pre></div>
</details>
</div>
<p>We first generate ages uniformly from 0 to 13, so</p>
<p><img src="https://latex.codecogs.com/png.latex?A%20%5Csim%20Uniform(0,13)"></p>
<p>Then, we generate heights from a normal distribution with means that are linearly related to the age.</p>
<p><img src="https://latex.codecogs.com/png.latex?H%20%5Csim%20Normal(%5Cmu%20=22%20+%202%20%5Ctimes%20A,%20%5Csigma%20=%203)"> Notice the intercept term to ensure a positive height for children who are 0 years old. <em>Note: A distribution like the Gamma may be better here to ensure we don’t get negative heights. For younger ages, I would assume that the distribution of heights has a little right-skew. In any case, we’ll move forward with the Normal distribution here for simplicity sake.</em></p>
<p>Then we generate the weights as a linear function of the observed age and heights.</p>
<p><img src="https://latex.codecogs.com/png.latex?W%20%5Csim%20Normal(%5Cmu=.8H,%20%5Csigma%20=%20.5)"> We make the assumption that there is a linear relationship between weight with age and height, and that for any age, the increase in mean weight per inch increase in height is the same. In fact, the effect for age is 0 since it is observed through height.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Simulate some children</span></span>
<span id="cb52-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">123</span>)</span>
<span id="cb52-3">simmed_children <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sim_children</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>)</span>
<span id="cb52-4"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">plot</span>(simmed_children)</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="https://www.zajichekstats.com/post/statistical-rethinking-2023-class-notes/index_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><p>Use a linear regression to estimate the <strong>total</strong> causal effect of each year of growth on weight.</p></li>
<li><p>Now suppose the causal association between age and weight might be different between boys and girls. Use a single linear regression, with a categorical variable for sex, to estimate the total causal effect of age on weight separately for boys and girls. How do boys and girls differ? Provide one or more posterior contrasts as a summary.</p></li>
</ol>
</section>
<section id="notes-3" class="level2">
<h2 class="anchored" data-anchor-id="notes-3">Notes</h2>
<ul>
<li>The linear regression can approximate anything, so we need to design it with the causal model in mind</li>
<li>Generative models + multiple estimands, we’ll have multiple estimands</li>
<li>Need post-processing of posterior distribution to gain inference of joint distributino</li>
<li>We require categories, splines, etc. to build causal estimators</li>
<li>Need to <em>stratify</em> by category to get at the estimands we want (separate lines)</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>Extend example above to include patient sex, age</li>
<li>Need to determine how height, weight, sex are causally related (add to DAG), and statistically related</li>
<li>To determine which way the arrows go, think about the interventions you’re willing to consider</li>
<li>Don’t have to draw them, but the implied unobserved causes of each variable are implied
<ul>
<li>These are ignorable <em>unless shared</em> across variables</li>
<li>Ex. temperature is a cause of sex and weight in some species</li>
</ul></li>
<li>What is the causal effect of S on W?
<ul>
<li>Accounts for direct and indirect effect</li>
<li>We can also ask what is the direct causal effect of S on W?</li>
<li>These questions require different models</li>
</ul></li>
<li>Generally want to assign the same prior for parameters for each category level (below)
<ul>
<li>Using indexing is advantageous because you have symmetry such that all parameters can get the same prior, they are all interpreted the same within their levels</li>
<li>Using indicators makes parameters relative to other levels, which causes you have to put priors on other parameters because it is an adjustment parameter (one is an average, one is an adjustment to an average)</li>
</ul></li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?W_i%20%5Csim%20Normal(%5Cmu_i,%20%5Csigma)%20%5Chskip.1in%20%5Cmu_i=%5Calpha_%7BS%5Bi%5D%7D"> <img src="https://latex.codecogs.com/png.latex?%5Calpha%20=%20%5B%5Calpha_1,%20%5Calpha_2%5D%20%5Chskip.1in%20%5Calpha_j%20%5Csim%20Normal(60,10)"> <strong>Total Causal Effect</strong></p>
<ul>
<li>Simulate one data set of all males, another of all females, look at the average difference in weight
<ul>
<li>This is the actual causal effect</li>
<li>Then you can generate a random data set, run the modeling process, and then ensure that the model provides the expected estimate</li>
</ul></li>
<li>Look at the posterior distribution of the mean difference, and randomly draw samples from the individual posteriors and compute the differences to answer questions like “what is the probability that a randomly selected male will be heavier than a randomly selected female?”</li>
<li>This was basically just an intercept-only model for sex, and the effect due to height would be captured in that difference</li>
</ul>
<p><strong>Direct Effect</strong></p>
<ul>
<li>How do we partial out the indirect effect of Height (block it)?
<ul>
<li>Stratify by height to block the association between S and W that is transmitted through H</li>
</ul></li>
<li>Difference in intercept, the indirect is slope differences</li>
<li>Here, the model allows for separate slopes by sex, so we can tease out the impact of height
<ul>
<li>Center the height to make the interpretation of the intercept be the average</li>
<li>Makes priors more intuitive, and computation easier</li>
</ul></li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?W_i%20%5Csim%20Normal(%5Cmu_i,%20%5Csigma)%20%5Chskip.1in%20%5Cmu_i=%5Calpha_%7BS%5Bi%5D%7D%20+%20%5Cbeta_%7BS%5Bi%5D%7D(H_i-%5Cbar%7BH%7D)"> <img src="https://latex.codecogs.com/png.latex?%5Calpha=%5B%5Calpha_1,%5Calpha_2%5D%20%5Chskip.1in%20%5Cbeta=%5B%5Cbeta_1,%5Cbeta_2%5D"></p>
<ul>
<li>In this case, nearly all the total effect of sex on weight is explained through height (the direct effect (posterior of the difference between weights at each height) is nearly 0 at all heights)</li>
</ul>
<p><strong>Curve Fitting</strong></p>
<ul>
<li>We use linear models to do this; i.e., it’s not mechanistic, but we use it wisely</li>
<li>Strategies
<ul>
<li>Polynomials: Don’t do it; no local smoothing, only global; learn to much from data in regions that lie far away
<ul>
<li>It’s not worth having a model that looks OK for most of the data that we know is completely erroneous (e.g., parabola at some point shows babies get heavier as their height decreases, which we know is wrong); even though this is a small portation of observations, it’s still knowingly wrong, so why use it?</li>
</ul></li>
<li>Splines &amp; GAMs: Not as bad as polynomials; add total many locally trained terms</li>
</ul></li>
</ul>
<p><strong>Splines</strong></p>
<ul>
<li>Flexible curve that will find trends</li>
<li>B-splines are linear models containing additive terms with synthetic variables
<ul>
<li>Think of it as a collection of individual curves (basis functions), but the weight of each basis function is non-zero at only particular areas of x, and spline is the sum of the curves at a particular point</li>
</ul></li>
</ul>
<p><img src="https://latex.codecogs.com/png.latex?%5Cmu_i%20=%20%5Calpha%20+%20w_1B_%7Bi,1%7D%20+%20w_2B_%7Bi,2%7D%20+%20..."></p>
<ul>
<li>Ideal model for age/height would be to account for what we know about human biology: infant, toddler, adolescent, adult. In the first 3, we expect only upward growth, so we should constrain.</li>
</ul>
<p><strong>Full Luxury Bayes</strong></p>
<ul>
<li>Equivalent approach is to use one model for entire causal sample</li>
<li>Then run simulations from overall system to get answers to specific queries</li>
</ul>


<!-- -->

</section>
</section>

 ]]></description>
  <category>Bayesian Statistics</category>
  <category>Causal Inference</category>
  <guid>https://www.zajichekstats.com/post/statistical-rethinking-2023-class-notes/</guid>
  <pubDate>Sun, 01 Jan 2023 06:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/statistical-rethinking-2023-class-notes/feature.png" medium="image" type="image/png" height="176" width="144"/>
</item>
<item>
  <title>A couple useful JavaScript aggregation and formatting functions for {reactable}</title>
  <dc:creator>Alex Zajichek</dc:creator>
  <link>https://www.zajichekstats.com/post/reactable-javascript/</link>
  <description><![CDATA[ 




<p>In my <a href="https://www.zajichekstats.com/post/filterable-maps/">last post</a> we demonstrated how to build a filterable map widget into an HTML output that was free of <code>R</code> runtime dependency. In continuation of that theme, this article focuses on the <a href="https://glin.github.io/reactable/"><code>reactable</code></a> package, which enables you to embed interactive data tables into your document. Specifically, we’ll look at how we can use its built-in JavaScript interface to define custom functions for commonly-desired aggregation and formatting.</p>
<section id="table-of-contents" class="level1">
<h1>Table of Contents</h1>
<ul>
<li>The Basics
<ul>
<li>Make a summary dataset</li>
<li>The default table</li>
<li>Built-in aggregation</li>
</ul></li>
<li>Using the JavaScript Interface
<ul>
<li>Function 1: Weighted mean</li>
<li>Function 2: Conditional coloring</li>
<li>Final touches</li>
</ul></li>
</ul>
</section>
<section id="the-basics" class="level1">
<h1>The Basics</h1>
<p>Let’s start with loading some packages.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(reactable)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(tidyverse)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<section id="summarydata" class="level2">
<h2 class="anchored" data-anchor-id="summarydata">Make a summary dataset</h2>
<p>First we’ll need to create a data frame with group-level summary statistics that we want to display. For this example, we’ll look at the 30-day hospital readmission rate for heart failure patients on Medicare at the top five (5) most voluminous hospitals in a handful of Midwest states.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Import dataset</span></span>
<span id="cb3-2">readmission_rates <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(</span>
<span id="cb3-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/Users/alexzajichek/Documents/GitHub/Unplanned_Hospital_Visits-Hospital.csv"</span>,</span>
<span id="cb3-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"NA"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"N/A"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Not Available"</span>)</span>
<span id="cb3-6">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-7">  </span>
<span id="cb3-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter to states with non-null values</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb3-10">    State <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"WI"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MN"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"MI"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"IL"</span>),</span>
<span id="cb3-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Measure ID</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"READM_30_HF"</span>,</span>
<span id="cb3-12">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Denominator),</span>
<span id="cb3-13">    <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">is.na</span>(Score)</span>
<span id="cb3-14">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-15">  </span>
<span id="cb3-16">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert to proportion</span></span>
<span id="cb3-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb3-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Score =</span> Score <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb3-19">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-20">  </span>
<span id="cb3-21">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Keep a few columns</span></span>
<span id="cb3-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(</span>
<span id="cb3-23">    State,</span>
<span id="cb3-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Hospital =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Facility Name</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>,</span>
<span id="cb3-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Cases =</span> Denominator,</span>
<span id="cb3-26">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">30-Day Readmission Rate</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Score</span>
<span id="cb3-27">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-28">  </span>
<span id="cb3-29">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For each state, keep the top 5 most voluminous hospitals</span></span>
<span id="cb3-30">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">group_by</span>(State) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">slice_max</span>(</span>
<span id="cb3-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">n =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb3-33">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">order_by =</span> Cases,</span>
<span id="cb3-34">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">with_ties =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb3-35">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-36">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ungroup</span>()</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 66906 Columns: 20
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (15): Facility ID, Facility Name, Address, City/Town, State, ZIP Code, C...
dbl  (5): Denominator, Score, Lower Estimate, Higher Estimate, Footnote

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">readmission_rates</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 4
   State Hospital                                   Cases 30-Day Readmission R…¹
   &lt;chr&gt; &lt;chr&gt;                                      &lt;dbl&gt;                  &lt;dbl&gt;
 1 IL    NORTHSHORE UNIVERSITY HEALTHSYSTEM - EVAN…  2294                  0.212
 2 IL    PALOS COMMUNITY HOSPITAL                    1436                  0.214
 3 IL    NORTHWESTERN MEMORIAL HOSPITAL              1315                  0.187
 4 IL    ADVOCATE CHRIST HOSPITAL &amp; MEDICAL CENTER   1287                  0.202
 5 IL    NORTHWESTERN MEDICINE MCHENRY               1286                  0.177
 6 MI    BEAUMONT HOSPITAL, TROY                     1683                  0.21 
 7 MI    BEAUMONT HOSPITAL ROYAL OAK                 1611                  0.2  
 8 MI    ASCENSION PROVIDENCE HOSPITAL, SOUTHFIELD…  1191                  0.206
 9 MI    TRINITY HEALTH ANN ARBOR HOSPITAL           1121                  0.191
10 MI    SPECTRUM HEALTH                             1065                  0.172
11 MN    MAYO CLINIC HOSPITAL ROCHESTER              1551                  0.173
12 MN    ABBOTT NORTHWESTERN HOSPITAL                 778                  0.189
13 MN    PARK NICOLLET METHODIST HOSPITAL             747                  0.213
14 MN    MERCY HOSPITAL                               742                  0.176
15 MN    ST CLOUD HOSPITAL                            623                  0.18 
16 WI    AURORA ST LUKES MEDICAL CENTER              1362                  0.188
17 WI    FROEDTERT MEMORIAL LUTHERAN HOSPITAL         621                  0.195
18 WI    UNIVERSITY OF WI  HOSPITALS &amp; CLINICS AUT…   609                  0.219
19 WI    WAUKESHA MEMORIAL HOSPITAL                   605                  0.171
20 WI    MILWAUKEE VA MEDICAL CENTER                  604                  0.222
# ℹ abbreviated name: ¹​`30-Day Readmission Rate`</code></pre>
</div>
</div>
</section>
<section id="defaulttable" class="level2">
<h2 class="anchored" data-anchor-id="defaulttable">The default table</h2>
<p>As a starting point, let’s see what we get when we call the <code>reactable</code> function without any additional arguments.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">readmission_rates <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactable</span>()</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item" id="htmlwidget-c9c65e70c67547d67cfb" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-c9c65e70c67547d67cfb">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"State":["IL","IL","IL","IL","IL","MI","MI","MI","MI","MI","MN","MN","MN","MN","MN","WI","WI","WI","WI","WI"],"Hospital":["NORTHSHORE UNIVERSITY HEALTHSYSTEM - EVANSTON HOSPITAL","PALOS COMMUNITY HOSPITAL","NORTHWESTERN MEMORIAL HOSPITAL","ADVOCATE CHRIST HOSPITAL & MEDICAL CENTER","NORTHWESTERN MEDICINE MCHENRY","BEAUMONT HOSPITAL, TROY","BEAUMONT HOSPITAL ROYAL OAK","ASCENSION PROVIDENCE HOSPITAL, SOUTHFIELD AND NOVI","TRINITY HEALTH ANN ARBOR HOSPITAL","SPECTRUM HEALTH","MAYO CLINIC HOSPITAL ROCHESTER","ABBOTT NORTHWESTERN HOSPITAL","PARK NICOLLET METHODIST HOSPITAL","MERCY HOSPITAL","ST CLOUD HOSPITAL","AURORA ST LUKES MEDICAL CENTER","FROEDTERT MEMORIAL LUTHERAN HOSPITAL","UNIVERSITY OF WI  HOSPITALS & CLINICS AUTHORITY","WAUKESHA MEMORIAL HOSPITAL","MILWAUKEE VA MEDICAL CENTER"],"Cases":[2294,1436,1315,1287,1286,1683,1611,1191,1121,1065,1551,778,747,742,623,1362,621,609,605,604],"30-Day Readmission Rate":[0.212,0.214,0.187,0.202,0.177,0.21,0.2,0.206,0.191,0.172,0.173,0.189,0.213,0.176,0.18,0.188,0.195,0.219,0.171,0.222]},"columns":[{"id":"State","name":"State","type":"character"},{"id":"Hospital","name":"Hospital","type":"character"},{"id":"Cases","name":"Cases","type":"numeric"},{"id":"30-Day Readmission Rate","name":"30-Day Readmission Rate","type":"numeric"}],"dataKey":"313142064b5325150dc6f28c2524bcaa"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>We get about what we’d expect: a basic, paginated table where each row from our dataset is represented verbatim. There are many things we could clean up here such as rounding, number representations, formatting, and, of course, aggregating the statistics to get state-specific readmission rates.</p>
</section>
<section id="builtinaggregation" class="level2">
<h2 class="anchored" data-anchor-id="builtinaggregation">Built-in aggregation</h2>
<p>There are a number of built-in aggregation functions available to us by default. We just need to specify:</p>
<ol type="1">
<li>The groups we want the aggregation applied within using the <code>groupBy</code> argument</li>
<li>The columns we want to aggregate, and how, using <code>colDef</code> within the <code>columns</code> argument</li>
</ol>
<p>Let’s add functionality to the table above to aggregate the <em>total</em> case count and the <em>average</em> 30-day readmission rate within each state.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">readmission_rates <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactable</span>(</span>
<span id="cb9-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">groupBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"State"</span>,</span>
<span id="cb9-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> </span>
<span id="cb9-5">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb9-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Cases =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span>),</span>
<span id="cb9-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">30-Day Readmission Rate</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mean"</span>)</span>
<span id="cb9-8">      )</span>
<span id="cb9-9">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item" id="htmlwidget-87e4aad21097214fe7b5" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-87e4aad21097214fe7b5">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"State":["IL","IL","IL","IL","IL","MI","MI","MI","MI","MI","MN","MN","MN","MN","MN","WI","WI","WI","WI","WI"],"Hospital":["NORTHSHORE UNIVERSITY HEALTHSYSTEM - EVANSTON HOSPITAL","PALOS COMMUNITY HOSPITAL","NORTHWESTERN MEMORIAL HOSPITAL","ADVOCATE CHRIST HOSPITAL & MEDICAL CENTER","NORTHWESTERN MEDICINE MCHENRY","BEAUMONT HOSPITAL, TROY","BEAUMONT HOSPITAL ROYAL OAK","ASCENSION PROVIDENCE HOSPITAL, SOUTHFIELD AND NOVI","TRINITY HEALTH ANN ARBOR HOSPITAL","SPECTRUM HEALTH","MAYO CLINIC HOSPITAL ROCHESTER","ABBOTT NORTHWESTERN HOSPITAL","PARK NICOLLET METHODIST HOSPITAL","MERCY HOSPITAL","ST CLOUD HOSPITAL","AURORA ST LUKES MEDICAL CENTER","FROEDTERT MEMORIAL LUTHERAN HOSPITAL","UNIVERSITY OF WI  HOSPITALS & CLINICS AUTHORITY","WAUKESHA MEMORIAL HOSPITAL","MILWAUKEE VA MEDICAL CENTER"],"Cases":[2294,1436,1315,1287,1286,1683,1611,1191,1121,1065,1551,778,747,742,623,1362,621,609,605,604],"30-Day Readmission Rate":[0.212,0.214,0.187,0.202,0.177,0.21,0.2,0.206,0.191,0.172,0.173,0.189,0.213,0.176,0.18,0.188,0.195,0.219,0.171,0.222]},"columns":[{"id":"State","name":"State","type":"character"},{"id":"Hospital","name":"Hospital","type":"character"},{"id":"Cases","name":"Cases","type":"numeric","aggregate":"sum"},{"id":"30-Day Readmission Rate","name":"30-Day Readmission Rate","type":"numeric","aggregate":"mean"}],"groupBy":["State"],"dataKey":"6cee1cd92fa72a703f67b42832e2ed41"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The problem with this table is that the displayed state-level readmission rates represent the <em>averaged</em> rates across the individual hospitals. What we really want in the aggregation is for the hospital-specific rates to be weighted by their respective case volumes so that the state-level readmission rates are correct. This is where JavaScript comes in.</p>
</section>
</section>
<section id="jsinterface" class="level1">
<h1>Using the JavaScript Interface</h1>
<p>During the call to <code>reactable</code>, our table is accessible through a JavaScript interface which makes it easy for us to customize the aggregation and formatting behavior when the default options won’t suffice. We can use the <code>JS</code> function from the <a href="https://www.htmlwidgets.org/"><code>htmlwidgets</code></a> package to:</p>
<ol type="1">
<li>Define a JavaScript function as a text string</li>
<li>Supply that function as the argument to <code>colDef</code> applicable to the function’s context</li>
</ol>
<section id="function1" class="level2">
<h2 class="anchored" data-anchor-id="function1">Function 1: Weighted mean</h2>
<p>Referring back to our example, we want to average the 30-day readmission rates over the hospitals within each state, but we need to weight them by their respective case volume. To do this, we can supply a custom JavaScript function to the <code>aggregate</code> argument. This function takes the entire vector of values within the group as its argument, as well as the group’s rows, and returns a scalar value. We can specify the column containing the case weights directly by name within the row.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">weighted_mean <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb10-2">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(weight) {</span>
<span id="cb10-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">JS</span>(</span>
<span id="cb10-4">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(</span>
<span id="cb10-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"function(values, rows) {</span></span>
<span id="cb10-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">          var numerator = 0</span></span>
<span id="cb10-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">          var denominator = 0</span></span>
<span id="cb10-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb10-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">          rows.forEach(function(row, index) {</span></span>
<span id="cb10-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            numerator += row['"</span>, weight, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"'] * values[index]</span></span>
<span id="cb10-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            denominator += row['"</span>, weight, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"']</span></span>
<span id="cb10-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">          })</span></span>
<span id="cb10-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb10-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">          return numerator / denominator</span></span>
<span id="cb10-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">  </span></span>
<span id="cb10-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        }"</span></span>
<span id="cb10-17">      )</span>
<span id="cb10-18">    )</span>
<span id="cb10-19">  }</span></code></pre></div>
</details>
</div>
<p>In our implementation, we encoded the <code>JS</code> function into an <code>R</code> function that calls for the weight column name so we can use it in any <code>reactable</code> in which we want this functionality applied. Let’s see what our table looks when we plug it in:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">readmission_rates <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactable</span>(</span>
<span id="cb11-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">groupBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"State"</span>,</span>
<span id="cb11-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> </span>
<span id="cb11-5">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb11-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Cases =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span>),</span>
<span id="cb11-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">30-Day Readmission Rate</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">weighted_mean</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cases"</span>))</span>
<span id="cb11-8">      )</span>
<span id="cb11-9">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item" id="htmlwidget-80d5fc8451ed2089bbf5" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-80d5fc8451ed2089bbf5">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"State":["IL","IL","IL","IL","IL","MI","MI","MI","MI","MI","MN","MN","MN","MN","MN","WI","WI","WI","WI","WI"],"Hospital":["NORTHSHORE UNIVERSITY HEALTHSYSTEM - EVANSTON HOSPITAL","PALOS COMMUNITY HOSPITAL","NORTHWESTERN MEMORIAL HOSPITAL","ADVOCATE CHRIST HOSPITAL & MEDICAL CENTER","NORTHWESTERN MEDICINE MCHENRY","BEAUMONT HOSPITAL, TROY","BEAUMONT HOSPITAL ROYAL OAK","ASCENSION PROVIDENCE HOSPITAL, SOUTHFIELD AND NOVI","TRINITY HEALTH ANN ARBOR HOSPITAL","SPECTRUM HEALTH","MAYO CLINIC HOSPITAL ROCHESTER","ABBOTT NORTHWESTERN HOSPITAL","PARK NICOLLET METHODIST HOSPITAL","MERCY HOSPITAL","ST CLOUD HOSPITAL","AURORA ST LUKES MEDICAL CENTER","FROEDTERT MEMORIAL LUTHERAN HOSPITAL","UNIVERSITY OF WI  HOSPITALS & CLINICS AUTHORITY","WAUKESHA MEMORIAL HOSPITAL","MILWAUKEE VA MEDICAL CENTER"],"Cases":[2294,1436,1315,1287,1286,1683,1611,1191,1121,1065,1551,778,747,742,623,1362,621,609,605,604],"30-Day Readmission Rate":[0.212,0.214,0.187,0.202,0.177,0.21,0.2,0.206,0.191,0.172,0.173,0.189,0.213,0.176,0.18,0.188,0.195,0.219,0.171,0.222]},"columns":[{"id":"State","name":"State","type":"character"},{"id":"Hospital","name":"Hospital","type":"character"},{"id":"Cases","name":"Cases","type":"numeric","aggregate":"sum"},{"id":"30-Day Readmission Rate","name":"30-Day Readmission Rate","type":"numeric","aggregate":"function(values, rows) {\n          var numerator = 0\n          var denominator = 0\n    \n          rows.forEach(function(row, index) {\n            numerator += row['Cases'] * values[index]\n            denominator += row['Cases']\n          })\n    \n          return numerator / denominator\n  \n        }"}],"groupBy":["State"],"dataKey":"5e9b112b9cc6b7701b88b671ed5f3c82"},"children":[]},"class":"reactR_markup"},"evals":["tag.attribs.columns.3.aggregate"],"jsHooks":[]}</script>
</div>
</div>
<p>Now we have correctly calculated the state-level 30-day readmission rates.</p>
</section>
<section id="function2" class="level2">
<h2 class="anchored" data-anchor-id="function2">Function 2: Conditional coloring</h2>
<p>Suppose we would like to differentiate readmission rates in our table that are above or below the national average. To do this, we can define another JavaScript function and supply it to the <code>style</code> argument within <code>colDef</code>. First, lets pull in the comparison value.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">national_rate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">read_csv</span>(</span>
<span id="cb12-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">file =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/Users/alexzajichek/Documents/GitHub/Unplanned_Hospital_Visits-National.csv"</span>,</span>
<span id="cb12-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">na =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Not Available"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Not Applicable"</span>)</span>
<span id="cb12-5">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-6">  </span>
<span id="cb12-7">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Filter to the measure</span></span>
<span id="cb12-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(</span>
<span id="cb12-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Measure ID</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"READM_30_HF"</span></span>
<span id="cb12-10">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb12-11">  </span>
<span id="cb12-12">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Pull the rate</span></span>
<span id="cb12-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pull</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">National Rate</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span>)</span></code></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 14 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (4): Measure ID, Measure Name, Start Date, End Date
dbl (9): National Rate, Number of Hospitals Worse, Number of Hospitals Same,...
lgl (1): Footnote

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1">national_rate <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> national_rate <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb15-2">national_rate</span></code></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.198</code></pre>
</div>
</div>
<p>Next, lets define another <code>JS</code> function wrapped in an <code>R</code> function that takes the column to evaluate, the comparison value, and the colors to fill in the table cell when it is above or below (or the same as) that threshold. These arguments will feed into the JavaScript function that applies the specified HTML styling to each value in the column.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1">conditional_coloring <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb17-2">  <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">function</span>(column, threshold, color_above, color_below, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color_same =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#fcfffd"</span>) {</span>
<span id="cb17-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">JS</span>(</span>
<span id="cb17-4">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">paste0</span>(</span>
<span id="cb17-5">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"function(rowInfo) {</span></span>
<span id="cb17-6"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">          var value = rowInfo.row['"</span>, column, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"']</span></span>
<span id="cb17-7"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb17-8"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">          if(value &gt; "</span>, threshold, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">") {</span></span>
<span id="cb17-9"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            var color = '"</span>, color_above, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"'</span></span>
<span id="cb17-10"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">          } else if(value &lt; "</span>, threshold, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">") {</span></span>
<span id="cb17-11"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            var color = '"</span>, color_below, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"'</span></span>
<span id="cb17-12"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">          } else {</span></span>
<span id="cb17-13"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">            var color = '"</span>, color_same, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"'</span></span>
<span id="cb17-14"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">          }</span></span>
<span id="cb17-15"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb17-16"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">          return {background:color}</span></span>
<span id="cb17-17"><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">        }"</span></span>
<span id="cb17-18">      )</span>
<span id="cb17-19">    )</span>
<span id="cb17-20">  }</span></code></pre></div>
</details>
</div>
<p>We can now add it to the table:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">readmission_rates <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb18-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactable</span>(</span>
<span id="cb18-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">groupBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"State"</span>,</span>
<span id="cb18-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> </span>
<span id="cb18-5">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb18-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Cases =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span>),</span>
<span id="cb18-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">30-Day Readmission Rate</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb18-8">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(</span>
<span id="cb18-9">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">weighted_mean</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cases"</span>),</span>
<span id="cb18-10">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> </span>
<span id="cb18-11">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">conditional_coloring</span>(</span>
<span id="cb18-12">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">column =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"30-Day Readmission Rate"</span>,</span>
<span id="cb18-13">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">threshold =</span> national_rate,</span>
<span id="cb18-14">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color_above =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#eb7554"</span>,</span>
<span id="cb18-15">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color_below =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#54a637"</span></span>
<span id="cb18-16">              )</span>
<span id="cb18-17">          )</span>
<span id="cb18-18">      )</span>
<span id="cb18-19">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item" id="htmlwidget-5afd9e95b0cfe4deb740" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-5afd9e95b0cfe4deb740">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"State":["IL","IL","IL","IL","IL","MI","MI","MI","MI","MI","MN","MN","MN","MN","MN","WI","WI","WI","WI","WI"],"Hospital":["NORTHSHORE UNIVERSITY HEALTHSYSTEM - EVANSTON HOSPITAL","PALOS COMMUNITY HOSPITAL","NORTHWESTERN MEMORIAL HOSPITAL","ADVOCATE CHRIST HOSPITAL & MEDICAL CENTER","NORTHWESTERN MEDICINE MCHENRY","BEAUMONT HOSPITAL, TROY","BEAUMONT HOSPITAL ROYAL OAK","ASCENSION PROVIDENCE HOSPITAL, SOUTHFIELD AND NOVI","TRINITY HEALTH ANN ARBOR HOSPITAL","SPECTRUM HEALTH","MAYO CLINIC HOSPITAL ROCHESTER","ABBOTT NORTHWESTERN HOSPITAL","PARK NICOLLET METHODIST HOSPITAL","MERCY HOSPITAL","ST CLOUD HOSPITAL","AURORA ST LUKES MEDICAL CENTER","FROEDTERT MEMORIAL LUTHERAN HOSPITAL","UNIVERSITY OF WI  HOSPITALS & CLINICS AUTHORITY","WAUKESHA MEMORIAL HOSPITAL","MILWAUKEE VA MEDICAL CENTER"],"Cases":[2294,1436,1315,1287,1286,1683,1611,1191,1121,1065,1551,778,747,742,623,1362,621,609,605,604],"30-Day Readmission Rate":[0.212,0.214,0.187,0.202,0.177,0.21,0.2,0.206,0.191,0.172,0.173,0.189,0.213,0.176,0.18,0.188,0.195,0.219,0.171,0.222]},"columns":[{"id":"State","name":"State","type":"character"},{"id":"Hospital","name":"Hospital","type":"character"},{"id":"Cases","name":"Cases","type":"numeric","aggregate":"sum"},{"id":"30-Day Readmission Rate","name":"30-Day Readmission Rate","type":"numeric","aggregate":"function(values, rows) {\n          var numerator = 0\n          var denominator = 0\n    \n          rows.forEach(function(row, index) {\n            numerator += row['Cases'] * values[index]\n            denominator += row['Cases']\n          })\n    \n          return numerator / denominator\n  \n        }","style":"function(rowInfo) {\n          var value = rowInfo.row['30-Day Readmission Rate']\n    \n          if(value > 0.198) {\n            var color = '#eb7554'\n          } else if(value < 0.198) {\n            var color = '#54a637'\n          } else {\n            var color = '#fcfffd'\n          }\n    \n          return {background:color}\n        }"}],"groupBy":["State"],"dataKey":"a7c42174866e310a6b5cd1fb297a7220"},"children":[]},"class":"reactR_markup"},"evals":["tag.attribs.columns.3.aggregate","tag.attribs.columns.3.style"],"jsHooks":[]}</script>
</div>
</div>
<p>Note that the national 30-day readmission rate for heart failure patients on Medicare was 19.8%.</p>
</section>
<section id="finaltouches" class="level2">
<h2 class="anchored" data-anchor-id="finaltouches">Final touches</h2>
<p>Finally, let’s add a few finishing touches to really make the table pop.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">readmission_rates <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb19-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reactable</span>(</span>
<span id="cb19-3">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">groupBy =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"State"</span>,</span>
<span id="cb19-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> </span>
<span id="cb19-5">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">list</span>(</span>
<span id="cb19-6">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Cases =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sum"</span>),</span>
<span id="cb19-7">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span><span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">30-Day Readmission Rate</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">`</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> </span>
<span id="cb19-8">          <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colDef</span>(</span>
<span id="cb19-9">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">aggregate =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">weighted_mean</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">weight =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Cases"</span>),</span>
<span id="cb19-10">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">style =</span> </span>
<span id="cb19-11">              <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">conditional_coloring</span>(</span>
<span id="cb19-12">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">column =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"30-Day Readmission Rate"</span>,</span>
<span id="cb19-13">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">threshold =</span> national_rate,</span>
<span id="cb19-14">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color_above =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#eb7554"</span>,</span>
<span id="cb19-15">                <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color_below =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#54a637"</span></span>
<span id="cb19-16">              ),</span>
<span id="cb19-17">            <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">format =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">colFormat</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">percent =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span>
<span id="cb19-18">          )</span>
<span id="cb19-19">      ),</span>
<span id="cb19-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">striped =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb19-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">highlight =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb19-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">bordered =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb19-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">resizable =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb19-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">theme =</span> reactablefmtr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">sandstone</span>()</span>
<span id="cb19-25">  )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div class="reactable html-widget html-fill-item" id="htmlwidget-7ec32b979b9fa3b5728e" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7ec32b979b9fa3b5728e">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"State":["IL","IL","IL","IL","IL","MI","MI","MI","MI","MI","MN","MN","MN","MN","MN","WI","WI","WI","WI","WI"],"Hospital":["NORTHSHORE UNIVERSITY HEALTHSYSTEM - EVANSTON HOSPITAL","PALOS COMMUNITY HOSPITAL","NORTHWESTERN MEMORIAL HOSPITAL","ADVOCATE CHRIST HOSPITAL & MEDICAL CENTER","NORTHWESTERN MEDICINE MCHENRY","BEAUMONT HOSPITAL, TROY","BEAUMONT HOSPITAL ROYAL OAK","ASCENSION PROVIDENCE HOSPITAL, SOUTHFIELD AND NOVI","TRINITY HEALTH ANN ARBOR HOSPITAL","SPECTRUM HEALTH","MAYO CLINIC HOSPITAL ROCHESTER","ABBOTT NORTHWESTERN HOSPITAL","PARK NICOLLET METHODIST HOSPITAL","MERCY HOSPITAL","ST CLOUD HOSPITAL","AURORA ST LUKES MEDICAL CENTER","FROEDTERT MEMORIAL LUTHERAN HOSPITAL","UNIVERSITY OF WI  HOSPITALS & CLINICS AUTHORITY","WAUKESHA MEMORIAL HOSPITAL","MILWAUKEE VA MEDICAL CENTER"],"Cases":[2294,1436,1315,1287,1286,1683,1611,1191,1121,1065,1551,778,747,742,623,1362,621,609,605,604],"30-Day Readmission Rate":[0.212,0.214,0.187,0.202,0.177,0.21,0.2,0.206,0.191,0.172,0.173,0.189,0.213,0.176,0.18,0.188,0.195,0.219,0.171,0.222]},"columns":[{"id":"State","name":"State","type":"character"},{"id":"Hospital","name":"Hospital","type":"character"},{"id":"Cases","name":"Cases","type":"numeric","aggregate":"sum"},{"id":"30-Day Readmission Rate","name":"30-Day Readmission Rate","type":"numeric","aggregate":"function(values, rows) {\n          var numerator = 0\n          var denominator = 0\n    \n          rows.forEach(function(row, index) {\n            numerator += row['Cases'] * values[index]\n            denominator += row['Cases']\n          })\n    \n          return numerator / denominator\n  \n        }","format":{"cell":{"digits":2,"percent":true},"aggregated":{"digits":2,"percent":true}},"style":"function(rowInfo) {\n          var value = rowInfo.row['30-Day Readmission Rate']\n    \n          if(value > 0.198) {\n            var color = '#eb7554'\n          } else if(value < 0.198) {\n            var color = '#54a637'\n          } else {\n            var color = '#fcfffd'\n          }\n    \n          return {background:color}\n        }"}],"groupBy":["State"],"resizable":true,"highlight":true,"bordered":true,"striped":true,"theme":{"color":"#3e3f3a","backgroundColor":"#ffffff","borderColor":"#f8f5f0","borderWidth":"1px","stripedColor":"#ededed","highlightColor":"#f8f5f0","cellPadding":6,"tableStyle":{"fontSize":15},"headerStyle":{"borderWidth":"2px","backgroundColor":"#f8f5f0","color":"#7c7a78","transitionDuration":"0.5s","&:hover[aria-sort]":{"color":"#000000"},"&[aria-sort='ascending'], &[aria-sort='descending']":{"color":"#000000"},"fontSize":16},"groupHeaderStyle":{"&:not(:empty)":{"color":"#3e3f3a","fontSize":16},"&:hover":{"fontWeight":"bold","transitionDuration":"1s","transitionTimingFunction":"ease-out","color":"#000000"}},"rowSelectedStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"inputStyle":{"backgroundColor":"#ffffff","borderColor":"#bcbfc1","color":"#3e3f3a"},"searchInputStyle":{"backgroundColor":"#ffffff","color":"#3e3f3a","borderColor":"#bcbfc1","&:focus":{"color":"#3e3f3a"}},"selectStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84","borderColor":"#ffffff","outlineColor":"#ffffff"},"pageButtonStyle":{"backgroundColor":"#f8f5f0","color":"#8e8c84","&:hover":{"backgroundColor":"#f3969a","color":"#8e8c84"}},"pageButtonHoverStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"pageButtonActiveStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"},"pageButtonCurrentStyle":{"backgroundColor":"#dfd7ca","color":"#8e8c84"}},"dataKey":"786601595b84f910a533a8723f1339ee"},"children":[]},"class":"reactR_markup"},"evals":["tag.attribs.columns.3.aggregate","tag.attribs.columns.3.style"],"jsHooks":[]}</script>
</div>
</div>


<!-- -->

</section>
</section>

 ]]></description>
  <category>Healthcare</category>
  <category>Tables</category>
  <category>Javascript</category>
  <guid>https://www.zajichekstats.com/post/reactable-javascript/</guid>
  <pubDate>Sun, 31 Jul 2022 05:00:00 GMT</pubDate>
  <media:content url="https://www.zajichekstats.com/post/reactable-javascript/feature.png" medium="image" type="image/png" height="143" width="144"/>
</item>
</channel>
</rss>
