---
title: Ordering dimensions within facets with {ggplot2}
subtitle: A look at Medicare spending in WI counties
author: R package build
date: '2022-11-29'
slug: ordering-dimensions-within-facets-in-ggplot2
categories: []
tags: []
summary: ''
authors: []
lastmod: '2022-11-29T11:09:28-06:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---

**In progress**

Over the years I've found myself frequently wanting to rank a dimension _within_ facets in a single [`ggplot`](https://ggplot2.tidyverse.org/). The `reorder_within` function (a [`ggplot`](https://ggplot2.tidyverse.org/) add-on) is a hidden gem within the [`tidytext`](https://cran.r-project.org/web/packages/tidytext/index.html) package and has been my go-to solution for this task. This article goes through an example of creating such a plot for Medicare spending in Wisconsin counties. First, lets load some packages:

```{r}
require(tidyverse)
```

# Table of Contents

1. [Building the dataset](#buildingthedataset)
  * [Extract Medicare spending](#extractspending)
  * [Extract hospital details](#extracthospital)
  * [Synthesize for plotting](#synthesize)

# 1. Building the dataset {#buildingthedataset}

The objective here is going to be to display the top and bottom five (5) Wisconsin counties in terms of relative [Medicare](https://www.cms.gov/)) spending for a few different categories. The source for all data used is the [CMS Provider Data Catalog](https://data.cms.gov/provider-data/).

## Extract Medicare spending {#extractspending}

The core dataset (described [here](https://data.cms.gov/provider-data/dataset/nrth-mfg3)) contains a listing of Medicare spending for U.S. hospitals by various claim types. We can import it directly with [`readr:read_csv`](https://readr.tidyverse.org/reference/read_delim.html):

```{r}
# Link copied from 'Download full dataset'
medicare_spend <-
  read_csv(
    file = "https://data.cms.gov/provider-data/sites/default/files/resources/baae89c939191d1ccb76feb4f9382234_1665414667/Medicare_Hospital_Spending_by_Claim.csv"
  )
medicare_spend
```

## Extract hospital details {#extracthospital}

The county that the hospital resides is not located in the [spending file](#extractspending). Therefore, we'll need an additional look-up file (described [here](https://data.cms.gov/provider-data/dataset/xubh-q36u)) that we can tie back in.

```{r}
# Link copied from 'Download full dataset'
hospital_information <-
  read_csv(
    file = "https://data.cms.gov/provider-data/sites/default/files/resources/092256becd267d9eeccf73bf7d16c46b_1666224317/Hospital_General_Information.csv"
  )
hospital_information
```

## Synthesize for plotting {#synthesize}

We can now take some steps to creating the plot-ready dataset.

### i. Filter to WI hospitals

```{r}
hospital_information %>%
  
  # Filter to Wisconsin
  filter(
    State == "WI"
  ) %>%
  
  # Keep a couple columns
  select(
    HospitalID = `Facility ID`,
    Hospital = `Facility Name`,
    County = `County Name`
  ) %>%
  
  # Keep the first letter capitalized only
  mutate(
    County = str_c(str_sub(County, 1, 1), tolower(str_sub(County, 2)))
  )
```



