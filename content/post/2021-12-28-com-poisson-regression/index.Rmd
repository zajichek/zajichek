---
title: Exploring COM Poisson Regression
subtitle: A method for underdispersed count data
author: Alex Zajichek
date: '2021-12-28'
slug: com-poisson-regression
categories: []
tags: []
summary: ''
authors: []
lastmod: '2021-12-28T06:53:32-06:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---

$$\Large \it \text {In Progress}$$
A few years ago I encountered an interesting count distribution at work during a modeling project. The goal was to model the number of [suture anchors](https://www.shoulderdoc.co.uk/article/538) used in rotator-cuff tendon tears, and how that was influenced by tear characteristics and surgeon preference. Typically the instinct would be to fit a standard [Poisson](https://en.wikipedia.org/wiki/Poisson_distribution) model, but the target (i.e., the # of anchors) took on relatively small values and was also non-zero, so I had to do some digging for alternative methods. I came across a method called Conway-Maxwell (COM) Poisson regression, which not only allowed for _overdispersion_ (i.e., the population variance is _greater_ than its mean), but also _underdispersion_. I had never really come across methodology for the latter and it seemed to fit my problem, so I was intrigued (FD: I also had heard of COM-Poisson, albeit knew nothing about it, prior when one of my super smart graduate school buddies was doing research on it, so that's partially why it stuck). 

Ultimately, we didn't end up using it for the [anchor project](https://www.jshoulderelbow.org/article/S1058-2746(18)30555-X/fulltext) `r emo::ji("grin")`, and instead went in favor of [Zero-Truncated Poisson regression](https://stats.oarc.ucla.edu/r/dae/zero-truncated-poisson/). Nevertheless I thought the COM-Poisson model was an awesome method that warranted further exploration and later did a [talk](NonTraditionalCountRegression.pdf) on it. That was a few years ago--so this article is meant to be a reworking of that talk as a way to re-learn it for myself, but also to get the word out to you about this awesome method!

# A brief review of Poisson regression

The Poisson distribution is used to model a count of the occurrences of some event __Y__, generally in a fixed amount of time (e.g., the number of patients entering the emergency department _per day_), thus, it can be interpreted as a rate. More formally, if the probability mass function (PMF) for a non-negative, integer-valued __Y__ is:

$$P(Y = y|\lambda) = \frac{e^{-\lambda}\lambda^y}{y!}$$
then __Y__ is distributed as a Poisson random variable, which implies the following crucial assumption:

$$E[Y] = Var[Y] = \lambda$$
Namely, the population average number of events is equal to its variance. Here is a look at the distribution of a number of simulated Poisson random variables for increasing $\lambda$:

```{r}

# Load the tidyverse!
require(tidyverse)

# Set a seed 
set.seed(123)

# Number of samples
n <- 10000

# Grid of lambdas
lambda_grid <- c(0.5, 1, 2, 4, 8, 15, 25, 50, 100)

lambda_grid %>%
  
  # For each lambda
  map_df(
    ~
      tibble(
        lambda = .x,
        y = rpois(n = n, lambda = .x)
      )
  ) %>%
  
  # Make facet labels; maintain ordering
  mutate(
    lambda = 
      lambda %>%
      factor() %>%
      fct_relabel(
        ~paste0("lambda==", .x),
      )
  ) %>%
  
  # Make a plot
  ggplot() +
  geom_histogram(
    aes(
      x = y,
      fill = lambda
    )
  ) +
  facet_wrap(
    ~lambda,
    label = "label_parsed",
    scales = "free_x"
  ) +
  xlab("Y = y") +
  ylab("Count") +
  theme(
    legend.position = "none",
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 12),
    strip.text = element_text(size = 12),
    panel.background = element_blank(),
    panel.grid.major.y = element_line(color = "gray")
  )

```

For small $\lambda$, __Y__ takes on a relatively small number of (small) values and appears right-skewed. As $\lambda$ increases, the distribution becomes much more symmetric and "organized", partially because the standard deviation is decreasing relative to the mean.

## How does the regression model work?

Just like other [generalized linear models](https://en.wikipedia.org/wiki/Generalized_linear_model) (GLM), in a Poisson regression model, we want to estimate the population average (the same average as described above), but conditioned on a given set of covariates. 

Suppose we have a collection of covariates $x_1, x_2, .., x_p$, then we can assume the following functional form:

$$log(\lambda_i) = \beta_0 + \beta_1x_{i1} + \beta_2x_{i2}+...+\beta_px_{ip}$$
This _log-linear_ model then allows us to estimate the average number of events (i.e., the Poisson parameter) for a given arrangement of covariate values. We also get informative interpretation of the individual effects of each covariate. For example, if we look at the resulting $\lambda$ estimation for increasing $x_1$ by 1 unit, assuming all other covariates are the same, we get:

$$$$

$$$$

To estimate the parameters, we can plug this equation into the Poisson PMF:

$$$$P(Y_i = y_i|\lambda_) $$


If $\lambda$ is large, it can be reasonable to get away with a ordinary least-squares model.




* COM Poisson distribution, generalizes Poisson
* Modeling different dispersions by groups
* Zero inflated COM Poisson
* Number of re-admissions in 30 day period

```{r}
# Load required packages
require(COMPoissonReg)
```

